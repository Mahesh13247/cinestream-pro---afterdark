var BE=s=>{throw TypeError(s)};var p0=(s,e,t)=>e.has(s)||BE("Cannot "+t);var re=(s,e,t)=>(p0(s,e,"read from private field"),t?t.call(s):e.get(s)),ze=(s,e,t)=>e.has(s)?BE("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),we=(s,e,t,i)=>(p0(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t),ms=(s,e,t)=>(p0(s,e,"access private method"),t);var kc=(s,e,t,i)=>({set _(a){we(s,e,a,t)},get _(){return re(s,e,i)}});import{a as B3,b as F3,g as cy,r as ie,j as b,u as ro,c as j3,L as gt,N as dy,d as Fd,e as H3,H as $3,R as G3,f as cs,h as V3}from"./vendor-jT0EeZjH.js";import{a as Li}from"./utils-B9ygI19o.js";import{S as Fl,a as bu,b as q3,M as Y3,U as jl,L as nm,X as iu,c as K3,P as Yi,d as ys,T as Nl,I as hd,C as z3,e as md,G as fy,A as qm,f as pa,g as FE,h as Za,O as Q3,E as eu,F as hy,i as In,j as am,k as Hl,H as rm,l as gd,m as Ym,n as X3,o as jE,p as HE,q as W3,r as Z3,K as J3,s as e_,R as t_,t as s_,u as i_}from"./ui-BbP9IpHw.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const l of u.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(a){if(a.ep)return;a.ep=!0;const u=t(a);fetch(a.href,u)}})();var b0={exports:{}},Tl={},E0={exports:{}},x0={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $E;function n_(){return $E||($E=1,(function(s){function e(B,W){var te=B.length;B.push(W);e:for(;0<te;){var J=te-1>>>1,pe=B[J];if(0<a(pe,W))B[J]=W,B[te]=pe,te=J;else break e}}function t(B){return B.length===0?null:B[0]}function i(B){if(B.length===0)return null;var W=B[0],te=B.pop();if(te!==W){B[0]=te;e:for(var J=0,pe=B.length,fe=pe>>>1;J<fe;){var ce=2*(J+1)-1,xe=B[ce],Ce=ce+1,Ne=B[Ce];if(0>a(xe,te))Ce<pe&&0>a(Ne,xe)?(B[J]=Ne,B[Ce]=te,J=Ce):(B[J]=xe,B[ce]=te,J=ce);else if(Ce<pe&&0>a(Ne,te))B[J]=Ne,B[Ce]=te,J=Ce;else break e}}return W}function a(B,W){var te=B.sortIndex-W.sortIndex;return te!==0?te:B.id-W.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;s.unstable_now=function(){return u.now()}}else{var l=Date,c=l.now();s.unstable_now=function(){return l.now()-c}}var f=[],h=[],m=1,g=null,E=3,T=!1,v=!1,S=!1,A=!1,I=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,N=typeof setImmediate<"u"?setImmediate:null;function D(B){for(var W=t(h);W!==null;){if(W.callback===null)i(h);else if(W.startTime<=B)i(h),W.sortIndex=W.expirationTime,e(f,W);else break;W=t(h)}}function k(B){if(S=!1,D(B),!v)if(t(f)!==null)v=!0,G||(G=!0,me());else{var W=t(h);W!==null&&ne(k,W.startTime-B)}}var G=!1,U=-1,H=5,$=-1;function F(){return A?!0:!(s.unstable_now()-$<H)}function ee(){if(A=!1,G){var B=s.unstable_now();$=B;var W=!0;try{e:{v=!1,S&&(S=!1,R(U),U=-1),T=!0;var te=E;try{t:{for(D(B),g=t(f);g!==null&&!(g.expirationTime>B&&F());){var J=g.callback;if(typeof J=="function"){g.callback=null,E=g.priorityLevel;var pe=J(g.expirationTime<=B);if(B=s.unstable_now(),typeof pe=="function"){g.callback=pe,D(B),W=!0;break t}g===t(f)&&i(f),D(B)}else i(f);g=t(f)}if(g!==null)W=!0;else{var fe=t(h);fe!==null&&ne(k,fe.startTime-B),W=!1}}break e}finally{g=null,E=te,T=!1}W=void 0}}finally{W?me():G=!1}}}var me;if(typeof N=="function")me=function(){N(ee)};else if(typeof MessageChannel<"u"){var be=new MessageChannel,Te=be.port2;be.port1.onmessage=ee,me=function(){Te.postMessage(null)}}else me=function(){I(ee,0)};function ne(B,W){U=I(function(){B(s.unstable_now())},W)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(B){B.callback=null},s.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<B?Math.floor(1e3/B):5},s.unstable_getCurrentPriorityLevel=function(){return E},s.unstable_next=function(B){switch(E){case 1:case 2:case 3:var W=3;break;default:W=E}var te=E;E=W;try{return B()}finally{E=te}},s.unstable_requestPaint=function(){A=!0},s.unstable_runWithPriority=function(B,W){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var te=E;E=B;try{return W()}finally{E=te}},s.unstable_scheduleCallback=function(B,W,te){var J=s.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?J+te:J):te=J,B){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=te+pe,B={id:m++,callback:W,priorityLevel:B,startTime:te,expirationTime:pe,sortIndex:-1},te>J?(B.sortIndex=te,e(h,B),t(f)===null&&B===t(h)&&(S?(R(U),U=-1):S=!0,ne(k,te-J))):(B.sortIndex=pe,e(f,B),v||T||(v=!0,G||(G=!0,me()))),B},s.unstable_shouldYield=F,s.unstable_wrapCallback=function(B){var W=E;return function(){var te=E;E=W;try{return B.apply(this,arguments)}finally{E=te}}}})(x0)),x0}var GE;function a_(){return GE||(GE=1,E0.exports=n_()),E0.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VE;function r_(){if(VE)return Tl;VE=1;var s=a_(),e=B3(),t=F3();function i(n){var r="https://react.dev/errors/"+n;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)r+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+n+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function u(n){var r=n,o=n;if(n.alternate)for(;r.return;)r=r.return;else{n=r;do r=n,(r.flags&4098)!==0&&(o=r.return),n=r.return;while(n)}return r.tag===3?o:null}function l(n){if(n.tag===13){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function c(n){if(n.tag===31){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function f(n){if(u(n)!==n)throw Error(i(188))}function h(n){var r=n.alternate;if(!r){if(r=u(n),r===null)throw Error(i(188));return r!==n?null:n}for(var o=n,d=r;;){var p=o.return;if(p===null)break;var x=p.alternate;if(x===null){if(d=p.return,d!==null){o=d;continue}break}if(p.child===x.child){for(x=p.child;x;){if(x===o)return f(p),n;if(x===d)return f(p),r;x=x.sibling}throw Error(i(188))}if(o.return!==d.return)o=p,d=x;else{for(var _=!1,C=p.child;C;){if(C===o){_=!0,o=p,d=x;break}if(C===d){_=!0,d=p,o=x;break}C=C.sibling}if(!_){for(C=x.child;C;){if(C===o){_=!0,o=x,d=p;break}if(C===d){_=!0,d=x,o=p;break}C=C.sibling}if(!_)throw Error(i(189))}}if(o.alternate!==d)throw Error(i(190))}if(o.tag!==3)throw Error(i(188));return o.stateNode.current===o?n:r}function m(n){var r=n.tag;if(r===5||r===26||r===27||r===6)return n;for(n=n.child;n!==null;){if(r=m(n),r!==null)return r;n=n.sibling}return null}var g=Object.assign,E=Symbol.for("react.element"),T=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),R=Symbol.for("react.consumer"),N=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),H=Symbol.for("react.lazy"),$=Symbol.for("react.activity"),F=Symbol.for("react.memo_cache_sentinel"),ee=Symbol.iterator;function me(n){return n===null||typeof n!="object"?null:(n=ee&&n[ee]||n["@@iterator"],typeof n=="function"?n:null)}var be=Symbol.for("react.client.reference");function Te(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===be?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case S:return"Fragment";case I:return"Profiler";case A:return"StrictMode";case k:return"Suspense";case G:return"SuspenseList";case $:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case v:return"Portal";case N:return n.displayName||"Context";case R:return(n._context.displayName||"Context")+".Consumer";case D:var r=n.render;return n=n.displayName,n||(n=r.displayName||r.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case U:return r=n.displayName||null,r!==null?r:Te(n.type)||"Memo";case H:r=n._payload,n=n._init;try{return Te(n(r))}catch{}}return null}var ne=Array.isArray,B=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},J=[],pe=-1;function fe(n){return{current:n}}function ce(n){0>pe||(n.current=J[pe],J[pe]=null,pe--)}function xe(n,r){pe++,J[pe]=n.current,n.current=r}var Ce=fe(null),Ne=fe(null),Me=fe(null),It=fe(null);function yt(n,r){switch(xe(Me,r),xe(Ne,n),xe(Ce,null),r.nodeType){case 9:case 11:n=(n=r.documentElement)&&(n=n.namespaceURI)?uE(n):0;break;default:if(n=r.tagName,r=r.namespaceURI)r=uE(r),n=lE(r,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}ce(Ce),xe(Ce,n)}function Vt(){ce(Ce),ce(Ne),ce(Me)}function Ss(n){n.memoizedState!==null&&xe(It,n);var r=Ce.current,o=lE(r,n.type);r!==o&&(xe(Ne,n),xe(Ce,o))}function ei(n){Ne.current===n&&(ce(Ce),ce(Ne)),It.current===n&&(ce(It),pl._currentValue=te)}var _u,lr;function pi(n){if(_u===void 0)try{throw Error()}catch(o){var r=o.stack.trim().match(/\n( *(at )?)/);_u=r&&r[1]||"",lr=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+_u+n+lr}var mo=!1;function Ve(n,r){if(!n||mo)return"";mo=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(r){var oe=function(){throw Error()};if(Object.defineProperty(oe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(oe,[])}catch(Z){var X=Z}Reflect.construct(n,[],oe)}else{try{oe.call()}catch(Z){X=Z}n.call(oe.prototype)}}else{try{throw Error()}catch(Z){X=Z}(oe=n())&&typeof oe.catch=="function"&&oe.catch(function(){})}}catch(Z){if(Z&&X&&typeof Z.stack=="string")return[Z.stack,X.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=d.DetermineComponentFrameRoot(),_=x[0],C=x[1];if(_&&C){var P=_.split(`
`),Q=C.split(`
`);for(p=d=0;d<P.length&&!P[d].includes("DetermineComponentFrameRoot");)d++;for(;p<Q.length&&!Q[p].includes("DetermineComponentFrameRoot");)p++;if(d===P.length||p===Q.length)for(d=P.length-1,p=Q.length-1;1<=d&&0<=p&&P[d]!==Q[p];)p--;for(;1<=d&&0<=p;d--,p--)if(P[d]!==Q[p]){if(d!==1||p!==1)do if(d--,p--,0>p||P[d]!==Q[p]){var ae=`
`+P[d].replace(" at new "," at ");return n.displayName&&ae.includes("<anonymous>")&&(ae=ae.replace("<anonymous>",n.displayName)),ae}while(1<=d&&0<=p);break}}}finally{mo=!1,Error.prepareStackTrace=o}return(o=n?n.displayName||n.name:"")?pi(o):""}function Qt(n,r){switch(n.tag){case 26:case 27:case 5:return pi(n.type);case 16:return pi("Lazy");case 13:return n.child!==r&&r!==null?pi("Suspense Fallback"):pi("Suspense");case 19:return pi("SuspenseList");case 0:case 15:return Ve(n.type,!1);case 11:return Ve(n.type.render,!1);case 1:return Ve(n.type,!0);case 31:return pi("Activity");default:return""}}function ps(n){try{var r="",o=null;do r+=Qt(n,o),o=n,n=n.return;while(n);return r}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var bi=Object.prototype.hasOwnProperty,bs=s.unstable_scheduleCallback,Ri=s.unstable_cancelCallback,Xi=s.unstable_shouldYield,go=s.unstable_requestPaint,Xt=s.unstable_now,po=s.unstable_getCurrentPriorityLevel,Rn=s.unstable_ImmediatePriority,Lu=s.unstable_UserBlockingPriority,or=s.unstable_NormalPriority,bo=s.unstable_LowPriority,Iu=s.unstable_IdlePriority,va=s.log,yS=s.unstable_setDisableYieldValue,Ru=null,Fs=null;function Nn(n){if(typeof va=="function"&&yS(n),Fs&&typeof Fs.setStrictMode=="function")try{Fs.setStrictMode(Ru,n)}catch{}}var js=Math.clz32?Math.clz32:AS,vS=Math.log,SS=Math.LN2;function AS(n){return n>>>=0,n===0?32:31-(vS(n)/SS|0)|0}var Eo=256,xo=262144,To=4194304;function Sa(n){var r=n&42;if(r!==0)return r;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function yo(n,r,o){var d=n.pendingLanes;if(d===0)return 0;var p=0,x=n.suspendedLanes,_=n.pingedLanes;n=n.warmLanes;var C=d&134217727;return C!==0?(d=C&~x,d!==0?p=Sa(d):(_&=C,_!==0?p=Sa(_):o||(o=C&~n,o!==0&&(p=Sa(o))))):(C=d&~x,C!==0?p=Sa(C):_!==0?p=Sa(_):o||(o=d&~n,o!==0&&(p=Sa(o)))),p===0?0:r!==0&&r!==p&&(r&x)===0&&(x=p&-p,o=r&-r,x>=o||x===32&&(o&4194048)!==0)?r:p}function Nu(n,r){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&r)===0}function _S(n,r){switch(n){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $g(){var n=To;return To<<=1,(To&62914560)===0&&(To=4194304),n}function nf(n){for(var r=[],o=0;31>o;o++)r.push(n);return r}function Cu(n,r){n.pendingLanes|=r,r!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function LS(n,r,o,d,p,x){var _=n.pendingLanes;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=o,n.entangledLanes&=o,n.errorRecoveryDisabledLanes&=o,n.shellSuspendCounter=0;var C=n.entanglements,P=n.expirationTimes,Q=n.hiddenUpdates;for(o=_&~o;0<o;){var ae=31-js(o),oe=1<<ae;C[ae]=0,P[ae]=-1;var X=Q[ae];if(X!==null)for(Q[ae]=null,ae=0;ae<X.length;ae++){var Z=X[ae];Z!==null&&(Z.lane&=-536870913)}o&=~oe}d!==0&&Gg(n,d,0),x!==0&&p===0&&n.tag!==0&&(n.suspendedLanes|=x&~(_&~r))}function Gg(n,r,o){n.pendingLanes|=r,n.suspendedLanes&=~r;var d=31-js(r);n.entangledLanes|=r,n.entanglements[d]=n.entanglements[d]|1073741824|o&261930}function Vg(n,r){var o=n.entangledLanes|=r;for(n=n.entanglements;o;){var d=31-js(o),p=1<<d;p&r|n[d]&r&&(n[d]|=r),o&=~p}}function qg(n,r){var o=r&-r;return o=(o&42)!==0?1:af(o),(o&(n.suspendedLanes|r))!==0?0:o}function af(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function rf(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function Yg(){var n=W.p;return n!==0?n:(n=window.event,n===void 0?32:DE(n.type))}function Kg(n,r){var o=W.p;try{return W.p=n,r()}finally{W.p=o}}var Cn=Math.random().toString(36).slice(2),as="__reactFiber$"+Cn,As="__reactProps$"+Cn,cr="__reactContainer$"+Cn,uf="__reactEvents$"+Cn,IS="__reactListeners$"+Cn,RS="__reactHandles$"+Cn,zg="__reactResources$"+Cn,Du="__reactMarker$"+Cn;function lf(n){delete n[as],delete n[As],delete n[uf],delete n[IS],delete n[RS]}function dr(n){var r=n[as];if(r)return r;for(var o=n.parentNode;o;){if(r=o[cr]||o[as]){if(o=r.alternate,r.child!==null||o!==null&&o.child!==null)for(n=gE(n);n!==null;){if(o=n[as])return o;n=gE(n)}return r}n=o,o=n.parentNode}return null}function fr(n){if(n=n[as]||n[cr]){var r=n.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return n}return null}function Ou(n){var r=n.tag;if(r===5||r===26||r===27||r===6)return n.stateNode;throw Error(i(33))}function hr(n){var r=n[zg];return r||(r=n[zg]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function Wt(n){n[Du]=!0}var Qg=new Set,Xg={};function Aa(n,r){mr(n,r),mr(n+"Capture",r)}function mr(n,r){for(Xg[n]=r,n=0;n<r.length;n++)Qg.add(r[n])}var NS=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Wg={},Zg={};function CS(n){return bi.call(Zg,n)?!0:bi.call(Wg,n)?!1:NS.test(n)?Zg[n]=!0:(Wg[n]=!0,!1)}function vo(n,r,o){if(CS(r))if(o===null)n.removeAttribute(r);else{switch(typeof o){case"undefined":case"function":case"symbol":n.removeAttribute(r);return;case"boolean":var d=r.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){n.removeAttribute(r);return}}n.setAttribute(r,""+o)}}function So(n,r,o){if(o===null)n.removeAttribute(r);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(r);return}n.setAttribute(r,""+o)}}function Wi(n,r,o,d){if(d===null)n.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(o);return}n.setAttributeNS(r,o,""+d)}}function ti(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Jg(n){var r=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function DS(n,r,o){var d=Object.getOwnPropertyDescriptor(n.constructor.prototype,r);if(!n.hasOwnProperty(r)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var p=d.get,x=d.set;return Object.defineProperty(n,r,{configurable:!0,get:function(){return p.call(this)},set:function(_){o=""+_,x.call(this,_)}}),Object.defineProperty(n,r,{enumerable:d.enumerable}),{getValue:function(){return o},setValue:function(_){o=""+_},stopTracking:function(){n._valueTracker=null,delete n[r]}}}}function of(n){if(!n._valueTracker){var r=Jg(n)?"checked":"value";n._valueTracker=DS(n,r,""+n[r])}}function ep(n){if(!n)return!1;var r=n._valueTracker;if(!r)return!0;var o=r.getValue(),d="";return n&&(d=Jg(n)?n.checked?"true":"false":n.value),n=d,n!==o?(r.setValue(n),!0):!1}function Ao(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var OS=/[\n"\\]/g;function si(n){return n.replace(OS,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function cf(n,r,o,d,p,x,_,C){n.name="",_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"?n.type=_:n.removeAttribute("type"),r!=null?_==="number"?(r===0&&n.value===""||n.value!=r)&&(n.value=""+ti(r)):n.value!==""+ti(r)&&(n.value=""+ti(r)):_!=="submit"&&_!=="reset"||n.removeAttribute("value"),r!=null?df(n,_,ti(r)):o!=null?df(n,_,ti(o)):d!=null&&n.removeAttribute("value"),p==null&&x!=null&&(n.defaultChecked=!!x),p!=null&&(n.checked=p&&typeof p!="function"&&typeof p!="symbol"),C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"?n.name=""+ti(C):n.removeAttribute("name")}function tp(n,r,o,d,p,x,_,C){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(n.type=x),r!=null||o!=null){if(!(x!=="submit"&&x!=="reset"||r!=null)){of(n);return}o=o!=null?""+ti(o):"",r=r!=null?""+ti(r):o,C||r===n.value||(n.value=r),n.defaultValue=r}d=d??p,d=typeof d!="function"&&typeof d!="symbol"&&!!d,n.checked=C?n.checked:!!d,n.defaultChecked=!!d,_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(n.name=_),of(n)}function df(n,r,o){r==="number"&&Ao(n.ownerDocument)===n||n.defaultValue===""+o||(n.defaultValue=""+o)}function gr(n,r,o,d){if(n=n.options,r){r={};for(var p=0;p<o.length;p++)r["$"+o[p]]=!0;for(o=0;o<n.length;o++)p=r.hasOwnProperty("$"+n[o].value),n[o].selected!==p&&(n[o].selected=p),p&&d&&(n[o].defaultSelected=!0)}else{for(o=""+ti(o),r=null,p=0;p<n.length;p++){if(n[p].value===o){n[p].selected=!0,d&&(n[p].defaultSelected=!0);return}r!==null||n[p].disabled||(r=n[p])}r!==null&&(r.selected=!0)}}function sp(n,r,o){if(r!=null&&(r=""+ti(r),r!==n.value&&(n.value=r),o==null)){n.defaultValue!==r&&(n.defaultValue=r);return}n.defaultValue=o!=null?""+ti(o):""}function ip(n,r,o,d){if(r==null){if(d!=null){if(o!=null)throw Error(i(92));if(ne(d)){if(1<d.length)throw Error(i(93));d=d[0]}o=d}o==null&&(o=""),r=o}o=ti(r),n.defaultValue=o,d=n.textContent,d===o&&d!==""&&d!==null&&(n.value=d),of(n)}function pr(n,r){if(r){var o=n.firstChild;if(o&&o===n.lastChild&&o.nodeType===3){o.nodeValue=r;return}}n.textContent=r}var wS=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function np(n,r,o){var d=r.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?d?n.setProperty(r,""):r==="float"?n.cssFloat="":n[r]="":d?n.setProperty(r,o):typeof o!="number"||o===0||wS.has(r)?r==="float"?n.cssFloat=o:n[r]=(""+o).trim():n[r]=o+"px"}function ap(n,r,o){if(r!=null&&typeof r!="object")throw Error(i(62));if(n=n.style,o!=null){for(var d in o)!o.hasOwnProperty(d)||r!=null&&r.hasOwnProperty(d)||(d.indexOf("--")===0?n.setProperty(d,""):d==="float"?n.cssFloat="":n[d]="");for(var p in r)d=r[p],r.hasOwnProperty(p)&&o[p]!==d&&np(n,p,d)}else for(var x in r)r.hasOwnProperty(x)&&np(n,x,r[x])}function ff(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kS=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),MS=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function _o(n){return MS.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function Zi(){}var hf=null;function mf(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var br=null,Er=null;function rp(n){var r=fr(n);if(r&&(n=r.stateNode)){var o=n[As]||null;e:switch(n=r.stateNode,r.type){case"input":if(cf(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),r=o.name,o.type==="radio"&&r!=null){for(o=n;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+si(""+r)+'"][type="radio"]'),r=0;r<o.length;r++){var d=o[r];if(d!==n&&d.form===n.form){var p=d[As]||null;if(!p)throw Error(i(90));cf(d,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(r=0;r<o.length;r++)d=o[r],d.form===n.form&&ep(d)}break e;case"textarea":sp(n,o.value,o.defaultValue);break e;case"select":r=o.value,r!=null&&gr(n,!!o.multiple,r,!1)}}}var gf=!1;function up(n,r,o){if(gf)return n(r,o);gf=!0;try{var d=n(r);return d}finally{if(gf=!1,(br!==null||Er!==null)&&(fc(),br&&(r=br,n=Er,Er=br=null,rp(r),n)))for(r=0;r<n.length;r++)rp(n[r])}}function wu(n,r){var o=n.stateNode;if(o===null)return null;var d=o[As]||null;if(d===null)return null;o=d[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(n=n.type,d=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!d;break e;default:n=!1}if(n)return null;if(o&&typeof o!="function")throw Error(i(231,r,typeof o));return o}var Ji=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),pf=!1;if(Ji)try{var ku={};Object.defineProperty(ku,"passive",{get:function(){pf=!0}}),window.addEventListener("test",ku,ku),window.removeEventListener("test",ku,ku)}catch{pf=!1}var Dn=null,bf=null,Lo=null;function lp(){if(Lo)return Lo;var n,r=bf,o=r.length,d,p="value"in Dn?Dn.value:Dn.textContent,x=p.length;for(n=0;n<o&&r[n]===p[n];n++);var _=o-n;for(d=1;d<=_&&r[o-d]===p[x-d];d++);return Lo=p.slice(n,1<d?1-d:void 0)}function Io(n){var r=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&r===13&&(n=13)):n=r,n===10&&(n=13),32<=n||n===13?n:0}function Ro(){return!0}function op(){return!1}function _s(n){function r(o,d,p,x,_){this._reactName=o,this._targetInst=p,this.type=d,this.nativeEvent=x,this.target=_,this.currentTarget=null;for(var C in n)n.hasOwnProperty(C)&&(o=n[C],this[C]=o?o(x):x[C]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?Ro:op,this.isPropagationStopped=op,this}return g(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Ro)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Ro)},persist:function(){},isPersistent:Ro}),r}var _a={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},No=_s(_a),Mu=g({},_a,{view:0,detail:0}),PS=_s(Mu),Ef,xf,Pu,Co=g({},Mu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yf,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Pu&&(Pu&&n.type==="mousemove"?(Ef=n.screenX-Pu.screenX,xf=n.screenY-Pu.screenY):xf=Ef=0,Pu=n),Ef)},movementY:function(n){return"movementY"in n?n.movementY:xf}}),cp=_s(Co),US=g({},Co,{dataTransfer:0}),BS=_s(US),FS=g({},Mu,{relatedTarget:0}),Tf=_s(FS),jS=g({},_a,{animationName:0,elapsedTime:0,pseudoElement:0}),HS=_s(jS),$S=g({},_a,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),GS=_s($S),VS=g({},_a,{data:0}),dp=_s(VS),qS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},YS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},KS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zS(n){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(n):(n=KS[n])?!!r[n]:!1}function yf(){return zS}var QS=g({},Mu,{key:function(n){if(n.key){var r=qS[n.key]||n.key;if(r!=="Unidentified")return r}return n.type==="keypress"?(n=Io(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?YS[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yf,charCode:function(n){return n.type==="keypress"?Io(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Io(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),XS=_s(QS),WS=g({},Co,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fp=_s(WS),ZS=g({},Mu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yf}),JS=_s(ZS),eA=g({},_a,{propertyName:0,elapsedTime:0,pseudoElement:0}),tA=_s(eA),sA=g({},Co,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),iA=_s(sA),nA=g({},_a,{newState:0,oldState:0}),aA=_s(nA),rA=[9,13,27,32],vf=Ji&&"CompositionEvent"in window,Uu=null;Ji&&"documentMode"in document&&(Uu=document.documentMode);var uA=Ji&&"TextEvent"in window&&!Uu,hp=Ji&&(!vf||Uu&&8<Uu&&11>=Uu),mp=" ",gp=!1;function pp(n,r){switch(n){case"keyup":return rA.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function bp(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var xr=!1;function lA(n,r){switch(n){case"compositionend":return bp(r);case"keypress":return r.which!==32?null:(gp=!0,mp);case"textInput":return n=r.data,n===mp&&gp?null:n;default:return null}}function oA(n,r){if(xr)return n==="compositionend"||!vf&&pp(n,r)?(n=lp(),Lo=bf=Dn=null,xr=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return hp&&r.locale!=="ko"?null:r.data;default:return null}}var cA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ep(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r==="input"?!!cA[n.type]:r==="textarea"}function xp(n,r,o,d){br?Er?Er.push(d):Er=[d]:br=d,r=xc(r,"onChange"),0<r.length&&(o=new No("onChange","change",null,o,d),n.push({event:o,listeners:r}))}var Bu=null,Fu=null;function dA(n){tE(n,0)}function Do(n){var r=Ou(n);if(ep(r))return n}function Tp(n,r){if(n==="change")return r}var yp=!1;if(Ji){var Sf;if(Ji){var Af="oninput"in document;if(!Af){var vp=document.createElement("div");vp.setAttribute("oninput","return;"),Af=typeof vp.oninput=="function"}Sf=Af}else Sf=!1;yp=Sf&&(!document.documentMode||9<document.documentMode)}function Sp(){Bu&&(Bu.detachEvent("onpropertychange",Ap),Fu=Bu=null)}function Ap(n){if(n.propertyName==="value"&&Do(Fu)){var r=[];xp(r,Fu,n,mf(n)),up(dA,r)}}function fA(n,r,o){n==="focusin"?(Sp(),Bu=r,Fu=o,Bu.attachEvent("onpropertychange",Ap)):n==="focusout"&&Sp()}function hA(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Do(Fu)}function mA(n,r){if(n==="click")return Do(r)}function gA(n,r){if(n==="input"||n==="change")return Do(r)}function pA(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var Hs=typeof Object.is=="function"?Object.is:pA;function ju(n,r){if(Hs(n,r))return!0;if(typeof n!="object"||n===null||typeof r!="object"||r===null)return!1;var o=Object.keys(n),d=Object.keys(r);if(o.length!==d.length)return!1;for(d=0;d<o.length;d++){var p=o[d];if(!bi.call(r,p)||!Hs(n[p],r[p]))return!1}return!0}function _p(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Lp(n,r){var o=_p(n);n=0;for(var d;o;){if(o.nodeType===3){if(d=n+o.textContent.length,n<=r&&d>=r)return{node:o,offset:r-n};n=d}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=_p(o)}}function Ip(n,r){return n&&r?n===r?!0:n&&n.nodeType===3?!1:r&&r.nodeType===3?Ip(n,r.parentNode):"contains"in n?n.contains(r):n.compareDocumentPosition?!!(n.compareDocumentPosition(r)&16):!1:!1}function Rp(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var r=Ao(n.document);r instanceof n.HTMLIFrameElement;){try{var o=typeof r.contentWindow.location.href=="string"}catch{o=!1}if(o)n=r.contentWindow;else break;r=Ao(n.document)}return r}function _f(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r&&(r==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||r==="textarea"||n.contentEditable==="true")}var bA=Ji&&"documentMode"in document&&11>=document.documentMode,Tr=null,Lf=null,Hu=null,If=!1;function Np(n,r,o){var d=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;If||Tr==null||Tr!==Ao(d)||(d=Tr,"selectionStart"in d&&_f(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Hu&&ju(Hu,d)||(Hu=d,d=xc(Lf,"onSelect"),0<d.length&&(r=new No("onSelect","select",null,r,o),n.push({event:r,listeners:d}),r.target=Tr)))}function La(n,r){var o={};return o[n.toLowerCase()]=r.toLowerCase(),o["Webkit"+n]="webkit"+r,o["Moz"+n]="moz"+r,o}var yr={animationend:La("Animation","AnimationEnd"),animationiteration:La("Animation","AnimationIteration"),animationstart:La("Animation","AnimationStart"),transitionrun:La("Transition","TransitionRun"),transitionstart:La("Transition","TransitionStart"),transitioncancel:La("Transition","TransitionCancel"),transitionend:La("Transition","TransitionEnd")},Rf={},Cp={};Ji&&(Cp=document.createElement("div").style,"AnimationEvent"in window||(delete yr.animationend.animation,delete yr.animationiteration.animation,delete yr.animationstart.animation),"TransitionEvent"in window||delete yr.transitionend.transition);function Ia(n){if(Rf[n])return Rf[n];if(!yr[n])return n;var r=yr[n],o;for(o in r)if(r.hasOwnProperty(o)&&o in Cp)return Rf[n]=r[o];return n}var Dp=Ia("animationend"),Op=Ia("animationiteration"),wp=Ia("animationstart"),EA=Ia("transitionrun"),xA=Ia("transitionstart"),TA=Ia("transitioncancel"),kp=Ia("transitionend"),Mp=new Map,Nf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Nf.push("scrollEnd");function Ei(n,r){Mp.set(n,r),Aa(r,[n])}var Oo=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},ii=[],vr=0,Cf=0;function wo(){for(var n=vr,r=Cf=vr=0;r<n;){var o=ii[r];ii[r++]=null;var d=ii[r];ii[r++]=null;var p=ii[r];ii[r++]=null;var x=ii[r];if(ii[r++]=null,d!==null&&p!==null){var _=d.pending;_===null?p.next=p:(p.next=_.next,_.next=p),d.pending=p}x!==0&&Pp(o,p,x)}}function ko(n,r,o,d){ii[vr++]=n,ii[vr++]=r,ii[vr++]=o,ii[vr++]=d,Cf|=d,n.lanes|=d,n=n.alternate,n!==null&&(n.lanes|=d)}function Df(n,r,o,d){return ko(n,r,o,d),Mo(n)}function Ra(n,r){return ko(n,null,null,r),Mo(n)}function Pp(n,r,o){n.lanes|=o;var d=n.alternate;d!==null&&(d.lanes|=o);for(var p=!1,x=n.return;x!==null;)x.childLanes|=o,d=x.alternate,d!==null&&(d.childLanes|=o),x.tag===22&&(n=x.stateNode,n===null||n._visibility&1||(p=!0)),n=x,x=x.return;return n.tag===3?(x=n.stateNode,p&&r!==null&&(p=31-js(o),n=x.hiddenUpdates,d=n[p],d===null?n[p]=[r]:d.push(r),r.lane=o|536870912),x):null}function Mo(n){if(50<ol)throw ol=0,jh=null,Error(i(185));for(var r=n.return;r!==null;)n=r,r=n.return;return n.tag===3?n.stateNode:null}var Sr={};function yA(n,r,o,d){this.tag=n,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $s(n,r,o,d){return new yA(n,r,o,d)}function Of(n){return n=n.prototype,!(!n||!n.isReactComponent)}function en(n,r){var o=n.alternate;return o===null?(o=$s(n.tag,r,n.key,n.mode),o.elementType=n.elementType,o.type=n.type,o.stateNode=n.stateNode,o.alternate=n,n.alternate=o):(o.pendingProps=r,o.type=n.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=n.flags&65011712,o.childLanes=n.childLanes,o.lanes=n.lanes,o.child=n.child,o.memoizedProps=n.memoizedProps,o.memoizedState=n.memoizedState,o.updateQueue=n.updateQueue,r=n.dependencies,o.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},o.sibling=n.sibling,o.index=n.index,o.ref=n.ref,o.refCleanup=n.refCleanup,o}function Up(n,r){n.flags&=65011714;var o=n.alternate;return o===null?(n.childLanes=0,n.lanes=r,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=o.childLanes,n.lanes=o.lanes,n.child=o.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=o.memoizedProps,n.memoizedState=o.memoizedState,n.updateQueue=o.updateQueue,n.type=o.type,r=o.dependencies,n.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),n}function Po(n,r,o,d,p,x){var _=0;if(d=n,typeof n=="function")Of(n)&&(_=1);else if(typeof n=="string")_=L3(n,o,Ce.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case $:return n=$s(31,o,r,p),n.elementType=$,n.lanes=x,n;case S:return Na(o.children,p,x,r);case A:_=8,p|=24;break;case I:return n=$s(12,o,r,p|2),n.elementType=I,n.lanes=x,n;case k:return n=$s(13,o,r,p),n.elementType=k,n.lanes=x,n;case G:return n=$s(19,o,r,p),n.elementType=G,n.lanes=x,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case N:_=10;break e;case R:_=9;break e;case D:_=11;break e;case U:_=14;break e;case H:_=16,d=null;break e}_=29,o=Error(i(130,n===null?"null":typeof n,"")),d=null}return r=$s(_,o,r,p),r.elementType=n,r.type=d,r.lanes=x,r}function Na(n,r,o,d){return n=$s(7,n,d,r),n.lanes=o,n}function wf(n,r,o){return n=$s(6,n,null,r),n.lanes=o,n}function Bp(n){var r=$s(18,null,null,0);return r.stateNode=n,r}function kf(n,r,o){return r=$s(4,n.children!==null?n.children:[],n.key,r),r.lanes=o,r.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},r}var Fp=new WeakMap;function ni(n,r){if(typeof n=="object"&&n!==null){var o=Fp.get(n);return o!==void 0?o:(r={value:n,source:r,stack:ps(r)},Fp.set(n,r),r)}return{value:n,source:r,stack:ps(r)}}var Ar=[],_r=0,Uo=null,$u=0,ai=[],ri=0,On=null,Ni=1,Ci="";function tn(n,r){Ar[_r++]=$u,Ar[_r++]=Uo,Uo=n,$u=r}function jp(n,r,o){ai[ri++]=Ni,ai[ri++]=Ci,ai[ri++]=On,On=n;var d=Ni;n=Ci;var p=32-js(d)-1;d&=~(1<<p),o+=1;var x=32-js(r)+p;if(30<x){var _=p-p%5;x=(d&(1<<_)-1).toString(32),d>>=_,p-=_,Ni=1<<32-js(r)+p|o<<p|d,Ci=x+n}else Ni=1<<x|o<<p|d,Ci=n}function Mf(n){n.return!==null&&(tn(n,1),jp(n,1,0))}function Pf(n){for(;n===Uo;)Uo=Ar[--_r],Ar[_r]=null,$u=Ar[--_r],Ar[_r]=null;for(;n===On;)On=ai[--ri],ai[ri]=null,Ci=ai[--ri],ai[ri]=null,Ni=ai[--ri],ai[ri]=null}function Hp(n,r){ai[ri++]=Ni,ai[ri++]=Ci,ai[ri++]=On,Ni=r.id,Ci=r.overflow,On=n}var rs=null,ht=null,Ke=!1,wn=null,ui=!1,Uf=Error(i(519));function kn(n){var r=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Gu(ni(r,n)),Uf}function $p(n){var r=n.stateNode,o=n.type,d=n.memoizedProps;switch(r[as]=n,r[As]=d,o){case"dialog":Ge("cancel",r),Ge("close",r);break;case"iframe":case"object":case"embed":Ge("load",r);break;case"video":case"audio":for(o=0;o<dl.length;o++)Ge(dl[o],r);break;case"source":Ge("error",r);break;case"img":case"image":case"link":Ge("error",r),Ge("load",r);break;case"details":Ge("toggle",r);break;case"input":Ge("invalid",r),tp(r,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":Ge("invalid",r);break;case"textarea":Ge("invalid",r),ip(r,d.value,d.defaultValue,d.children)}o=d.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||r.textContent===""+o||d.suppressHydrationWarning===!0||aE(r.textContent,o)?(d.popover!=null&&(Ge("beforetoggle",r),Ge("toggle",r)),d.onScroll!=null&&Ge("scroll",r),d.onScrollEnd!=null&&Ge("scrollend",r),d.onClick!=null&&(r.onclick=Zi),r=!0):r=!1,r||kn(n,!0)}function Gp(n){for(rs=n.return;rs;)switch(rs.tag){case 5:case 31:case 13:ui=!1;return;case 27:case 3:ui=!0;return;default:rs=rs.return}}function Lr(n){if(n!==rs)return!1;if(!Ke)return Gp(n),Ke=!0,!1;var r=n.tag,o;if((o=r!==3&&r!==27)&&((o=r===5)&&(o=n.type,o=!(o!=="form"&&o!=="button")||t0(n.type,n.memoizedProps)),o=!o),o&&ht&&kn(n),Gp(n),r===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));ht=mE(n)}else if(r===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));ht=mE(n)}else r===27?(r=ht,zn(n.type)?(n=r0,r0=null,ht=n):ht=r):ht=rs?oi(n.stateNode.nextSibling):null;return!0}function Ca(){ht=rs=null,Ke=!1}function Bf(){var n=wn;return n!==null&&(Ns===null?Ns=n:Ns.push.apply(Ns,n),wn=null),n}function Gu(n){wn===null?wn=[n]:wn.push(n)}var Ff=fe(null),Da=null,sn=null;function Mn(n,r,o){xe(Ff,r._currentValue),r._currentValue=o}function nn(n){n._currentValue=Ff.current,ce(Ff)}function jf(n,r,o){for(;n!==null;){var d=n.alternate;if((n.childLanes&r)!==r?(n.childLanes|=r,d!==null&&(d.childLanes|=r)):d!==null&&(d.childLanes&r)!==r&&(d.childLanes|=r),n===o)break;n=n.return}}function Hf(n,r,o,d){var p=n.child;for(p!==null&&(p.return=n);p!==null;){var x=p.dependencies;if(x!==null){var _=p.child;x=x.firstContext;e:for(;x!==null;){var C=x;x=p;for(var P=0;P<r.length;P++)if(C.context===r[P]){x.lanes|=o,C=x.alternate,C!==null&&(C.lanes|=o),jf(x.return,o,n),d||(_=null);break e}x=C.next}}else if(p.tag===18){if(_=p.return,_===null)throw Error(i(341));_.lanes|=o,x=_.alternate,x!==null&&(x.lanes|=o),jf(_,o,n),_=null}else _=p.child;if(_!==null)_.return=p;else for(_=p;_!==null;){if(_===n){_=null;break}if(p=_.sibling,p!==null){p.return=_.return,_=p;break}_=_.return}p=_}}function Ir(n,r,o,d){n=null;for(var p=r,x=!1;p!==null;){if(!x){if((p.flags&524288)!==0)x=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var _=p.alternate;if(_===null)throw Error(i(387));if(_=_.memoizedProps,_!==null){var C=p.type;Hs(p.pendingProps.value,_.value)||(n!==null?n.push(C):n=[C])}}else if(p===It.current){if(_=p.alternate,_===null)throw Error(i(387));_.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(n!==null?n.push(pl):n=[pl])}p=p.return}n!==null&&Hf(r,n,o,d),r.flags|=262144}function Bo(n){for(n=n.firstContext;n!==null;){if(!Hs(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function Oa(n){Da=n,sn=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function us(n){return Vp(Da,n)}function Fo(n,r){return Da===null&&Oa(n),Vp(n,r)}function Vp(n,r){var o=r._currentValue;if(r={context:r,memoizedValue:o,next:null},sn===null){if(n===null)throw Error(i(308));sn=r,n.dependencies={lanes:0,firstContext:r},n.flags|=524288}else sn=sn.next=r;return o}var vA=typeof AbortController<"u"?AbortController:function(){var n=[],r=this.signal={aborted:!1,addEventListener:function(o,d){n.push(d)}};this.abort=function(){r.aborted=!0,n.forEach(function(o){return o()})}},SA=s.unstable_scheduleCallback,AA=s.unstable_NormalPriority,Ot={$$typeof:N,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function $f(){return{controller:new vA,data:new Map,refCount:0}}function Vu(n){n.refCount--,n.refCount===0&&SA(AA,function(){n.controller.abort()})}var qu=null,Gf=0,Rr=0,Nr=null;function _A(n,r){if(qu===null){var o=qu=[];Gf=0,Rr=Yh(),Nr={status:"pending",value:void 0,then:function(d){o.push(d)}}}return Gf++,r.then(qp,qp),r}function qp(){if(--Gf===0&&qu!==null){Nr!==null&&(Nr.status="fulfilled");var n=qu;qu=null,Rr=0,Nr=null;for(var r=0;r<n.length;r++)(0,n[r])()}}function LA(n,r){var o=[],d={status:"pending",value:null,reason:null,then:function(p){o.push(p)}};return n.then(function(){d.status="fulfilled",d.value=r;for(var p=0;p<o.length;p++)(0,o[p])(r)},function(p){for(d.status="rejected",d.reason=p,p=0;p<o.length;p++)(0,o[p])(void 0)}),d}var Yp=B.S;B.S=function(n,r){Nb=Xt(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&_A(n,r),Yp!==null&&Yp(n,r)};var wa=fe(null);function Vf(){var n=wa.current;return n!==null?n:ct.pooledCache}function jo(n,r){r===null?xe(wa,wa.current):xe(wa,r.pool)}function Kp(){var n=Vf();return n===null?null:{parent:Ot._currentValue,pool:n}}var Cr=Error(i(460)),qf=Error(i(474)),Ho=Error(i(542)),$o={then:function(){}};function zp(n){return n=n.status,n==="fulfilled"||n==="rejected"}function Qp(n,r,o){switch(o=n[o],o===void 0?n.push(r):o!==r&&(r.then(Zi,Zi),r=o),r.status){case"fulfilled":return r.value;case"rejected":throw n=r.reason,Wp(n),n;default:if(typeof r.status=="string")r.then(Zi,Zi);else{if(n=ct,n!==null&&100<n.shellSuspendCounter)throw Error(i(482));n=r,n.status="pending",n.then(function(d){if(r.status==="pending"){var p=r;p.status="fulfilled",p.value=d}},function(d){if(r.status==="pending"){var p=r;p.status="rejected",p.reason=d}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw n=r.reason,Wp(n),n}throw Ma=r,Cr}}function ka(n){try{var r=n._init;return r(n._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(Ma=o,Cr):o}}var Ma=null;function Xp(){if(Ma===null)throw Error(i(459));var n=Ma;return Ma=null,n}function Wp(n){if(n===Cr||n===Ho)throw Error(i(483))}var Dr=null,Yu=0;function Go(n){var r=Yu;return Yu+=1,Dr===null&&(Dr=[]),Qp(Dr,n,r)}function Ku(n,r){r=r.props.ref,n.ref=r!==void 0?r:null}function Vo(n,r){throw r.$$typeof===E?Error(i(525)):(n=Object.prototype.toString.call(r),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n)))}function Zp(n){function r(V,j){if(n){var z=V.deletions;z===null?(V.deletions=[j],V.flags|=16):z.push(j)}}function o(V,j){if(!n)return null;for(;j!==null;)r(V,j),j=j.sibling;return null}function d(V){for(var j=new Map;V!==null;)V.key!==null?j.set(V.key,V):j.set(V.index,V),V=V.sibling;return j}function p(V,j){return V=en(V,j),V.index=0,V.sibling=null,V}function x(V,j,z){return V.index=z,n?(z=V.alternate,z!==null?(z=z.index,z<j?(V.flags|=67108866,j):z):(V.flags|=67108866,j)):(V.flags|=1048576,j)}function _(V){return n&&V.alternate===null&&(V.flags|=67108866),V}function C(V,j,z,le){return j===null||j.tag!==6?(j=wf(z,V.mode,le),j.return=V,j):(j=p(j,z),j.return=V,j)}function P(V,j,z,le){var _e=z.type;return _e===S?ae(V,j,z.props.children,le,z.key):j!==null&&(j.elementType===_e||typeof _e=="object"&&_e!==null&&_e.$$typeof===H&&ka(_e)===j.type)?(j=p(j,z.props),Ku(j,z),j.return=V,j):(j=Po(z.type,z.key,z.props,null,V.mode,le),Ku(j,z),j.return=V,j)}function Q(V,j,z,le){return j===null||j.tag!==4||j.stateNode.containerInfo!==z.containerInfo||j.stateNode.implementation!==z.implementation?(j=kf(z,V.mode,le),j.return=V,j):(j=p(j,z.children||[]),j.return=V,j)}function ae(V,j,z,le,_e){return j===null||j.tag!==7?(j=Na(z,V.mode,le,_e),j.return=V,j):(j=p(j,z),j.return=V,j)}function oe(V,j,z){if(typeof j=="string"&&j!==""||typeof j=="number"||typeof j=="bigint")return j=wf(""+j,V.mode,z),j.return=V,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case T:return z=Po(j.type,j.key,j.props,null,V.mode,z),Ku(z,j),z.return=V,z;case v:return j=kf(j,V.mode,z),j.return=V,j;case H:return j=ka(j),oe(V,j,z)}if(ne(j)||me(j))return j=Na(j,V.mode,z,null),j.return=V,j;if(typeof j.then=="function")return oe(V,Go(j),z);if(j.$$typeof===N)return oe(V,Fo(V,j),z);Vo(V,j)}return null}function X(V,j,z,le){var _e=j!==null?j.key:null;if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return _e!==null?null:C(V,j,""+z,le);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case T:return z.key===_e?P(V,j,z,le):null;case v:return z.key===_e?Q(V,j,z,le):null;case H:return z=ka(z),X(V,j,z,le)}if(ne(z)||me(z))return _e!==null?null:ae(V,j,z,le,null);if(typeof z.then=="function")return X(V,j,Go(z),le);if(z.$$typeof===N)return X(V,j,Fo(V,z),le);Vo(V,z)}return null}function Z(V,j,z,le,_e){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return V=V.get(z)||null,C(j,V,""+le,_e);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case T:return V=V.get(le.key===null?z:le.key)||null,P(j,V,le,_e);case v:return V=V.get(le.key===null?z:le.key)||null,Q(j,V,le,_e);case H:return le=ka(le),Z(V,j,z,le,_e)}if(ne(le)||me(le))return V=V.get(z)||null,ae(j,V,le,_e,null);if(typeof le.then=="function")return Z(V,j,z,Go(le),_e);if(le.$$typeof===N)return Z(V,j,z,Fo(j,le),_e);Vo(j,le)}return null}function ve(V,j,z,le){for(var _e=null,We=null,Se=j,Ue=j=0,Ye=null;Se!==null&&Ue<z.length;Ue++){Se.index>Ue?(Ye=Se,Se=null):Ye=Se.sibling;var Ze=X(V,Se,z[Ue],le);if(Ze===null){Se===null&&(Se=Ye);break}n&&Se&&Ze.alternate===null&&r(V,Se),j=x(Ze,j,Ue),We===null?_e=Ze:We.sibling=Ze,We=Ze,Se=Ye}if(Ue===z.length)return o(V,Se),Ke&&tn(V,Ue),_e;if(Se===null){for(;Ue<z.length;Ue++)Se=oe(V,z[Ue],le),Se!==null&&(j=x(Se,j,Ue),We===null?_e=Se:We.sibling=Se,We=Se);return Ke&&tn(V,Ue),_e}for(Se=d(Se);Ue<z.length;Ue++)Ye=Z(Se,V,Ue,z[Ue],le),Ye!==null&&(n&&Ye.alternate!==null&&Se.delete(Ye.key===null?Ue:Ye.key),j=x(Ye,j,Ue),We===null?_e=Ye:We.sibling=Ye,We=Ye);return n&&Se.forEach(function(Jn){return r(V,Jn)}),Ke&&tn(V,Ue),_e}function Ie(V,j,z,le){if(z==null)throw Error(i(151));for(var _e=null,We=null,Se=j,Ue=j=0,Ye=null,Ze=z.next();Se!==null&&!Ze.done;Ue++,Ze=z.next()){Se.index>Ue?(Ye=Se,Se=null):Ye=Se.sibling;var Jn=X(V,Se,Ze.value,le);if(Jn===null){Se===null&&(Se=Ye);break}n&&Se&&Jn.alternate===null&&r(V,Se),j=x(Jn,j,Ue),We===null?_e=Jn:We.sibling=Jn,We=Jn,Se=Ye}if(Ze.done)return o(V,Se),Ke&&tn(V,Ue),_e;if(Se===null){for(;!Ze.done;Ue++,Ze=z.next())Ze=oe(V,Ze.value,le),Ze!==null&&(j=x(Ze,j,Ue),We===null?_e=Ze:We.sibling=Ze,We=Ze);return Ke&&tn(V,Ue),_e}for(Se=d(Se);!Ze.done;Ue++,Ze=z.next())Ze=Z(Se,V,Ue,Ze.value,le),Ze!==null&&(n&&Ze.alternate!==null&&Se.delete(Ze.key===null?Ue:Ze.key),j=x(Ze,j,Ue),We===null?_e=Ze:We.sibling=Ze,We=Ze);return n&&Se.forEach(function(U3){return r(V,U3)}),Ke&&tn(V,Ue),_e}function ut(V,j,z,le){if(typeof z=="object"&&z!==null&&z.type===S&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case T:e:{for(var _e=z.key;j!==null;){if(j.key===_e){if(_e=z.type,_e===S){if(j.tag===7){o(V,j.sibling),le=p(j,z.props.children),le.return=V,V=le;break e}}else if(j.elementType===_e||typeof _e=="object"&&_e!==null&&_e.$$typeof===H&&ka(_e)===j.type){o(V,j.sibling),le=p(j,z.props),Ku(le,z),le.return=V,V=le;break e}o(V,j);break}else r(V,j);j=j.sibling}z.type===S?(le=Na(z.props.children,V.mode,le,z.key),le.return=V,V=le):(le=Po(z.type,z.key,z.props,null,V.mode,le),Ku(le,z),le.return=V,V=le)}return _(V);case v:e:{for(_e=z.key;j!==null;){if(j.key===_e)if(j.tag===4&&j.stateNode.containerInfo===z.containerInfo&&j.stateNode.implementation===z.implementation){o(V,j.sibling),le=p(j,z.children||[]),le.return=V,V=le;break e}else{o(V,j);break}else r(V,j);j=j.sibling}le=kf(z,V.mode,le),le.return=V,V=le}return _(V);case H:return z=ka(z),ut(V,j,z,le)}if(ne(z))return ve(V,j,z,le);if(me(z)){if(_e=me(z),typeof _e!="function")throw Error(i(150));return z=_e.call(z),Ie(V,j,z,le)}if(typeof z.then=="function")return ut(V,j,Go(z),le);if(z.$$typeof===N)return ut(V,j,Fo(V,z),le);Vo(V,z)}return typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint"?(z=""+z,j!==null&&j.tag===6?(o(V,j.sibling),le=p(j,z),le.return=V,V=le):(o(V,j),le=wf(z,V.mode,le),le.return=V,V=le),_(V)):o(V,j)}return function(V,j,z,le){try{Yu=0;var _e=ut(V,j,z,le);return Dr=null,_e}catch(Se){if(Se===Cr||Se===Ho)throw Se;var We=$s(29,Se,null,V.mode);return We.lanes=le,We.return=V,We}finally{}}}var Pa=Zp(!0),Jp=Zp(!1),Pn=!1;function Yf(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Kf(n,r){n=n.updateQueue,r.updateQueue===n&&(r.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function Un(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function Bn(n,r,o){var d=n.updateQueue;if(d===null)return null;if(d=d.shared,(Je&2)!==0){var p=d.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),d.pending=r,r=Mo(n),Pp(n,null,o),r}return ko(n,d,r,o),Mo(n)}function zu(n,r,o){if(r=r.updateQueue,r!==null&&(r=r.shared,(o&4194048)!==0)){var d=r.lanes;d&=n.pendingLanes,o|=d,r.lanes=o,Vg(n,o)}}function zf(n,r){var o=n.updateQueue,d=n.alternate;if(d!==null&&(d=d.updateQueue,o===d)){var p=null,x=null;if(o=o.firstBaseUpdate,o!==null){do{var _={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};x===null?p=x=_:x=x.next=_,o=o.next}while(o!==null);x===null?p=x=r:x=x.next=r}else p=x=r;o={baseState:d.baseState,firstBaseUpdate:p,lastBaseUpdate:x,shared:d.shared,callbacks:d.callbacks},n.updateQueue=o;return}n=o.lastBaseUpdate,n===null?o.firstBaseUpdate=r:n.next=r,o.lastBaseUpdate=r}var Qf=!1;function Qu(){if(Qf){var n=Nr;if(n!==null)throw n}}function Xu(n,r,o,d){Qf=!1;var p=n.updateQueue;Pn=!1;var x=p.firstBaseUpdate,_=p.lastBaseUpdate,C=p.shared.pending;if(C!==null){p.shared.pending=null;var P=C,Q=P.next;P.next=null,_===null?x=Q:_.next=Q,_=P;var ae=n.alternate;ae!==null&&(ae=ae.updateQueue,C=ae.lastBaseUpdate,C!==_&&(C===null?ae.firstBaseUpdate=Q:C.next=Q,ae.lastBaseUpdate=P))}if(x!==null){var oe=p.baseState;_=0,ae=Q=P=null,C=x;do{var X=C.lane&-536870913,Z=X!==C.lane;if(Z?(qe&X)===X:(d&X)===X){X!==0&&X===Rr&&(Qf=!0),ae!==null&&(ae=ae.next={lane:0,tag:C.tag,payload:C.payload,callback:null,next:null});e:{var ve=n,Ie=C;X=r;var ut=o;switch(Ie.tag){case 1:if(ve=Ie.payload,typeof ve=="function"){oe=ve.call(ut,oe,X);break e}oe=ve;break e;case 3:ve.flags=ve.flags&-65537|128;case 0:if(ve=Ie.payload,X=typeof ve=="function"?ve.call(ut,oe,X):ve,X==null)break e;oe=g({},oe,X);break e;case 2:Pn=!0}}X=C.callback,X!==null&&(n.flags|=64,Z&&(n.flags|=8192),Z=p.callbacks,Z===null?p.callbacks=[X]:Z.push(X))}else Z={lane:X,tag:C.tag,payload:C.payload,callback:C.callback,next:null},ae===null?(Q=ae=Z,P=oe):ae=ae.next=Z,_|=X;if(C=C.next,C===null){if(C=p.shared.pending,C===null)break;Z=C,C=Z.next,Z.next=null,p.lastBaseUpdate=Z,p.shared.pending=null}}while(!0);ae===null&&(P=oe),p.baseState=P,p.firstBaseUpdate=Q,p.lastBaseUpdate=ae,x===null&&(p.shared.lanes=0),Gn|=_,n.lanes=_,n.memoizedState=oe}}function e1(n,r){if(typeof n!="function")throw Error(i(191,n));n.call(r)}function t1(n,r){var o=n.callbacks;if(o!==null)for(n.callbacks=null,n=0;n<o.length;n++)e1(o[n],r)}var Or=fe(null),qo=fe(0);function s1(n,r){n=hn,xe(qo,n),xe(Or,r),hn=n|r.baseLanes}function Xf(){xe(qo,hn),xe(Or,Or.current)}function Wf(){hn=qo.current,ce(Or),ce(qo)}var Gs=fe(null),li=null;function Fn(n){var r=n.alternate;xe(Rt,Rt.current&1),xe(Gs,n),li===null&&(r===null||Or.current!==null||r.memoizedState!==null)&&(li=n)}function Zf(n){xe(Rt,Rt.current),xe(Gs,n),li===null&&(li=n)}function i1(n){n.tag===22?(xe(Rt,Rt.current),xe(Gs,n),li===null&&(li=n)):jn()}function jn(){xe(Rt,Rt.current),xe(Gs,Gs.current)}function Vs(n){ce(Gs),li===n&&(li=null),ce(Rt)}var Rt=fe(0);function Yo(n){for(var r=n;r!==null;){if(r.tag===13){var o=r.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||n0(o)||a0(o)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var an=0,Pe=null,at=null,wt=null,Ko=!1,wr=!1,Ua=!1,zo=0,Wu=0,kr=null,IA=0;function vt(){throw Error(i(321))}function Jf(n,r){if(r===null)return!1;for(var o=0;o<r.length&&o<n.length;o++)if(!Hs(n[o],r[o]))return!1;return!0}function eh(n,r,o,d,p,x){return an=x,Pe=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,B.H=n===null||n.memoizedState===null?j1:gh,Ua=!1,x=o(d,p),Ua=!1,wr&&(x=a1(r,o,d,p)),n1(n),x}function n1(n){B.H=el;var r=at!==null&&at.next!==null;if(an=0,wt=at=Pe=null,Ko=!1,Wu=0,kr=null,r)throw Error(i(300));n===null||kt||(n=n.dependencies,n!==null&&Bo(n)&&(kt=!0))}function a1(n,r,o,d){Pe=n;var p=0;do{if(wr&&(kr=null),Wu=0,wr=!1,25<=p)throw Error(i(301));if(p+=1,wt=at=null,n.updateQueue!=null){var x=n.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}B.H=H1,x=r(o,d)}while(wr);return x}function RA(){var n=B.H,r=n.useState()[0];return r=typeof r.then=="function"?Zu(r):r,n=n.useState()[0],(at!==null?at.memoizedState:null)!==n&&(Pe.flags|=1024),r}function th(){var n=zo!==0;return zo=0,n}function sh(n,r,o){r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~o}function ih(n){if(Ko){for(n=n.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}Ko=!1}an=0,wt=at=Pe=null,wr=!1,Wu=zo=0,kr=null}function Es(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wt===null?Pe.memoizedState=wt=n:wt=wt.next=n,wt}function Nt(){if(at===null){var n=Pe.alternate;n=n!==null?n.memoizedState:null}else n=at.next;var r=wt===null?Pe.memoizedState:wt.next;if(r!==null)wt=r,at=n;else{if(n===null)throw Pe.alternate===null?Error(i(467)):Error(i(310));at=n,n={memoizedState:at.memoizedState,baseState:at.baseState,baseQueue:at.baseQueue,queue:at.queue,next:null},wt===null?Pe.memoizedState=wt=n:wt=wt.next=n}return wt}function Qo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Zu(n){var r=Wu;return Wu+=1,kr===null&&(kr=[]),n=Qp(kr,n,r),r=Pe,(wt===null?r.memoizedState:wt.next)===null&&(r=r.alternate,B.H=r===null||r.memoizedState===null?j1:gh),n}function Xo(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return Zu(n);if(n.$$typeof===N)return us(n)}throw Error(i(438,String(n)))}function nh(n){var r=null,o=Pe.updateQueue;if(o!==null&&(r=o.memoCache),r==null){var d=Pe.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(r={data:d.data.map(function(p){return p.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),o===null&&(o=Qo(),Pe.updateQueue=o),o.memoCache=r,o=r.data[r.index],o===void 0)for(o=r.data[r.index]=Array(n),d=0;d<n;d++)o[d]=F;return r.index++,o}function rn(n,r){return typeof r=="function"?r(n):r}function Wo(n){var r=Nt();return ah(r,at,n)}function ah(n,r,o){var d=n.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=o;var p=n.baseQueue,x=d.pending;if(x!==null){if(p!==null){var _=p.next;p.next=x.next,x.next=_}r.baseQueue=p=x,d.pending=null}if(x=n.baseState,p===null)n.memoizedState=x;else{r=p.next;var C=_=null,P=null,Q=r,ae=!1;do{var oe=Q.lane&-536870913;if(oe!==Q.lane?(qe&oe)===oe:(an&oe)===oe){var X=Q.revertLane;if(X===0)P!==null&&(P=P.next={lane:0,revertLane:0,gesture:null,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),oe===Rr&&(ae=!0);else if((an&X)===X){Q=Q.next,X===Rr&&(ae=!0);continue}else oe={lane:0,revertLane:Q.revertLane,gesture:null,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},P===null?(C=P=oe,_=x):P=P.next=oe,Pe.lanes|=X,Gn|=X;oe=Q.action,Ua&&o(x,oe),x=Q.hasEagerState?Q.eagerState:o(x,oe)}else X={lane:oe,revertLane:Q.revertLane,gesture:Q.gesture,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},P===null?(C=P=X,_=x):P=P.next=X,Pe.lanes|=oe,Gn|=oe;Q=Q.next}while(Q!==null&&Q!==r);if(P===null?_=x:P.next=C,!Hs(x,n.memoizedState)&&(kt=!0,ae&&(o=Nr,o!==null)))throw o;n.memoizedState=x,n.baseState=_,n.baseQueue=P,d.lastRenderedState=x}return p===null&&(d.lanes=0),[n.memoizedState,d.dispatch]}function rh(n){var r=Nt(),o=r.queue;if(o===null)throw Error(i(311));o.lastRenderedReducer=n;var d=o.dispatch,p=o.pending,x=r.memoizedState;if(p!==null){o.pending=null;var _=p=p.next;do x=n(x,_.action),_=_.next;while(_!==p);Hs(x,r.memoizedState)||(kt=!0),r.memoizedState=x,r.baseQueue===null&&(r.baseState=x),o.lastRenderedState=x}return[x,d]}function r1(n,r,o){var d=Pe,p=Nt(),x=Ke;if(x){if(o===void 0)throw Error(i(407));o=o()}else o=r();var _=!Hs((at||p).memoizedState,o);if(_&&(p.memoizedState=o,kt=!0),p=p.queue,oh(o1.bind(null,d,p,n),[n]),p.getSnapshot!==r||_||wt!==null&&wt.memoizedState.tag&1){if(d.flags|=2048,Mr(9,{destroy:void 0},l1.bind(null,d,p,o,r),null),ct===null)throw Error(i(349));x||(an&127)!==0||u1(d,r,o)}return o}function u1(n,r,o){n.flags|=16384,n={getSnapshot:r,value:o},r=Pe.updateQueue,r===null?(r=Qo(),Pe.updateQueue=r,r.stores=[n]):(o=r.stores,o===null?r.stores=[n]:o.push(n))}function l1(n,r,o,d){r.value=o,r.getSnapshot=d,c1(r)&&d1(n)}function o1(n,r,o){return o(function(){c1(r)&&d1(n)})}function c1(n){var r=n.getSnapshot;n=n.value;try{var o=r();return!Hs(n,o)}catch{return!0}}function d1(n){var r=Ra(n,2);r!==null&&Cs(r,n,2)}function uh(n){var r=Es();if(typeof n=="function"){var o=n;if(n=o(),Ua){Nn(!0);try{o()}finally{Nn(!1)}}}return r.memoizedState=r.baseState=n,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:rn,lastRenderedState:n},r}function f1(n,r,o,d){return n.baseState=o,ah(n,at,typeof d=="function"?d:rn)}function NA(n,r,o,d,p){if(ec(n))throw Error(i(485));if(n=r.action,n!==null){var x={payload:p,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(_){x.listeners.push(_)}};B.T!==null?o(!0):x.isTransition=!1,d(x),o=r.pending,o===null?(x.next=r.pending=x,h1(r,x)):(x.next=o.next,r.pending=o.next=x)}}function h1(n,r){var o=r.action,d=r.payload,p=n.state;if(r.isTransition){var x=B.T,_={};B.T=_;try{var C=o(p,d),P=B.S;P!==null&&P(_,C),m1(n,r,C)}catch(Q){lh(n,r,Q)}finally{x!==null&&_.types!==null&&(x.types=_.types),B.T=x}}else try{x=o(p,d),m1(n,r,x)}catch(Q){lh(n,r,Q)}}function m1(n,r,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(d){g1(n,r,d)},function(d){return lh(n,r,d)}):g1(n,r,o)}function g1(n,r,o){r.status="fulfilled",r.value=o,p1(r),n.state=o,r=n.pending,r!==null&&(o=r.next,o===r?n.pending=null:(o=o.next,r.next=o,h1(n,o)))}function lh(n,r,o){var d=n.pending;if(n.pending=null,d!==null){d=d.next;do r.status="rejected",r.reason=o,p1(r),r=r.next;while(r!==d)}n.action=null}function p1(n){n=n.listeners;for(var r=0;r<n.length;r++)(0,n[r])()}function b1(n,r){return r}function E1(n,r){if(Ke){var o=ct.formState;if(o!==null){e:{var d=Pe;if(Ke){if(ht){t:{for(var p=ht,x=ui;p.nodeType!==8;){if(!x){p=null;break t}if(p=oi(p.nextSibling),p===null){p=null;break t}}x=p.data,p=x==="F!"||x==="F"?p:null}if(p){ht=oi(p.nextSibling),d=p.data==="F!";break e}}kn(d)}d=!1}d&&(r=o[0])}}return o=Es(),o.memoizedState=o.baseState=r,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:b1,lastRenderedState:r},o.queue=d,o=U1.bind(null,Pe,d),d.dispatch=o,d=uh(!1),x=mh.bind(null,Pe,!1,d.queue),d=Es(),p={state:r,dispatch:null,action:n,pending:null},d.queue=p,o=NA.bind(null,Pe,p,x,o),p.dispatch=o,d.memoizedState=n,[r,o,!1]}function x1(n){var r=Nt();return T1(r,at,n)}function T1(n,r,o){if(r=ah(n,r,b1)[0],n=Wo(rn)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var d=Zu(r)}catch(_){throw _===Cr?Ho:_}else d=r;r=Nt();var p=r.queue,x=p.dispatch;return o!==r.memoizedState&&(Pe.flags|=2048,Mr(9,{destroy:void 0},CA.bind(null,p,o),null)),[d,x,n]}function CA(n,r){n.action=r}function y1(n){var r=Nt(),o=at;if(o!==null)return T1(r,o,n);Nt(),r=r.memoizedState,o=Nt();var d=o.queue.dispatch;return o.memoizedState=n,[r,d,!1]}function Mr(n,r,o,d){return n={tag:n,create:o,deps:d,inst:r,next:null},r=Pe.updateQueue,r===null&&(r=Qo(),Pe.updateQueue=r),o=r.lastEffect,o===null?r.lastEffect=n.next=n:(d=o.next,o.next=n,n.next=d,r.lastEffect=n),n}function v1(){return Nt().memoizedState}function Zo(n,r,o,d){var p=Es();Pe.flags|=n,p.memoizedState=Mr(1|r,{destroy:void 0},o,d===void 0?null:d)}function Jo(n,r,o,d){var p=Nt();d=d===void 0?null:d;var x=p.memoizedState.inst;at!==null&&d!==null&&Jf(d,at.memoizedState.deps)?p.memoizedState=Mr(r,x,o,d):(Pe.flags|=n,p.memoizedState=Mr(1|r,x,o,d))}function S1(n,r){Zo(8390656,8,n,r)}function oh(n,r){Jo(2048,8,n,r)}function DA(n){Pe.flags|=4;var r=Pe.updateQueue;if(r===null)r=Qo(),Pe.updateQueue=r,r.events=[n];else{var o=r.events;o===null?r.events=[n]:o.push(n)}}function A1(n){var r=Nt().memoizedState;return DA({ref:r,nextImpl:n}),function(){if((Je&2)!==0)throw Error(i(440));return r.impl.apply(void 0,arguments)}}function _1(n,r){return Jo(4,2,n,r)}function L1(n,r){return Jo(4,4,n,r)}function I1(n,r){if(typeof r=="function"){n=n();var o=r(n);return function(){typeof o=="function"?o():r(null)}}if(r!=null)return n=n(),r.current=n,function(){r.current=null}}function R1(n,r,o){o=o!=null?o.concat([n]):null,Jo(4,4,I1.bind(null,r,n),o)}function ch(){}function N1(n,r){var o=Nt();r=r===void 0?null:r;var d=o.memoizedState;return r!==null&&Jf(r,d[1])?d[0]:(o.memoizedState=[n,r],n)}function C1(n,r){var o=Nt();r=r===void 0?null:r;var d=o.memoizedState;if(r!==null&&Jf(r,d[1]))return d[0];if(d=n(),Ua){Nn(!0);try{n()}finally{Nn(!1)}}return o.memoizedState=[d,r],d}function dh(n,r,o){return o===void 0||(an&1073741824)!==0&&(qe&261930)===0?n.memoizedState=r:(n.memoizedState=o,n=Db(),Pe.lanes|=n,Gn|=n,o)}function D1(n,r,o,d){return Hs(o,r)?o:Or.current!==null?(n=dh(n,o,d),Hs(n,r)||(kt=!0),n):(an&42)===0||(an&1073741824)!==0&&(qe&261930)===0?(kt=!0,n.memoizedState=o):(n=Db(),Pe.lanes|=n,Gn|=n,r)}function O1(n,r,o,d,p){var x=W.p;W.p=x!==0&&8>x?x:8;var _=B.T,C={};B.T=C,mh(n,!1,r,o);try{var P=p(),Q=B.S;if(Q!==null&&Q(C,P),P!==null&&typeof P=="object"&&typeof P.then=="function"){var ae=LA(P,d);Ju(n,r,ae,Ks(n))}else Ju(n,r,d,Ks(n))}catch(oe){Ju(n,r,{then:function(){},status:"rejected",reason:oe},Ks())}finally{W.p=x,_!==null&&C.types!==null&&(_.types=C.types),B.T=_}}function OA(){}function fh(n,r,o,d){if(n.tag!==5)throw Error(i(476));var p=w1(n).queue;O1(n,p,r,te,o===null?OA:function(){return k1(n),o(d)})}function w1(n){var r=n.memoizedState;if(r!==null)return r;r={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:rn,lastRenderedState:te},next:null};var o={};return r.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:rn,lastRenderedState:o},next:null},n.memoizedState=r,n=n.alternate,n!==null&&(n.memoizedState=r),r}function k1(n){var r=w1(n);r.next===null&&(r=n.alternate.memoizedState),Ju(n,r.next.queue,{},Ks())}function hh(){return us(pl)}function M1(){return Nt().memoizedState}function P1(){return Nt().memoizedState}function wA(n){for(var r=n.return;r!==null;){switch(r.tag){case 24:case 3:var o=Ks();n=Un(o);var d=Bn(r,n,o);d!==null&&(Cs(d,r,o),zu(d,r,o)),r={cache:$f()},n.payload=r;return}r=r.return}}function kA(n,r,o){var d=Ks();o={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},ec(n)?B1(r,o):(o=Df(n,r,o,d),o!==null&&(Cs(o,n,d),F1(o,r,d)))}function U1(n,r,o){var d=Ks();Ju(n,r,o,d)}function Ju(n,r,o,d){var p={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(ec(n))B1(r,p);else{var x=n.alternate;if(n.lanes===0&&(x===null||x.lanes===0)&&(x=r.lastRenderedReducer,x!==null))try{var _=r.lastRenderedState,C=x(_,o);if(p.hasEagerState=!0,p.eagerState=C,Hs(C,_))return ko(n,r,p,0),ct===null&&wo(),!1}catch{}finally{}if(o=Df(n,r,p,d),o!==null)return Cs(o,n,d),F1(o,r,d),!0}return!1}function mh(n,r,o,d){if(d={lane:2,revertLane:Yh(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},ec(n)){if(r)throw Error(i(479))}else r=Df(n,o,d,2),r!==null&&Cs(r,n,2)}function ec(n){var r=n.alternate;return n===Pe||r!==null&&r===Pe}function B1(n,r){wr=Ko=!0;var o=n.pending;o===null?r.next=r:(r.next=o.next,o.next=r),n.pending=r}function F1(n,r,o){if((o&4194048)!==0){var d=r.lanes;d&=n.pendingLanes,o|=d,r.lanes=o,Vg(n,o)}}var el={readContext:us,use:Xo,useCallback:vt,useContext:vt,useEffect:vt,useImperativeHandle:vt,useLayoutEffect:vt,useInsertionEffect:vt,useMemo:vt,useReducer:vt,useRef:vt,useState:vt,useDebugValue:vt,useDeferredValue:vt,useTransition:vt,useSyncExternalStore:vt,useId:vt,useHostTransitionStatus:vt,useFormState:vt,useActionState:vt,useOptimistic:vt,useMemoCache:vt,useCacheRefresh:vt};el.useEffectEvent=vt;var j1={readContext:us,use:Xo,useCallback:function(n,r){return Es().memoizedState=[n,r===void 0?null:r],n},useContext:us,useEffect:S1,useImperativeHandle:function(n,r,o){o=o!=null?o.concat([n]):null,Zo(4194308,4,I1.bind(null,r,n),o)},useLayoutEffect:function(n,r){return Zo(4194308,4,n,r)},useInsertionEffect:function(n,r){Zo(4,2,n,r)},useMemo:function(n,r){var o=Es();r=r===void 0?null:r;var d=n();if(Ua){Nn(!0);try{n()}finally{Nn(!1)}}return o.memoizedState=[d,r],d},useReducer:function(n,r,o){var d=Es();if(o!==void 0){var p=o(r);if(Ua){Nn(!0);try{o(r)}finally{Nn(!1)}}}else p=r;return d.memoizedState=d.baseState=p,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:p},d.queue=n,n=n.dispatch=kA.bind(null,Pe,n),[d.memoizedState,n]},useRef:function(n){var r=Es();return n={current:n},r.memoizedState=n},useState:function(n){n=uh(n);var r=n.queue,o=U1.bind(null,Pe,r);return r.dispatch=o,[n.memoizedState,o]},useDebugValue:ch,useDeferredValue:function(n,r){var o=Es();return dh(o,n,r)},useTransition:function(){var n=uh(!1);return n=O1.bind(null,Pe,n.queue,!0,!1),Es().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,r,o){var d=Pe,p=Es();if(Ke){if(o===void 0)throw Error(i(407));o=o()}else{if(o=r(),ct===null)throw Error(i(349));(qe&127)!==0||u1(d,r,o)}p.memoizedState=o;var x={value:o,getSnapshot:r};return p.queue=x,S1(o1.bind(null,d,x,n),[n]),d.flags|=2048,Mr(9,{destroy:void 0},l1.bind(null,d,x,o,r),null),o},useId:function(){var n=Es(),r=ct.identifierPrefix;if(Ke){var o=Ci,d=Ni;o=(d&~(1<<32-js(d)-1)).toString(32)+o,r="_"+r+"R_"+o,o=zo++,0<o&&(r+="H"+o.toString(32)),r+="_"}else o=IA++,r="_"+r+"r_"+o.toString(32)+"_";return n.memoizedState=r},useHostTransitionStatus:hh,useFormState:E1,useActionState:E1,useOptimistic:function(n){var r=Es();r.memoizedState=r.baseState=n;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=o,r=mh.bind(null,Pe,!0,o),o.dispatch=r,[n,r]},useMemoCache:nh,useCacheRefresh:function(){return Es().memoizedState=wA.bind(null,Pe)},useEffectEvent:function(n){var r=Es(),o={impl:n};return r.memoizedState=o,function(){if((Je&2)!==0)throw Error(i(440));return o.impl.apply(void 0,arguments)}}},gh={readContext:us,use:Xo,useCallback:N1,useContext:us,useEffect:oh,useImperativeHandle:R1,useInsertionEffect:_1,useLayoutEffect:L1,useMemo:C1,useReducer:Wo,useRef:v1,useState:function(){return Wo(rn)},useDebugValue:ch,useDeferredValue:function(n,r){var o=Nt();return D1(o,at.memoizedState,n,r)},useTransition:function(){var n=Wo(rn)[0],r=Nt().memoizedState;return[typeof n=="boolean"?n:Zu(n),r]},useSyncExternalStore:r1,useId:M1,useHostTransitionStatus:hh,useFormState:x1,useActionState:x1,useOptimistic:function(n,r){var o=Nt();return f1(o,at,n,r)},useMemoCache:nh,useCacheRefresh:P1};gh.useEffectEvent=A1;var H1={readContext:us,use:Xo,useCallback:N1,useContext:us,useEffect:oh,useImperativeHandle:R1,useInsertionEffect:_1,useLayoutEffect:L1,useMemo:C1,useReducer:rh,useRef:v1,useState:function(){return rh(rn)},useDebugValue:ch,useDeferredValue:function(n,r){var o=Nt();return at===null?dh(o,n,r):D1(o,at.memoizedState,n,r)},useTransition:function(){var n=rh(rn)[0],r=Nt().memoizedState;return[typeof n=="boolean"?n:Zu(n),r]},useSyncExternalStore:r1,useId:M1,useHostTransitionStatus:hh,useFormState:y1,useActionState:y1,useOptimistic:function(n,r){var o=Nt();return at!==null?f1(o,at,n,r):(o.baseState=n,[n,o.queue.dispatch])},useMemoCache:nh,useCacheRefresh:P1};H1.useEffectEvent=A1;function ph(n,r,o,d){r=n.memoizedState,o=o(d,r),o=o==null?r:g({},r,o),n.memoizedState=o,n.lanes===0&&(n.updateQueue.baseState=o)}var bh={enqueueSetState:function(n,r,o){n=n._reactInternals;var d=Ks(),p=Un(d);p.payload=r,o!=null&&(p.callback=o),r=Bn(n,p,d),r!==null&&(Cs(r,n,d),zu(r,n,d))},enqueueReplaceState:function(n,r,o){n=n._reactInternals;var d=Ks(),p=Un(d);p.tag=1,p.payload=r,o!=null&&(p.callback=o),r=Bn(n,p,d),r!==null&&(Cs(r,n,d),zu(r,n,d))},enqueueForceUpdate:function(n,r){n=n._reactInternals;var o=Ks(),d=Un(o);d.tag=2,r!=null&&(d.callback=r),r=Bn(n,d,o),r!==null&&(Cs(r,n,o),zu(r,n,o))}};function $1(n,r,o,d,p,x,_){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(d,x,_):r.prototype&&r.prototype.isPureReactComponent?!ju(o,d)||!ju(p,x):!0}function G1(n,r,o,d){n=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(o,d),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(o,d),r.state!==n&&bh.enqueueReplaceState(r,r.state,null)}function Ba(n,r){var o=r;if("ref"in r){o={};for(var d in r)d!=="ref"&&(o[d]=r[d])}if(n=n.defaultProps){o===r&&(o=g({},o));for(var p in n)o[p]===void 0&&(o[p]=n[p])}return o}function V1(n){Oo(n)}function q1(n){console.error(n)}function Y1(n){Oo(n)}function tc(n,r){try{var o=n.onUncaughtError;o(r.value,{componentStack:r.stack})}catch(d){setTimeout(function(){throw d})}}function K1(n,r,o){try{var d=n.onCaughtError;d(o.value,{componentStack:o.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function Eh(n,r,o){return o=Un(o),o.tag=3,o.payload={element:null},o.callback=function(){tc(n,r)},o}function z1(n){return n=Un(n),n.tag=3,n}function Q1(n,r,o,d){var p=o.type.getDerivedStateFromError;if(typeof p=="function"){var x=d.value;n.payload=function(){return p(x)},n.callback=function(){K1(r,o,d)}}var _=o.stateNode;_!==null&&typeof _.componentDidCatch=="function"&&(n.callback=function(){K1(r,o,d),typeof p!="function"&&(Vn===null?Vn=new Set([this]):Vn.add(this));var C=d.stack;this.componentDidCatch(d.value,{componentStack:C!==null?C:""})})}function MA(n,r,o,d,p){if(o.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(r=o.alternate,r!==null&&Ir(r,o,p,!0),o=Gs.current,o!==null){switch(o.tag){case 31:case 13:return li===null?hc():o.alternate===null&&St===0&&(St=3),o.flags&=-257,o.flags|=65536,o.lanes=p,d===$o?o.flags|=16384:(r=o.updateQueue,r===null?o.updateQueue=new Set([d]):r.add(d),Gh(n,d,p)),!1;case 22:return o.flags|=65536,d===$o?o.flags|=16384:(r=o.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([d])},o.updateQueue=r):(o=r.retryQueue,o===null?r.retryQueue=new Set([d]):o.add(d)),Gh(n,d,p)),!1}throw Error(i(435,o.tag))}return Gh(n,d,p),hc(),!1}if(Ke)return r=Gs.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=p,d!==Uf&&(n=Error(i(422),{cause:d}),Gu(ni(n,o)))):(d!==Uf&&(r=Error(i(423),{cause:d}),Gu(ni(r,o))),n=n.current.alternate,n.flags|=65536,p&=-p,n.lanes|=p,d=ni(d,o),p=Eh(n.stateNode,d,p),zf(n,p),St!==4&&(St=2)),!1;var x=Error(i(520),{cause:d});if(x=ni(x,o),ll===null?ll=[x]:ll.push(x),St!==4&&(St=2),r===null)return!0;d=ni(d,o),o=r;do{switch(o.tag){case 3:return o.flags|=65536,n=p&-p,o.lanes|=n,n=Eh(o.stateNode,d,n),zf(o,n),!1;case 1:if(r=o.type,x=o.stateNode,(o.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Vn===null||!Vn.has(x))))return o.flags|=65536,p&=-p,o.lanes|=p,p=z1(p),Q1(p,n,o,d),zf(o,p),!1}o=o.return}while(o!==null);return!1}var xh=Error(i(461)),kt=!1;function ls(n,r,o,d){r.child=n===null?Jp(r,null,o,d):Pa(r,n.child,o,d)}function X1(n,r,o,d,p){o=o.render;var x=r.ref;if("ref"in d){var _={};for(var C in d)C!=="ref"&&(_[C]=d[C])}else _=d;return Oa(r),d=eh(n,r,o,_,x,p),C=th(),n!==null&&!kt?(sh(n,r,p),un(n,r,p)):(Ke&&C&&Mf(r),r.flags|=1,ls(n,r,d,p),r.child)}function W1(n,r,o,d,p){if(n===null){var x=o.type;return typeof x=="function"&&!Of(x)&&x.defaultProps===void 0&&o.compare===null?(r.tag=15,r.type=x,Z1(n,r,x,d,p)):(n=Po(o.type,null,d,r,r.mode,p),n.ref=r.ref,n.return=r,r.child=n)}if(x=n.child,!Ih(n,p)){var _=x.memoizedProps;if(o=o.compare,o=o!==null?o:ju,o(_,d)&&n.ref===r.ref)return un(n,r,p)}return r.flags|=1,n=en(x,d),n.ref=r.ref,n.return=r,r.child=n}function Z1(n,r,o,d,p){if(n!==null){var x=n.memoizedProps;if(ju(x,d)&&n.ref===r.ref)if(kt=!1,r.pendingProps=d=x,Ih(n,p))(n.flags&131072)!==0&&(kt=!0);else return r.lanes=n.lanes,un(n,r,p)}return Th(n,r,o,d,p)}function J1(n,r,o,d){var p=d.children,x=n!==null?n.memoizedState:null;if(n===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((r.flags&128)!==0){if(x=x!==null?x.baseLanes|o:o,n!==null){for(d=r.child=n.child,p=0;d!==null;)p=p|d.lanes|d.childLanes,d=d.sibling;d=p&~x}else d=0,r.child=null;return eb(n,r,x,o,d)}if((o&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},n!==null&&jo(r,x!==null?x.cachePool:null),x!==null?s1(r,x):Xf(),i1(r);else return d=r.lanes=536870912,eb(n,r,x!==null?x.baseLanes|o:o,o,d)}else x!==null?(jo(r,x.cachePool),s1(r,x),jn(),r.memoizedState=null):(n!==null&&jo(r,null),Xf(),jn());return ls(n,r,p,o),r.child}function tl(n,r){return n!==null&&n.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function eb(n,r,o,d,p){var x=Vf();return x=x===null?null:{parent:Ot._currentValue,pool:x},r.memoizedState={baseLanes:o,cachePool:x},n!==null&&jo(r,null),Xf(),i1(r),n!==null&&Ir(n,r,d,!0),r.childLanes=p,null}function sc(n,r){return r=nc({mode:r.mode,children:r.children},n.mode),r.ref=n.ref,n.child=r,r.return=n,r}function tb(n,r,o){return Pa(r,n.child,null,o),n=sc(r,r.pendingProps),n.flags|=2,Vs(r),r.memoizedState=null,n}function PA(n,r,o){var d=r.pendingProps,p=(r.flags&128)!==0;if(r.flags&=-129,n===null){if(Ke){if(d.mode==="hidden")return n=sc(r,d),r.lanes=536870912,tl(null,n);if(Zf(r),(n=ht)?(n=hE(n,ui),n=n!==null&&n.data==="&"?n:null,n!==null&&(r.memoizedState={dehydrated:n,treeContext:On!==null?{id:Ni,overflow:Ci}:null,retryLane:536870912,hydrationErrors:null},o=Bp(n),o.return=r,r.child=o,rs=r,ht=null)):n=null,n===null)throw kn(r);return r.lanes=536870912,null}return sc(r,d)}var x=n.memoizedState;if(x!==null){var _=x.dehydrated;if(Zf(r),p)if(r.flags&256)r.flags&=-257,r=tb(n,r,o);else if(r.memoizedState!==null)r.child=n.child,r.flags|=128,r=null;else throw Error(i(558));else if(kt||Ir(n,r,o,!1),p=(o&n.childLanes)!==0,kt||p){if(d=ct,d!==null&&(_=qg(d,o),_!==0&&_!==x.retryLane))throw x.retryLane=_,Ra(n,_),Cs(d,n,_),xh;hc(),r=tb(n,r,o)}else n=x.treeContext,ht=oi(_.nextSibling),rs=r,Ke=!0,wn=null,ui=!1,n!==null&&Hp(r,n),r=sc(r,d),r.flags|=4096;return r}return n=en(n.child,{mode:d.mode,children:d.children}),n.ref=r.ref,r.child=n,n.return=r,n}function ic(n,r){var o=r.ref;if(o===null)n!==null&&n.ref!==null&&(r.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(i(284));(n===null||n.ref!==o)&&(r.flags|=4194816)}}function Th(n,r,o,d,p){return Oa(r),o=eh(n,r,o,d,void 0,p),d=th(),n!==null&&!kt?(sh(n,r,p),un(n,r,p)):(Ke&&d&&Mf(r),r.flags|=1,ls(n,r,o,p),r.child)}function sb(n,r,o,d,p,x){return Oa(r),r.updateQueue=null,o=a1(r,d,o,p),n1(n),d=th(),n!==null&&!kt?(sh(n,r,x),un(n,r,x)):(Ke&&d&&Mf(r),r.flags|=1,ls(n,r,o,x),r.child)}function ib(n,r,o,d,p){if(Oa(r),r.stateNode===null){var x=Sr,_=o.contextType;typeof _=="object"&&_!==null&&(x=us(_)),x=new o(d,x),r.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=bh,r.stateNode=x,x._reactInternals=r,x=r.stateNode,x.props=d,x.state=r.memoizedState,x.refs={},Yf(r),_=o.contextType,x.context=typeof _=="object"&&_!==null?us(_):Sr,x.state=r.memoizedState,_=o.getDerivedStateFromProps,typeof _=="function"&&(ph(r,o,_,d),x.state=r.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(_=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),_!==x.state&&bh.enqueueReplaceState(x,x.state,null),Xu(r,d,x,p),Qu(),x.state=r.memoizedState),typeof x.componentDidMount=="function"&&(r.flags|=4194308),d=!0}else if(n===null){x=r.stateNode;var C=r.memoizedProps,P=Ba(o,C);x.props=P;var Q=x.context,ae=o.contextType;_=Sr,typeof ae=="object"&&ae!==null&&(_=us(ae));var oe=o.getDerivedStateFromProps;ae=typeof oe=="function"||typeof x.getSnapshotBeforeUpdate=="function",C=r.pendingProps!==C,ae||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(C||Q!==_)&&G1(r,x,d,_),Pn=!1;var X=r.memoizedState;x.state=X,Xu(r,d,x,p),Qu(),Q=r.memoizedState,C||X!==Q||Pn?(typeof oe=="function"&&(ph(r,o,oe,d),Q=r.memoizedState),(P=Pn||$1(r,o,P,d,X,Q,_))?(ae||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(r.flags|=4194308)):(typeof x.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=d,r.memoizedState=Q),x.props=d,x.state=Q,x.context=_,d=P):(typeof x.componentDidMount=="function"&&(r.flags|=4194308),d=!1)}else{x=r.stateNode,Kf(n,r),_=r.memoizedProps,ae=Ba(o,_),x.props=ae,oe=r.pendingProps,X=x.context,Q=o.contextType,P=Sr,typeof Q=="object"&&Q!==null&&(P=us(Q)),C=o.getDerivedStateFromProps,(Q=typeof C=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(_!==oe||X!==P)&&G1(r,x,d,P),Pn=!1,X=r.memoizedState,x.state=X,Xu(r,d,x,p),Qu();var Z=r.memoizedState;_!==oe||X!==Z||Pn||n!==null&&n.dependencies!==null&&Bo(n.dependencies)?(typeof C=="function"&&(ph(r,o,C,d),Z=r.memoizedState),(ae=Pn||$1(r,o,ae,d,X,Z,P)||n!==null&&n.dependencies!==null&&Bo(n.dependencies))?(Q||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(d,Z,P),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(d,Z,P)),typeof x.componentDidUpdate=="function"&&(r.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof x.componentDidUpdate!="function"||_===n.memoizedProps&&X===n.memoizedState||(r.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||_===n.memoizedProps&&X===n.memoizedState||(r.flags|=1024),r.memoizedProps=d,r.memoizedState=Z),x.props=d,x.state=Z,x.context=P,d=ae):(typeof x.componentDidUpdate!="function"||_===n.memoizedProps&&X===n.memoizedState||(r.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||_===n.memoizedProps&&X===n.memoizedState||(r.flags|=1024),d=!1)}return x=d,ic(n,r),d=(r.flags&128)!==0,x||d?(x=r.stateNode,o=d&&typeof o.getDerivedStateFromError!="function"?null:x.render(),r.flags|=1,n!==null&&d?(r.child=Pa(r,n.child,null,p),r.child=Pa(r,null,o,p)):ls(n,r,o,p),r.memoizedState=x.state,n=r.child):n=un(n,r,p),n}function nb(n,r,o,d){return Ca(),r.flags|=256,ls(n,r,o,d),r.child}var yh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function vh(n){return{baseLanes:n,cachePool:Kp()}}function Sh(n,r,o){return n=n!==null?n.childLanes&~o:0,r&&(n|=Ys),n}function ab(n,r,o){var d=r.pendingProps,p=!1,x=(r.flags&128)!==0,_;if((_=x)||(_=n!==null&&n.memoizedState===null?!1:(Rt.current&2)!==0),_&&(p=!0,r.flags&=-129),_=(r.flags&32)!==0,r.flags&=-33,n===null){if(Ke){if(p?Fn(r):jn(),(n=ht)?(n=hE(n,ui),n=n!==null&&n.data!=="&"?n:null,n!==null&&(r.memoizedState={dehydrated:n,treeContext:On!==null?{id:Ni,overflow:Ci}:null,retryLane:536870912,hydrationErrors:null},o=Bp(n),o.return=r,r.child=o,rs=r,ht=null)):n=null,n===null)throw kn(r);return a0(n)?r.lanes=32:r.lanes=536870912,null}var C=d.children;return d=d.fallback,p?(jn(),p=r.mode,C=nc({mode:"hidden",children:C},p),d=Na(d,p,o,null),C.return=r,d.return=r,C.sibling=d,r.child=C,d=r.child,d.memoizedState=vh(o),d.childLanes=Sh(n,_,o),r.memoizedState=yh,tl(null,d)):(Fn(r),Ah(r,C))}var P=n.memoizedState;if(P!==null&&(C=P.dehydrated,C!==null)){if(x)r.flags&256?(Fn(r),r.flags&=-257,r=_h(n,r,o)):r.memoizedState!==null?(jn(),r.child=n.child,r.flags|=128,r=null):(jn(),C=d.fallback,p=r.mode,d=nc({mode:"visible",children:d.children},p),C=Na(C,p,o,null),C.flags|=2,d.return=r,C.return=r,d.sibling=C,r.child=d,Pa(r,n.child,null,o),d=r.child,d.memoizedState=vh(o),d.childLanes=Sh(n,_,o),r.memoizedState=yh,r=tl(null,d));else if(Fn(r),a0(C)){if(_=C.nextSibling&&C.nextSibling.dataset,_)var Q=_.dgst;_=Q,d=Error(i(419)),d.stack="",d.digest=_,Gu({value:d,source:null,stack:null}),r=_h(n,r,o)}else if(kt||Ir(n,r,o,!1),_=(o&n.childLanes)!==0,kt||_){if(_=ct,_!==null&&(d=qg(_,o),d!==0&&d!==P.retryLane))throw P.retryLane=d,Ra(n,d),Cs(_,n,d),xh;n0(C)||hc(),r=_h(n,r,o)}else n0(C)?(r.flags|=192,r.child=n.child,r=null):(n=P.treeContext,ht=oi(C.nextSibling),rs=r,Ke=!0,wn=null,ui=!1,n!==null&&Hp(r,n),r=Ah(r,d.children),r.flags|=4096);return r}return p?(jn(),C=d.fallback,p=r.mode,P=n.child,Q=P.sibling,d=en(P,{mode:"hidden",children:d.children}),d.subtreeFlags=P.subtreeFlags&65011712,Q!==null?C=en(Q,C):(C=Na(C,p,o,null),C.flags|=2),C.return=r,d.return=r,d.sibling=C,r.child=d,tl(null,d),d=r.child,C=n.child.memoizedState,C===null?C=vh(o):(p=C.cachePool,p!==null?(P=Ot._currentValue,p=p.parent!==P?{parent:P,pool:P}:p):p=Kp(),C={baseLanes:C.baseLanes|o,cachePool:p}),d.memoizedState=C,d.childLanes=Sh(n,_,o),r.memoizedState=yh,tl(n.child,d)):(Fn(r),o=n.child,n=o.sibling,o=en(o,{mode:"visible",children:d.children}),o.return=r,o.sibling=null,n!==null&&(_=r.deletions,_===null?(r.deletions=[n],r.flags|=16):_.push(n)),r.child=o,r.memoizedState=null,o)}function Ah(n,r){return r=nc({mode:"visible",children:r},n.mode),r.return=n,n.child=r}function nc(n,r){return n=$s(22,n,null,r),n.lanes=0,n}function _h(n,r,o){return Pa(r,n.child,null,o),n=Ah(r,r.pendingProps.children),n.flags|=2,r.memoizedState=null,n}function rb(n,r,o){n.lanes|=r;var d=n.alternate;d!==null&&(d.lanes|=r),jf(n.return,r,o)}function Lh(n,r,o,d,p,x){var _=n.memoizedState;_===null?n.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:d,tail:o,tailMode:p,treeForkCount:x}:(_.isBackwards=r,_.rendering=null,_.renderingStartTime=0,_.last=d,_.tail=o,_.tailMode=p,_.treeForkCount=x)}function ub(n,r,o){var d=r.pendingProps,p=d.revealOrder,x=d.tail;d=d.children;var _=Rt.current,C=(_&2)!==0;if(C?(_=_&1|2,r.flags|=128):_&=1,xe(Rt,_),ls(n,r,d,o),d=Ke?$u:0,!C&&n!==null&&(n.flags&128)!==0)e:for(n=r.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&rb(n,o,r);else if(n.tag===19)rb(n,o,r);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break e;for(;n.sibling===null;){if(n.return===null||n.return===r)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(p){case"forwards":for(o=r.child,p=null;o!==null;)n=o.alternate,n!==null&&Yo(n)===null&&(p=o),o=o.sibling;o=p,o===null?(p=r.child,r.child=null):(p=o.sibling,o.sibling=null),Lh(r,!1,p,o,x,d);break;case"backwards":case"unstable_legacy-backwards":for(o=null,p=r.child,r.child=null;p!==null;){if(n=p.alternate,n!==null&&Yo(n)===null){r.child=p;break}n=p.sibling,p.sibling=o,o=p,p=n}Lh(r,!0,o,null,x,d);break;case"together":Lh(r,!1,null,null,void 0,d);break;default:r.memoizedState=null}return r.child}function un(n,r,o){if(n!==null&&(r.dependencies=n.dependencies),Gn|=r.lanes,(o&r.childLanes)===0)if(n!==null){if(Ir(n,r,o,!1),(o&r.childLanes)===0)return null}else return null;if(n!==null&&r.child!==n.child)throw Error(i(153));if(r.child!==null){for(n=r.child,o=en(n,n.pendingProps),r.child=o,o.return=r;n.sibling!==null;)n=n.sibling,o=o.sibling=en(n,n.pendingProps),o.return=r;o.sibling=null}return r.child}function Ih(n,r){return(n.lanes&r)!==0?!0:(n=n.dependencies,!!(n!==null&&Bo(n)))}function UA(n,r,o){switch(r.tag){case 3:yt(r,r.stateNode.containerInfo),Mn(r,Ot,n.memoizedState.cache),Ca();break;case 27:case 5:Ss(r);break;case 4:yt(r,r.stateNode.containerInfo);break;case 10:Mn(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,Zf(r),null;break;case 13:var d=r.memoizedState;if(d!==null)return d.dehydrated!==null?(Fn(r),r.flags|=128,null):(o&r.child.childLanes)!==0?ab(n,r,o):(Fn(r),n=un(n,r,o),n!==null?n.sibling:null);Fn(r);break;case 19:var p=(n.flags&128)!==0;if(d=(o&r.childLanes)!==0,d||(Ir(n,r,o,!1),d=(o&r.childLanes)!==0),p){if(d)return ub(n,r,o);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),xe(Rt,Rt.current),d)break;return null;case 22:return r.lanes=0,J1(n,r,o,r.pendingProps);case 24:Mn(r,Ot,n.memoizedState.cache)}return un(n,r,o)}function lb(n,r,o){if(n!==null)if(n.memoizedProps!==r.pendingProps)kt=!0;else{if(!Ih(n,o)&&(r.flags&128)===0)return kt=!1,UA(n,r,o);kt=(n.flags&131072)!==0}else kt=!1,Ke&&(r.flags&1048576)!==0&&jp(r,$u,r.index);switch(r.lanes=0,r.tag){case 16:e:{var d=r.pendingProps;if(n=ka(r.elementType),r.type=n,typeof n=="function")Of(n)?(d=Ba(n,d),r.tag=1,r=ib(null,r,n,d,o)):(r.tag=0,r=Th(null,r,n,d,o));else{if(n!=null){var p=n.$$typeof;if(p===D){r.tag=11,r=X1(null,r,n,d,o);break e}else if(p===U){r.tag=14,r=W1(null,r,n,d,o);break e}}throw r=Te(n)||n,Error(i(306,r,""))}}return r;case 0:return Th(n,r,r.type,r.pendingProps,o);case 1:return d=r.type,p=Ba(d,r.pendingProps),ib(n,r,d,p,o);case 3:e:{if(yt(r,r.stateNode.containerInfo),n===null)throw Error(i(387));d=r.pendingProps;var x=r.memoizedState;p=x.element,Kf(n,r),Xu(r,d,null,o);var _=r.memoizedState;if(d=_.cache,Mn(r,Ot,d),d!==x.cache&&Hf(r,[Ot],o,!0),Qu(),d=_.element,x.isDehydrated)if(x={element:d,isDehydrated:!1,cache:_.cache},r.updateQueue.baseState=x,r.memoizedState=x,r.flags&256){r=nb(n,r,d,o);break e}else if(d!==p){p=ni(Error(i(424)),r),Gu(p),r=nb(n,r,d,o);break e}else{switch(n=r.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(ht=oi(n.firstChild),rs=r,Ke=!0,wn=null,ui=!0,o=Jp(r,null,d,o),r.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(Ca(),d===p){r=un(n,r,o);break e}ls(n,r,d,o)}r=r.child}return r;case 26:return ic(n,r),n===null?(o=xE(r.type,null,r.pendingProps,null))?r.memoizedState=o:Ke||(o=r.type,n=r.pendingProps,d=Tc(Me.current).createElement(o),d[as]=r,d[As]=n,os(d,o,n),Wt(d),r.stateNode=d):r.memoizedState=xE(r.type,n.memoizedProps,r.pendingProps,n.memoizedState),null;case 27:return Ss(r),n===null&&Ke&&(d=r.stateNode=pE(r.type,r.pendingProps,Me.current),rs=r,ui=!0,p=ht,zn(r.type)?(r0=p,ht=oi(d.firstChild)):ht=p),ls(n,r,r.pendingProps.children,o),ic(n,r),n===null&&(r.flags|=4194304),r.child;case 5:return n===null&&Ke&&((p=d=ht)&&(d=h3(d,r.type,r.pendingProps,ui),d!==null?(r.stateNode=d,rs=r,ht=oi(d.firstChild),ui=!1,p=!0):p=!1),p||kn(r)),Ss(r),p=r.type,x=r.pendingProps,_=n!==null?n.memoizedProps:null,d=x.children,t0(p,x)?d=null:_!==null&&t0(p,_)&&(r.flags|=32),r.memoizedState!==null&&(p=eh(n,r,RA,null,null,o),pl._currentValue=p),ic(n,r),ls(n,r,d,o),r.child;case 6:return n===null&&Ke&&((n=o=ht)&&(o=m3(o,r.pendingProps,ui),o!==null?(r.stateNode=o,rs=r,ht=null,n=!0):n=!1),n||kn(r)),null;case 13:return ab(n,r,o);case 4:return yt(r,r.stateNode.containerInfo),d=r.pendingProps,n===null?r.child=Pa(r,null,d,o):ls(n,r,d,o),r.child;case 11:return X1(n,r,r.type,r.pendingProps,o);case 7:return ls(n,r,r.pendingProps,o),r.child;case 8:return ls(n,r,r.pendingProps.children,o),r.child;case 12:return ls(n,r,r.pendingProps.children,o),r.child;case 10:return d=r.pendingProps,Mn(r,r.type,d.value),ls(n,r,d.children,o),r.child;case 9:return p=r.type._context,d=r.pendingProps.children,Oa(r),p=us(p),d=d(p),r.flags|=1,ls(n,r,d,o),r.child;case 14:return W1(n,r,r.type,r.pendingProps,o);case 15:return Z1(n,r,r.type,r.pendingProps,o);case 19:return ub(n,r,o);case 31:return PA(n,r,o);case 22:return J1(n,r,o,r.pendingProps);case 24:return Oa(r),d=us(Ot),n===null?(p=Vf(),p===null&&(p=ct,x=$f(),p.pooledCache=x,x.refCount++,x!==null&&(p.pooledCacheLanes|=o),p=x),r.memoizedState={parent:d,cache:p},Yf(r),Mn(r,Ot,p)):((n.lanes&o)!==0&&(Kf(n,r),Xu(r,null,null,o),Qu()),p=n.memoizedState,x=r.memoizedState,p.parent!==d?(p={parent:d,cache:d},r.memoizedState=p,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=p),Mn(r,Ot,d)):(d=x.cache,Mn(r,Ot,d),d!==p.cache&&Hf(r,[Ot],o,!0))),ls(n,r,r.pendingProps.children,o),r.child;case 29:throw r.pendingProps}throw Error(i(156,r.tag))}function ln(n){n.flags|=4}function Rh(n,r,o,d,p){if((r=(n.mode&32)!==0)&&(r=!1),r){if(n.flags|=16777216,(p&335544128)===p)if(n.stateNode.complete)n.flags|=8192;else if(Mb())n.flags|=8192;else throw Ma=$o,qf}else n.flags&=-16777217}function ob(n,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!AE(r))if(Mb())n.flags|=8192;else throw Ma=$o,qf}function ac(n,r){r!==null&&(n.flags|=4),n.flags&16384&&(r=n.tag!==22?$g():536870912,n.lanes|=r,Fr|=r)}function sl(n,r){if(!Ke)switch(n.tailMode){case"hidden":r=n.tail;for(var o=null;r!==null;)r.alternate!==null&&(o=r),r=r.sibling;o===null?n.tail=null:o.sibling=null;break;case"collapsed":o=n.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?r||n.tail===null?n.tail=null:n.tail.sibling=null:d.sibling=null}}function mt(n){var r=n.alternate!==null&&n.alternate.child===n.child,o=0,d=0;if(r)for(var p=n.child;p!==null;)o|=p.lanes|p.childLanes,d|=p.subtreeFlags&65011712,d|=p.flags&65011712,p.return=n,p=p.sibling;else for(p=n.child;p!==null;)o|=p.lanes|p.childLanes,d|=p.subtreeFlags,d|=p.flags,p.return=n,p=p.sibling;return n.subtreeFlags|=d,n.childLanes=o,r}function BA(n,r,o){var d=r.pendingProps;switch(Pf(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return mt(r),null;case 1:return mt(r),null;case 3:return o=r.stateNode,d=null,n!==null&&(d=n.memoizedState.cache),r.memoizedState.cache!==d&&(r.flags|=2048),nn(Ot),Vt(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(n===null||n.child===null)&&(Lr(r)?ln(r):n===null||n.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Bf())),mt(r),null;case 26:var p=r.type,x=r.memoizedState;return n===null?(ln(r),x!==null?(mt(r),ob(r,x)):(mt(r),Rh(r,p,null,d,o))):x?x!==n.memoizedState?(ln(r),mt(r),ob(r,x)):(mt(r),r.flags&=-16777217):(n=n.memoizedProps,n!==d&&ln(r),mt(r),Rh(r,p,n,d,o)),null;case 27:if(ei(r),o=Me.current,p=r.type,n!==null&&r.stateNode!=null)n.memoizedProps!==d&&ln(r);else{if(!d){if(r.stateNode===null)throw Error(i(166));return mt(r),null}n=Ce.current,Lr(r)?$p(r):(n=pE(p,d,o),r.stateNode=n,ln(r))}return mt(r),null;case 5:if(ei(r),p=r.type,n!==null&&r.stateNode!=null)n.memoizedProps!==d&&ln(r);else{if(!d){if(r.stateNode===null)throw Error(i(166));return mt(r),null}if(x=Ce.current,Lr(r))$p(r);else{var _=Tc(Me.current);switch(x){case 1:x=_.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:x=_.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":x=_.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":x=_.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":x=_.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof d.is=="string"?_.createElement("select",{is:d.is}):_.createElement("select"),d.multiple?x.multiple=!0:d.size&&(x.size=d.size);break;default:x=typeof d.is=="string"?_.createElement(p,{is:d.is}):_.createElement(p)}}x[as]=r,x[As]=d;e:for(_=r.child;_!==null;){if(_.tag===5||_.tag===6)x.appendChild(_.stateNode);else if(_.tag!==4&&_.tag!==27&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===r)break e;for(;_.sibling===null;){if(_.return===null||_.return===r)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}r.stateNode=x;e:switch(os(x,p,d),p){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&ln(r)}}return mt(r),Rh(r,r.type,n===null?null:n.memoizedProps,r.pendingProps,o),null;case 6:if(n&&r.stateNode!=null)n.memoizedProps!==d&&ln(r);else{if(typeof d!="string"&&r.stateNode===null)throw Error(i(166));if(n=Me.current,Lr(r)){if(n=r.stateNode,o=r.memoizedProps,d=null,p=rs,p!==null)switch(p.tag){case 27:case 5:d=p.memoizedProps}n[as]=r,n=!!(n.nodeValue===o||d!==null&&d.suppressHydrationWarning===!0||aE(n.nodeValue,o)),n||kn(r,!0)}else n=Tc(n).createTextNode(d),n[as]=r,r.stateNode=n}return mt(r),null;case 31:if(o=r.memoizedState,n===null||n.memoizedState!==null){if(d=Lr(r),o!==null){if(n===null){if(!d)throw Error(i(318));if(n=r.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(557));n[as]=r}else Ca(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;mt(r),n=!1}else o=Bf(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=o),n=!0;if(!n)return r.flags&256?(Vs(r),r):(Vs(r),null);if((r.flags&128)!==0)throw Error(i(558))}return mt(r),null;case 13:if(d=r.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(p=Lr(r),d!==null&&d.dehydrated!==null){if(n===null){if(!p)throw Error(i(318));if(p=r.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));p[as]=r}else Ca(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;mt(r),p=!1}else p=Bf(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=p),p=!0;if(!p)return r.flags&256?(Vs(r),r):(Vs(r),null)}return Vs(r),(r.flags&128)!==0?(r.lanes=o,r):(o=d!==null,n=n!==null&&n.memoizedState!==null,o&&(d=r.child,p=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(p=d.alternate.memoizedState.cachePool.pool),x=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(x=d.memoizedState.cachePool.pool),x!==p&&(d.flags|=2048)),o!==n&&o&&(r.child.flags|=8192),ac(r,r.updateQueue),mt(r),null);case 4:return Vt(),n===null&&Xh(r.stateNode.containerInfo),mt(r),null;case 10:return nn(r.type),mt(r),null;case 19:if(ce(Rt),d=r.memoizedState,d===null)return mt(r),null;if(p=(r.flags&128)!==0,x=d.rendering,x===null)if(p)sl(d,!1);else{if(St!==0||n!==null&&(n.flags&128)!==0)for(n=r.child;n!==null;){if(x=Yo(n),x!==null){for(r.flags|=128,sl(d,!1),n=x.updateQueue,r.updateQueue=n,ac(r,n),r.subtreeFlags=0,n=o,o=r.child;o!==null;)Up(o,n),o=o.sibling;return xe(Rt,Rt.current&1|2),Ke&&tn(r,d.treeForkCount),r.child}n=n.sibling}d.tail!==null&&Xt()>cc&&(r.flags|=128,p=!0,sl(d,!1),r.lanes=4194304)}else{if(!p)if(n=Yo(x),n!==null){if(r.flags|=128,p=!0,n=n.updateQueue,r.updateQueue=n,ac(r,n),sl(d,!0),d.tail===null&&d.tailMode==="hidden"&&!x.alternate&&!Ke)return mt(r),null}else 2*Xt()-d.renderingStartTime>cc&&o!==536870912&&(r.flags|=128,p=!0,sl(d,!1),r.lanes=4194304);d.isBackwards?(x.sibling=r.child,r.child=x):(n=d.last,n!==null?n.sibling=x:r.child=x,d.last=x)}return d.tail!==null?(n=d.tail,d.rendering=n,d.tail=n.sibling,d.renderingStartTime=Xt(),n.sibling=null,o=Rt.current,xe(Rt,p?o&1|2:o&1),Ke&&tn(r,d.treeForkCount),n):(mt(r),null);case 22:case 23:return Vs(r),Wf(),d=r.memoizedState!==null,n!==null?n.memoizedState!==null!==d&&(r.flags|=8192):d&&(r.flags|=8192),d?(o&536870912)!==0&&(r.flags&128)===0&&(mt(r),r.subtreeFlags&6&&(r.flags|=8192)):mt(r),o=r.updateQueue,o!==null&&ac(r,o.retryQueue),o=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),d=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),d!==o&&(r.flags|=2048),n!==null&&ce(wa),null;case 24:return o=null,n!==null&&(o=n.memoizedState.cache),r.memoizedState.cache!==o&&(r.flags|=2048),nn(Ot),mt(r),null;case 25:return null;case 30:return null}throw Error(i(156,r.tag))}function FA(n,r){switch(Pf(r),r.tag){case 1:return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 3:return nn(Ot),Vt(),n=r.flags,(n&65536)!==0&&(n&128)===0?(r.flags=n&-65537|128,r):null;case 26:case 27:case 5:return ei(r),null;case 31:if(r.memoizedState!==null){if(Vs(r),r.alternate===null)throw Error(i(340));Ca()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 13:if(Vs(r),n=r.memoizedState,n!==null&&n.dehydrated!==null){if(r.alternate===null)throw Error(i(340));Ca()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 19:return ce(Rt),null;case 4:return Vt(),null;case 10:return nn(r.type),null;case 22:case 23:return Vs(r),Wf(),n!==null&&ce(wa),n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 24:return nn(Ot),null;case 25:return null;default:return null}}function cb(n,r){switch(Pf(r),r.tag){case 3:nn(Ot),Vt();break;case 26:case 27:case 5:ei(r);break;case 4:Vt();break;case 31:r.memoizedState!==null&&Vs(r);break;case 13:Vs(r);break;case 19:ce(Rt);break;case 10:nn(r.type);break;case 22:case 23:Vs(r),Wf(),n!==null&&ce(wa);break;case 24:nn(Ot)}}function il(n,r){try{var o=r.updateQueue,d=o!==null?o.lastEffect:null;if(d!==null){var p=d.next;o=p;do{if((o.tag&n)===n){d=void 0;var x=o.create,_=o.inst;d=x(),_.destroy=d}o=o.next}while(o!==p)}}catch(C){st(r,r.return,C)}}function Hn(n,r,o){try{var d=r.updateQueue,p=d!==null?d.lastEffect:null;if(p!==null){var x=p.next;d=x;do{if((d.tag&n)===n){var _=d.inst,C=_.destroy;if(C!==void 0){_.destroy=void 0,p=r;var P=o,Q=C;try{Q()}catch(ae){st(p,P,ae)}}}d=d.next}while(d!==x)}}catch(ae){st(r,r.return,ae)}}function db(n){var r=n.updateQueue;if(r!==null){var o=n.stateNode;try{t1(r,o)}catch(d){st(n,n.return,d)}}}function fb(n,r,o){o.props=Ba(n.type,n.memoizedProps),o.state=n.memoizedState;try{o.componentWillUnmount()}catch(d){st(n,r,d)}}function nl(n,r){try{var o=n.ref;if(o!==null){switch(n.tag){case 26:case 27:case 5:var d=n.stateNode;break;case 30:d=n.stateNode;break;default:d=n.stateNode}typeof o=="function"?n.refCleanup=o(d):o.current=d}}catch(p){st(n,r,p)}}function Di(n,r){var o=n.ref,d=n.refCleanup;if(o!==null)if(typeof d=="function")try{d()}catch(p){st(n,r,p)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(p){st(n,r,p)}else o.current=null}function hb(n){var r=n.type,o=n.memoizedProps,d=n.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":o.autoFocus&&d.focus();break e;case"img":o.src?d.src=o.src:o.srcSet&&(d.srcset=o.srcSet)}}catch(p){st(n,n.return,p)}}function Nh(n,r,o){try{var d=n.stateNode;u3(d,n.type,o,r),d[As]=r}catch(p){st(n,n.return,p)}}function mb(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&zn(n.type)||n.tag===4}function Ch(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||mb(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&zn(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Dh(n,r,o){var d=n.tag;if(d===5||d===6)n=n.stateNode,r?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(n,r):(r=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,r.appendChild(n),o=o._reactRootContainer,o!=null||r.onclick!==null||(r.onclick=Zi));else if(d!==4&&(d===27&&zn(n.type)&&(o=n.stateNode,r=null),n=n.child,n!==null))for(Dh(n,r,o),n=n.sibling;n!==null;)Dh(n,r,o),n=n.sibling}function rc(n,r,o){var d=n.tag;if(d===5||d===6)n=n.stateNode,r?o.insertBefore(n,r):o.appendChild(n);else if(d!==4&&(d===27&&zn(n.type)&&(o=n.stateNode),n=n.child,n!==null))for(rc(n,r,o),n=n.sibling;n!==null;)rc(n,r,o),n=n.sibling}function gb(n){var r=n.stateNode,o=n.memoizedProps;try{for(var d=n.type,p=r.attributes;p.length;)r.removeAttributeNode(p[0]);os(r,d,o),r[as]=n,r[As]=o}catch(x){st(n,n.return,x)}}var on=!1,Mt=!1,Oh=!1,pb=typeof WeakSet=="function"?WeakSet:Set,Zt=null;function jA(n,r){if(n=n.containerInfo,Jh=Ic,n=Rp(n),_f(n)){if("selectionStart"in n)var o={start:n.selectionStart,end:n.selectionEnd};else e:{o=(o=n.ownerDocument)&&o.defaultView||window;var d=o.getSelection&&o.getSelection();if(d&&d.rangeCount!==0){o=d.anchorNode;var p=d.anchorOffset,x=d.focusNode;d=d.focusOffset;try{o.nodeType,x.nodeType}catch{o=null;break e}var _=0,C=-1,P=-1,Q=0,ae=0,oe=n,X=null;t:for(;;){for(var Z;oe!==o||p!==0&&oe.nodeType!==3||(C=_+p),oe!==x||d!==0&&oe.nodeType!==3||(P=_+d),oe.nodeType===3&&(_+=oe.nodeValue.length),(Z=oe.firstChild)!==null;)X=oe,oe=Z;for(;;){if(oe===n)break t;if(X===o&&++Q===p&&(C=_),X===x&&++ae===d&&(P=_),(Z=oe.nextSibling)!==null)break;oe=X,X=oe.parentNode}oe=Z}o=C===-1||P===-1?null:{start:C,end:P}}else o=null}o=o||{start:0,end:0}}else o=null;for(e0={focusedElem:n,selectionRange:o},Ic=!1,Zt=r;Zt!==null;)if(r=Zt,n=r.child,(r.subtreeFlags&1028)!==0&&n!==null)n.return=r,Zt=n;else for(;Zt!==null;){switch(r=Zt,x=r.alternate,n=r.flags,r.tag){case 0:if((n&4)!==0&&(n=r.updateQueue,n=n!==null?n.events:null,n!==null))for(o=0;o<n.length;o++)p=n[o],p.ref.impl=p.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&x!==null){n=void 0,o=r,p=x.memoizedProps,x=x.memoizedState,d=o.stateNode;try{var ve=Ba(o.type,p);n=d.getSnapshotBeforeUpdate(ve,x),d.__reactInternalSnapshotBeforeUpdate=n}catch(Ie){st(o,o.return,Ie)}}break;case 3:if((n&1024)!==0){if(n=r.stateNode.containerInfo,o=n.nodeType,o===9)i0(n);else if(o===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":i0(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(i(163))}if(n=r.sibling,n!==null){n.return=r.return,Zt=n;break}Zt=r.return}}function bb(n,r,o){var d=o.flags;switch(o.tag){case 0:case 11:case 15:dn(n,o),d&4&&il(5,o);break;case 1:if(dn(n,o),d&4)if(n=o.stateNode,r===null)try{n.componentDidMount()}catch(_){st(o,o.return,_)}else{var p=Ba(o.type,r.memoizedProps);r=r.memoizedState;try{n.componentDidUpdate(p,r,n.__reactInternalSnapshotBeforeUpdate)}catch(_){st(o,o.return,_)}}d&64&&db(o),d&512&&nl(o,o.return);break;case 3:if(dn(n,o),d&64&&(n=o.updateQueue,n!==null)){if(r=null,o.child!==null)switch(o.child.tag){case 27:case 5:r=o.child.stateNode;break;case 1:r=o.child.stateNode}try{t1(n,r)}catch(_){st(o,o.return,_)}}break;case 27:r===null&&d&4&&gb(o);case 26:case 5:dn(n,o),r===null&&d&4&&hb(o),d&512&&nl(o,o.return);break;case 12:dn(n,o);break;case 31:dn(n,o),d&4&&Tb(n,o);break;case 13:dn(n,o),d&4&&yb(n,o),d&64&&(n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(o=QA.bind(null,o),g3(n,o))));break;case 22:if(d=o.memoizedState!==null||on,!d){r=r!==null&&r.memoizedState!==null||Mt,p=on;var x=Mt;on=d,(Mt=r)&&!x?fn(n,o,(o.subtreeFlags&8772)!==0):dn(n,o),on=p,Mt=x}break;case 30:break;default:dn(n,o)}}function Eb(n){var r=n.alternate;r!==null&&(n.alternate=null,Eb(r)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(r=n.stateNode,r!==null&&lf(r)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var pt=null,Ls=!1;function cn(n,r,o){for(o=o.child;o!==null;)xb(n,r,o),o=o.sibling}function xb(n,r,o){if(Fs&&typeof Fs.onCommitFiberUnmount=="function")try{Fs.onCommitFiberUnmount(Ru,o)}catch{}switch(o.tag){case 26:Mt||Di(o,r),cn(n,r,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:Mt||Di(o,r);var d=pt,p=Ls;zn(o.type)&&(pt=o.stateNode,Ls=!1),cn(n,r,o),hl(o.stateNode),pt=d,Ls=p;break;case 5:Mt||Di(o,r);case 6:if(d=pt,p=Ls,pt=null,cn(n,r,o),pt=d,Ls=p,pt!==null)if(Ls)try{(pt.nodeType===9?pt.body:pt.nodeName==="HTML"?pt.ownerDocument.body:pt).removeChild(o.stateNode)}catch(x){st(o,r,x)}else try{pt.removeChild(o.stateNode)}catch(x){st(o,r,x)}break;case 18:pt!==null&&(Ls?(n=pt,dE(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,o.stateNode),Kr(n)):dE(pt,o.stateNode));break;case 4:d=pt,p=Ls,pt=o.stateNode.containerInfo,Ls=!0,cn(n,r,o),pt=d,Ls=p;break;case 0:case 11:case 14:case 15:Hn(2,o,r),Mt||Hn(4,o,r),cn(n,r,o);break;case 1:Mt||(Di(o,r),d=o.stateNode,typeof d.componentWillUnmount=="function"&&fb(o,r,d)),cn(n,r,o);break;case 21:cn(n,r,o);break;case 22:Mt=(d=Mt)||o.memoizedState!==null,cn(n,r,o),Mt=d;break;default:cn(n,r,o)}}function Tb(n,r){if(r.memoizedState===null&&(n=r.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{Kr(n)}catch(o){st(r,r.return,o)}}}function yb(n,r){if(r.memoizedState===null&&(n=r.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{Kr(n)}catch(o){st(r,r.return,o)}}function HA(n){switch(n.tag){case 31:case 13:case 19:var r=n.stateNode;return r===null&&(r=n.stateNode=new pb),r;case 22:return n=n.stateNode,r=n._retryCache,r===null&&(r=n._retryCache=new pb),r;default:throw Error(i(435,n.tag))}}function uc(n,r){var o=HA(n);r.forEach(function(d){if(!o.has(d)){o.add(d);var p=XA.bind(null,n,d);d.then(p,p)}})}function Is(n,r){var o=r.deletions;if(o!==null)for(var d=0;d<o.length;d++){var p=o[d],x=n,_=r,C=_;e:for(;C!==null;){switch(C.tag){case 27:if(zn(C.type)){pt=C.stateNode,Ls=!1;break e}break;case 5:pt=C.stateNode,Ls=!1;break e;case 3:case 4:pt=C.stateNode.containerInfo,Ls=!0;break e}C=C.return}if(pt===null)throw Error(i(160));xb(x,_,p),pt=null,Ls=!1,x=p.alternate,x!==null&&(x.return=null),p.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)vb(r,n),r=r.sibling}var xi=null;function vb(n,r){var o=n.alternate,d=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Is(r,n),Rs(n),d&4&&(Hn(3,n,n.return),il(3,n),Hn(5,n,n.return));break;case 1:Is(r,n),Rs(n),d&512&&(Mt||o===null||Di(o,o.return)),d&64&&on&&(n=n.updateQueue,n!==null&&(d=n.callbacks,d!==null&&(o=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=o===null?d:o.concat(d))));break;case 26:var p=xi;if(Is(r,n),Rs(n),d&512&&(Mt||o===null||Di(o,o.return)),d&4){var x=o!==null?o.memoizedState:null;if(d=n.memoizedState,o===null)if(d===null)if(n.stateNode===null){e:{d=n.type,o=n.memoizedProps,p=p.ownerDocument||p;t:switch(d){case"title":x=p.getElementsByTagName("title")[0],(!x||x[Du]||x[as]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=p.createElement(d),p.head.insertBefore(x,p.querySelector("head > title"))),os(x,d,o),x[as]=n,Wt(x),d=x;break e;case"link":var _=vE("link","href",p).get(d+(o.href||""));if(_){for(var C=0;C<_.length;C++)if(x=_[C],x.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&x.getAttribute("rel")===(o.rel==null?null:o.rel)&&x.getAttribute("title")===(o.title==null?null:o.title)&&x.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){_.splice(C,1);break t}}x=p.createElement(d),os(x,d,o),p.head.appendChild(x);break;case"meta":if(_=vE("meta","content",p).get(d+(o.content||""))){for(C=0;C<_.length;C++)if(x=_[C],x.getAttribute("content")===(o.content==null?null:""+o.content)&&x.getAttribute("name")===(o.name==null?null:o.name)&&x.getAttribute("property")===(o.property==null?null:o.property)&&x.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&x.getAttribute("charset")===(o.charSet==null?null:o.charSet)){_.splice(C,1);break t}}x=p.createElement(d),os(x,d,o),p.head.appendChild(x);break;default:throw Error(i(468,d))}x[as]=n,Wt(x),d=x}n.stateNode=d}else SE(p,n.type,n.stateNode);else n.stateNode=yE(p,d,n.memoizedProps);else x!==d?(x===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):x.count--,d===null?SE(p,n.type,n.stateNode):yE(p,d,n.memoizedProps)):d===null&&n.stateNode!==null&&Nh(n,n.memoizedProps,o.memoizedProps)}break;case 27:Is(r,n),Rs(n),d&512&&(Mt||o===null||Di(o,o.return)),o!==null&&d&4&&Nh(n,n.memoizedProps,o.memoizedProps);break;case 5:if(Is(r,n),Rs(n),d&512&&(Mt||o===null||Di(o,o.return)),n.flags&32){p=n.stateNode;try{pr(p,"")}catch(ve){st(n,n.return,ve)}}d&4&&n.stateNode!=null&&(p=n.memoizedProps,Nh(n,p,o!==null?o.memoizedProps:p)),d&1024&&(Oh=!0);break;case 6:if(Is(r,n),Rs(n),d&4){if(n.stateNode===null)throw Error(i(162));d=n.memoizedProps,o=n.stateNode;try{o.nodeValue=d}catch(ve){st(n,n.return,ve)}}break;case 3:if(Sc=null,p=xi,xi=yc(r.containerInfo),Is(r,n),xi=p,Rs(n),d&4&&o!==null&&o.memoizedState.isDehydrated)try{Kr(r.containerInfo)}catch(ve){st(n,n.return,ve)}Oh&&(Oh=!1,Sb(n));break;case 4:d=xi,xi=yc(n.stateNode.containerInfo),Is(r,n),Rs(n),xi=d;break;case 12:Is(r,n),Rs(n);break;case 31:Is(r,n),Rs(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,uc(n,d)));break;case 13:Is(r,n),Rs(n),n.child.flags&8192&&n.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(oc=Xt()),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,uc(n,d)));break;case 22:p=n.memoizedState!==null;var P=o!==null&&o.memoizedState!==null,Q=on,ae=Mt;if(on=Q||p,Mt=ae||P,Is(r,n),Mt=ae,on=Q,Rs(n),d&8192)e:for(r=n.stateNode,r._visibility=p?r._visibility&-2:r._visibility|1,p&&(o===null||P||on||Mt||Fa(n)),o=null,r=n;;){if(r.tag===5||r.tag===26){if(o===null){P=o=r;try{if(x=P.stateNode,p)_=x.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none";else{C=P.stateNode;var oe=P.memoizedProps.style,X=oe!=null&&oe.hasOwnProperty("display")?oe.display:null;C.style.display=X==null||typeof X=="boolean"?"":(""+X).trim()}}catch(ve){st(P,P.return,ve)}}}else if(r.tag===6){if(o===null){P=r;try{P.stateNode.nodeValue=p?"":P.memoizedProps}catch(ve){st(P,P.return,ve)}}}else if(r.tag===18){if(o===null){P=r;try{var Z=P.stateNode;p?fE(Z,!0):fE(P.stateNode,!1)}catch(ve){st(P,P.return,ve)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===n)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break e;for(;r.sibling===null;){if(r.return===null||r.return===n)break e;o===r&&(o=null),r=r.return}o===r&&(o=null),r.sibling.return=r.return,r=r.sibling}d&4&&(d=n.updateQueue,d!==null&&(o=d.retryQueue,o!==null&&(d.retryQueue=null,uc(n,o))));break;case 19:Is(r,n),Rs(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,uc(n,d)));break;case 30:break;case 21:break;default:Is(r,n),Rs(n)}}function Rs(n){var r=n.flags;if(r&2){try{for(var o,d=n.return;d!==null;){if(mb(d)){o=d;break}d=d.return}if(o==null)throw Error(i(160));switch(o.tag){case 27:var p=o.stateNode,x=Ch(n);rc(n,x,p);break;case 5:var _=o.stateNode;o.flags&32&&(pr(_,""),o.flags&=-33);var C=Ch(n);rc(n,C,_);break;case 3:case 4:var P=o.stateNode.containerInfo,Q=Ch(n);Dh(n,Q,P);break;default:throw Error(i(161))}}catch(ae){st(n,n.return,ae)}n.flags&=-3}r&4096&&(n.flags&=-4097)}function Sb(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var r=n;Sb(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),n=n.sibling}}function dn(n,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)bb(n,r.alternate,r),r=r.sibling}function Fa(n){for(n=n.child;n!==null;){var r=n;switch(r.tag){case 0:case 11:case 14:case 15:Hn(4,r,r.return),Fa(r);break;case 1:Di(r,r.return);var o=r.stateNode;typeof o.componentWillUnmount=="function"&&fb(r,r.return,o),Fa(r);break;case 27:hl(r.stateNode);case 26:case 5:Di(r,r.return),Fa(r);break;case 22:r.memoizedState===null&&Fa(r);break;case 30:Fa(r);break;default:Fa(r)}n=n.sibling}}function fn(n,r,o){for(o=o&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var d=r.alternate,p=n,x=r,_=x.flags;switch(x.tag){case 0:case 11:case 15:fn(p,x,o),il(4,x);break;case 1:if(fn(p,x,o),d=x,p=d.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(Q){st(d,d.return,Q)}if(d=x,p=d.updateQueue,p!==null){var C=d.stateNode;try{var P=p.shared.hiddenCallbacks;if(P!==null)for(p.shared.hiddenCallbacks=null,p=0;p<P.length;p++)e1(P[p],C)}catch(Q){st(d,d.return,Q)}}o&&_&64&&db(x),nl(x,x.return);break;case 27:gb(x);case 26:case 5:fn(p,x,o),o&&d===null&&_&4&&hb(x),nl(x,x.return);break;case 12:fn(p,x,o);break;case 31:fn(p,x,o),o&&_&4&&Tb(p,x);break;case 13:fn(p,x,o),o&&_&4&&yb(p,x);break;case 22:x.memoizedState===null&&fn(p,x,o),nl(x,x.return);break;case 30:break;default:fn(p,x,o)}r=r.sibling}}function wh(n,r){var o=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),n=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(n=r.memoizedState.cachePool.pool),n!==o&&(n!=null&&n.refCount++,o!=null&&Vu(o))}function kh(n,r){n=null,r.alternate!==null&&(n=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==n&&(r.refCount++,n!=null&&Vu(n))}function Ti(n,r,o,d){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Ab(n,r,o,d),r=r.sibling}function Ab(n,r,o,d){var p=r.flags;switch(r.tag){case 0:case 11:case 15:Ti(n,r,o,d),p&2048&&il(9,r);break;case 1:Ti(n,r,o,d);break;case 3:Ti(n,r,o,d),p&2048&&(n=null,r.alternate!==null&&(n=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==n&&(r.refCount++,n!=null&&Vu(n)));break;case 12:if(p&2048){Ti(n,r,o,d),n=r.stateNode;try{var x=r.memoizedProps,_=x.id,C=x.onPostCommit;typeof C=="function"&&C(_,r.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(P){st(r,r.return,P)}}else Ti(n,r,o,d);break;case 31:Ti(n,r,o,d);break;case 13:Ti(n,r,o,d);break;case 23:break;case 22:x=r.stateNode,_=r.alternate,r.memoizedState!==null?x._visibility&2?Ti(n,r,o,d):al(n,r):x._visibility&2?Ti(n,r,o,d):(x._visibility|=2,Pr(n,r,o,d,(r.subtreeFlags&10256)!==0||!1)),p&2048&&wh(_,r);break;case 24:Ti(n,r,o,d),p&2048&&kh(r.alternate,r);break;default:Ti(n,r,o,d)}}function Pr(n,r,o,d,p){for(p=p&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var x=n,_=r,C=o,P=d,Q=_.flags;switch(_.tag){case 0:case 11:case 15:Pr(x,_,C,P,p),il(8,_);break;case 23:break;case 22:var ae=_.stateNode;_.memoizedState!==null?ae._visibility&2?Pr(x,_,C,P,p):al(x,_):(ae._visibility|=2,Pr(x,_,C,P,p)),p&&Q&2048&&wh(_.alternate,_);break;case 24:Pr(x,_,C,P,p),p&&Q&2048&&kh(_.alternate,_);break;default:Pr(x,_,C,P,p)}r=r.sibling}}function al(n,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var o=n,d=r,p=d.flags;switch(d.tag){case 22:al(o,d),p&2048&&wh(d.alternate,d);break;case 24:al(o,d),p&2048&&kh(d.alternate,d);break;default:al(o,d)}r=r.sibling}}var rl=8192;function Ur(n,r,o){if(n.subtreeFlags&rl)for(n=n.child;n!==null;)_b(n,r,o),n=n.sibling}function _b(n,r,o){switch(n.tag){case 26:Ur(n,r,o),n.flags&rl&&n.memoizedState!==null&&I3(o,xi,n.memoizedState,n.memoizedProps);break;case 5:Ur(n,r,o);break;case 3:case 4:var d=xi;xi=yc(n.stateNode.containerInfo),Ur(n,r,o),xi=d;break;case 22:n.memoizedState===null&&(d=n.alternate,d!==null&&d.memoizedState!==null?(d=rl,rl=16777216,Ur(n,r,o),rl=d):Ur(n,r,o));break;default:Ur(n,r,o)}}function Lb(n){var r=n.alternate;if(r!==null&&(n=r.child,n!==null)){r.child=null;do r=n.sibling,n.sibling=null,n=r;while(n!==null)}}function ul(n){var r=n.deletions;if((n.flags&16)!==0){if(r!==null)for(var o=0;o<r.length;o++){var d=r[o];Zt=d,Rb(d,n)}Lb(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Ib(n),n=n.sibling}function Ib(n){switch(n.tag){case 0:case 11:case 15:ul(n),n.flags&2048&&Hn(9,n,n.return);break;case 3:ul(n);break;case 12:ul(n);break;case 22:var r=n.stateNode;n.memoizedState!==null&&r._visibility&2&&(n.return===null||n.return.tag!==13)?(r._visibility&=-3,lc(n)):ul(n);break;default:ul(n)}}function lc(n){var r=n.deletions;if((n.flags&16)!==0){if(r!==null)for(var o=0;o<r.length;o++){var d=r[o];Zt=d,Rb(d,n)}Lb(n)}for(n=n.child;n!==null;){switch(r=n,r.tag){case 0:case 11:case 15:Hn(8,r,r.return),lc(r);break;case 22:o=r.stateNode,o._visibility&2&&(o._visibility&=-3,lc(r));break;default:lc(r)}n=n.sibling}}function Rb(n,r){for(;Zt!==null;){var o=Zt;switch(o.tag){case 0:case 11:case 15:Hn(8,o,r);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var d=o.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Vu(o.memoizedState.cache)}if(d=o.child,d!==null)d.return=o,Zt=d;else e:for(o=n;Zt!==null;){d=Zt;var p=d.sibling,x=d.return;if(Eb(d),d===o){Zt=null;break e}if(p!==null){p.return=x,Zt=p;break e}Zt=x}}}var $A={getCacheForType:function(n){var r=us(Ot),o=r.data.get(n);return o===void 0&&(o=n(),r.data.set(n,o)),o},cacheSignal:function(){return us(Ot).controller.signal}},GA=typeof WeakMap=="function"?WeakMap:Map,Je=0,ct=null,$e=null,qe=0,tt=0,qs=null,$n=!1,Br=!1,Mh=!1,hn=0,St=0,Gn=0,ja=0,Ph=0,Ys=0,Fr=0,ll=null,Ns=null,Uh=!1,oc=0,Nb=0,cc=1/0,dc=null,Vn=null,qt=0,qn=null,jr=null,mn=0,Bh=0,Fh=null,Cb=null,ol=0,jh=null;function Ks(){return(Je&2)!==0&&qe!==0?qe&-qe:B.T!==null?Yh():Yg()}function Db(){if(Ys===0)if((qe&536870912)===0||Ke){var n=xo;xo<<=1,(xo&3932160)===0&&(xo=262144),Ys=n}else Ys=536870912;return n=Gs.current,n!==null&&(n.flags|=32),Ys}function Cs(n,r,o){(n===ct&&(tt===2||tt===9)||n.cancelPendingCommit!==null)&&(Hr(n,0),Yn(n,qe,Ys,!1)),Cu(n,o),((Je&2)===0||n!==ct)&&(n===ct&&((Je&2)===0&&(ja|=o),St===4&&Yn(n,qe,Ys,!1)),Oi(n))}function Ob(n,r,o){if((Je&6)!==0)throw Error(i(327));var d=!o&&(r&127)===0&&(r&n.expiredLanes)===0||Nu(n,r),p=d?YA(n,r):$h(n,r,!0),x=d;do{if(p===0){Br&&!d&&Yn(n,r,0,!1);break}else{if(o=n.current.alternate,x&&!VA(o)){p=$h(n,r,!1),x=!1;continue}if(p===2){if(x=r,n.errorRecoveryDisabledLanes&x)var _=0;else _=n.pendingLanes&-536870913,_=_!==0?_:_&536870912?536870912:0;if(_!==0){r=_;e:{var C=n;p=ll;var P=C.current.memoizedState.isDehydrated;if(P&&(Hr(C,_).flags|=256),_=$h(C,_,!1),_!==2){if(Mh&&!P){C.errorRecoveryDisabledLanes|=x,ja|=x,p=4;break e}x=Ns,Ns=p,x!==null&&(Ns===null?Ns=x:Ns.push.apply(Ns,x))}p=_}if(x=!1,p!==2)continue}}if(p===1){Hr(n,0),Yn(n,r,0,!0);break}e:{switch(d=n,x=p,x){case 0:case 1:throw Error(i(345));case 4:if((r&4194048)!==r)break;case 6:Yn(d,r,Ys,!$n);break e;case 2:Ns=null;break;case 3:case 5:break;default:throw Error(i(329))}if((r&62914560)===r&&(p=oc+300-Xt(),10<p)){if(Yn(d,r,Ys,!$n),yo(d,0,!0)!==0)break e;mn=r,d.timeoutHandle=oE(wb.bind(null,d,o,Ns,dc,Uh,r,Ys,ja,Fr,$n,x,"Throttled",-0,0),p);break e}wb(d,o,Ns,dc,Uh,r,Ys,ja,Fr,$n,x,null,-0,0)}}break}while(!0);Oi(n)}function wb(n,r,o,d,p,x,_,C,P,Q,ae,oe,X,Z){if(n.timeoutHandle=-1,oe=r.subtreeFlags,oe&8192||(oe&16785408)===16785408){oe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Zi},_b(r,x,oe);var ve=(x&62914560)===x?oc-Xt():(x&4194048)===x?Nb-Xt():0;if(ve=R3(oe,ve),ve!==null){mn=x,n.cancelPendingCommit=ve(Hb.bind(null,n,r,x,o,d,p,_,C,P,ae,oe,null,X,Z)),Yn(n,x,_,!Q);return}}Hb(n,r,x,o,d,p,_,C,P)}function VA(n){for(var r=n;;){var o=r.tag;if((o===0||o===11||o===15)&&r.flags&16384&&(o=r.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var d=0;d<o.length;d++){var p=o[d],x=p.getSnapshot;p=p.value;try{if(!Hs(x(),p))return!1}catch{return!1}}if(o=r.child,r.subtreeFlags&16384&&o!==null)o.return=r,r=o;else{if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Yn(n,r,o,d){r&=~Ph,r&=~ja,n.suspendedLanes|=r,n.pingedLanes&=~r,d&&(n.warmLanes|=r),d=n.expirationTimes;for(var p=r;0<p;){var x=31-js(p),_=1<<x;d[x]=-1,p&=~_}o!==0&&Gg(n,o,r)}function fc(){return(Je&6)===0?(cl(0),!1):!0}function Hh(){if($e!==null){if(tt===0)var n=$e.return;else n=$e,sn=Da=null,ih(n),Dr=null,Yu=0,n=$e;for(;n!==null;)cb(n.alternate,n),n=n.return;$e=null}}function Hr(n,r){var o=n.timeoutHandle;o!==-1&&(n.timeoutHandle=-1,c3(o)),o=n.cancelPendingCommit,o!==null&&(n.cancelPendingCommit=null,o()),mn=0,Hh(),ct=n,$e=o=en(n.current,null),qe=r,tt=0,qs=null,$n=!1,Br=Nu(n,r),Mh=!1,Fr=Ys=Ph=ja=Gn=St=0,Ns=ll=null,Uh=!1,(r&8)!==0&&(r|=r&32);var d=n.entangledLanes;if(d!==0)for(n=n.entanglements,d&=r;0<d;){var p=31-js(d),x=1<<p;r|=n[p],d&=~x}return hn=r,wo(),o}function kb(n,r){Pe=null,B.H=el,r===Cr||r===Ho?(r=Xp(),tt=3):r===qf?(r=Xp(),tt=4):tt=r===xh?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,qs=r,$e===null&&(St=1,tc(n,ni(r,n.current)))}function Mb(){var n=Gs.current;return n===null?!0:(qe&4194048)===qe?li===null:(qe&62914560)===qe||(qe&536870912)!==0?n===li:!1}function Pb(){var n=B.H;return B.H=el,n===null?el:n}function Ub(){var n=B.A;return B.A=$A,n}function hc(){St=4,$n||(qe&4194048)!==qe&&Gs.current!==null||(Br=!0),(Gn&134217727)===0&&(ja&134217727)===0||ct===null||Yn(ct,qe,Ys,!1)}function $h(n,r,o){var d=Je;Je|=2;var p=Pb(),x=Ub();(ct!==n||qe!==r)&&(dc=null,Hr(n,r)),r=!1;var _=St;e:do try{if(tt!==0&&$e!==null){var C=$e,P=qs;switch(tt){case 8:Hh(),_=6;break e;case 3:case 2:case 9:case 6:Gs.current===null&&(r=!0);var Q=tt;if(tt=0,qs=null,$r(n,C,P,Q),o&&Br){_=0;break e}break;default:Q=tt,tt=0,qs=null,$r(n,C,P,Q)}}qA(),_=St;break}catch(ae){kb(n,ae)}while(!0);return r&&n.shellSuspendCounter++,sn=Da=null,Je=d,B.H=p,B.A=x,$e===null&&(ct=null,qe=0,wo()),_}function qA(){for(;$e!==null;)Bb($e)}function YA(n,r){var o=Je;Je|=2;var d=Pb(),p=Ub();ct!==n||qe!==r?(dc=null,cc=Xt()+500,Hr(n,r)):Br=Nu(n,r);e:do try{if(tt!==0&&$e!==null){r=$e;var x=qs;t:switch(tt){case 1:tt=0,qs=null,$r(n,r,x,1);break;case 2:case 9:if(zp(x)){tt=0,qs=null,Fb(r);break}r=function(){tt!==2&&tt!==9||ct!==n||(tt=7),Oi(n)},x.then(r,r);break e;case 3:tt=7;break e;case 4:tt=5;break e;case 7:zp(x)?(tt=0,qs=null,Fb(r)):(tt=0,qs=null,$r(n,r,x,7));break;case 5:var _=null;switch($e.tag){case 26:_=$e.memoizedState;case 5:case 27:var C=$e;if(_?AE(_):C.stateNode.complete){tt=0,qs=null;var P=C.sibling;if(P!==null)$e=P;else{var Q=C.return;Q!==null?($e=Q,mc(Q)):$e=null}break t}}tt=0,qs=null,$r(n,r,x,5);break;case 6:tt=0,qs=null,$r(n,r,x,6);break;case 8:Hh(),St=6;break e;default:throw Error(i(462))}}KA();break}catch(ae){kb(n,ae)}while(!0);return sn=Da=null,B.H=d,B.A=p,Je=o,$e!==null?0:(ct=null,qe=0,wo(),St)}function KA(){for(;$e!==null&&!Xi();)Bb($e)}function Bb(n){var r=lb(n.alternate,n,hn);n.memoizedProps=n.pendingProps,r===null?mc(n):$e=r}function Fb(n){var r=n,o=r.alternate;switch(r.tag){case 15:case 0:r=sb(o,r,r.pendingProps,r.type,void 0,qe);break;case 11:r=sb(o,r,r.pendingProps,r.type.render,r.ref,qe);break;case 5:ih(r);default:cb(o,r),r=$e=Up(r,hn),r=lb(o,r,hn)}n.memoizedProps=n.pendingProps,r===null?mc(n):$e=r}function $r(n,r,o,d){sn=Da=null,ih(r),Dr=null,Yu=0;var p=r.return;try{if(MA(n,p,r,o,qe)){St=1,tc(n,ni(o,n.current)),$e=null;return}}catch(x){if(p!==null)throw $e=p,x;St=1,tc(n,ni(o,n.current)),$e=null;return}r.flags&32768?(Ke||d===1?n=!0:Br||(qe&536870912)!==0?n=!1:($n=n=!0,(d===2||d===9||d===3||d===6)&&(d=Gs.current,d!==null&&d.tag===13&&(d.flags|=16384))),jb(r,n)):mc(r)}function mc(n){var r=n;do{if((r.flags&32768)!==0){jb(r,$n);return}n=r.return;var o=BA(r.alternate,r,hn);if(o!==null){$e=o;return}if(r=r.sibling,r!==null){$e=r;return}$e=r=n}while(r!==null);St===0&&(St=5)}function jb(n,r){do{var o=FA(n.alternate,n);if(o!==null){o.flags&=32767,$e=o;return}if(o=n.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!r&&(n=n.sibling,n!==null)){$e=n;return}$e=n=o}while(n!==null);St=6,$e=null}function Hb(n,r,o,d,p,x,_,C,P){n.cancelPendingCommit=null;do gc();while(qt!==0);if((Je&6)!==0)throw Error(i(327));if(r!==null){if(r===n.current)throw Error(i(177));if(x=r.lanes|r.childLanes,x|=Cf,LS(n,o,x,_,C,P),n===ct&&($e=ct=null,qe=0),jr=r,qn=n,mn=o,Bh=x,Fh=p,Cb=d,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,WA(or,function(){return Yb(),null})):(n.callbackNode=null,n.callbackPriority=0),d=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||d){d=B.T,B.T=null,p=W.p,W.p=2,_=Je,Je|=4;try{jA(n,r,o)}finally{Je=_,W.p=p,B.T=d}}qt=1,$b(),Gb(),Vb()}}function $b(){if(qt===1){qt=0;var n=qn,r=jr,o=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||o){o=B.T,B.T=null;var d=W.p;W.p=2;var p=Je;Je|=4;try{vb(r,n);var x=e0,_=Rp(n.containerInfo),C=x.focusedElem,P=x.selectionRange;if(_!==C&&C&&C.ownerDocument&&Ip(C.ownerDocument.documentElement,C)){if(P!==null&&_f(C)){var Q=P.start,ae=P.end;if(ae===void 0&&(ae=Q),"selectionStart"in C)C.selectionStart=Q,C.selectionEnd=Math.min(ae,C.value.length);else{var oe=C.ownerDocument||document,X=oe&&oe.defaultView||window;if(X.getSelection){var Z=X.getSelection(),ve=C.textContent.length,Ie=Math.min(P.start,ve),ut=P.end===void 0?Ie:Math.min(P.end,ve);!Z.extend&&Ie>ut&&(_=ut,ut=Ie,Ie=_);var V=Lp(C,Ie),j=Lp(C,ut);if(V&&j&&(Z.rangeCount!==1||Z.anchorNode!==V.node||Z.anchorOffset!==V.offset||Z.focusNode!==j.node||Z.focusOffset!==j.offset)){var z=oe.createRange();z.setStart(V.node,V.offset),Z.removeAllRanges(),Ie>ut?(Z.addRange(z),Z.extend(j.node,j.offset)):(z.setEnd(j.node,j.offset),Z.addRange(z))}}}}for(oe=[],Z=C;Z=Z.parentNode;)Z.nodeType===1&&oe.push({element:Z,left:Z.scrollLeft,top:Z.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<oe.length;C++){var le=oe[C];le.element.scrollLeft=le.left,le.element.scrollTop=le.top}}Ic=!!Jh,e0=Jh=null}finally{Je=p,W.p=d,B.T=o}}n.current=r,qt=2}}function Gb(){if(qt===2){qt=0;var n=qn,r=jr,o=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||o){o=B.T,B.T=null;var d=W.p;W.p=2;var p=Je;Je|=4;try{bb(n,r.alternate,r)}finally{Je=p,W.p=d,B.T=o}}qt=3}}function Vb(){if(qt===4||qt===3){qt=0,go();var n=qn,r=jr,o=mn,d=Cb;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?qt=5:(qt=0,jr=qn=null,qb(n,n.pendingLanes));var p=n.pendingLanes;if(p===0&&(Vn=null),rf(o),r=r.stateNode,Fs&&typeof Fs.onCommitFiberRoot=="function")try{Fs.onCommitFiberRoot(Ru,r,void 0,(r.current.flags&128)===128)}catch{}if(d!==null){r=B.T,p=W.p,W.p=2,B.T=null;try{for(var x=n.onRecoverableError,_=0;_<d.length;_++){var C=d[_];x(C.value,{componentStack:C.stack})}}finally{B.T=r,W.p=p}}(mn&3)!==0&&gc(),Oi(n),p=n.pendingLanes,(o&261930)!==0&&(p&42)!==0?n===jh?ol++:(ol=0,jh=n):ol=0,cl(0)}}function qb(n,r){(n.pooledCacheLanes&=r)===0&&(r=n.pooledCache,r!=null&&(n.pooledCache=null,Vu(r)))}function gc(){return $b(),Gb(),Vb(),Yb()}function Yb(){if(qt!==5)return!1;var n=qn,r=Bh;Bh=0;var o=rf(mn),d=B.T,p=W.p;try{W.p=32>o?32:o,B.T=null,o=Fh,Fh=null;var x=qn,_=mn;if(qt=0,jr=qn=null,mn=0,(Je&6)!==0)throw Error(i(331));var C=Je;if(Je|=4,Ib(x.current),Ab(x,x.current,_,o),Je=C,cl(0,!1),Fs&&typeof Fs.onPostCommitFiberRoot=="function")try{Fs.onPostCommitFiberRoot(Ru,x)}catch{}return!0}finally{W.p=p,B.T=d,qb(n,r)}}function Kb(n,r,o){r=ni(o,r),r=Eh(n.stateNode,r,2),n=Bn(n,r,2),n!==null&&(Cu(n,2),Oi(n))}function st(n,r,o){if(n.tag===3)Kb(n,n,o);else for(;r!==null;){if(r.tag===3){Kb(r,n,o);break}else if(r.tag===1){var d=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Vn===null||!Vn.has(d))){n=ni(o,n),o=z1(2),d=Bn(r,o,2),d!==null&&(Q1(o,d,r,n),Cu(d,2),Oi(d));break}}r=r.return}}function Gh(n,r,o){var d=n.pingCache;if(d===null){d=n.pingCache=new GA;var p=new Set;d.set(r,p)}else p=d.get(r),p===void 0&&(p=new Set,d.set(r,p));p.has(o)||(Mh=!0,p.add(o),n=zA.bind(null,n,r,o),r.then(n,n))}function zA(n,r,o){var d=n.pingCache;d!==null&&d.delete(r),n.pingedLanes|=n.suspendedLanes&o,n.warmLanes&=~o,ct===n&&(qe&o)===o&&(St===4||St===3&&(qe&62914560)===qe&&300>Xt()-oc?(Je&2)===0&&Hr(n,0):Ph|=o,Fr===qe&&(Fr=0)),Oi(n)}function zb(n,r){r===0&&(r=$g()),n=Ra(n,r),n!==null&&(Cu(n,r),Oi(n))}function QA(n){var r=n.memoizedState,o=0;r!==null&&(o=r.retryLane),zb(n,o)}function XA(n,r){var o=0;switch(n.tag){case 31:case 13:var d=n.stateNode,p=n.memoizedState;p!==null&&(o=p.retryLane);break;case 19:d=n.stateNode;break;case 22:d=n.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(r),zb(n,o)}function WA(n,r){return bs(n,r)}var pc=null,Gr=null,Vh=!1,bc=!1,qh=!1,Kn=0;function Oi(n){n!==Gr&&n.next===null&&(Gr===null?pc=Gr=n:Gr=Gr.next=n),bc=!0,Vh||(Vh=!0,JA())}function cl(n,r){if(!qh&&bc){qh=!0;do for(var o=!1,d=pc;d!==null;){if(n!==0){var p=d.pendingLanes;if(p===0)var x=0;else{var _=d.suspendedLanes,C=d.pingedLanes;x=(1<<31-js(42|n)+1)-1,x&=p&~(_&~C),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(o=!0,Zb(d,x))}else x=qe,x=yo(d,d===ct?x:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(x&3)===0||Nu(d,x)||(o=!0,Zb(d,x));d=d.next}while(o);qh=!1}}function ZA(){Qb()}function Qb(){bc=Vh=!1;var n=0;Kn!==0&&o3()&&(n=Kn);for(var r=Xt(),o=null,d=pc;d!==null;){var p=d.next,x=Xb(d,r);x===0?(d.next=null,o===null?pc=p:o.next=p,p===null&&(Gr=o)):(o=d,(n!==0||(x&3)!==0)&&(bc=!0)),d=p}qt!==0&&qt!==5||cl(n),Kn!==0&&(Kn=0)}function Xb(n,r){for(var o=n.suspendedLanes,d=n.pingedLanes,p=n.expirationTimes,x=n.pendingLanes&-62914561;0<x;){var _=31-js(x),C=1<<_,P=p[_];P===-1?((C&o)===0||(C&d)!==0)&&(p[_]=_S(C,r)):P<=r&&(n.expiredLanes|=C),x&=~C}if(r=ct,o=qe,o=yo(n,n===r?o:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d=n.callbackNode,o===0||n===r&&(tt===2||tt===9)||n.cancelPendingCommit!==null)return d!==null&&d!==null&&Ri(d),n.callbackNode=null,n.callbackPriority=0;if((o&3)===0||Nu(n,o)){if(r=o&-o,r===n.callbackPriority)return r;switch(d!==null&&Ri(d),rf(o)){case 2:case 8:o=Lu;break;case 32:o=or;break;case 268435456:o=Iu;break;default:o=or}return d=Wb.bind(null,n),o=bs(o,d),n.callbackPriority=r,n.callbackNode=o,r}return d!==null&&d!==null&&Ri(d),n.callbackPriority=2,n.callbackNode=null,2}function Wb(n,r){if(qt!==0&&qt!==5)return n.callbackNode=null,n.callbackPriority=0,null;var o=n.callbackNode;if(gc()&&n.callbackNode!==o)return null;var d=qe;return d=yo(n,n===ct?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d===0?null:(Ob(n,d,r),Xb(n,Xt()),n.callbackNode!=null&&n.callbackNode===o?Wb.bind(null,n):null)}function Zb(n,r){if(gc())return null;Ob(n,r,!0)}function JA(){d3(function(){(Je&6)!==0?bs(Rn,ZA):Qb()})}function Yh(){if(Kn===0){var n=Rr;n===0&&(n=Eo,Eo<<=1,(Eo&261888)===0&&(Eo=256)),Kn=n}return Kn}function Jb(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:_o(""+n)}function eE(n,r){var o=r.ownerDocument.createElement("input");return o.name=r.name,o.value=r.value,n.id&&o.setAttribute("form",n.id),r.parentNode.insertBefore(o,r),n=new FormData(n),o.parentNode.removeChild(o),n}function e3(n,r,o,d,p){if(r==="submit"&&o&&o.stateNode===p){var x=Jb((p[As]||null).action),_=d.submitter;_&&(r=(r=_[As]||null)?Jb(r.formAction):_.getAttribute("formAction"),r!==null&&(x=r,_=null));var C=new No("action","action",null,d,p);n.push({event:C,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Kn!==0){var P=_?eE(p,_):new FormData(p);fh(o,{pending:!0,data:P,method:p.method,action:x},null,P)}}else typeof x=="function"&&(C.preventDefault(),P=_?eE(p,_):new FormData(p),fh(o,{pending:!0,data:P,method:p.method,action:x},x,P))},currentTarget:p}]})}}for(var Kh=0;Kh<Nf.length;Kh++){var zh=Nf[Kh],t3=zh.toLowerCase(),s3=zh[0].toUpperCase()+zh.slice(1);Ei(t3,"on"+s3)}Ei(Dp,"onAnimationEnd"),Ei(Op,"onAnimationIteration"),Ei(wp,"onAnimationStart"),Ei("dblclick","onDoubleClick"),Ei("focusin","onFocus"),Ei("focusout","onBlur"),Ei(EA,"onTransitionRun"),Ei(xA,"onTransitionStart"),Ei(TA,"onTransitionCancel"),Ei(kp,"onTransitionEnd"),mr("onMouseEnter",["mouseout","mouseover"]),mr("onMouseLeave",["mouseout","mouseover"]),mr("onPointerEnter",["pointerout","pointerover"]),mr("onPointerLeave",["pointerout","pointerover"]),Aa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Aa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Aa("onBeforeInput",["compositionend","keypress","textInput","paste"]),Aa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Aa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Aa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var dl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),i3=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(dl));function tE(n,r){r=(r&4)!==0;for(var o=0;o<n.length;o++){var d=n[o],p=d.event;d=d.listeners;e:{var x=void 0;if(r)for(var _=d.length-1;0<=_;_--){var C=d[_],P=C.instance,Q=C.currentTarget;if(C=C.listener,P!==x&&p.isPropagationStopped())break e;x=C,p.currentTarget=Q;try{x(p)}catch(ae){Oo(ae)}p.currentTarget=null,x=P}else for(_=0;_<d.length;_++){if(C=d[_],P=C.instance,Q=C.currentTarget,C=C.listener,P!==x&&p.isPropagationStopped())break e;x=C,p.currentTarget=Q;try{x(p)}catch(ae){Oo(ae)}p.currentTarget=null,x=P}}}}function Ge(n,r){var o=r[uf];o===void 0&&(o=r[uf]=new Set);var d=n+"__bubble";o.has(d)||(sE(r,n,2,!1),o.add(d))}function Qh(n,r,o){var d=0;r&&(d|=4),sE(o,n,d,r)}var Ec="_reactListening"+Math.random().toString(36).slice(2);function Xh(n){if(!n[Ec]){n[Ec]=!0,Qg.forEach(function(o){o!=="selectionchange"&&(i3.has(o)||Qh(o,!1,n),Qh(o,!0,n))});var r=n.nodeType===9?n:n.ownerDocument;r===null||r[Ec]||(r[Ec]=!0,Qh("selectionchange",!1,r))}}function sE(n,r,o,d){switch(DE(r)){case 2:var p=D3;break;case 8:p=O3;break;default:p=d0}o=p.bind(null,r,o,n),p=void 0,!pf||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),d?p!==void 0?n.addEventListener(r,o,{capture:!0,passive:p}):n.addEventListener(r,o,!0):p!==void 0?n.addEventListener(r,o,{passive:p}):n.addEventListener(r,o,!1)}function Wh(n,r,o,d,p){var x=d;if((r&1)===0&&(r&2)===0&&d!==null)e:for(;;){if(d===null)return;var _=d.tag;if(_===3||_===4){var C=d.stateNode.containerInfo;if(C===p)break;if(_===4)for(_=d.return;_!==null;){var P=_.tag;if((P===3||P===4)&&_.stateNode.containerInfo===p)return;_=_.return}for(;C!==null;){if(_=dr(C),_===null)return;if(P=_.tag,P===5||P===6||P===26||P===27){d=x=_;continue e}C=C.parentNode}}d=d.return}up(function(){var Q=x,ae=mf(o),oe=[];e:{var X=Mp.get(n);if(X!==void 0){var Z=No,ve=n;switch(n){case"keypress":if(Io(o)===0)break e;case"keydown":case"keyup":Z=XS;break;case"focusin":ve="focus",Z=Tf;break;case"focusout":ve="blur",Z=Tf;break;case"beforeblur":case"afterblur":Z=Tf;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=cp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=BS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=JS;break;case Dp:case Op:case wp:Z=HS;break;case kp:Z=tA;break;case"scroll":case"scrollend":Z=PS;break;case"wheel":Z=iA;break;case"copy":case"cut":case"paste":Z=GS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=fp;break;case"toggle":case"beforetoggle":Z=aA}var Ie=(r&4)!==0,ut=!Ie&&(n==="scroll"||n==="scrollend"),V=Ie?X!==null?X+"Capture":null:X;Ie=[];for(var j=Q,z;j!==null;){var le=j;if(z=le.stateNode,le=le.tag,le!==5&&le!==26&&le!==27||z===null||V===null||(le=wu(j,V),le!=null&&Ie.push(fl(j,le,z))),ut)break;j=j.return}0<Ie.length&&(X=new Z(X,ve,null,o,ae),oe.push({event:X,listeners:Ie}))}}if((r&7)===0){e:{if(X=n==="mouseover"||n==="pointerover",Z=n==="mouseout"||n==="pointerout",X&&o!==hf&&(ve=o.relatedTarget||o.fromElement)&&(dr(ve)||ve[cr]))break e;if((Z||X)&&(X=ae.window===ae?ae:(X=ae.ownerDocument)?X.defaultView||X.parentWindow:window,Z?(ve=o.relatedTarget||o.toElement,Z=Q,ve=ve?dr(ve):null,ve!==null&&(ut=u(ve),Ie=ve.tag,ve!==ut||Ie!==5&&Ie!==27&&Ie!==6)&&(ve=null)):(Z=null,ve=Q),Z!==ve)){if(Ie=cp,le="onMouseLeave",V="onMouseEnter",j="mouse",(n==="pointerout"||n==="pointerover")&&(Ie=fp,le="onPointerLeave",V="onPointerEnter",j="pointer"),ut=Z==null?X:Ou(Z),z=ve==null?X:Ou(ve),X=new Ie(le,j+"leave",Z,o,ae),X.target=ut,X.relatedTarget=z,le=null,dr(ae)===Q&&(Ie=new Ie(V,j+"enter",ve,o,ae),Ie.target=z,Ie.relatedTarget=ut,le=Ie),ut=le,Z&&ve)t:{for(Ie=n3,V=Z,j=ve,z=0,le=V;le;le=Ie(le))z++;le=0;for(var _e=j;_e;_e=Ie(_e))le++;for(;0<z-le;)V=Ie(V),z--;for(;0<le-z;)j=Ie(j),le--;for(;z--;){if(V===j||j!==null&&V===j.alternate){Ie=V;break t}V=Ie(V),j=Ie(j)}Ie=null}else Ie=null;Z!==null&&iE(oe,X,Z,Ie,!1),ve!==null&&ut!==null&&iE(oe,ut,ve,Ie,!0)}}e:{if(X=Q?Ou(Q):window,Z=X.nodeName&&X.nodeName.toLowerCase(),Z==="select"||Z==="input"&&X.type==="file")var We=Tp;else if(Ep(X))if(yp)We=gA;else{We=hA;var Se=fA}else Z=X.nodeName,!Z||Z.toLowerCase()!=="input"||X.type!=="checkbox"&&X.type!=="radio"?Q&&ff(Q.elementType)&&(We=Tp):We=mA;if(We&&(We=We(n,Q))){xp(oe,We,o,ae);break e}Se&&Se(n,X,Q),n==="focusout"&&Q&&X.type==="number"&&Q.memoizedProps.value!=null&&df(X,"number",X.value)}switch(Se=Q?Ou(Q):window,n){case"focusin":(Ep(Se)||Se.contentEditable==="true")&&(Tr=Se,Lf=Q,Hu=null);break;case"focusout":Hu=Lf=Tr=null;break;case"mousedown":If=!0;break;case"contextmenu":case"mouseup":case"dragend":If=!1,Np(oe,o,ae);break;case"selectionchange":if(bA)break;case"keydown":case"keyup":Np(oe,o,ae)}var Ue;if(vf)e:{switch(n){case"compositionstart":var Ye="onCompositionStart";break e;case"compositionend":Ye="onCompositionEnd";break e;case"compositionupdate":Ye="onCompositionUpdate";break e}Ye=void 0}else xr?pp(n,o)&&(Ye="onCompositionEnd"):n==="keydown"&&o.keyCode===229&&(Ye="onCompositionStart");Ye&&(hp&&o.locale!=="ko"&&(xr||Ye!=="onCompositionStart"?Ye==="onCompositionEnd"&&xr&&(Ue=lp()):(Dn=ae,bf="value"in Dn?Dn.value:Dn.textContent,xr=!0)),Se=xc(Q,Ye),0<Se.length&&(Ye=new dp(Ye,n,null,o,ae),oe.push({event:Ye,listeners:Se}),Ue?Ye.data=Ue:(Ue=bp(o),Ue!==null&&(Ye.data=Ue)))),(Ue=uA?lA(n,o):oA(n,o))&&(Ye=xc(Q,"onBeforeInput"),0<Ye.length&&(Se=new dp("onBeforeInput","beforeinput",null,o,ae),oe.push({event:Se,listeners:Ye}),Se.data=Ue)),e3(oe,n,Q,o,ae)}tE(oe,r)})}function fl(n,r,o){return{instance:n,listener:r,currentTarget:o}}function xc(n,r){for(var o=r+"Capture",d=[];n!==null;){var p=n,x=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||x===null||(p=wu(n,o),p!=null&&d.unshift(fl(n,p,x)),p=wu(n,r),p!=null&&d.push(fl(n,p,x))),n.tag===3)return d;n=n.return}return[]}function n3(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function iE(n,r,o,d,p){for(var x=r._reactName,_=[];o!==null&&o!==d;){var C=o,P=C.alternate,Q=C.stateNode;if(C=C.tag,P!==null&&P===d)break;C!==5&&C!==26&&C!==27||Q===null||(P=Q,p?(Q=wu(o,x),Q!=null&&_.unshift(fl(o,Q,P))):p||(Q=wu(o,x),Q!=null&&_.push(fl(o,Q,P)))),o=o.return}_.length!==0&&n.push({event:r,listeners:_})}var a3=/\r\n?/g,r3=/\u0000|\uFFFD/g;function nE(n){return(typeof n=="string"?n:""+n).replace(a3,`
`).replace(r3,"")}function aE(n,r){return r=nE(r),nE(n)===r}function rt(n,r,o,d,p,x){switch(o){case"children":typeof d=="string"?r==="body"||r==="textarea"&&d===""||pr(n,d):(typeof d=="number"||typeof d=="bigint")&&r!=="body"&&pr(n,""+d);break;case"className":So(n,"class",d);break;case"tabIndex":So(n,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":So(n,o,d);break;case"style":ap(n,d,x);break;case"data":if(r!=="object"){So(n,"data",d);break}case"src":case"href":if(d===""&&(r!=="a"||o!=="href")){n.removeAttribute(o);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(o);break}d=_o(""+d),n.setAttribute(o,d);break;case"action":case"formAction":if(typeof d=="function"){n.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(o==="formAction"?(r!=="input"&&rt(n,r,"name",p.name,p,null),rt(n,r,"formEncType",p.formEncType,p,null),rt(n,r,"formMethod",p.formMethod,p,null),rt(n,r,"formTarget",p.formTarget,p,null)):(rt(n,r,"encType",p.encType,p,null),rt(n,r,"method",p.method,p,null),rt(n,r,"target",p.target,p,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(o);break}d=_o(""+d),n.setAttribute(o,d);break;case"onClick":d!=null&&(n.onclick=Zi);break;case"onScroll":d!=null&&Ge("scroll",n);break;case"onScrollEnd":d!=null&&Ge("scrollend",n);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(p.children!=null)throw Error(i(60));n.innerHTML=o}}break;case"multiple":n.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":n.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){n.removeAttribute("xlink:href");break}o=_o(""+d),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,""+d):n.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,""):n.removeAttribute(o);break;case"capture":case"download":d===!0?n.setAttribute(o,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(o,d):n.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?n.setAttribute(o,d):n.removeAttribute(o);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?n.removeAttribute(o):n.setAttribute(o,d);break;case"popover":Ge("beforetoggle",n),Ge("toggle",n),vo(n,"popover",d);break;case"xlinkActuate":Wi(n,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":Wi(n,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":Wi(n,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":Wi(n,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":Wi(n,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":Wi(n,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":Wi(n,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":Wi(n,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":Wi(n,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":vo(n,"is",d);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=kS.get(o)||o,vo(n,o,d))}}function Zh(n,r,o,d,p,x){switch(o){case"style":ap(n,d,x);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(o=d.__html,o!=null){if(p.children!=null)throw Error(i(60));n.innerHTML=o}}break;case"children":typeof d=="string"?pr(n,d):(typeof d=="number"||typeof d=="bigint")&&pr(n,""+d);break;case"onScroll":d!=null&&Ge("scroll",n);break;case"onScrollEnd":d!=null&&Ge("scrollend",n);break;case"onClick":d!=null&&(n.onclick=Zi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Xg.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(p=o.endsWith("Capture"),r=o.slice(2,p?o.length-7:void 0),x=n[As]||null,x=x!=null?x[o]:null,typeof x=="function"&&n.removeEventListener(r,x,p),typeof d=="function")){typeof x!="function"&&x!==null&&(o in n?n[o]=null:n.hasAttribute(o)&&n.removeAttribute(o)),n.addEventListener(r,d,p);break e}o in n?n[o]=d:d===!0?n.setAttribute(o,""):vo(n,o,d)}}}function os(n,r,o){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ge("error",n),Ge("load",n);var d=!1,p=!1,x;for(x in o)if(o.hasOwnProperty(x)){var _=o[x];if(_!=null)switch(x){case"src":d=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:rt(n,r,x,_,o,null)}}p&&rt(n,r,"srcSet",o.srcSet,o,null),d&&rt(n,r,"src",o.src,o,null);return;case"input":Ge("invalid",n);var C=x=_=p=null,P=null,Q=null;for(d in o)if(o.hasOwnProperty(d)){var ae=o[d];if(ae!=null)switch(d){case"name":p=ae;break;case"type":_=ae;break;case"checked":P=ae;break;case"defaultChecked":Q=ae;break;case"value":x=ae;break;case"defaultValue":C=ae;break;case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(i(137,r));break;default:rt(n,r,d,ae,o,null)}}tp(n,x,C,P,Q,_,p,!1);return;case"select":Ge("invalid",n),d=_=x=null;for(p in o)if(o.hasOwnProperty(p)&&(C=o[p],C!=null))switch(p){case"value":x=C;break;case"defaultValue":_=C;break;case"multiple":d=C;default:rt(n,r,p,C,o,null)}r=x,o=_,n.multiple=!!d,r!=null?gr(n,!!d,r,!1):o!=null&&gr(n,!!d,o,!0);return;case"textarea":Ge("invalid",n),x=p=d=null;for(_ in o)if(o.hasOwnProperty(_)&&(C=o[_],C!=null))switch(_){case"value":d=C;break;case"defaultValue":p=C;break;case"children":x=C;break;case"dangerouslySetInnerHTML":if(C!=null)throw Error(i(91));break;default:rt(n,r,_,C,o,null)}ip(n,d,p,x);return;case"option":for(P in o)if(o.hasOwnProperty(P)&&(d=o[P],d!=null))switch(P){case"selected":n.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:rt(n,r,P,d,o,null)}return;case"dialog":Ge("beforetoggle",n),Ge("toggle",n),Ge("cancel",n),Ge("close",n);break;case"iframe":case"object":Ge("load",n);break;case"video":case"audio":for(d=0;d<dl.length;d++)Ge(dl[d],n);break;case"image":Ge("error",n),Ge("load",n);break;case"details":Ge("toggle",n);break;case"embed":case"source":case"link":Ge("error",n),Ge("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Q in o)if(o.hasOwnProperty(Q)&&(d=o[Q],d!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:rt(n,r,Q,d,o,null)}return;default:if(ff(r)){for(ae in o)o.hasOwnProperty(ae)&&(d=o[ae],d!==void 0&&Zh(n,r,ae,d,o,void 0));return}}for(C in o)o.hasOwnProperty(C)&&(d=o[C],d!=null&&rt(n,r,C,d,o,null))}function u3(n,r,o,d){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,x=null,_=null,C=null,P=null,Q=null,ae=null;for(Z in o){var oe=o[Z];if(o.hasOwnProperty(Z)&&oe!=null)switch(Z){case"checked":break;case"value":break;case"defaultValue":P=oe;default:d.hasOwnProperty(Z)||rt(n,r,Z,null,d,oe)}}for(var X in d){var Z=d[X];if(oe=o[X],d.hasOwnProperty(X)&&(Z!=null||oe!=null))switch(X){case"type":x=Z;break;case"name":p=Z;break;case"checked":Q=Z;break;case"defaultChecked":ae=Z;break;case"value":_=Z;break;case"defaultValue":C=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(i(137,r));break;default:Z!==oe&&rt(n,r,X,Z,d,oe)}}cf(n,_,C,P,Q,ae,x,p);return;case"select":Z=_=C=X=null;for(x in o)if(P=o[x],o.hasOwnProperty(x)&&P!=null)switch(x){case"value":break;case"multiple":Z=P;default:d.hasOwnProperty(x)||rt(n,r,x,null,d,P)}for(p in d)if(x=d[p],P=o[p],d.hasOwnProperty(p)&&(x!=null||P!=null))switch(p){case"value":X=x;break;case"defaultValue":C=x;break;case"multiple":_=x;default:x!==P&&rt(n,r,p,x,d,P)}r=C,o=_,d=Z,X!=null?gr(n,!!o,X,!1):!!d!=!!o&&(r!=null?gr(n,!!o,r,!0):gr(n,!!o,o?[]:"",!1));return;case"textarea":Z=X=null;for(C in o)if(p=o[C],o.hasOwnProperty(C)&&p!=null&&!d.hasOwnProperty(C))switch(C){case"value":break;case"children":break;default:rt(n,r,C,null,d,p)}for(_ in d)if(p=d[_],x=o[_],d.hasOwnProperty(_)&&(p!=null||x!=null))switch(_){case"value":X=p;break;case"defaultValue":Z=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(i(91));break;default:p!==x&&rt(n,r,_,p,d,x)}sp(n,X,Z);return;case"option":for(var ve in o)if(X=o[ve],o.hasOwnProperty(ve)&&X!=null&&!d.hasOwnProperty(ve))switch(ve){case"selected":n.selected=!1;break;default:rt(n,r,ve,null,d,X)}for(P in d)if(X=d[P],Z=o[P],d.hasOwnProperty(P)&&X!==Z&&(X!=null||Z!=null))switch(P){case"selected":n.selected=X&&typeof X!="function"&&typeof X!="symbol";break;default:rt(n,r,P,X,d,Z)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ie in o)X=o[Ie],o.hasOwnProperty(Ie)&&X!=null&&!d.hasOwnProperty(Ie)&&rt(n,r,Ie,null,d,X);for(Q in d)if(X=d[Q],Z=o[Q],d.hasOwnProperty(Q)&&X!==Z&&(X!=null||Z!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(i(137,r));break;default:rt(n,r,Q,X,d,Z)}return;default:if(ff(r)){for(var ut in o)X=o[ut],o.hasOwnProperty(ut)&&X!==void 0&&!d.hasOwnProperty(ut)&&Zh(n,r,ut,void 0,d,X);for(ae in d)X=d[ae],Z=o[ae],!d.hasOwnProperty(ae)||X===Z||X===void 0&&Z===void 0||Zh(n,r,ae,X,d,Z);return}}for(var V in o)X=o[V],o.hasOwnProperty(V)&&X!=null&&!d.hasOwnProperty(V)&&rt(n,r,V,null,d,X);for(oe in d)X=d[oe],Z=o[oe],!d.hasOwnProperty(oe)||X===Z||X==null&&Z==null||rt(n,r,oe,X,d,Z)}function rE(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function l3(){if(typeof performance.getEntriesByType=="function"){for(var n=0,r=0,o=performance.getEntriesByType("resource"),d=0;d<o.length;d++){var p=o[d],x=p.transferSize,_=p.initiatorType,C=p.duration;if(x&&C&&rE(_)){for(_=0,C=p.responseEnd,d+=1;d<o.length;d++){var P=o[d],Q=P.startTime;if(Q>C)break;var ae=P.transferSize,oe=P.initiatorType;ae&&rE(oe)&&(P=P.responseEnd,_+=ae*(P<C?1:(C-Q)/(P-Q)))}if(--d,r+=8*(x+_)/(p.duration/1e3),n++,10<n)break}}if(0<n)return r/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var Jh=null,e0=null;function Tc(n){return n.nodeType===9?n:n.ownerDocument}function uE(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function lE(n,r){if(n===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&r==="foreignObject"?0:n}function t0(n,r){return n==="textarea"||n==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var s0=null;function o3(){var n=window.event;return n&&n.type==="popstate"?n===s0?!1:(s0=n,!0):(s0=null,!1)}var oE=typeof setTimeout=="function"?setTimeout:void 0,c3=typeof clearTimeout=="function"?clearTimeout:void 0,cE=typeof Promise=="function"?Promise:void 0,d3=typeof queueMicrotask=="function"?queueMicrotask:typeof cE<"u"?function(n){return cE.resolve(null).then(n).catch(f3)}:oE;function f3(n){setTimeout(function(){throw n})}function zn(n){return n==="head"}function dE(n,r){var o=r,d=0;do{var p=o.nextSibling;if(n.removeChild(o),p&&p.nodeType===8)if(o=p.data,o==="/$"||o==="/&"){if(d===0){n.removeChild(p),Kr(r);return}d--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")d++;else if(o==="html")hl(n.ownerDocument.documentElement);else if(o==="head"){o=n.ownerDocument.head,hl(o);for(var x=o.firstChild;x;){var _=x.nextSibling,C=x.nodeName;x[Du]||C==="SCRIPT"||C==="STYLE"||C==="LINK"&&x.rel.toLowerCase()==="stylesheet"||o.removeChild(x),x=_}}else o==="body"&&hl(n.ownerDocument.body);o=p}while(o);Kr(r)}function fE(n,r){var o=n;n=0;do{var d=o.nextSibling;if(o.nodeType===1?r?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(r?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),d&&d.nodeType===8)if(o=d.data,o==="/$"){if(n===0)break;n--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||n++;o=d}while(o)}function i0(n){var r=n.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var o=r;switch(r=r.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":i0(o),lf(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}n.removeChild(o)}}function h3(n,r,o,d){for(;n.nodeType===1;){var p=o;if(n.nodeName.toLowerCase()!==r.toLowerCase()){if(!d&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(d){if(!n[Du])switch(r){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(x=n.getAttribute("rel"),x==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(x!==p.rel||n.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||n.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||n.getAttribute("title")!==(p.title==null?null:p.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(x=n.getAttribute("src"),(x!==(p.src==null?null:p.src)||n.getAttribute("type")!==(p.type==null?null:p.type)||n.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&x&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(r==="input"&&n.type==="hidden"){var x=p.name==null?null:""+p.name;if(p.type==="hidden"&&n.getAttribute("name")===x)return n}else return n;if(n=oi(n.nextSibling),n===null)break}return null}function m3(n,r,o){if(r==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!o||(n=oi(n.nextSibling),n===null))return null;return n}function hE(n,r){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!r||(n=oi(n.nextSibling),n===null))return null;return n}function n0(n){return n.data==="$?"||n.data==="$~"}function a0(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function g3(n,r){var o=n.ownerDocument;if(n.data==="$~")n._reactRetry=r;else if(n.data!=="$?"||o.readyState!=="loading")r();else{var d=function(){r(),o.removeEventListener("DOMContentLoaded",d)};o.addEventListener("DOMContentLoaded",d),n._reactRetry=d}}function oi(n){for(;n!=null;n=n.nextSibling){var r=n.nodeType;if(r===1||r===3)break;if(r===8){if(r=n.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return n}var r0=null;function mE(n){n=n.nextSibling;for(var r=0;n;){if(n.nodeType===8){var o=n.data;if(o==="/$"||o==="/&"){if(r===0)return oi(n.nextSibling);r--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||r++}n=n.nextSibling}return null}function gE(n){n=n.previousSibling;for(var r=0;n;){if(n.nodeType===8){var o=n.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(r===0)return n;r--}else o!=="/$"&&o!=="/&"||r++}n=n.previousSibling}return null}function pE(n,r,o){switch(r=Tc(o),n){case"html":if(n=r.documentElement,!n)throw Error(i(452));return n;case"head":if(n=r.head,!n)throw Error(i(453));return n;case"body":if(n=r.body,!n)throw Error(i(454));return n;default:throw Error(i(451))}}function hl(n){for(var r=n.attributes;r.length;)n.removeAttributeNode(r[0]);lf(n)}var ci=new Map,bE=new Set;function yc(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var gn=W.d;W.d={f:p3,r:b3,D:E3,C:x3,L:T3,m:y3,X:S3,S:v3,M:A3};function p3(){var n=gn.f(),r=fc();return n||r}function b3(n){var r=fr(n);r!==null&&r.tag===5&&r.type==="form"?k1(r):gn.r(n)}var Vr=typeof document>"u"?null:document;function EE(n,r,o){var d=Vr;if(d&&typeof r=="string"&&r){var p=si(r);p='link[rel="'+n+'"][href="'+p+'"]',typeof o=="string"&&(p+='[crossorigin="'+o+'"]'),bE.has(p)||(bE.add(p),n={rel:n,crossOrigin:o,href:r},d.querySelector(p)===null&&(r=d.createElement("link"),os(r,"link",n),Wt(r),d.head.appendChild(r)))}}function E3(n){gn.D(n),EE("dns-prefetch",n,null)}function x3(n,r){gn.C(n,r),EE("preconnect",n,r)}function T3(n,r,o){gn.L(n,r,o);var d=Vr;if(d&&n&&r){var p='link[rel="preload"][as="'+si(r)+'"]';r==="image"&&o&&o.imageSrcSet?(p+='[imagesrcset="'+si(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(p+='[imagesizes="'+si(o.imageSizes)+'"]')):p+='[href="'+si(n)+'"]';var x=p;switch(r){case"style":x=qr(n);break;case"script":x=Yr(n)}ci.has(x)||(n=g({rel:"preload",href:r==="image"&&o&&o.imageSrcSet?void 0:n,as:r},o),ci.set(x,n),d.querySelector(p)!==null||r==="style"&&d.querySelector(ml(x))||r==="script"&&d.querySelector(gl(x))||(r=d.createElement("link"),os(r,"link",n),Wt(r),d.head.appendChild(r)))}}function y3(n,r){gn.m(n,r);var o=Vr;if(o&&n){var d=r&&typeof r.as=="string"?r.as:"script",p='link[rel="modulepreload"][as="'+si(d)+'"][href="'+si(n)+'"]',x=p;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=Yr(n)}if(!ci.has(x)&&(n=g({rel:"modulepreload",href:n},r),ci.set(x,n),o.querySelector(p)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(gl(x)))return}d=o.createElement("link"),os(d,"link",n),Wt(d),o.head.appendChild(d)}}}function v3(n,r,o){gn.S(n,r,o);var d=Vr;if(d&&n){var p=hr(d).hoistableStyles,x=qr(n);r=r||"default";var _=p.get(x);if(!_){var C={loading:0,preload:null};if(_=d.querySelector(ml(x)))C.loading=5;else{n=g({rel:"stylesheet",href:n,"data-precedence":r},o),(o=ci.get(x))&&u0(n,o);var P=_=d.createElement("link");Wt(P),os(P,"link",n),P._p=new Promise(function(Q,ae){P.onload=Q,P.onerror=ae}),P.addEventListener("load",function(){C.loading|=1}),P.addEventListener("error",function(){C.loading|=2}),C.loading|=4,vc(_,r,d)}_={type:"stylesheet",instance:_,count:1,state:C},p.set(x,_)}}}function S3(n,r){gn.X(n,r);var o=Vr;if(o&&n){var d=hr(o).hoistableScripts,p=Yr(n),x=d.get(p);x||(x=o.querySelector(gl(p)),x||(n=g({src:n,async:!0},r),(r=ci.get(p))&&l0(n,r),x=o.createElement("script"),Wt(x),os(x,"link",n),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},d.set(p,x))}}function A3(n,r){gn.M(n,r);var o=Vr;if(o&&n){var d=hr(o).hoistableScripts,p=Yr(n),x=d.get(p);x||(x=o.querySelector(gl(p)),x||(n=g({src:n,async:!0,type:"module"},r),(r=ci.get(p))&&l0(n,r),x=o.createElement("script"),Wt(x),os(x,"link",n),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},d.set(p,x))}}function xE(n,r,o,d){var p=(p=Me.current)?yc(p):null;if(!p)throw Error(i(446));switch(n){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(r=qr(o.href),o=hr(p).hoistableStyles,d=o.get(r),d||(d={type:"style",instance:null,count:0,state:null},o.set(r,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){n=qr(o.href);var x=hr(p).hoistableStyles,_=x.get(n);if(_||(p=p.ownerDocument||p,_={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(n,_),(x=p.querySelector(ml(n)))&&!x._p&&(_.instance=x,_.state.loading=5),ci.has(n)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},ci.set(n,o),x||_3(p,n,o,_.state))),r&&d===null)throw Error(i(528,""));return _}if(r&&d!==null)throw Error(i(529,""));return null;case"script":return r=o.async,o=o.src,typeof o=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=Yr(o),o=hr(p).hoistableScripts,d=o.get(r),d||(d={type:"script",instance:null,count:0,state:null},o.set(r,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,n))}}function qr(n){return'href="'+si(n)+'"'}function ml(n){return'link[rel="stylesheet"]['+n+"]"}function TE(n){return g({},n,{"data-precedence":n.precedence,precedence:null})}function _3(n,r,o,d){n.querySelector('link[rel="preload"][as="style"]['+r+"]")?d.loading=1:(r=n.createElement("link"),d.preload=r,r.addEventListener("load",function(){return d.loading|=1}),r.addEventListener("error",function(){return d.loading|=2}),os(r,"link",o),Wt(r),n.head.appendChild(r))}function Yr(n){return'[src="'+si(n)+'"]'}function gl(n){return"script[async]"+n}function yE(n,r,o){if(r.count++,r.instance===null)switch(r.type){case"style":var d=n.querySelector('style[data-href~="'+si(o.href)+'"]');if(d)return r.instance=d,Wt(d),d;var p=g({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return d=(n.ownerDocument||n).createElement("style"),Wt(d),os(d,"style",p),vc(d,o.precedence,n),r.instance=d;case"stylesheet":p=qr(o.href);var x=n.querySelector(ml(p));if(x)return r.state.loading|=4,r.instance=x,Wt(x),x;d=TE(o),(p=ci.get(p))&&u0(d,p),x=(n.ownerDocument||n).createElement("link"),Wt(x);var _=x;return _._p=new Promise(function(C,P){_.onload=C,_.onerror=P}),os(x,"link",d),r.state.loading|=4,vc(x,o.precedence,n),r.instance=x;case"script":return x=Yr(o.src),(p=n.querySelector(gl(x)))?(r.instance=p,Wt(p),p):(d=o,(p=ci.get(x))&&(d=g({},o),l0(d,p)),n=n.ownerDocument||n,p=n.createElement("script"),Wt(p),os(p,"link",d),n.head.appendChild(p),r.instance=p);case"void":return null;default:throw Error(i(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(d=r.instance,r.state.loading|=4,vc(d,o.precedence,n));return r.instance}function vc(n,r,o){for(var d=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=d.length?d[d.length-1]:null,x=p,_=0;_<d.length;_++){var C=d[_];if(C.dataset.precedence===r)x=C;else if(x!==p)break}x?x.parentNode.insertBefore(n,x.nextSibling):(r=o.nodeType===9?o.head:o,r.insertBefore(n,r.firstChild))}function u0(n,r){n.crossOrigin==null&&(n.crossOrigin=r.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=r.referrerPolicy),n.title==null&&(n.title=r.title)}function l0(n,r){n.crossOrigin==null&&(n.crossOrigin=r.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=r.referrerPolicy),n.integrity==null&&(n.integrity=r.integrity)}var Sc=null;function vE(n,r,o){if(Sc===null){var d=new Map,p=Sc=new Map;p.set(o,d)}else p=Sc,d=p.get(o),d||(d=new Map,p.set(o,d));if(d.has(n))return d;for(d.set(n,null),o=o.getElementsByTagName(n),p=0;p<o.length;p++){var x=o[p];if(!(x[Du]||x[as]||n==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var _=x.getAttribute(r)||"";_=n+_;var C=d.get(_);C?C.push(x):d.set(_,[x])}}return d}function SE(n,r,o){n=n.ownerDocument||n,n.head.insertBefore(o,r==="title"?n.querySelector("head > title"):null)}function L3(n,r,o){if(o===1||r.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return n=r.disabled,typeof r.precedence=="string"&&n==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function AE(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function I3(n,r,o,d){if(o.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var p=qr(d.href),x=r.querySelector(ml(p));if(x){r=x._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(n.count++,n=Ac.bind(n),r.then(n,n)),o.state.loading|=4,o.instance=x,Wt(x);return}x=r.ownerDocument||r,d=TE(d),(p=ci.get(p))&&u0(d,p),x=x.createElement("link"),Wt(x);var _=x;_._p=new Promise(function(C,P){_.onload=C,_.onerror=P}),os(x,"link",d),o.instance=x}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(o,r),(r=o.state.preload)&&(o.state.loading&3)===0&&(n.count++,o=Ac.bind(n),r.addEventListener("load",o),r.addEventListener("error",o))}}var o0=0;function R3(n,r){return n.stylesheets&&n.count===0&&Lc(n,n.stylesheets),0<n.count||0<n.imgCount?function(o){var d=setTimeout(function(){if(n.stylesheets&&Lc(n,n.stylesheets),n.unsuspend){var x=n.unsuspend;n.unsuspend=null,x()}},6e4+r);0<n.imgBytes&&o0===0&&(o0=62500*l3());var p=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&Lc(n,n.stylesheets),n.unsuspend)){var x=n.unsuspend;n.unsuspend=null,x()}},(n.imgBytes>o0?50:800)+r);return n.unsuspend=o,function(){n.unsuspend=null,clearTimeout(d),clearTimeout(p)}}:null}function Ac(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Lc(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var _c=null;function Lc(n,r){n.stylesheets=null,n.unsuspend!==null&&(n.count++,_c=new Map,r.forEach(N3,n),_c=null,Ac.call(n))}function N3(n,r){if(!(r.state.loading&4)){var o=_c.get(n);if(o)var d=o.get(null);else{o=new Map,_c.set(n,o);for(var p=n.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<p.length;x++){var _=p[x];(_.nodeName==="LINK"||_.getAttribute("media")!=="not all")&&(o.set(_.dataset.precedence,_),d=_)}d&&o.set(null,d)}p=r.instance,_=p.getAttribute("data-precedence"),x=o.get(_)||d,x===d&&o.set(null,p),o.set(_,p),this.count++,d=Ac.bind(this),p.addEventListener("load",d),p.addEventListener("error",d),x?x.parentNode.insertBefore(p,x.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(p,n.firstChild)),r.state.loading|=4}}var pl={$$typeof:N,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function C3(n,r,o,d,p,x,_,C,P){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=nf(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nf(0),this.hiddenUpdates=nf(null),this.identifierPrefix=d,this.onUncaughtError=p,this.onCaughtError=x,this.onRecoverableError=_,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=P,this.incompleteTransitions=new Map}function _E(n,r,o,d,p,x,_,C,P,Q,ae,oe){return n=new C3(n,r,o,_,P,Q,ae,oe,C),r=1,x===!0&&(r|=24),x=$s(3,null,null,r),n.current=x,x.stateNode=n,r=$f(),r.refCount++,n.pooledCache=r,r.refCount++,x.memoizedState={element:d,isDehydrated:o,cache:r},Yf(x),n}function LE(n){return n?(n=Sr,n):Sr}function IE(n,r,o,d,p,x){p=LE(p),d.context===null?d.context=p:d.pendingContext=p,d=Un(r),d.payload={element:o},x=x===void 0?null:x,x!==null&&(d.callback=x),o=Bn(n,d,r),o!==null&&(Cs(o,n,r),zu(o,n,r))}function RE(n,r){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var o=n.retryLane;n.retryLane=o!==0&&o<r?o:r}}function c0(n,r){RE(n,r),(n=n.alternate)&&RE(n,r)}function NE(n){if(n.tag===13||n.tag===31){var r=Ra(n,67108864);r!==null&&Cs(r,n,67108864),c0(n,67108864)}}function CE(n){if(n.tag===13||n.tag===31){var r=Ks();r=af(r);var o=Ra(n,r);o!==null&&Cs(o,n,r),c0(n,r)}}var Ic=!0;function D3(n,r,o,d){var p=B.T;B.T=null;var x=W.p;try{W.p=2,d0(n,r,o,d)}finally{W.p=x,B.T=p}}function O3(n,r,o,d){var p=B.T;B.T=null;var x=W.p;try{W.p=8,d0(n,r,o,d)}finally{W.p=x,B.T=p}}function d0(n,r,o,d){if(Ic){var p=f0(d);if(p===null)Wh(n,r,d,Rc,o),OE(n,d);else if(k3(p,n,r,o,d))d.stopPropagation();else if(OE(n,d),r&4&&-1<w3.indexOf(n)){for(;p!==null;){var x=fr(p);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var _=Sa(x.pendingLanes);if(_!==0){var C=x;for(C.pendingLanes|=2,C.entangledLanes|=2;_;){var P=1<<31-js(_);C.entanglements[1]|=P,_&=~P}Oi(x),(Je&6)===0&&(cc=Xt()+500,cl(0))}}break;case 31:case 13:C=Ra(x,2),C!==null&&Cs(C,x,2),fc(),c0(x,2)}if(x=f0(d),x===null&&Wh(n,r,d,Rc,o),x===p)break;p=x}p!==null&&d.stopPropagation()}else Wh(n,r,d,null,o)}}function f0(n){return n=mf(n),h0(n)}var Rc=null;function h0(n){if(Rc=null,n=dr(n),n!==null){var r=u(n);if(r===null)n=null;else{var o=r.tag;if(o===13){if(n=l(r),n!==null)return n;n=null}else if(o===31){if(n=c(r),n!==null)return n;n=null}else if(o===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null)}}return Rc=n,null}function DE(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(po()){case Rn:return 2;case Lu:return 8;case or:case bo:return 32;case Iu:return 268435456;default:return 32}default:return 32}}var m0=!1,Qn=null,Xn=null,Wn=null,bl=new Map,El=new Map,Zn=[],w3="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function OE(n,r){switch(n){case"focusin":case"focusout":Qn=null;break;case"dragenter":case"dragleave":Xn=null;break;case"mouseover":case"mouseout":Wn=null;break;case"pointerover":case"pointerout":bl.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":El.delete(r.pointerId)}}function xl(n,r,o,d,p,x){return n===null||n.nativeEvent!==x?(n={blockedOn:r,domEventName:o,eventSystemFlags:d,nativeEvent:x,targetContainers:[p]},r!==null&&(r=fr(r),r!==null&&NE(r)),n):(n.eventSystemFlags|=d,r=n.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),n)}function k3(n,r,o,d,p){switch(r){case"focusin":return Qn=xl(Qn,n,r,o,d,p),!0;case"dragenter":return Xn=xl(Xn,n,r,o,d,p),!0;case"mouseover":return Wn=xl(Wn,n,r,o,d,p),!0;case"pointerover":var x=p.pointerId;return bl.set(x,xl(bl.get(x)||null,n,r,o,d,p)),!0;case"gotpointercapture":return x=p.pointerId,El.set(x,xl(El.get(x)||null,n,r,o,d,p)),!0}return!1}function wE(n){var r=dr(n.target);if(r!==null){var o=u(r);if(o!==null){if(r=o.tag,r===13){if(r=l(o),r!==null){n.blockedOn=r,Kg(n.priority,function(){CE(o)});return}}else if(r===31){if(r=c(o),r!==null){n.blockedOn=r,Kg(n.priority,function(){CE(o)});return}}else if(r===3&&o.stateNode.current.memoizedState.isDehydrated){n.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Nc(n){if(n.blockedOn!==null)return!1;for(var r=n.targetContainers;0<r.length;){var o=f0(n.nativeEvent);if(o===null){o=n.nativeEvent;var d=new o.constructor(o.type,o);hf=d,o.target.dispatchEvent(d),hf=null}else return r=fr(o),r!==null&&NE(r),n.blockedOn=o,!1;r.shift()}return!0}function kE(n,r,o){Nc(n)&&o.delete(r)}function M3(){m0=!1,Qn!==null&&Nc(Qn)&&(Qn=null),Xn!==null&&Nc(Xn)&&(Xn=null),Wn!==null&&Nc(Wn)&&(Wn=null),bl.forEach(kE),El.forEach(kE)}function Cc(n,r){n.blockedOn===r&&(n.blockedOn=null,m0||(m0=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,M3)))}var Dc=null;function ME(n){Dc!==n&&(Dc=n,s.unstable_scheduleCallback(s.unstable_NormalPriority,function(){Dc===n&&(Dc=null);for(var r=0;r<n.length;r+=3){var o=n[r],d=n[r+1],p=n[r+2];if(typeof d!="function"){if(h0(d||o)===null)continue;break}var x=fr(o);x!==null&&(n.splice(r,3),r-=3,fh(x,{pending:!0,data:p,method:o.method,action:d},d,p))}}))}function Kr(n){function r(P){return Cc(P,n)}Qn!==null&&Cc(Qn,n),Xn!==null&&Cc(Xn,n),Wn!==null&&Cc(Wn,n),bl.forEach(r),El.forEach(r);for(var o=0;o<Zn.length;o++){var d=Zn[o];d.blockedOn===n&&(d.blockedOn=null)}for(;0<Zn.length&&(o=Zn[0],o.blockedOn===null);)wE(o),o.blockedOn===null&&Zn.shift();if(o=(n.ownerDocument||n).$$reactFormReplay,o!=null)for(d=0;d<o.length;d+=3){var p=o[d],x=o[d+1],_=p[As]||null;if(typeof x=="function")_||ME(o);else if(_){var C=null;if(x&&x.hasAttribute("formAction")){if(p=x,_=x[As]||null)C=_.formAction;else if(h0(p)!==null)continue}else C=_.action;typeof C=="function"?o[d+1]=C:(o.splice(d,3),d-=3),ME(o)}}}function PE(){function n(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function(_){return p=_})},focusReset:"manual",scroll:"manual"})}function r(){p!==null&&(p(),p=null),d||setTimeout(o,20)}function o(){if(!d&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,p=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(o,100),function(){d=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),p!==null&&(p(),p=null)}}}function g0(n){this._internalRoot=n}Oc.prototype.render=g0.prototype.render=function(n){var r=this._internalRoot;if(r===null)throw Error(i(409));var o=r.current,d=Ks();IE(o,d,n,r,null,null)},Oc.prototype.unmount=g0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var r=n.containerInfo;IE(n.current,2,null,n,null,null),fc(),r[cr]=null}};function Oc(n){this._internalRoot=n}Oc.prototype.unstable_scheduleHydration=function(n){if(n){var r=Yg();n={blockedOn:null,target:n,priority:r};for(var o=0;o<Zn.length&&r!==0&&r<Zn[o].priority;o++);Zn.splice(o,0,n),o===0&&wE(n)}};var UE=e.version;if(UE!=="19.2.0")throw Error(i(527,UE,"19.2.0"));W.findDOMNode=function(n){var r=n._reactInternals;if(r===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=h(r),n=n!==null?m(n):null,n=n===null?null:n.stateNode,n};var P3={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:B,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wc.isDisabled&&wc.supportsFiber)try{Ru=wc.inject(P3),Fs=wc}catch{}}return Tl.createRoot=function(n,r){if(!a(n))throw Error(i(299));var o=!1,d="",p=V1,x=q1,_=Y1;return r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(d=r.identifierPrefix),r.onUncaughtError!==void 0&&(p=r.onUncaughtError),r.onCaughtError!==void 0&&(x=r.onCaughtError),r.onRecoverableError!==void 0&&(_=r.onRecoverableError)),r=_E(n,1,!1,null,null,o,d,null,p,x,_,PE),n[cr]=r.current,Xh(n),new g0(r)},Tl.hydrateRoot=function(n,r,o){if(!a(n))throw Error(i(299));var d=!1,p="",x=V1,_=q1,C=Y1,P=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(p=o.identifierPrefix),o.onUncaughtError!==void 0&&(x=o.onUncaughtError),o.onCaughtError!==void 0&&(_=o.onCaughtError),o.onRecoverableError!==void 0&&(C=o.onRecoverableError),o.formState!==void 0&&(P=o.formState)),r=_E(n,1,!0,r,o??null,d,p,P,x,_,C,PE),r.context=LE(null),o=r.current,d=Ks(),d=af(d),p=Un(d),p.callback=null,Bn(o,p,d),o=d,r.current.lanes=o,Cu(r,o),Oi(r),n[cr]=r.current,Xh(n),new Oc(r)},Tl.version="19.2.0",Tl}var qE;function u_(){if(qE)return b0.exports;qE=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(e){console.error(e)}}return s(),b0.exports=r_(),b0.exports}var l_=u_();const o_=cy(l_);var jd=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(s){return this.listeners.add(s),this.onSubscribe(),()=>{this.listeners.delete(s),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},c_={setTimeout:(s,e)=>setTimeout(s,e),clearTimeout:s=>clearTimeout(s),setInterval:(s,e)=>setInterval(s,e),clearInterval:s=>clearInterval(s)},ua,Vm,ty,d_=(ty=class{constructor(){ze(this,ua,c_);ze(this,Vm,!1)}setTimeoutProvider(s){we(this,ua,s)}setTimeout(s,e){return re(this,ua).setTimeout(s,e)}clearTimeout(s){re(this,ua).clearTimeout(s)}setInterval(s,e){return re(this,ua).setInterval(s,e)}clearInterval(s){re(this,ua).clearInterval(s)}},ua=new WeakMap,Vm=new WeakMap,ty),um=new d_;function f_(s){setTimeout(s,0)}var Hd=typeof window>"u"||"Deno"in globalThis;function Si(){}function h_(s,e){return typeof s=="function"?s(e):s}function m_(s){return typeof s=="number"&&s>=0&&s!==1/0}function g_(s,e){return Math.max(s+(e||0)-Date.now(),0)}function lm(s,e){return typeof s=="function"?s(e):s}function p_(s,e){return typeof s=="function"?s(e):s}function YE(s,e){const{type:t="all",exact:i,fetchStatus:a,predicate:u,queryKey:l,stale:c}=s;if(l){if(i){if(e.queryHash!==Km(l,e.options))return!1}else if(!Gl(e.queryKey,l))return!1}if(t!=="all"){const f=e.isActive();if(t==="active"&&!f||t==="inactive"&&f)return!1}return!(typeof c=="boolean"&&e.isStale()!==c||a&&a!==e.state.fetchStatus||u&&!u(e))}function KE(s,e){const{exact:t,status:i,predicate:a,mutationKey:u}=s;if(u){if(!e.options.mutationKey)return!1;if(t){if($l(e.options.mutationKey)!==$l(u))return!1}else if(!Gl(e.options.mutationKey,u))return!1}return!(i&&e.state.status!==i||a&&!a(e))}function Km(s,e){return((e==null?void 0:e.queryKeyHashFn)||$l)(s)}function $l(s){return JSON.stringify(s,(e,t)=>om(t)?Object.keys(t).sort().reduce((i,a)=>(i[a]=t[a],i),{}):t)}function Gl(s,e){return s===e?!0:typeof s!=typeof e?!1:s&&e&&typeof s=="object"&&typeof e=="object"?Object.keys(e).every(t=>Gl(s[t],e[t])):!1}var b_=Object.prototype.hasOwnProperty;function my(s,e){if(s===e)return s;const t=zE(s)&&zE(e);if(!t&&!(om(s)&&om(e)))return e;const a=(t?s:Object.keys(s)).length,u=t?e:Object.keys(e),l=u.length,c=t?new Array(l):{};let f=0;for(let h=0;h<l;h++){const m=t?h:u[h],g=s[m],E=e[m];if(g===E){c[m]=g,(t?h<a:b_.call(s,m))&&f++;continue}if(g===null||E===null||typeof g!="object"||typeof E!="object"){c[m]=E;continue}const T=my(g,E);c[m]=T,T===g&&f++}return a===l&&f===a?s:c}function zE(s){return Array.isArray(s)&&s.length===Object.keys(s).length}function om(s){if(!QE(s))return!1;const e=s.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!QE(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(s)!==Object.prototype)}function QE(s){return Object.prototype.toString.call(s)==="[object Object]"}function E_(s){return new Promise(e=>{um.setTimeout(e,s)})}function x_(s,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(s,e):t.structuralSharing!==!1?my(s,e):e}function T_(s,e,t=0){const i=[...s,e];return t&&i.length>t?i.slice(1):i}function y_(s,e,t=0){const i=[e,...s];return t&&i.length>t?i.slice(0,-1):i}var zm=Symbol();function gy(s,e){return!s.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!s.queryFn||s.queryFn===zm?()=>Promise.reject(new Error(`Missing queryFn: '${s.queryHash}'`)):s.queryFn}var Ya,la,ou,sy,v_=(sy=class extends jd{constructor(){super();ze(this,Ya);ze(this,la);ze(this,ou);we(this,ou,e=>{if(!Hd&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){re(this,la)||this.setEventListener(re(this,ou))}onUnsubscribe(){var e;this.hasListeners()||((e=re(this,la))==null||e.call(this),we(this,la,void 0))}setEventListener(e){var t;we(this,ou,e),(t=re(this,la))==null||t.call(this),we(this,la,e(i=>{typeof i=="boolean"?this.setFocused(i):this.onFocus()}))}setFocused(e){re(this,Ya)!==e&&(we(this,Ya,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof re(this,Ya)=="boolean"?re(this,Ya):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Ya=new WeakMap,la=new WeakMap,ou=new WeakMap,sy),py=new v_;function S_(){let s,e;const t=new Promise((a,u)=>{s=a,e=u});t.status="pending",t.catch(()=>{});function i(a){Object.assign(t,a),delete t.resolve,delete t.reject}return t.resolve=a=>{i({status:"fulfilled",value:a}),s(a)},t.reject=a=>{i({status:"rejected",reason:a}),e(a)},t}var A_=f_;function __(){let s=[],e=0,t=c=>{c()},i=c=>{c()},a=A_;const u=c=>{e?s.push(c):a(()=>{t(c)})},l=()=>{const c=s;s=[],c.length&&a(()=>{i(()=>{c.forEach(f=>{t(f)})})})};return{batch:c=>{let f;e++;try{f=c()}finally{e--,e||l()}return f},batchCalls:c=>(...f)=>{u(()=>{c(...f)})},schedule:u,setNotifyFunction:c=>{t=c},setBatchNotifyFunction:c=>{i=c},setScheduler:c=>{a=c}}}var Ts=__(),cu,oa,du,iy,L_=(iy=class extends jd{constructor(){super();ze(this,cu,!0);ze(this,oa);ze(this,du);we(this,du,e=>{if(!Hd&&window.addEventListener){const t=()=>e(!0),i=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",i)}}})}onSubscribe(){re(this,oa)||this.setEventListener(re(this,du))}onUnsubscribe(){var e;this.hasListeners()||((e=re(this,oa))==null||e.call(this),we(this,oa,void 0))}setEventListener(e){var t;we(this,du,e),(t=re(this,oa))==null||t.call(this),we(this,oa,e(this.setOnline.bind(this)))}setOnline(e){re(this,cu)!==e&&(we(this,cu,e),this.listeners.forEach(i=>{i(e)}))}isOnline(){return re(this,cu)}},cu=new WeakMap,oa=new WeakMap,du=new WeakMap,iy),pd=new L_;function I_(s){return Math.min(1e3*2**s,3e4)}function by(s){return(s??"online")==="online"?pd.isOnline():!0}var cm=class extends Error{constructor(s){super("CancelledError"),this.revert=s==null?void 0:s.revert,this.silent=s==null?void 0:s.silent}};function Ey(s){let e=!1,t=0,i;const a=S_(),u=()=>a.status!=="pending",l=S=>{var A;if(!u()){const I=new cm(S);E(I),(A=s.onCancel)==null||A.call(s,I)}},c=()=>{e=!0},f=()=>{e=!1},h=()=>py.isFocused()&&(s.networkMode==="always"||pd.isOnline())&&s.canRun(),m=()=>by(s.networkMode)&&s.canRun(),g=S=>{u()||(i==null||i(),a.resolve(S))},E=S=>{u()||(i==null||i(),a.reject(S))},T=()=>new Promise(S=>{var A;i=I=>{(u()||h())&&S(I)},(A=s.onPause)==null||A.call(s)}).then(()=>{var S;i=void 0,u()||(S=s.onContinue)==null||S.call(s)}),v=()=>{if(u())return;let S;const A=t===0?s.initialPromise:void 0;try{S=A??s.fn()}catch(I){S=Promise.reject(I)}Promise.resolve(S).then(g).catch(I=>{var G;if(u())return;const R=s.retry??(Hd?0:3),N=s.retryDelay??I_,D=typeof N=="function"?N(t,I):N,k=R===!0||typeof R=="number"&&t<R||typeof R=="function"&&R(t,I);if(e||!k){E(I);return}t++,(G=s.onFail)==null||G.call(s,t,I),E_(D).then(()=>h()?void 0:T()).then(()=>{e?E(I):v()})})};return{promise:a,status:()=>a.status,cancel:l,continue:()=>(i==null||i(),a),cancelRetry:c,continueRetry:f,canStart:m,start:()=>(m()?v():T().then(v),a)}}var Ka,ny,xy=(ny=class{constructor(){ze(this,Ka)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),m_(this.gcTime)&&we(this,Ka,um.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(s){this.gcTime=Math.max(this.gcTime||0,s??(Hd?1/0:300*1e3))}clearGcTimeout(){re(this,Ka)&&(um.clearTimeout(re(this,Ka)),we(this,Ka,void 0))}},Ka=new WeakMap,ny),za,fu,fi,Qa,ss,io,Xa,Ai,En,ay,R_=(ay=class extends xy{constructor(e){super();ze(this,Ai);ze(this,za);ze(this,fu);ze(this,fi);ze(this,Qa);ze(this,ss);ze(this,io);ze(this,Xa);we(this,Xa,!1),we(this,io,e.defaultOptions),this.setOptions(e.options),this.observers=[],we(this,Qa,e.client),we(this,fi,re(this,Qa).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,we(this,za,WE(this.options)),this.state=e.state??re(this,za),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=re(this,ss))==null?void 0:e.promise}setOptions(e){if(this.options={...re(this,io),...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const t=WE(this.options);t.data!==void 0&&(this.setState(XE(t.data,t.dataUpdatedAt)),we(this,za,t))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&re(this,fi).remove(this)}setData(e,t){const i=x_(this.state.data,e,this.options);return ms(this,Ai,En).call(this,{data:i,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),i}setState(e,t){ms(this,Ai,En).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var i,a;const t=(i=re(this,ss))==null?void 0:i.promise;return(a=re(this,ss))==null||a.cancel(e),t?t.then(Si).catch(Si):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(re(this,za))}isActive(){return this.observers.some(e=>p_(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===zm||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>lm(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!g_(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(i=>i.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=re(this,ss))==null||t.continue()}onOnline(){var t;const e=this.observers.find(i=>i.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=re(this,ss))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),re(this,fi).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(re(this,ss)&&(re(this,Xa)?re(this,ss).cancel({revert:!0}):re(this,ss).cancelRetry()),this.scheduleGc()),re(this,fi).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ms(this,Ai,En).call(this,{type:"invalidate"})}async fetch(e,t){var f,h,m,g,E,T,v,S,A,I,R,N;if(this.state.fetchStatus!=="idle"&&((f=re(this,ss))==null?void 0:f.status())!=="rejected"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if(re(this,ss))return re(this,ss).continueRetry(),re(this,ss).promise}if(e&&this.setOptions(e),!this.options.queryFn){const D=this.observers.find(k=>k.options.queryFn);D&&this.setOptions(D.options)}const i=new AbortController,a=D=>{Object.defineProperty(D,"signal",{enumerable:!0,get:()=>(we(this,Xa,!0),i.signal)})},u=()=>{const D=gy(this.options,t),G=(()=>{const U={client:re(this,Qa),queryKey:this.queryKey,meta:this.meta};return a(U),U})();return we(this,Xa,!1),this.options.persister?this.options.persister(D,G,this):D(G)},c=(()=>{const D={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:re(this,Qa),state:this.state,fetchFn:u};return a(D),D})();(h=this.options.behavior)==null||h.onFetch(c,this),we(this,fu,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((m=c.fetchOptions)==null?void 0:m.meta))&&ms(this,Ai,En).call(this,{type:"fetch",meta:(g=c.fetchOptions)==null?void 0:g.meta}),we(this,ss,Ey({initialPromise:t==null?void 0:t.initialPromise,fn:c.fetchFn,onCancel:D=>{D instanceof cm&&D.revert&&this.setState({...re(this,fu),fetchStatus:"idle"}),i.abort()},onFail:(D,k)=>{ms(this,Ai,En).call(this,{type:"failed",failureCount:D,error:k})},onPause:()=>{ms(this,Ai,En).call(this,{type:"pause"})},onContinue:()=>{ms(this,Ai,En).call(this,{type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0}));try{const D=await re(this,ss).start();if(D===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(D),(T=(E=re(this,fi).config).onSuccess)==null||T.call(E,D,this),(S=(v=re(this,fi).config).onSettled)==null||S.call(v,D,this.state.error,this),D}catch(D){if(D instanceof cm){if(D.silent)return re(this,ss).promise;if(D.revert){if(this.state.data===void 0)throw D;return this.state.data}}throw ms(this,Ai,En).call(this,{type:"error",error:D}),(I=(A=re(this,fi).config).onError)==null||I.call(A,D,this),(N=(R=re(this,fi).config).onSettled)==null||N.call(R,this.state.data,D,this),D}finally{this.scheduleGc()}}},za=new WeakMap,fu=new WeakMap,fi=new WeakMap,Qa=new WeakMap,ss=new WeakMap,io=new WeakMap,Xa=new WeakMap,Ai=new WeakSet,En=function(e){const t=i=>{switch(e.type){case"failed":return{...i,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...N_(i.data,this.options),fetchMeta:e.meta??null};case"success":const a={...i,...XE(e.data,e.dataUpdatedAt),dataUpdateCount:i.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return we(this,fu,e.manual?a:void 0),a;case"error":const u=e.error;return{...i,error:u,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error"};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...e.state}}};this.state=t(this.state),Ts.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),re(this,fi).notify({query:this,type:"updated",action:e})})},ay);function N_(s,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:by(e.networkMode)?"fetching":"paused",...s===void 0&&{error:null,status:"pending"}}}function XE(s,e){return{data:s,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function WE(s){const e=typeof s.initialData=="function"?s.initialData():s.initialData,t=e!==void 0,i=t?typeof s.initialDataUpdatedAt=="function"?s.initialDataUpdatedAt():s.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}function ZE(s){return{onFetch:(e,t)=>{var m,g,E,T,v;const i=e.options,a=(E=(g=(m=e.fetchOptions)==null?void 0:m.meta)==null?void 0:g.fetchMore)==null?void 0:E.direction,u=((T=e.state.data)==null?void 0:T.pages)||[],l=((v=e.state.data)==null?void 0:v.pageParams)||[];let c={pages:[],pageParams:[]},f=0;const h=async()=>{let S=!1;const A=N=>{Object.defineProperty(N,"signal",{enumerable:!0,get:()=>(e.signal.aborted?S=!0:e.signal.addEventListener("abort",()=>{S=!0}),e.signal)})},I=gy(e.options,e.fetchOptions),R=async(N,D,k)=>{if(S)return Promise.reject();if(D==null&&N.pages.length)return Promise.resolve(N);const U=(()=>{const ee={client:e.client,queryKey:e.queryKey,pageParam:D,direction:k?"backward":"forward",meta:e.options.meta};return A(ee),ee})(),H=await I(U),{maxPages:$}=e.options,F=k?y_:T_;return{pages:F(N.pages,H,$),pageParams:F(N.pageParams,D,$)}};if(a&&u.length){const N=a==="backward",D=N?C_:JE,k={pages:u,pageParams:l},G=D(i,k);c=await R(k,G,N)}else{const N=s??u.length;do{const D=f===0?l[0]??i.initialPageParam:JE(i,c);if(f>0&&D==null)break;c=await R(c,D),f++}while(f<N)}return c};e.options.persister?e.fetchFn=()=>{var S,A;return(A=(S=e.options).persister)==null?void 0:A.call(S,h,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=h}}}function JE(s,{pages:e,pageParams:t}){const i=e.length-1;return e.length>0?s.getNextPageParam(e[i],e,t[i],t):void 0}function C_(s,{pages:e,pageParams:t}){var i;return e.length>0?(i=s.getPreviousPageParam)==null?void 0:i.call(s,e[0],e,t[0],t):void 0}var no,Pi,xs,Wa,Ui,sa,ry,D_=(ry=class extends xy{constructor(e){super();ze(this,Ui);ze(this,no);ze(this,Pi);ze(this,xs);ze(this,Wa);we(this,no,e.client),this.mutationId=e.mutationId,we(this,xs,e.mutationCache),we(this,Pi,[]),this.state=e.state||O_(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){re(this,Pi).includes(e)||(re(this,Pi).push(e),this.clearGcTimeout(),re(this,xs).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){we(this,Pi,re(this,Pi).filter(t=>t!==e)),this.scheduleGc(),re(this,xs).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){re(this,Pi).length||(this.state.status==="pending"?this.scheduleGc():re(this,xs).remove(this))}continue(){var e;return((e=re(this,Wa))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var l,c,f,h,m,g,E,T,v,S,A,I,R,N,D,k,G,U,H,$;const t=()=>{ms(this,Ui,sa).call(this,{type:"continue"})},i={client:re(this,no),meta:this.options.meta,mutationKey:this.options.mutationKey};we(this,Wa,Ey({fn:()=>this.options.mutationFn?this.options.mutationFn(e,i):Promise.reject(new Error("No mutationFn found")),onFail:(F,ee)=>{ms(this,Ui,sa).call(this,{type:"failed",failureCount:F,error:ee})},onPause:()=>{ms(this,Ui,sa).call(this,{type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>re(this,xs).canRun(this)}));const a=this.state.status==="pending",u=!re(this,Wa).canStart();try{if(a)t();else{ms(this,Ui,sa).call(this,{type:"pending",variables:e,isPaused:u}),await((c=(l=re(this,xs).config).onMutate)==null?void 0:c.call(l,e,this,i));const ee=await((h=(f=this.options).onMutate)==null?void 0:h.call(f,e,i));ee!==this.state.context&&ms(this,Ui,sa).call(this,{type:"pending",context:ee,variables:e,isPaused:u})}const F=await re(this,Wa).start();return await((g=(m=re(this,xs).config).onSuccess)==null?void 0:g.call(m,F,e,this.state.context,this,i)),await((T=(E=this.options).onSuccess)==null?void 0:T.call(E,F,e,this.state.context,i)),await((S=(v=re(this,xs).config).onSettled)==null?void 0:S.call(v,F,null,this.state.variables,this.state.context,this,i)),await((I=(A=this.options).onSettled)==null?void 0:I.call(A,F,null,e,this.state.context,i)),ms(this,Ui,sa).call(this,{type:"success",data:F}),F}catch(F){try{throw await((N=(R=re(this,xs).config).onError)==null?void 0:N.call(R,F,e,this.state.context,this,i)),await((k=(D=this.options).onError)==null?void 0:k.call(D,F,e,this.state.context,i)),await((U=(G=re(this,xs).config).onSettled)==null?void 0:U.call(G,void 0,F,this.state.variables,this.state.context,this,i)),await(($=(H=this.options).onSettled)==null?void 0:$.call(H,void 0,F,e,this.state.context,i)),F}finally{ms(this,Ui,sa).call(this,{type:"error",error:F})}}finally{re(this,xs).runNext(this)}}},no=new WeakMap,Pi=new WeakMap,xs=new WeakMap,Wa=new WeakMap,Ui=new WeakSet,sa=function(e){const t=i=>{switch(e.type){case"failed":return{...i,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...i,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:e.error,failureCount:i.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),Ts.batch(()=>{re(this,Pi).forEach(i=>{i.onMutationUpdate(e)}),re(this,xs).notify({mutation:this,type:"updated",action:e})})},ry);function O_(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Sn,_i,ao,uy,w_=(uy=class extends jd{constructor(e={}){super();ze(this,Sn);ze(this,_i);ze(this,ao);this.config=e,we(this,Sn,new Set),we(this,_i,new Map),we(this,ao,0)}build(e,t,i){const a=new D_({client:e,mutationCache:this,mutationId:++kc(this,ao)._,options:e.defaultMutationOptions(t),state:i});return this.add(a),a}add(e){re(this,Sn).add(e);const t=Mc(e);if(typeof t=="string"){const i=re(this,_i).get(t);i?i.push(e):re(this,_i).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(re(this,Sn).delete(e)){const t=Mc(e);if(typeof t=="string"){const i=re(this,_i).get(t);if(i)if(i.length>1){const a=i.indexOf(e);a!==-1&&i.splice(a,1)}else i[0]===e&&re(this,_i).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=Mc(e);if(typeof t=="string"){const i=re(this,_i).get(t),a=i==null?void 0:i.find(u=>u.state.status==="pending");return!a||a===e}else return!0}runNext(e){var i;const t=Mc(e);if(typeof t=="string"){const a=(i=re(this,_i).get(t))==null?void 0:i.find(u=>u!==e&&u.state.isPaused);return(a==null?void 0:a.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Ts.batch(()=>{re(this,Sn).forEach(e=>{this.notify({type:"removed",mutation:e})}),re(this,Sn).clear(),re(this,_i).clear()})}getAll(){return Array.from(re(this,Sn))}find(e){const t={exact:!0,...e};return this.getAll().find(i=>KE(t,i))}findAll(e={}){return this.getAll().filter(t=>KE(e,t))}notify(e){Ts.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return Ts.batch(()=>Promise.all(e.map(t=>t.continue().catch(Si))))}},Sn=new WeakMap,_i=new WeakMap,ao=new WeakMap,uy);function Mc(s){var e;return(e=s.options.scope)==null?void 0:e.id}var Bi,ly,k_=(ly=class extends jd{constructor(e={}){super();ze(this,Bi);this.config=e,we(this,Bi,new Map)}build(e,t,i){const a=t.queryKey,u=t.queryHash??Km(a,t);let l=this.get(u);return l||(l=new R_({client:e,queryKey:a,queryHash:u,options:e.defaultQueryOptions(t),state:i,defaultOptions:e.getQueryDefaults(a)}),this.add(l)),l}add(e){re(this,Bi).has(e.queryHash)||(re(this,Bi).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=re(this,Bi).get(e.queryHash);t&&(e.destroy(),t===e&&re(this,Bi).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Ts.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return re(this,Bi).get(e)}getAll(){return[...re(this,Bi).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(i=>YE(t,i))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(i=>YE(e,i)):t}notify(e){Ts.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Ts.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Ts.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Bi=new WeakMap,ly),_t,ca,da,hu,mu,fa,gu,pu,oy,M_=(oy=class{constructor(s={}){ze(this,_t);ze(this,ca);ze(this,da);ze(this,hu);ze(this,mu);ze(this,fa);ze(this,gu);ze(this,pu);we(this,_t,s.queryCache||new k_),we(this,ca,s.mutationCache||new w_),we(this,da,s.defaultOptions||{}),we(this,hu,new Map),we(this,mu,new Map),we(this,fa,0)}mount(){kc(this,fa)._++,re(this,fa)===1&&(we(this,gu,py.subscribe(async s=>{s&&(await this.resumePausedMutations(),re(this,_t).onFocus())})),we(this,pu,pd.subscribe(async s=>{s&&(await this.resumePausedMutations(),re(this,_t).onOnline())})))}unmount(){var s,e;kc(this,fa)._--,re(this,fa)===0&&((s=re(this,gu))==null||s.call(this),we(this,gu,void 0),(e=re(this,pu))==null||e.call(this),we(this,pu,void 0))}isFetching(s){return re(this,_t).findAll({...s,fetchStatus:"fetching"}).length}isMutating(s){return re(this,ca).findAll({...s,status:"pending"}).length}getQueryData(s){var t;const e=this.defaultQueryOptions({queryKey:s});return(t=re(this,_t).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(s){const e=this.defaultQueryOptions(s),t=re(this,_t).build(this,e),i=t.state.data;return i===void 0?this.fetchQuery(s):(s.revalidateIfStale&&t.isStaleByTime(lm(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(i))}getQueriesData(s){return re(this,_t).findAll(s).map(({queryKey:e,state:t})=>{const i=t.data;return[e,i]})}setQueryData(s,e,t){const i=this.defaultQueryOptions({queryKey:s}),a=re(this,_t).get(i.queryHash),u=a==null?void 0:a.state.data,l=h_(e,u);if(l!==void 0)return re(this,_t).build(this,i).setData(l,{...t,manual:!0})}setQueriesData(s,e,t){return Ts.batch(()=>re(this,_t).findAll(s).map(({queryKey:i})=>[i,this.setQueryData(i,e,t)]))}getQueryState(s){var t;const e=this.defaultQueryOptions({queryKey:s});return(t=re(this,_t).get(e.queryHash))==null?void 0:t.state}removeQueries(s){const e=re(this,_t);Ts.batch(()=>{e.findAll(s).forEach(t=>{e.remove(t)})})}resetQueries(s,e){const t=re(this,_t);return Ts.batch(()=>(t.findAll(s).forEach(i=>{i.reset()}),this.refetchQueries({type:"active",...s},e)))}cancelQueries(s,e={}){const t={revert:!0,...e},i=Ts.batch(()=>re(this,_t).findAll(s).map(a=>a.cancel(t)));return Promise.all(i).then(Si).catch(Si)}invalidateQueries(s,e={}){return Ts.batch(()=>(re(this,_t).findAll(s).forEach(t=>{t.invalidate()}),(s==null?void 0:s.refetchType)==="none"?Promise.resolve():this.refetchQueries({...s,type:(s==null?void 0:s.refetchType)??(s==null?void 0:s.type)??"active"},e)))}refetchQueries(s,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},i=Ts.batch(()=>re(this,_t).findAll(s).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let u=a.fetch(void 0,t);return t.throwOnError||(u=u.catch(Si)),a.state.fetchStatus==="paused"?Promise.resolve():u}));return Promise.all(i).then(Si)}fetchQuery(s){const e=this.defaultQueryOptions(s);e.retry===void 0&&(e.retry=!1);const t=re(this,_t).build(this,e);return t.isStaleByTime(lm(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(s){return this.fetchQuery(s).then(Si).catch(Si)}fetchInfiniteQuery(s){return s.behavior=ZE(s.pages),this.fetchQuery(s)}prefetchInfiniteQuery(s){return this.fetchInfiniteQuery(s).then(Si).catch(Si)}ensureInfiniteQueryData(s){return s.behavior=ZE(s.pages),this.ensureQueryData(s)}resumePausedMutations(){return pd.isOnline()?re(this,ca).resumePausedMutations():Promise.resolve()}getQueryCache(){return re(this,_t)}getMutationCache(){return re(this,ca)}getDefaultOptions(){return re(this,da)}setDefaultOptions(s){we(this,da,s)}setQueryDefaults(s,e){re(this,hu).set($l(s),{queryKey:s,defaultOptions:e})}getQueryDefaults(s){const e=[...re(this,hu).values()],t={};return e.forEach(i=>{Gl(s,i.queryKey)&&Object.assign(t,i.defaultOptions)}),t}setMutationDefaults(s,e){re(this,mu).set($l(s),{mutationKey:s,defaultOptions:e})}getMutationDefaults(s){const e=[...re(this,mu).values()],t={};return e.forEach(i=>{Gl(s,i.mutationKey)&&Object.assign(t,i.defaultOptions)}),t}defaultQueryOptions(s){if(s._defaulted)return s;const e={...re(this,da).queries,...this.getQueryDefaults(s.queryKey),...s,_defaulted:!0};return e.queryHash||(e.queryHash=Km(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===zm&&(e.enabled=!1),e}defaultMutationOptions(s){return s!=null&&s._defaulted?s:{...re(this,da).mutations,...(s==null?void 0:s.mutationKey)&&this.getMutationDefaults(s.mutationKey),...s,_defaulted:!0}}clear(){re(this,_t).clear(),re(this,ca).clear()}},_t=new WeakMap,ca=new WeakMap,da=new WeakMap,hu=new WeakMap,mu=new WeakMap,fa=new WeakMap,gu=new WeakMap,pu=new WeakMap,oy),P_=ie.createContext(void 0),U_=({client:s,children:e})=>(ie.useEffect(()=>(s.mount(),()=>{s.unmount()}),[s]),b.jsx(P_.Provider,{value:s,children:e}));const B_="https://cinestream-pro-afterdark.onrender.com",di=Li.create({baseURL:B_,headers:{"Content-Type":"application/json"}});di.interceptors.request.use(s=>{const e=sessionStorage.getItem("accessToken");return e&&(s.headers.Authorization=`Bearer ${e}`),s},s=>Promise.reject(s));di.interceptors.response.use(s=>s,s=>{var e;return((e=s.response)==null?void 0:e.status)===401&&(sessionStorage.removeItem("accessToken"),sessionStorage.removeItem("refreshToken"),sessionStorage.removeItem("user"),window.location.href="/#/login"),Promise.reject(s)});const Fi={login:async(s,e)=>(await di.post("/api/auth/login",{username:s,password:e})).data,logout:async()=>(await di.post("/api/auth/logout")).data,getCurrentUser:async()=>(await di.get("/api/auth/me")).data,getAllUsers:async(s=1,e=50)=>(await di.get("/api/admin/users",{params:{page:s,limit:e}})).data,createUser:async(s,e,t)=>(await di.post("/api/admin/users",{username:s,password:e,role:t})).data,updateUser:async(s,e)=>(await di.put(`/api/admin/users/${s}`,e)).data,deleteUser:async s=>(await di.delete(`/api/admin/users/${s}`)).data,blockUser:async s=>(await di.patch(`/api/admin/users/${s}/block`)).data,unblockUser:async s=>(await di.patch(`/api/admin/users/${s}/unblock`)).data,resetPassword:async(s,e)=>(await di.patch(`/api/admin/users/${s}/reset-password`,{newPassword:e})).data},Ty=ie.createContext(void 0),F_=({children:s})=>{const[e,t]=ie.useState(null),[i,a]=ie.useState(!0),[u,l]=ie.useState(!!sessionStorage.getItem("accessToken")),c=async()=>{try{if(!sessionStorage.getItem("accessToken")){t(null),a(!1),l(!1);return}try{const T=await Fi.getCurrentUser();if(T.success&&T.data)t(T.data);else throw new Error("Invalid session")}catch(T){console.error("Session verification failed:",T),sessionStorage.removeItem("accessToken"),sessionStorage.removeItem("refreshToken"),t(null),l(!1)}finally{a(!1)}}catch(E){console.error("Auth check failed:",E),t(null),sessionStorage.removeItem("accessToken"),sessionStorage.removeItem("refreshToken"),a(!1),l(!1)}},f=async(E,T)=>{var v,S;try{const A=await Fi.login(E,T);if(A.success){const{user:I,accessToken:R,refreshToken:N}=A.data;sessionStorage.setItem("accessToken",R),sessionStorage.setItem("refreshToken",N),t(I),l(!1),I.role==="admin"?window.location.hash="/admin-dashboard":window.location.hash="/"}else throw new Error(A.message||"Login failed")}catch(A){const I=((S=(v=A.response)==null?void 0:v.data)==null?void 0:S.message)||A.message||"Login failed";throw new Error(I)}},h=async E=>{if(e)try{if((await Fi.login(e.username,E)).success)l(!1);else throw new Error("Incorrect password")}catch{throw new Error("Incorrect password")}},m=async()=>{try{await Fi.logout()}catch(E){console.error("Logout error:",E)}finally{sessionStorage.removeItem("accessToken"),sessionStorage.removeItem("refreshToken"),t(null),l(!1),window.location.hash="/login"}};ie.useEffect(()=>{c()},[]);const g={user:e,isAuthenticated:!!e,isAdmin:(e==null?void 0:e.role)==="admin",loading:i,isLocked:u,login:f,logout:m,unlock:h,checkAuth:c};return b.jsx(Ty.Provider,{value:g,children:s})},ar=()=>{const s=ie.useContext(Ty);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s},yy=ie.createContext(void 0),j_=({children:s})=>{const[e,t]=ie.useState(()=>{const a=localStorage.getItem("theme");return a||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")});ie.useEffect(()=>{const a=window.document.documentElement;e==="dark"?a.classList.add("dark"):a.classList.remove("dark"),localStorage.setItem("theme",e)},[e]);const i=()=>{t(a=>a==="dark"?"light":"dark")};return b.jsx(yy.Provider,{value:{theme:e,toggleTheme:i},children:s})},H_=()=>{const s=ie.useContext(yy);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s},$_=()=>{const[s,e]=ie.useState(!1),[t,i]=ie.useState(""),[a,u]=ie.useState(!1),l=ro(),c=j3(),{user:f,isAdmin:h,logout:m}=ar(),{theme:g,toggleTheme:E}=H_(),T=c.pathname.startsWith("/adult"),S=(["/","/adult"].includes(c.pathname)||c.pathname.startsWith("/watch")||c.pathname.startsWith("/movies/"))&&!s;ie.useEffect(()=>{const N=()=>e(window.scrollY>50);return window.addEventListener("scroll",N),()=>window.removeEventListener("scroll",N)},[]);const A=N=>{if(N.preventDefault(),!t.trim())return;l(`${T?"/adult/search":"/search"}?q=${encodeURIComponent(t)}`),u(!1)},I=async()=>{await m()},R=T?[{name:"Home",path:"/adult"},{name:"Latest",path:"/adult/latest"},{name:"Categories",path:"/adult/categories"}]:[{name:"Home",path:"/"},{name:"Movies",path:"/movies"},{name:"Genres",path:"/genres"},{name:"Web Series",path:"/webseries"},{name:"Favorites",path:"/favorites"},{name:"History",path:"/history"}];return b.jsxs("nav",{className:`fixed top-0 w-full z-50 transition-all duration-300 ${S?"bg-transparent":"bg-background/95 backdrop-blur-md border-b border-white/5 shadow-sm"}`,children:[b.jsxs("div",{className:"w-full max-w-[2000px] mx-auto px-4 md:px-6 h-16 flex items-center justify-between",children:[b.jsxs(gt,{to:"/",className:"flex items-center gap-2 z-50",children:[b.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center font-bold text-xl ${T?"bg-secondary":"bg-primary"}`,children:T?"X":"C"}),b.jsx("span",{className:`font-bold text-xl tracking-tight hidden sm:block ${S?"text-white":"text-text"}`,children:T?"AfterDark":"CineStream Pro AfterDark"})]}),b.jsxs("div",{className:"hidden md:flex items-center gap-6",children:[R.map(N=>b.jsx(gt,{to:N.path,className:`text-sm font-medium transition-colors ${S?"text-gray-300 hover:text-white":"text-text-muted hover:text-primary"}`,children:N.name},N.path)),b.jsxs(gt,{to:"/livetv",className:`text-sm font-medium transition-colors flex items-center gap-1 ${S?"text-gray-300 hover:text-red-500":"text-text-muted hover:text-red-500"}`,children:[b.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"})," Live TV"]}),h&&b.jsxs(gt,{to:"/admin-dashboard",className:"text-sm font-medium text-purple-400 hover:text-purple-300 transition-colors flex items-center gap-1",children:[b.jsx(Fl,{className:"w-4 h-4"})," Admin"]})]}),b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsxs("form",{onSubmit:A,className:"hidden md:flex relative items-center",children:[b.jsx(bu,{className:`absolute left-3 w-4 h-4 ${S?"text-gray-400":"text-text-muted"}`}),b.jsx("input",{type:"text",placeholder:T?"Search videos...":"Search movies...",value:t,onChange:N=>i(N.target.value),className:`border rounded-full py-1.5 pl-9 pr-4 text-sm focus:outline-none transition-all w-48 lg:w-64 ${S?"bg-white/10 border-white/10 focus:border-white/30 focus:bg-white/20 text-white placeholder-gray-400":"bg-surface border-white/10 focus:border-primary/50 focus:bg-surface text-text placeholder-text-muted"}`})]}),b.jsx("button",{onClick:E,className:`p-2 rounded-full transition-colors ${S?"text-gray-300 hover:bg-white/10":"text-text-muted hover:bg-surface"}`,title:`Switch to ${g==="dark"?"light":"dark"} mode`,children:g==="dark"?b.jsx(q3,{className:"w-5 h-5"}):b.jsx(Y3,{className:"w-5 h-5"})}),b.jsx("button",{onClick:()=>l(T?"/":"/adult"),className:`px-3 py-1 rounded-md text-xs font-bold border transition-all ${T?"border-primary text-primary hover:bg-primary hover:text-black":"border-secondary text-secondary hover:bg-secondary hover:text-white"}`,children:T?"SAFE MODE":"18+"}),f&&b.jsxs("div",{className:"hidden md:flex items-center gap-3",children:[b.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full border ${S?"bg-white/10 border-white/10":"bg-surface border-white/10"}`,children:[b.jsx(jl,{className:`w-4 h-4 ${S?"text-gray-400":"text-text-muted"}`}),b.jsx("span",{className:`text-sm ${S?"text-gray-300":"text-text"}`,children:f.username})]}),b.jsx("button",{onClick:I,className:"p-2 hover:bg-red-500/20 rounded-lg transition-colors group",title:"Logout",children:b.jsx(nm,{className:`w-4 h-4 ${S?"text-gray-400":"text-text-muted"} group-hover:text-red-400`})})]}),b.jsx("button",{className:`md:hidden ${S?"text-gray-300":"text-text"}`,onClick:()=>u(!a),children:a?b.jsx(iu,{}):b.jsx(K3,{})})]})]}),a&&b.jsxs("div",{className:"md:hidden absolute top-16 left-0 w-full bg-[#FFC107] rounded-b-[3rem] p-5 flex flex-col gap-4 shadow-2xl animate-slide-up z-50",children:[b.jsxs("form",{onSubmit:A,className:"relative w-full",children:[b.jsx(bu,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),b.jsx("input",{type:"text",placeholder:"Search...",value:t,onChange:N=>i(N.target.value),className:"w-full bg-[#1a1a1a] rounded-xl py-3 pl-10 pr-4 text-sm text-red-500 placeholder-gray-500 focus:outline-none border-none"})]}),b.jsx("div",{className:"flex flex-col gap-1",children:R.map(N=>b.jsx(gt,{to:N.path,onClick:()=>u(!1),className:"text-lg font-medium text-black hover:text-white py-2 px-2 transition-colors",children:N.name},N.path))}),h&&b.jsxs(gt,{to:"/admin-dashboard",onClick:()=>u(!1),className:"text-lg font-medium text-red-600 hover:text-red-700 py-2 px-2 flex items-center gap-2 transition-colors",children:[b.jsx(Fl,{className:"w-5 h-5"})," Admin Panel"]}),f&&b.jsx("div",{className:"mt-2 pt-2",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center gap-2 text-red-600 font-medium px-2",children:[b.jsx(jl,{className:"w-5 h-5"}),b.jsx("span",{className:"text-base",children:f.username})]}),b.jsxs("button",{onClick:I,className:"flex items-center gap-2 px-4 py-2 bg-black/10 hover:bg-black/20 text-black rounded-lg transition font-medium",children:[b.jsx(nm,{className:"w-4 h-4"}),b.jsx("span",{className:"text-sm",children:"Logout"})]})]})})]})]})},Ds=({children:s})=>{const{isAuthenticated:e,loading:t}=ar();return t?b.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:b.jsxs("div",{className:"text-center flex flex-col items-center gap-4",children:[b.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"}),b.jsx("p",{className:"text-text text-lg",children:"Loading..."})]})}):e?b.jsx(b.Fragment,{children:s}):b.jsx(dy,{to:"/login",replace:!0})},G_=({children:s})=>{const{isAuthenticated:e,isAdmin:t,loading:i}=ar();return i?b.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:b.jsxs("div",{className:"text-center flex flex-col items-center gap-4",children:[b.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"}),b.jsx("p",{className:"text-text text-lg",children:"Loading..."})]})}):e?t?b.jsx(b.Fragment,{children:s}):b.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:b.jsx("div",{className:"max-w-md w-full bg-surface p-8 rounded-2xl border border-white/10 shadow-2xl animate-fade-in",children:b.jsxs("div",{className:"text-center text-text",children:[b.jsx("div",{className:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-6",children:b.jsx(Fl,{className:"w-8 h-8 text-red-500"})}),b.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Access Denied"}),b.jsx("p",{className:"text-text-muted mb-8",children:"You don't have permission to access this page."}),b.jsx(gt,{to:"/",className:"block w-full bg-primary text-black font-bold py-3 rounded-xl hover:bg-blue-400 transition transform hover:scale-105",children:"Return Home"})]})})}):b.jsx(dy,{to:"/login",replace:!0})},V_="https://api.themoviedb.org/3",q_="be36c8a63f4f2aad5c22a368508a1672",Y_="https://www.eporner.com/api/v2",Os=Li.create({baseURL:V_,params:{api_key:q_}}),He={getTrending:async(s="week")=>(await Os.get(`/trending/all/${s}`)).data.results,getPopular:async(s="movie",e=1)=>(await Os.get(`/${s}/popular`,{params:{page:e}})).data.results,getTopRated:async(s="movie",e=1)=>(await Os.get(`/${s}/top_rated`,{params:{page:e}})).data.results,getUpcoming:async()=>(await Os.get("/movie/upcoming")).data.results,getNowPlaying:async()=>(await Os.get("/movie/now_playing")).data.results,getDetails:async(s,e)=>(await Os.get(`/${e}/${s}`,{params:{append_to_response:"credits,videos,similar"}})).data,getSimilar:async(s,e="movie")=>(await Os.get(`/${e}/${s}/similar`)).data.results,search:async(s,e=1)=>(await Os.get("/search/multi",{params:{query:s,page:e}})).data.results,getMoviesByGenre:async(s,e=1)=>(await Os.get("/discover/movie",{params:{with_genres:s,page:e,sort_by:"popularity.desc"}})).data.results,getDiscoverTV:async(s=1)=>(await Os.get("/discover/tv",{params:{page:s,sort_by:"popularity.desc"}})).data.results.map(t=>({...t,title:t.name,release_date:t.first_air_date})),getTrendingTV:async()=>(await Os.get("/trending/tv/week")).data.results.map(e=>({...e,title:e.name,release_date:e.first_air_date})),getActorDetails:async s=>(await Os.get(`/person/${s}`)).data,getActorMovieCredits:async s=>(await Os.get(`/person/${s}/movie_credits`)).data,getActorTVCredits:async s=>(await Os.get(`/person/${s}/tv_credits`)).data,getImageUrl:(s,e="w500")=>s?`https://image.tmdb.org/t/p/${e}${s}`:"https://picsum.photos/500/750?grayscale"},K_={getVideos:async(s="",e=1,t=20,i="top-weekly")=>{try{return(await Li.get(`${Y_}/video/search/`,{params:{query:i==="jav"?`${s} jav`:s,per_page:t,page:e,thumbsize:"medium",order:i==="jav"?"latest-updates":i,format:"json"}})).data.videos}catch{return console.warn("Eporner API failed (likely CORS). Returning fallback data for demo."),Array.from({length:10}).map((u,l)=>({id:`mock-${l}`,title:`Adult Video Demo Title ${l+1}`,url:"#",default_thumb:{src:`https://picsum.photos/400/225?random=${l}`},length_min:"12:34",views:1e4+l*500,rate:"95%",keywords:"demo, test"}))}}},ex=({movie:s,onRemove:e})=>{const t=s.title||s.name||"Untitled",i=s.release_date||s.first_air_date||"",a=i?new Date(i).getFullYear():"",u=s.media_type==="tv"||!!s.name,l=(s.vote_average||0).toFixed(1),c=f=>{f.preventDefault(),f.stopPropagation(),e(s.id.toString())};return b.jsxs(gt,{to:`/${u?"webseries":"movies"}/${s.id}`,className:"group relative block",children:[b.jsx("button",{onClick:c,className:"absolute top-2 right-2 z-20 w-8 h-8 bg-black/80 hover:bg-red-500 rounded-full flex items-center justify-center transition-all opacity-100 md:opacity-0 md:group-hover:opacity-100 border border-white/20 hover:border-red-500",title:"Remove from Continue Watching",children:b.jsx(iu,{className:"w-4 h-4 text-white"})}),b.jsx("div",{className:"relative backdrop-blur-xl rounded-2xl overflow-hidden transition-all duration-500 hover:scale-[1.02] hover:shadow-2xl bg-card-bg border",style:{borderColor:"var(--color-border)",boxShadow:"0 4px 6px var(--color-shadow)"},onMouseEnter:f=>f.currentTarget.style.borderColor="var(--color-border-hover)",onMouseLeave:f=>f.currentTarget.style.borderColor="var(--color-border)",children:b.jsxs("div",{className:"relative aspect-[2/3] w-full overflow-hidden",children:[b.jsx("img",{src:He.getImageUrl(s.poster_path),alt:t,loading:"lazy",className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent opacity-60 group-hover:opacity-80 transition-opacity duration-300"}),b.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300",children:b.jsx("div",{className:"w-16 h-16 rounded-full bg-primary backdrop-blur-md flex items-center justify-center transform scale-75 group-hover:scale-100 transition-transform duration-300 shadow-2xl",children:b.jsx(Yi,{className:"w-7 h-7 text-black fill-current ml-1"})})}),b.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 transform translate-y-0 md:translate-y-full md:group-hover:translate-y-0 transition-transform duration-300",children:b.jsxs("div",{className:"space-y-2",children:[b.jsx("h3",{className:"font-bold text-white text-sm md:text-base line-clamp-2 drop-shadow-lg leading-tight",children:t}),b.jsxs("div",{className:"flex items-center justify-between gap-2",children:[b.jsx("span",{className:"text-gray-300 text-xs font-medium",children:a}),l!=="0.0"&&b.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-black/60 backdrop-blur-md rounded-full border border-yellow-500/30",children:[b.jsx(ys,{className:"w-3.5 h-3.5 fill-yellow-400 text-yellow-400"}),b.jsx("span",{className:"text-yellow-400 text-xs font-bold",children:l})]})]})]})})]})}),b.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-primary/0 via-primary/20 to-primary/0 rounded-2xl opacity-0 group-hover:opacity-100 blur-xl transition-opacity duration-500 -z-10"})]})},tr=({movie:s})=>{const e=s.title||s.name||"Untitled",t=s.release_date||s.first_air_date||"",i=t?new Date(t).getFullYear():"",a=s.media_type==="tv"||!!s.name,u=(s.vote_average||0).toFixed(1);return b.jsxs(gt,{to:`/${a?"webseries":"movies"}/${s.id}`,className:"group relative block",children:[b.jsx("div",{className:"relative backdrop-blur-xl rounded-2xl overflow-hidden transition-all duration-500 hover:scale-[1.02] hover:shadow-2xl bg-card-bg border",style:{borderColor:"var(--color-border)",boxShadow:"0 4px 6px var(--color-shadow)"},onMouseEnter:l=>l.currentTarget.style.borderColor="var(--color-border-hover)",onMouseLeave:l=>l.currentTarget.style.borderColor="var(--color-border)",children:b.jsxs("div",{className:"relative aspect-[2/3] w-full overflow-hidden",children:[b.jsx("img",{src:He.getImageUrl(s.poster_path),alt:e,loading:"lazy",className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent opacity-60 group-hover:opacity-80 transition-opacity duration-300"}),s.vote_average&&s.vote_average>8&&b.jsxs("div",{className:"absolute top-3 right-3 px-3 py-1.5 bg-gradient-to-r from-yellow-500/90 to-orange-500/90 backdrop-blur-md rounded-full flex items-center gap-1.5 shadow-lg animate-pulse",children:[b.jsx(Nl,{className:"w-3.5 h-3.5 text-white"}),b.jsx("span",{className:"text-white text-xs font-bold",children:"Hot"})]}),b.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300",children:b.jsx("div",{className:"w-16 h-16 rounded-full bg-primary backdrop-blur-md flex items-center justify-center transform scale-75 group-hover:scale-100 transition-transform duration-300 shadow-2xl",children:b.jsx(Yi,{className:"w-7 h-7 text-black fill-current ml-1"})})}),b.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 transform translate-y-0 md:translate-y-full md:group-hover:translate-y-0 transition-transform duration-300",children:b.jsxs("div",{className:"space-y-2",children:[b.jsx("h3",{className:"font-bold text-white text-sm md:text-base line-clamp-2 drop-shadow-lg leading-tight",children:e}),b.jsxs("div",{className:"flex items-center justify-between gap-2",children:[b.jsx("span",{className:"text-gray-300 text-xs font-medium",children:i}),b.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 bg-black/60 backdrop-blur-md rounded-full border border-yellow-500/30",children:[b.jsx(ys,{className:"w-3.5 h-3.5 fill-yellow-400 text-yellow-400"}),b.jsx("span",{className:"text-yellow-400 text-xs font-bold",children:u})]})]}),b.jsxs("button",{className:"hidden md:flex w-full items-center justify-center gap-2 bg-primary backdrop-blur-md text-black font-bold py-2.5 rounded-xl transition-all duration-300 hover:bg-blue-400 transform opacity-0 group-hover:opacity-100 shadow-lg",children:[b.jsx(hd,{className:"w-4 h-4"}),b.jsx("span",{className:"text-sm",children:"View Details"})]})]})})]})}),b.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-primary/0 via-primary/20 to-primary/0 rounded-2xl opacity-0 group-hover:opacity-100 blur-xl transition-opacity duration-500 -z-10"})]})},yl=({title:s,movies:e,link:t})=>!e||e.length===0?null:b.jsxs("section",{className:"space-y-4 md:space-y-6",children:[b.jsxs("div",{className:"flex items-center justify-between px-4 md:px-0",children:[b.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-text flex items-center gap-3",children:[b.jsx("span",{className:"bg-gradient-to-r from-primary to-purple-500 bg-clip-text text-transparent",children:s}),b.jsx("div",{className:"hidden md:block w-20 h-1 bg-gradient-to-r from-primary/50 to-transparent rounded-full"})]}),t&&b.jsxs(gt,{to:t,className:"group flex items-center gap-2 text-sm md:text-base text-text-muted hover:text-primary transition-colors font-medium",children:[b.jsx("span",{children:"View All"}),b.jsx(z3,{className:"w-4 h-4 md:w-5 md:h-5 transform group-hover:translate-x-1 transition-transform"})]})]}),b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"md:hidden overflow-x-auto scrollbar-hide -mx-4 px-4",children:b.jsx("div",{className:"flex gap-4 pb-4 snap-x snap-mandatory",children:e.slice(0,10).map(i=>b.jsx("div",{className:"flex-none w-[160px] snap-start",children:b.jsx(tr,{movie:i})},i.id))})}),b.jsx("div",{className:"hidden md:grid grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 min-[1800px]:grid-cols-7 gap-6",children:e.slice(0,12).map(i=>b.jsx(tr,{movie:i},i.id))})]}),b.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
        .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
      `})]}),T0="continue_watching",vy=()=>{const[s,e]=ie.useState([]);return ie.useEffect(()=>{const a=localStorage.getItem(T0);if(a)try{e(JSON.parse(a))}catch(u){console.error("Failed to parse continue watching data",u)}},[]),{items:s,saveProgress:a=>{e(u=>{const l=u.filter(h=>h.id!==a.id),f=[{...a,lastWatched:Date.now()},...l].slice(0,20);return localStorage.setItem(T0,JSON.stringify(f)),f})},removeItem:a=>{e(u=>{const l=u.filter(c=>c.id!==a);return localStorage.setItem(T0,JSON.stringify(l)),l})}}},z_=()=>{var N;const[s,e]=ie.useState([]),[t,i]=ie.useState([]),[a,u]=ie.useState([]),[l,c]=ie.useState([]),[f,h]=ie.useState([]),[m,g]=ie.useState(null),[E,T]=ie.useState(!0),[v,S]=ie.useState(null),{items:A,removeItem:I}=vy();ie.useEffect(()=>{(async()=>{try{S(null);const[k,G,U,H,$]=await Promise.all([He.getTrending(),He.getPopular(),He.getTopRated(),He.getUpcoming(),He.getNowPlaying()]);e(k),i(G),u(U),c(H),h($),g(k[0])}catch(k){console.error("Failed to fetch movies",k),S("Failed to load movies. Please check your internet connection or API key.")}finally{T(!1)}})()},[]);const R=A.map(D=>({id:parseInt(D.tmdbId),title:D.title,name:D.title,poster_path:D.poster_path,backdrop_path:D.backdrop_path,vote_average:0,release_date:"",first_air_date:"",overview:"",genre_ids:[],original_language:"en",popularity:0,vote_count:0,video:!1,adult:!1}));return E?b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsxs("div",{className:"flex flex-col items-center gap-4",children:[b.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin"}),b.jsx("p",{className:"text-primary font-medium",children:"Loading amazing content..."})]})}):v?b.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center text-red-500 gap-4 px-4",children:[b.jsx("div",{className:"w-20 h-20 rounded-full bg-red-500/10 flex items-center justify-center",children:b.jsx(hd,{size:40})}),b.jsx("p",{className:"text-xl text-center max-w-md",children:v}),b.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-primary text-black font-bold rounded-lg hover:bg-blue-400 transition-all transform hover:scale-105",children:"Retry"})]}):b.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[m&&b.jsxs("div",{className:"relative h-[60vh] md:h-[75vh] lg:h-[85vh] w-full overflow-hidden",children:[b.jsxs("div",{className:"absolute inset-0",children:[b.jsx("img",{src:He.getImageUrl(m.backdrop_path,"original"),alt:m.title,className:"w-full h-full object-cover scale-105 animate-[zoom_20s_ease-in-out_infinite_alternate]"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-background/80 md:via-background/60 to-transparent"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-background/95 md:from-background/90 via-background/50 md:via-background/40 to-transparent"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/60 via-transparent to-transparent"})]}),b.jsx("div",{className:"absolute bottom-0 left-0 w-full p-4 md:p-8 lg:p-16 z-30",children:b.jsxs("div",{className:"max-w-4xl space-y-3 md:space-y-5 animate-fade-in",children:[b.jsxs("div",{className:"flex items-center gap-2 md:gap-3 flex-wrap",children:[b.jsxs("span",{className:"px-3 md:px-4 py-1 md:py-1.5 bg-primary/20 backdrop-blur-md border border-primary/30 rounded-full text-primary text-xs font-bold uppercase tracking-wider flex items-center gap-1.5 md:gap-2",children:[b.jsx(Nl,{className:"w-3 md:w-3.5"}),b.jsx("span",{className:"hidden sm:inline",children:"Trending Now"}),b.jsx("span",{className:"sm:hidden",children:"Trending"})]}),m.vote_average&&b.jsxs("span",{className:"px-3 md:px-4 py-1 md:py-1.5 bg-yellow-500/20 backdrop-blur-md border border-yellow-500/30 rounded-full text-yellow-400 text-xs font-bold flex items-center gap-1.5",children:[b.jsx(ys,{className:"w-3 md:w-3.5 fill-current"}),m.vote_average.toFixed(1)]})]}),b.jsx("h1",{className:"text-3xl sm:text-4xl md:text-6xl lg:text-7xl font-black leading-tight",style:{color:"var(--color-hero-text)"},children:b.jsx("span",{className:"drop-shadow-2xl",children:m.title||m.name})}),b.jsx("p",{className:"hidden sm:block text-sm md:text-base lg:text-lg line-clamp-2 md:line-clamp-3 max-w-2xl drop-shadow-lg leading-relaxed",style:{color:"var(--color-hero-text-muted)"},children:m.overview}),b.jsxs("div",{className:"flex items-center gap-3 md:gap-6 text-xs md:text-sm",style:{color:"var(--color-text-muted)"},children:[b.jsxs("div",{className:"flex items-center gap-1 text-yellow-500 dark:text-yellow-400",children:[b.jsx(ys,{size:14,className:"md:w-4 md:h-4 fill-current"}),b.jsx("span",{className:"font-bold",children:m.vote_average.toFixed(1)})]}),b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(md,{size:14,className:"md:w-4 md:h-4"}),b.jsx("span",{children:new Date(m.release_date||m.first_air_date||"").getFullYear()})]}),b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(fy,{size:14,className:"md:w-4 md:h-4"}),b.jsx("span",{children:((N=m.original_language)==null?void 0:N.toUpperCase())||"EN"})]})]}),b.jsxs("div",{className:"flex items-center gap-3 md:gap-4 pt-2 md:pt-4 flex-wrap",children:[b.jsxs(gt,{to:`/watch/${m.id}`,className:"group bg-primary text-black font-bold px-6 md:px-8 py-3 md:py-4 rounded-xl md:rounded-2xl flex items-center gap-2 md:gap-3 hover:bg-blue-400 transition-all transform active:scale-95 md:hover:scale-105 shadow-lg hover:shadow-2xl hover:shadow-primary/50 min-h-[44px]",children:[b.jsx(Yi,{className:"w-5 md:w-6 fill-current group-hover:scale-110 transition-transform"}),b.jsx("span",{className:"text-sm md:text-base",children:"Watch Now"})]}),b.jsxs(gt,{to:`/movies/${m.id}`,className:"group backdrop-blur-xl border-2 font-bold px-6 md:px-8 py-3 md:py-4 rounded-xl md:rounded-2xl flex items-center gap-2 md:gap-3 transition-all transform active:scale-95 md:hover:scale-105 min-h-[44px] bg-white/90 dark:bg-white/10 border-gray-300 dark:border-white/20 text-gray-900 dark:text-white hover:bg-white dark:hover:bg-white/20 hover:border-gray-400 dark:hover:border-white/40",children:[b.jsx(hd,{className:"w-5 md:w-6 group-hover:rotate-12 transition-transform"}),b.jsx("span",{className:"text-sm md:text-base",children:"More Info"})]})]})]})}),b.jsx("div",{className:"absolute bottom-6 md:bottom-8 left-1/2 -translate-x-1/2 z-20 animate-bounce hidden md:block",children:b.jsx("div",{className:"w-6 h-10 border-2 border-white/30 dark:border-white/30 rounded-full flex items-start justify-center p-2",children:b.jsx("div",{className:"w-1.5 h-3 bg-white/50 dark:bg-white/50 rounded-full animate-pulse"})})})]}),b.jsxs("div",{className:"w-full max-w-[2000px] mx-auto px-4 md:px-8 mt-12 md:mt-8 lg:mt-4 relative z-10 space-y-10 md:space-y-16",children:[R.length>0&&b.jsxs("section",{className:"space-y-4 md:space-y-6",children:[b.jsx("div",{className:"flex items-center justify-between px-4 md:px-0",children:b.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-text flex items-center gap-3",children:[b.jsx("span",{className:"bg-gradient-to-r from-primary to-purple-500 bg-clip-text text-transparent",children:"Continue Watching"}),b.jsx("div",{className:"hidden md:block w-20 h-1 bg-gradient-to-r from-primary/50 to-transparent rounded-full"})]})}),b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"md:hidden overflow-x-auto scrollbar-hide -mx-4 px-4",children:b.jsx("div",{className:"flex gap-4 pb-4 snap-x snap-mandatory",children:R.slice(0,10).map(D=>b.jsx("div",{className:"flex-none w-[160px] snap-start",children:b.jsx(ex,{movie:D,onRemove:I})},D.id))})}),b.jsx("div",{className:"hidden md:grid grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 min-[1800px]:grid-cols-7 gap-6",children:R.slice(0,12).map(D=>b.jsx(ex,{movie:D,onRemove:I},D.id))})]})]}),b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"absolute -top-8 left-0 w-32 h-32 bg-primary/5 rounded-full blur-3xl"}),b.jsx(yl,{title:"Trending Now",movies:s,link:"/movies"})]}),b.jsx(yl,{title:"Now Playing",movies:f,link:"/movies"}),b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-secondary/5 rounded-full blur-3xl"}),b.jsx(yl,{title:"Popular Movies",movies:t,link:"/movies"})]}),b.jsx(yl,{title:"Top Rated",movies:a,link:"/movies"}),b.jsx(yl,{title:"Upcoming Releases",movies:l,link:"/movies"})]}),b.jsx("div",{className:"fixed top-1/4 left-0 w-96 h-96 bg-primary/3 rounded-full blur-3xl pointer-events-none -z-10"}),b.jsx("div",{className:"fixed bottom-1/4 right-0 w-96 h-96 bg-secondary/3 rounded-full blur-3xl pointer-events-none -z-10"})]})},tx=({type:s})=>{var m,g;const e=ro(),{id:t}=Fd(),[i,a]=ie.useState(null),[u,l]=ie.useState(!0),[c,f]=ie.useState(null),h=s;return ie.useEffect(()=>{(async()=>{if(t){l(!0),f(null);try{const T=await He.getDetails(t,h);a(T)}catch(T){console.error(T),f("Failed to load movie details.")}finally{l(!1)}}})()},[t,h]),u?b.jsx("div",{className:"h-screen flex items-center justify-center text-primary",children:"Loading details..."}):c?b.jsxs("div",{className:"h-screen flex flex-col items-center justify-center text-red-500 gap-4",children:[b.jsx("p",{className:"text-xl",children:c}),b.jsx(gt,{to:"/",className:"px-4 py-2 bg-primary text-black rounded hover:bg-blue-400",children:"Go Home"})]}):i?b.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[b.jsx("button",{onClick:()=>e(-1),className:"fixed top-20 left-4 z-40 p-3 bg-black/50 backdrop-blur-md border border-white/10 rounded-full text-white hover:bg-primary hover:text-black transition-all duration-300 group shadow-lg","aria-label":"Go Back",children:b.jsx(qm,{size:24,className:"group-hover:-translate-x-1 transition-transform"})}),b.jsx("div",{className:"relative h-[50vh] lg:h-[60vh]",children:b.jsxs("div",{className:"absolute inset-0",children:[b.jsx("img",{src:He.getImageUrl(i.backdrop_path,"original"),alt:i.title,className:"w-full h-full object-cover"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-background/60 to-transparent"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/60 via-transparent to-transparent"})]})}),b.jsxs("div",{className:"w-full mx-auto px-4 sm:px-6 md:px-8 lg:px-12 xl:px-16 -mt-32 relative z-10",children:[b.jsxs("div",{className:"flex flex-col md:flex-row gap-6 lg:gap-8 xl:gap-12 mb-8",children:[b.jsx("div",{className:"w-48 md:w-64 lg:w-72 xl:w-80 flex-shrink-0 mx-auto md:mx-0 rounded-xl overflow-hidden shadow-2xl border border-white/10",children:b.jsx("img",{src:He.getImageUrl(i.poster_path),alt:i.title,className:"w-full h-full object-fill"})}),b.jsxs("div",{className:"flex-1 pt-8 md:pt-32 text-center md:text-left min-w-0",children:[b.jsx("h1",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-text mb-4 lg:mb-6",children:i.title||i.name}),b.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 lg:gap-4 text-sm lg:text-base text-text-muted mb-6 lg:mb-8",children:[b.jsxs("div",{className:"flex items-center gap-1 text-yellow-500 dark:text-yellow-400",children:[b.jsx(ys,{size:18,fill:"currentColor"}),b.jsx("span",{className:"font-bold",children:i.vote_average.toFixed(1)})]}),b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(md,{size:18}),b.jsx("span",{children:new Date(i.release_date||i.first_air_date||"").getFullYear()})]}),i.runtime&&b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(pa,{size:18}),b.jsxs("span",{children:[i.runtime," min"]})]}),b.jsx("div",{className:"flex gap-2 flex-wrap",children:i.genres.map(E=>b.jsx("span",{className:"bg-surface border border-white/10 px-3 py-1 rounded text-xs lg:text-sm",children:E.name},E.id))})]}),b.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-3 lg:gap-4 mb-6 lg:mb-8",children:[b.jsxs(gt,{to:`/watch/${i.id}`,className:"bg-primary text-black font-bold px-6 lg:px-10 py-3 lg:py-4 rounded-lg flex items-center gap-2 hover:bg-blue-400 transition-transform hover:scale-105 text-sm lg:text-base",children:[b.jsx(Yi,{size:20,fill:"currentColor"})," Watch Movie"]}),b.jsxs("button",{onClick:()=>{const E=JSON.parse(localStorage.getItem("watchlist")||"[]");if(E.some(T=>T.id===i.id)){const T=E.filter(v=>v.id!==i.id);localStorage.setItem("watchlist",JSON.stringify(T)),alert("Removed from Watchlist")}else E.push({id:i.id,title:i.title||i.name,poster_path:i.poster_path}),localStorage.setItem("watchlist",JSON.stringify(E)),alert("Added to Watchlist")},className:"bg-white/80 dark:bg-white/10 text-gray-900 dark:text-white font-bold px-6 lg:px-10 py-3 lg:py-4 rounded-lg flex items-center gap-2 hover:bg-white hover:border-black/10 dark:hover:bg-white/20 dark:hover:border-white/40 transition-transform hover:scale-105 border border-black/5 dark:border-white/10 text-sm lg:text-base",children:[b.jsx(ys,{size:20})," Watchlist"]})]}),b.jsx("h3",{className:"text-xl lg:text-2xl font-semibold text-text mb-3",children:"Overview"}),b.jsx("p",{className:"text-text-muted leading-relaxed text-sm lg:text-base mb-6 lg:mb-8",children:i.overview})]})]}),((m=i.videos)==null?void 0:m.results)&&i.videos.results.length>0&&b.jsxs("div",{className:"mb-8 w-full",children:[b.jsxs("h3",{className:"text-xl font-semibold text-text mb-4 flex items-center gap-2",children:[b.jsx(Yi,{size:20,className:"text-primary",fill:"currentColor"}),"Trailers & Videos"]}),b.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 lg:gap-6",children:i.videos.results.filter(E=>E.site==="YouTube"&&(E.type==="Trailer"||E.type==="Teaser")).slice(0,6).map(E=>b.jsxs("div",{className:"group relative aspect-video rounded-xl overflow-hidden bg-surface border border-white/10 shadow-lg transition-all duration-300 hover:shadow-2xl hover:shadow-primary/20 hover:border-primary/50",children:[b.jsxs("div",{className:"absolute top-0 left-0 right-0 z-10 bg-gradient-to-b from-black/80 via-black/40 to-transparent p-3 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[b.jsx("p",{className:"text-white text-sm font-semibold truncate",children:E.name||E.type}),b.jsxs("p",{className:"text-white/70 text-xs",children:[E.type,"  YouTube"]})]}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-surface via-surface-highlight to-surface animate-pulse",children:b.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:b.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/20 flex items-center justify-center",children:b.jsx(Yi,{size:32,className:"text-primary ml-1",fill:"currentColor"})})})}),b.jsx("iframe",{src:`https://www.youtube.com/embed/${E.key}?rel=0&modestbranding=1`,title:E.name||E.type,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0,loading:"lazy",className:"absolute inset-0 w-full h-full z-[5] transition-opacity duration-500",onLoad:T=>{const S=T.currentTarget.previousElementSibling;S&&(S.classList.add("opacity-0"),setTimeout(()=>S.remove(),500))}}),b.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-20 bg-gradient-to-t from-black/60 to-transparent pointer-events-none z-[6] opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]},E.key))})]}),b.jsxs("div",{className:"mb-8",children:[b.jsx("h3",{className:"text-xl lg:text-2xl font-semibold text-text mb-4",children:"Top Cast"}),b.jsx("div",{className:"flex gap-3 lg:gap-4 overflow-x-auto pb-4 scrollbar-hide -mx-4 px-4 sm:-mx-6 sm:px-6 md:-mx-8 md:px-8 lg:-mx-12 lg:px-12 xl:-mx-16 xl:px-16",children:(g=i.credits)==null?void 0:g.cast.slice(0,10).map(E=>b.jsxs(gt,{to:`/actor/${E.id}`,className:"flex-none w-28 lg:w-32 group",children:[b.jsx("div",{className:"w-28 h-28 lg:w-32 lg:h-32 rounded-full overflow-hidden mb-2 border-2 border-transparent group-hover:border-primary transition-colors",children:E.profile_path?b.jsx("img",{src:He.getImageUrl(E.profile_path,"w500"),alt:E.name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"}):b.jsx("div",{className:"w-full h-full bg-surface flex items-center justify-center text-text-muted text-xs text-center p-1",children:"No Image"})}),b.jsx("p",{className:"text-xs lg:text-sm font-medium text-text truncate group-hover:text-primary transition-colors",children:E.name}),b.jsx("p",{className:"text-xs text-text-muted truncate",children:E.character})]},E.id))})]}),i.similar&&i.similar.results.length>0&&b.jsxs("div",{className:"mt-8 mb-8",children:[b.jsx("h3",{className:"text-xl lg:text-2xl font-semibold text-text mb-4",children:"You May Also Like"}),b.jsx("div",{className:"flex overflow-x-auto gap-4 lg:gap-5 pb-4 scrollbar-hide -mx-4 px-4 sm:-mx-6 sm:px-6 md:-mx-8 md:px-8 lg:-mx-12 lg:px-12 xl:-mx-16 xl:px-16",children:i.similar.results.slice(0,10).map(E=>b.jsxs(gt,{to:`/${h==="tv"?"webseries":"movies"}/${E.id}`,className:"w-40 lg:w-44 xl:w-48 flex-shrink-0 block group",children:[b.jsx("div",{className:"aspect-[2/3] rounded-xl overflow-hidden mb-3 border border-white/10 shadow-lg group-hover:shadow-2xl group-hover:shadow-primary/20 transition-all duration-300 group-hover:border-primary/50",children:b.jsx("img",{src:He.getImageUrl(E.poster_path),alt:E.title||E.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"})}),b.jsx("p",{className:"text-sm lg:text-base font-medium text-text truncate group-hover:text-primary transition-colors px-1",children:E.title||E.name})]},E.id))})]})]})]}):b.jsx("div",{className:"h-screen flex items-center justify-center",children:"Movie not found"})};class Q_{constructor(){this.providers=new Map,this.enabledProviders=[]}register(e){this.providers.set(e.config.id,e),this.updateEnabledProviders()}unregister(e){this.providers.delete(e),this.updateEnabledProviders()}getProvider(e){return this.providers.get(e)}getAllProviders(){return Array.from(this.providers.values())}getEnabledProviders(){return this.enabledProviders}setProviderEnabled(e,t){const i=this.providers.get(e);i&&(i.config.enabled=t,this.updateEnabledProviders())}updateEnabledProviders(){this.enabledProviders=Array.from(this.providers.values()).filter(e=>e.config.enabled).sort((e,t)=>e.config.priority-t.config.priority)}async getPostsFromAll(e){const t=await Promise.allSettled(this.enabledProviders.map(a=>a.getPosts({...e,providerContext:{baseUrl:a.config.baseUrl}}))),i=[];return t.forEach((a,u)=>{a.status==="fulfilled"?i.push(...a.value):console.error(`Provider ${this.enabledProviders[u].config.name} failed:`,a.reason)}),i}async searchAll(e){const t=await Promise.allSettled(this.enabledProviders.filter(a=>a.getSearchPosts).map(a=>a.getSearchPosts({...e,providerContext:{baseUrl:a.config.baseUrl}}))),i=[];return t.forEach((a,u)=>{a.status==="fulfilled"?i.push(...a.value):console.error("Search failed for provider:",a.reason)}),this.deduplicatePosts(i)}async getMetaWithFallback(e,t){const i=t?[this.providers.get(t),...this.enabledProviders].filter(Boolean):this.enabledProviders;for(const a of i)try{return await a.getMeta({link:e,providerContext:{baseUrl:a.config.baseUrl}})}catch(u){console.error(`Failed to get meta from ${a.config.name}:`,u);continue}return null}async getStreamsFromAll(e,t){const i=await Promise.allSettled(this.enabledProviders.map(u=>u.getStream({link:e,type:t,providerContext:{baseUrl:u.config.baseUrl}}))),a=[];return i.forEach((u,l)=>{u.status==="fulfilled"?a.push(...u.value):console.error(`Stream fetch failed for ${this.enabledProviders[l].config.name}:`,u.reason)}),a}async getEpisodesWithFallback(e,t){const i=t?[this.providers.get(t),...this.enabledProviders].filter(Boolean):this.enabledProviders;for(const a of i)if(a.getEpisodes)try{return await a.getEpisodes({url:e,providerContext:{baseUrl:a.config.baseUrl}})}catch(u){console.error(`Failed to get episodes from ${a.config.name}:`,u);continue}return[]}deduplicatePosts(e){const t=new Map;return e.forEach(i=>{const a=`${i.title.toLowerCase()}-${i.year||""}`;t.has(a)||t.set(a,i)}),Array.from(t.values())}getStats(){return{total:this.providers.size,enabled:this.enabledProviders.length,disabled:this.providers.size-this.enabledProviders.length,providers:Array.from(this.providers.values()).map(e=>({id:e.config.id,name:e.config.name,enabled:e.config.enabled,priority:e.config.priority,type:e.config.type}))}}}const sd=new Q_,Ut=[{title:"Trending Now",filter:"/trending",type:"both"},{title:"Popular Movies",filter:"/popular/movie",type:"movie"},{title:"Popular TV Shows",filter:"/popular/tv",type:"tv"},{title:"Latest Releases",filter:"/latest",type:"both"}],Bt=[{id:"28",title:"Action",filter:"/genre/28"},{id:"35",title:"Comedy",filter:"/genre/35"},{id:"18",title:"Drama",filter:"/genre/18"},{id:"27",title:"Horror",filter:"/genre/27"},{id:"10749",title:"Romance",filter:"/genre/10749"},{id:"878",title:"Sci-Fi",filter:"/genre/878"},{id:"53",title:"Thriller",filter:"/genre/53"}];async function Ft(s){const{filter:e,page:t}=s;try{let i=[];if(e.includes("/trending/movie"))i=await He.getTrending("week");else if(e.includes("/popular/movie"))i=await He.getPopular("movie",t);else if(e.includes("/top-rated/movie"))i=await He.getTopRated("movie",t);else if(e.includes("/trending/tv"))i=await He.getTrendingTV();else if(e.includes("/popular/tv"))i=await He.getPopular("tv",t);else if(e.includes("/genre/")){const a=e.split("/genre/")[1];i=await He.getMoviesByGenre(a,t)}else i=await He.getPopular("movie",t);return i.map(a=>({id:a.id.toString(),title:a.title||a.name||"Unknown",image:He.getImageUrl(a.poster_path),link:`/movie/${a.id}`,type:a.media_type==="tv"||a.name?"tv":"movie",year:a.release_date||a.first_air_date?new Date(a.release_date||a.first_air_date).getFullYear().toString():void 0,rating:a.vote_average,provider:"vidsrc"}))}catch(i){return console.error("Failed to fetch posts:",i),[]}}async function jt(s){const{searchQuery:e,page:t}=s;try{return(await He.search(e,t)).filter(a=>a.media_type!=="person").map(a=>({id:a.id.toString(),title:a.title||a.name||"Unknown",image:He.getImageUrl(a.poster_path),link:`/${a.media_type||"movie"}/${a.id}`,type:a.media_type==="tv"?"tv":"movie",year:a.release_date||a.first_air_date?new Date(a.release_date||a.first_air_date).getFullYear().toString():void 0,rating:a.vote_average,provider:"vidsrc"}))}catch(i){return console.error("Failed to search posts:",i),[]}}async function Ht(s){var l,c,f,h;const{link:e}=s,t=e.match(/\/(movie|tv)\/(\d+)/);if(!t)throw new Error("Invalid link format");const[,i,a]=t,u=i;try{const m=await He.getDetails(a,u);let g;return u==="tv"&&m.number_of_seasons&&(g=Array.from({length:m.number_of_seasons},(E,T)=>({title:`Season ${T+1}`,episodesLink:`/tv/${a}/season/${T+1}`}))),{title:m.title||m.name||"Unknown",synopsis:m.overview||"No description available",image:He.getImageUrl(m.poster_path),backdrop:He.getImageUrl(m.backdrop_path,"original"),rating:m.vote_average,year:m.release_date||m.first_air_date?new Date(m.release_date||m.first_air_date).getFullYear().toString():void 0,genres:(l=m.genres)==null?void 0:l.map(E=>E.name),cast:(c=m.credits)==null?void 0:c.cast.slice(0,10).map(E=>E.name),director:(h=(f=m.credits)==null?void 0:f.crew.find(E=>E.job==="Director"))==null?void 0:h.name,duration:m.runtime?`${m.runtime} min`:void 0,linkList:g,provider:"vidsrc"}}catch(m){throw console.error("Failed to fetch metadata:",m),m}}function $t(s,e){return async t=>{var l;const{link:i,type:a}=t,u=((l=i.match(/\/(?:movie|tv)\/(\d+)/))==null?void 0:l[1])||i;return e.map((c,f)=>({server:`${s}${f>0?` ${f+1}`:""}`,link:c.replace("{type}",a).replace("{id}",u).replace("{tmdb}",u),type:"iframe",quality:"auto"}))}}const Gt={vidsrc:["https://vidsrc.xyz/embed/{type}/{id}","https://vidsrc.pro/embed/{type}/{id}","https://vidsrc.me/embed/{type}?tmdb={id}","https://vidsrc.cc/v2/embed/{type}/{id}","https://vidsrc.net/embed/{type}/{id}","https://vidsrc.to/embed/{type}/{id}","https://vidsrc.rip/embed/{type}/{id}","https://vidsrc.stream/embed/{type}/{id}","https://vidsrc.vip/embed/{type}/{id}","https://vidsrc.pm/embed/{type}/{id}","https://vidsrc.icu/embed/{type}/{id}","https://vidsrc.in/embed/{type}/{id}"],embedapi:["https://player.embed-api.stream/?id={id}"],superembed:["https://multiembed.mov/?video_id={id}&tmdb=1","https://multiembed.mov/directstream.php?video_id={id}&tmdb=1","https://superembed.stream/embed/{id}"],"2embed":["https://www.2embed.cc/embed/{id}","https://www.2embed.skin/embed/{id}","https://2embed.org/embed/{id}"],godriveplayer:["https://godriveplayer.com/embed/{type}/{id}"],embedsu:["https://embed.su/embed/{type}/{id}"],nontongo:["https://www.nontongo.win/embed/{type}/{id}"],autoembed:["https://autoembed.co/movie/tmdb/{id}","https://autoembed.cc/movie/tmdb/{id}"],vidlink:["https://vidlink.pro/{type}/{id}","https://vidlink.org/embed/{type}/{id}"],smashystream:["https://player.smashy.stream/{type}/{id}","https://embed.smashystream.com/{type}/{id}"],moviesapi:["https://moviesapi.club/{type}/{id}"],embedsoap:["https://www.embedsoap.com/embed/{type}?id={id}"],embedflix:["https://embedflix.net/{type}/{id}"],frembed:["https://frembed.com/api/film.php?id={id}"],embedplayer:["https://embedplayer.site/embed/{type}/{id}"],vidbinge:["https://vidbinge.com/embed/{type}/{id}"],vidfast:["https://vidfast.to/embed/{type}/{id}"],moviee:["https://moviee.tv/embed/{type}/{id}"],warezcdn:["https://embed.warezcdn.com/{type}/{id}"],embedv:["https://www.embedv.net/embed/{type}/{id}"]};var et;(function(s){s.Root="root",s.Text="text",s.Directive="directive",s.Comment="comment",s.Script="script",s.Style="style",s.Tag="tag",s.CDATA="cdata",s.Doctype="doctype"})(et||(et={}));function X_(s){return s.type===et.Tag||s.type===et.Script||s.type===et.Style}const Qm=et.Root,Sy=et.Text,W_=et.Directive,Ay=et.Comment,Z_=et.Script,J_=et.Style,dm=et.Tag,e6=et.CDATA,t6=et.Doctype;class _y{constructor(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}get parentNode(){return this.parent}set parentNode(e){this.parent=e}get previousSibling(){return this.prev}set previousSibling(e){this.prev=e}get nextSibling(){return this.next}set nextSibling(e){this.next=e}cloneNode(e=!1){return ql(this,e)}}class Xm extends _y{constructor(e){super(),this.data=e}get nodeValue(){return this.data}set nodeValue(e){this.data=e}}class Vl extends Xm{constructor(){super(...arguments),this.type=et.Text}get nodeType(){return 3}}class Wm extends Xm{constructor(){super(...arguments),this.type=et.Comment}get nodeType(){return 8}}class Zm extends Xm{constructor(e,t){super(t),this.name=e,this.type=et.Directive}get nodeType(){return 1}}class Jm extends _y{constructor(e){super(),this.children=e}get firstChild(){var e;return(e=this.children[0])!==null&&e!==void 0?e:null}get lastChild(){return this.children.length>0?this.children[this.children.length-1]:null}get childNodes(){return this.children}set childNodes(e){this.children=e}}class Ly extends Jm{constructor(){super(...arguments),this.type=et.CDATA}get nodeType(){return 4}}class sr extends Jm{constructor(){super(...arguments),this.type=et.Root}get nodeType(){return 9}}class eg extends Jm{constructor(e,t,i=[],a=e==="script"?et.Script:e==="style"?et.Style:et.Tag){super(i),this.name=e,this.attribs=t,this.type=a}get nodeType(){return 1}get tagName(){return this.name}set tagName(e){this.name=e}get attributes(){return Object.keys(this.attribs).map(e=>{var t,i;return{name:e,value:this.attribs[e],namespace:(t=this["x-attribsNamespace"])===null||t===void 0?void 0:t[e],prefix:(i=this["x-attribsPrefix"])===null||i===void 0?void 0:i[e]}})}}function De(s){return X_(s)}function $d(s){return s.type===et.CDATA}function Ki(s){return s.type===et.Text}function Gd(s){return s.type===et.Comment}function fm(s){return s.type===et.Directive}function Ta(s){return s.type===et.Root}function Dt(s){return Object.prototype.hasOwnProperty.call(s,"children")}function ql(s,e=!1){let t;if(Ki(s))t=new Vl(s.data);else if(Gd(s))t=new Wm(s.data);else if(De(s)){const i=e?y0(s.children):[],a=new eg(s.name,{...s.attribs},i);i.forEach(u=>u.parent=a),s.namespace!=null&&(a.namespace=s.namespace),s["x-attribsNamespace"]&&(a["x-attribsNamespace"]={...s["x-attribsNamespace"]}),s["x-attribsPrefix"]&&(a["x-attribsPrefix"]={...s["x-attribsPrefix"]}),t=a}else if($d(s)){const i=e?y0(s.children):[],a=new Ly(i);i.forEach(u=>u.parent=a),t=a}else if(Ta(s)){const i=e?y0(s.children):[],a=new sr(i);i.forEach(u=>u.parent=a),s["x-mode"]&&(a["x-mode"]=s["x-mode"]),t=a}else if(fm(s)){const i=new Zm(s.name,s.data);s["x-name"]!=null&&(i["x-name"]=s["x-name"],i["x-publicId"]=s["x-publicId"],i["x-systemId"]=s["x-systemId"]),t=i}else throw new Error(`Not implemented yet: ${s.type}`);return t.startIndex=s.startIndex,t.endIndex=s.endIndex,s.sourceCodeLocation!=null&&(t.sourceCodeLocation=s.sourceCodeLocation),t}function y0(s){const e=s.map(t=>ql(t,!0));for(let t=1;t<e.length;t++)e[t].prev=e[t-1],e[t-1].next=e[t];return e}const sx={withStartIndices:!1,withEndIndices:!1,xmlMode:!1};class s6{constructor(e,t,i){this.dom=[],this.root=new sr(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof t=="function"&&(i=t,t=sx),typeof e=="object"&&(t=e,e=void 0),this.callback=e??null,this.options=t??sx,this.elementCB=i??null}onparserinit(e){this.parser=e}onreset(){this.dom=[],this.root=new sr(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null}onend(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))}onerror(e){this.handleCallback(e)}onclosetag(){this.lastNode=null;const e=this.tagStack.pop();this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(e)}onopentag(e,t){const i=this.options.xmlMode?et.Tag:void 0,a=new eg(e,t,void 0,i);this.addNode(a),this.tagStack.push(a)}ontext(e){const{lastNode:t}=this;if(t&&t.type===et.Text)t.data+=e,this.options.withEndIndices&&(t.endIndex=this.parser.endIndex);else{const i=new Vl(e);this.addNode(i),this.lastNode=i}}oncomment(e){if(this.lastNode&&this.lastNode.type===et.Comment){this.lastNode.data+=e;return}const t=new Wm(e);this.addNode(t),this.lastNode=t}oncommentend(){this.lastNode=null}oncdatastart(){const e=new Vl(""),t=new Ly([e]);this.addNode(t),e.parent=t,this.lastNode=e}oncdataend(){this.lastNode=null}onprocessinginstruction(e,t){const i=new Zm(e,t);this.addNode(i)}handleCallback(e){if(typeof this.callback=="function")this.callback(e,this.dom);else if(e)throw e}addNode(e){const t=this.tagStack[this.tagStack.length-1],i=t.children[t.children.length-1];this.options.withStartIndices&&(e.startIndex=this.parser.startIndex),this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),t.children.push(e),i&&(e.prev=i,i.next=e),e.parent=t,this.lastNode=null}}const ix=/["&'<>$\x80-\uFFFF]/g,i6=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]),n6=String.prototype.codePointAt!=null?(s,e)=>s.codePointAt(e):(s,e)=>(s.charCodeAt(e)&64512)===55296?(s.charCodeAt(e)-55296)*1024+s.charCodeAt(e+1)-56320+65536:s.charCodeAt(e);function Iy(s){let e="",t=0,i;for(;(i=ix.exec(s))!==null;){const a=i.index,u=s.charCodeAt(a),l=i6.get(u);l!==void 0?(e+=s.substring(t,a)+l,t=a+1):(e+=`${s.substring(t,a)}&#x${n6(s,a).toString(16)};`,t=ix.lastIndex+=+((u&64512)===55296))}return e+s.substr(t)}function Ry(s,e){return function(i){let a,u=0,l="";for(;a=s.exec(i);)u!==a.index&&(l+=i.substring(u,a.index)),l+=e.get(a[0].charCodeAt(0)),u=a.index+1;return l+i.substring(u)}}const a6=Ry(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),r6=Ry(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]])),u6=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(s=>[s.toLowerCase(),s])),l6=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(s=>[s.toLowerCase(),s])),o6=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function c6(s){return s.replace(/"/g,"&quot;")}function d6(s,e){var t;if(!s)return;const i=((t=e.encodeEntities)!==null&&t!==void 0?t:e.decodeEntities)===!1?c6:e.xmlMode||e.encodeEntities!=="utf8"?Iy:a6;return Object.keys(s).map(a=>{var u,l;const c=(u=s[a])!==null&&u!==void 0?u:"";return e.xmlMode==="foreign"&&(a=(l=l6.get(a))!==null&&l!==void 0?l:a),!e.emptyAttrs&&!e.xmlMode&&c===""?a:`${a}="${i(c)}"`}).join(" ")}const nx=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function Vd(s,e={}){const t="length"in s?s:[s];let i="";for(let a=0;a<t.length;a++)i+=f6(t[a],e);return i}function f6(s,e){switch(s.type){case Qm:return Vd(s.children,e);case t6:case W_:return p6(s);case Ay:return x6(s);case e6:return E6(s);case Z_:case J_:case dm:return g6(s,e);case Sy:return b6(s,e)}}const h6=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),m6=new Set(["svg","math"]);function g6(s,e){var t;e.xmlMode==="foreign"&&(s.name=(t=u6.get(s.name))!==null&&t!==void 0?t:s.name,s.parent&&h6.has(s.parent.name)&&(e={...e,xmlMode:!1})),!e.xmlMode&&m6.has(s.name)&&(e={...e,xmlMode:"foreign"});let i=`<${s.name}`;const a=d6(s.attribs,e);return a&&(i+=` ${a}`),s.children.length===0&&(e.xmlMode?e.selfClosingTags!==!1:e.selfClosingTags&&nx.has(s.name))?(e.xmlMode||(i+=" "),i+="/>"):(i+=">",s.children.length>0&&(i+=Vd(s.children,e)),(e.xmlMode||!nx.has(s.name))&&(i+=`</${s.name}>`)),i}function p6(s){return`<${s.data}>`}function b6(s,e){var t;let i=s.data||"";return((t=e.encodeEntities)!==null&&t!==void 0?t:e.decodeEntities)!==!1&&!(!e.xmlMode&&s.parent&&o6.has(s.parent.name))&&(i=e.xmlMode||e.encodeEntities!=="utf8"?Iy(i):r6(i)),i}function E6(s){return`<![CDATA[${s.children[0].data}]]>`}function x6(s){return`<!--${s.data}-->`}function Ny(s,e){return Vd(s,e)}function T6(s,e){return Dt(s)?s.children.map(t=>Ny(t,e)).join(""):""}function id(s){return Array.isArray(s)?s.map(id).join(""):De(s)?s.name==="br"?`
`:id(s.children):$d(s)?id(s.children):Ki(s)?s.data:""}function Eu(s){return Array.isArray(s)?s.map(Eu).join(""):Dt(s)&&!Gd(s)?Eu(s.children):Ki(s)?s.data:""}function bd(s){return Array.isArray(s)?s.map(bd).join(""):Dt(s)&&(s.type===et.Tag||$d(s))?bd(s.children):Ki(s)?s.data:""}function qd(s){return Dt(s)?s.children:[]}function Cy(s){return s.parent||null}function Dy(s){const e=Cy(s);if(e!=null)return qd(e);const t=[s];let{prev:i,next:a}=s;for(;i!=null;)t.unshift(i),{prev:i}=i;for(;a!=null;)t.push(a),{next:a}=a;return t}function y6(s,e){var t;return(t=s.attribs)===null||t===void 0?void 0:t[e]}function v6(s,e){return s.attribs!=null&&Object.prototype.hasOwnProperty.call(s.attribs,e)&&s.attribs[e]!=null}function S6(s){return s.name}function tg(s){let{next:e}=s;for(;e!==null&&!De(e);)({next:e}=e);return e}function sg(s){let{prev:e}=s;for(;e!==null&&!De(e);)({prev:e}=e);return e}function rr(s){if(s.prev&&(s.prev.next=s.next),s.next&&(s.next.prev=s.prev),s.parent){const e=s.parent.children,t=e.lastIndexOf(s);t>=0&&e.splice(t,1)}s.next=null,s.prev=null,s.parent=null}function A6(s,e){const t=e.prev=s.prev;t&&(t.next=e);const i=e.next=s.next;i&&(i.prev=e);const a=e.parent=s.parent;if(a){const u=a.children;u[u.lastIndexOf(s)]=e,s.parent=null}}function _6(s,e){if(rr(e),e.next=null,e.parent=s,s.children.push(e)>1){const t=s.children[s.children.length-2];t.next=e,e.prev=t}else e.prev=null}function L6(s,e){rr(e);const{parent:t}=s,i=s.next;if(e.next=i,e.prev=s,s.next=e,e.parent=t,i){if(i.prev=e,t){const a=t.children;a.splice(a.lastIndexOf(i),0,e)}}else t&&t.children.push(e)}function I6(s,e){if(rr(e),e.parent=s,e.prev=null,s.children.unshift(e)!==1){const t=s.children[1];t.prev=e,e.next=t}else e.next=null}function R6(s,e){rr(e);const{parent:t}=s;if(t){const i=t.children;i.splice(i.indexOf(s),0,e)}s.prev&&(s.prev.next=e),e.parent=t,e.prev=s.prev,e.next=s,s.prev=e}function uo(s,e,t=!0,i=1/0){return ig(s,Array.isArray(e)?e:[e],t,i)}function ig(s,e,t,i){const a=[],u=[Array.isArray(e)?e:[e]],l=[0];for(;;){if(l[0]>=u[0].length){if(l.length===1)return a;u.shift(),l.shift();continue}const c=u[0][l[0]++];if(s(c)&&(a.push(c),--i<=0))return a;t&&Dt(c)&&c.children.length>0&&(l.unshift(0),u.unshift(c.children))}}function N6(s,e){return e.find(s)}function ng(s,e,t=!0){const i=Array.isArray(e)?e:[e];for(let a=0;a<i.length;a++){const u=i[a];if(De(u)&&s(u))return u;if(t&&Dt(u)&&u.children.length>0){const l=ng(s,u.children,!0);if(l)return l}}return null}function Oy(s,e){return(Array.isArray(e)?e:[e]).some(t=>De(t)&&s(t)||Dt(t)&&Oy(s,t.children))}function C6(s,e){const t=[],i=[Array.isArray(e)?e:[e]],a=[0];for(;;){if(a[0]>=i[0].length){if(i.length===1)return t;i.shift(),a.shift();continue}const u=i[0][a[0]++];De(u)&&s(u)&&t.push(u),Dt(u)&&u.children.length>0&&(a.unshift(0),i.unshift(u.children))}}const Ed={tag_name(s){return typeof s=="function"?e=>De(e)&&s(e.name):s==="*"?De:e=>De(e)&&e.name===s},tag_type(s){return typeof s=="function"?e=>s(e.type):e=>e.type===s},tag_contains(s){return typeof s=="function"?e=>Ki(e)&&s(e.data):e=>Ki(e)&&e.data===s}};function ag(s,e){return typeof e=="function"?t=>De(t)&&e(t.attribs[s]):t=>De(t)&&t.attribs[s]===e}function D6(s,e){return t=>s(t)||e(t)}function wy(s){const e=Object.keys(s).map(t=>{const i=s[t];return Object.prototype.hasOwnProperty.call(Ed,t)?Ed[t](i):ag(t,i)});return e.length===0?null:e.reduce(D6)}function O6(s,e){const t=wy(s);return t?t(e):!0}function w6(s,e,t,i=1/0){const a=wy(s);return a?uo(a,e,t,i):[]}function k6(s,e,t=!0){return Array.isArray(e)||(e=[e]),ng(ag("id",s),e,t)}function vu(s,e,t=!0,i=1/0){return uo(Ed.tag_name(s),e,t,i)}function M6(s,e,t=!0,i=1/0){return uo(ag("class",s),e,t,i)}function P6(s,e,t=!0,i=1/0){return uo(Ed.tag_type(s),e,t,i)}function U6(s){let e=s.length;for(;--e>=0;){const t=s[e];if(e>0&&s.lastIndexOf(t,e-1)>=0){s.splice(e,1);continue}for(let i=t.parent;i;i=i.parent)if(s.includes(i)){s.splice(e,1);break}}return s}var hi;(function(s){s[s.DISCONNECTED=1]="DISCONNECTED",s[s.PRECEDING=2]="PRECEDING",s[s.FOLLOWING=4]="FOLLOWING",s[s.CONTAINS=8]="CONTAINS",s[s.CONTAINED_BY=16]="CONTAINED_BY"})(hi||(hi={}));function ky(s,e){const t=[],i=[];if(s===e)return 0;let a=Dt(s)?s:s.parent;for(;a;)t.unshift(a),a=a.parent;for(a=Dt(e)?e:e.parent;a;)i.unshift(a),a=a.parent;const u=Math.min(t.length,i.length);let l=0;for(;l<u&&t[l]===i[l];)l++;if(l===0)return hi.DISCONNECTED;const c=t[l-1],f=c.children,h=t[l],m=i[l];return f.indexOf(h)>f.indexOf(m)?c===e?hi.FOLLOWING|hi.CONTAINED_BY:hi.FOLLOWING:c===s?hi.PRECEDING|hi.CONTAINS:hi.PRECEDING}function Su(s){return s=s.filter((e,t,i)=>!i.includes(e,t+1)),s.sort((e,t)=>{const i=ky(e,t);return i&hi.PRECEDING?-1:i&hi.FOLLOWING?1:0}),s}function B6(s){const e=xd(G6,s);return e?e.name==="feed"?F6(e):j6(e):null}function F6(s){var e;const t=s.children,i={type:"atom",items:vu("entry",t).map(l=>{var c;const{children:f}=l,h={media:My(f)};Ps(h,"id","id",f),Ps(h,"title","title",f);const m=(c=xd("link",f))===null||c===void 0?void 0:c.attribs.href;m&&(h.link=m);const g=ha("summary",f)||ha("content",f);g&&(h.description=g);const E=ha("updated",f);return E&&(h.pubDate=new Date(E)),h})};Ps(i,"id","id",t),Ps(i,"title","title",t);const a=(e=xd("link",t))===null||e===void 0?void 0:e.attribs.href;a&&(i.link=a),Ps(i,"description","subtitle",t);const u=ha("updated",t);return u&&(i.updated=new Date(u)),Ps(i,"author","email",t,!0),i}function j6(s){var e,t;const i=(t=(e=xd("channel",s.children))===null||e===void 0?void 0:e.children)!==null&&t!==void 0?t:[],a={type:s.name.substr(0,3),id:"",items:vu("item",s.children).map(l=>{const{children:c}=l,f={media:My(c)};Ps(f,"id","guid",c),Ps(f,"title","title",c),Ps(f,"link","link",c),Ps(f,"description","description",c);const h=ha("pubDate",c)||ha("dc:date",c);return h&&(f.pubDate=new Date(h)),f})};Ps(a,"title","title",i),Ps(a,"link","link",i),Ps(a,"description","description",i);const u=ha("lastBuildDate",i);return u&&(a.updated=new Date(u)),Ps(a,"author","managingEditor",i,!0),a}const H6=["url","type","lang"],$6=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function My(s){return vu("media:content",s).map(e=>{const{attribs:t}=e,i={medium:t.medium,isDefault:!!t.isDefault};for(const a of H6)t[a]&&(i[a]=t[a]);for(const a of $6)t[a]&&(i[a]=parseInt(t[a],10));return t.expression&&(i.expression=t.expression),i})}function xd(s,e){return vu(s,e,!0,1)[0]}function ha(s,e,t=!1){return Eu(vu(s,e,t,1)).trim()}function Ps(s,e,t,i,a=!1){const u=ha(t,i,a);u&&(s[e]=u)}function G6(s){return s==="rss"||s==="feed"||s==="rdf:RDF"}const Yd=Object.freeze(Object.defineProperty({__proto__:null,get DocumentPosition(){return hi},append:L6,appendChild:_6,compareDocumentPosition:ky,existsOne:Oy,filter:uo,find:ig,findAll:C6,findOne:ng,findOneChild:N6,getAttributeValue:y6,getChildren:qd,getElementById:k6,getElements:w6,getElementsByClassName:M6,getElementsByTagName:vu,getElementsByTagType:P6,getFeed:B6,getInnerHTML:T6,getName:S6,getOuterHTML:Ny,getParent:Cy,getSiblings:Dy,getText:id,hasAttrib:v6,hasChildren:Dt,innerText:bd,isCDATA:$d,isComment:Gd,isDocument:Ta,isTag:De,isText:Ki,nextElementSibling:tg,prepend:R6,prependChild:I6,prevElementSibling:sg,removeElement:rr,removeSubsets:U6,replaceElement:A6,testElement:O6,textContent:Eu,uniqueSort:Su},Symbol.toStringTag,{value:"Module"})),V6={_useHtmlParser2:!1};function hm(s,e){if(!s)return e??V6;const t={_useHtmlParser2:!!s.xmlMode,...e,...s};return s.xml?(t._useHtmlParser2=!0,t.xmlMode=!0,s.xml!==!0&&Object.assign(t,s.xml)):s.xmlMode&&(t._useHtmlParser2=!0),t}function Py(s,e,t){return s?s(e??s._root.children,null,void 0,t).toString():""}function q6(s,e){return typeof s=="object"&&s!=null&&!("length"in s)&&!("type"in s)}function Y6(s,e){const t=q6(s)?(e=s,void 0):s,i={...this===null||this===void 0?void 0:this._options,...hm(e)};return Py(this,t,i)}function K6(s){const e={...this._options,xmlMode:!0};return Py(this,s,e)}function Yl(s){const e=s??(this?this.root():[]);let t="";for(let i=0;i<e.length;i++)t+=Eu(e[i]);return t}function z6(s,e,t=typeof e=="boolean"?e:!1){if(!s||typeof s!="string")return null;typeof e=="boolean"&&(t=e);const i=this.load(s,this._options,!1);return t||i("script").remove(),[...i.root()[0].children]}function Q6(){return this(this._root)}function Uy(s,e){if(e===s)return!1;let t=e;for(;t&&t!==t.parent;)if(t=t.parent,t===s)return!0;return!1}function X6(s){return this.root().extract(s)}function W6(s,e){if(!ax(s)||!ax(e))return;let t=s.length;const i=+e.length;for(let a=0;a<i;a++)s[t++]=e[a];return s.length=t,s}function ax(s){if(Array.isArray(s))return!0;if(typeof s!="object"||s===null||!("length"in s)||typeof s.length!="number"||s.length<0)return!1;for(let e=0;e<s.length;e++)if(!(e in s))return!1;return!0}const Z6=Object.freeze(Object.defineProperty({__proto__:null,contains:Uy,extract:X6,html:Y6,merge:W6,parseHTML:z6,root:Q6,text:Yl,xml:K6},Symbol.toStringTag,{value:"Module"}));function Ln(s){return s.cheerio!=null}function J6(s){return s.replace(/[._-](\w|$)/g,(e,t)=>t.toUpperCase())}function eL(s){return s.replace(/[A-Z]/g,"-$&").toLowerCase()}function Tt(s,e){const t=s.length;for(let i=0;i<t;i++)e(s[i],i);return s}var qa;(function(s){s[s.LowerA=97]="LowerA",s[s.LowerZ=122]="LowerZ",s[s.UpperA=65]="UpperA",s[s.UpperZ=90]="UpperZ",s[s.Exclamation=33]="Exclamation"})(qa||(qa={}));function mm(s){const e=s.indexOf("<");if(e===-1||e>s.length-3)return!1;const t=s.charCodeAt(e+1);return(t>=qa.LowerA&&t<=qa.LowerZ||t>=qa.UpperA&&t<=qa.UpperZ||t===qa.Exclamation)&&s.includes(">",e+2)}const tL=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(s=>s.charCodeAt(0))),sL=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(s=>s.charCodeAt(0)));var v0;const iL=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),rx=(v0=String.fromCodePoint)!==null&&v0!==void 0?v0:function(s){let e="";return s>65535&&(s-=65536,e+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),e+=String.fromCharCode(s),e};function nL(s){var e;return s>=55296&&s<=57343||s>1114111?65533:(e=iL.get(s))!==null&&e!==void 0?e:s}var is;(function(s){s[s.NUM=35]="NUM",s[s.SEMI=59]="SEMI",s[s.EQUALS=61]="EQUALS",s[s.ZERO=48]="ZERO",s[s.NINE=57]="NINE",s[s.LOWER_A=97]="LOWER_A",s[s.LOWER_F=102]="LOWER_F",s[s.LOWER_X=120]="LOWER_X",s[s.LOWER_Z=122]="LOWER_Z",s[s.UPPER_A=65]="UPPER_A",s[s.UPPER_F=70]="UPPER_F",s[s.UPPER_Z=90]="UPPER_Z"})(is||(is={}));const aL=32;var ma;(function(s){s[s.VALUE_LENGTH=49152]="VALUE_LENGTH",s[s.BRANCH_LENGTH=16256]="BRANCH_LENGTH",s[s.JUMP_TABLE=127]="JUMP_TABLE"})(ma||(ma={}));function gm(s){return s>=is.ZERO&&s<=is.NINE}function rL(s){return s>=is.UPPER_A&&s<=is.UPPER_F||s>=is.LOWER_A&&s<=is.LOWER_F}function uL(s){return s>=is.UPPER_A&&s<=is.UPPER_Z||s>=is.LOWER_A&&s<=is.LOWER_Z||gm(s)}function lL(s){return s===is.EQUALS||uL(s)}var es;(function(s){s[s.EntityStart=0]="EntityStart",s[s.NumericStart=1]="NumericStart",s[s.NumericDecimal=2]="NumericDecimal",s[s.NumericHex=3]="NumericHex",s[s.NamedEntity=4]="NamedEntity"})(es||(es={}));var $i;(function(s){s[s.Legacy=0]="Legacy",s[s.Strict=1]="Strict",s[s.Attribute=2]="Attribute"})($i||($i={}));let oL=class{constructor(e,t,i){this.decodeTree=e,this.emitCodePoint=t,this.errors=i,this.state=es.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=$i.Strict}startEntity(e){this.decodeMode=e,this.state=es.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,t){switch(this.state){case es.EntityStart:return e.charCodeAt(t)===is.NUM?(this.state=es.NumericStart,this.consumed+=1,this.stateNumericStart(e,t+1)):(this.state=es.NamedEntity,this.stateNamedEntity(e,t));case es.NumericStart:return this.stateNumericStart(e,t);case es.NumericDecimal:return this.stateNumericDecimal(e,t);case es.NumericHex:return this.stateNumericHex(e,t);case es.NamedEntity:return this.stateNamedEntity(e,t)}}stateNumericStart(e,t){return t>=e.length?-1:(e.charCodeAt(t)|aL)===is.LOWER_X?(this.state=es.NumericHex,this.consumed+=1,this.stateNumericHex(e,t+1)):(this.state=es.NumericDecimal,this.stateNumericDecimal(e,t))}addToNumericResult(e,t,i,a){if(t!==i){const u=i-t;this.result=this.result*Math.pow(a,u)+Number.parseInt(e.substr(t,u),a),this.consumed+=u}}stateNumericHex(e,t){const i=t;for(;t<e.length;){const a=e.charCodeAt(t);if(gm(a)||rL(a))t+=1;else return this.addToNumericResult(e,i,t,16),this.emitNumericEntity(a,3)}return this.addToNumericResult(e,i,t,16),-1}stateNumericDecimal(e,t){const i=t;for(;t<e.length;){const a=e.charCodeAt(t);if(gm(a))t+=1;else return this.addToNumericResult(e,i,t,10),this.emitNumericEntity(a,2)}return this.addToNumericResult(e,i,t,10),-1}emitNumericEntity(e,t){var i;if(this.consumed<=t)return(i=this.errors)===null||i===void 0||i.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===is.SEMI)this.consumed+=1;else if(this.decodeMode===$i.Strict)return 0;return this.emitCodePoint(nL(this.result),this.consumed),this.errors&&(e!==is.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,t){const{decodeTree:i}=this;let a=i[this.treeIndex],u=(a&ma.VALUE_LENGTH)>>14;for(;t<e.length;t++,this.excess++){const l=e.charCodeAt(t);if(this.treeIndex=cL(i,a,this.treeIndex+Math.max(1,u),l),this.treeIndex<0)return this.result===0||this.decodeMode===$i.Attribute&&(u===0||lL(l))?0:this.emitNotTerminatedNamedEntity();if(a=i[this.treeIndex],u=(a&ma.VALUE_LENGTH)>>14,u!==0){if(l===is.SEMI)return this.emitNamedEntityData(this.treeIndex,u,this.consumed+this.excess);this.decodeMode!==$i.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:t,decodeTree:i}=this,a=(i[t]&ma.VALUE_LENGTH)>>14;return this.emitNamedEntityData(t,a,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,t,i){const{decodeTree:a}=this;return this.emitCodePoint(t===1?a[e]&~ma.VALUE_LENGTH:a[e+1],i),t===3&&this.emitCodePoint(a[e+2],i),i}end(){var e;switch(this.state){case es.NamedEntity:return this.result!==0&&(this.decodeMode!==$i.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case es.NumericDecimal:return this.emitNumericEntity(0,2);case es.NumericHex:return this.emitNumericEntity(0,3);case es.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case es.EntityStart:return 0}}};function cL(s,e,t,i){const a=(e&ma.BRANCH_LENGTH)>>7,u=e&ma.JUMP_TABLE;if(a===0)return u!==0&&i===u?t:-1;if(u){const f=i-u;return f<0||f>=a?-1:s[t+f]-1}let l=t,c=l+a-1;for(;l<=c;){const f=l+c>>>1,h=s[f];if(h<i)l=f+1;else if(h>i)c=f-1;else return s[f+a]}return-1}var Re;(function(s){s[s.Tab=9]="Tab",s[s.NewLine=10]="NewLine",s[s.FormFeed=12]="FormFeed",s[s.CarriageReturn=13]="CarriageReturn",s[s.Space=32]="Space",s[s.ExclamationMark=33]="ExclamationMark",s[s.Number=35]="Number",s[s.Amp=38]="Amp",s[s.SingleQuote=39]="SingleQuote",s[s.DoubleQuote=34]="DoubleQuote",s[s.Dash=45]="Dash",s[s.Slash=47]="Slash",s[s.Zero=48]="Zero",s[s.Nine=57]="Nine",s[s.Semi=59]="Semi",s[s.Lt=60]="Lt",s[s.Eq=61]="Eq",s[s.Gt=62]="Gt",s[s.Questionmark=63]="Questionmark",s[s.UpperA=65]="UpperA",s[s.LowerA=97]="LowerA",s[s.UpperF=70]="UpperF",s[s.LowerF=102]="LowerF",s[s.UpperZ=90]="UpperZ",s[s.LowerZ=122]="LowerZ",s[s.LowerX=120]="LowerX",s[s.OpeningSquareBracket=91]="OpeningSquareBracket"})(Re||(Re={}));var he;(function(s){s[s.Text=1]="Text",s[s.BeforeTagName=2]="BeforeTagName",s[s.InTagName=3]="InTagName",s[s.InSelfClosingTag=4]="InSelfClosingTag",s[s.BeforeClosingTagName=5]="BeforeClosingTagName",s[s.InClosingTagName=6]="InClosingTagName",s[s.AfterClosingTagName=7]="AfterClosingTagName",s[s.BeforeAttributeName=8]="BeforeAttributeName",s[s.InAttributeName=9]="InAttributeName",s[s.AfterAttributeName=10]="AfterAttributeName",s[s.BeforeAttributeValue=11]="BeforeAttributeValue",s[s.InAttributeValueDq=12]="InAttributeValueDq",s[s.InAttributeValueSq=13]="InAttributeValueSq",s[s.InAttributeValueNq=14]="InAttributeValueNq",s[s.BeforeDeclaration=15]="BeforeDeclaration",s[s.InDeclaration=16]="InDeclaration",s[s.InProcessingInstruction=17]="InProcessingInstruction",s[s.BeforeComment=18]="BeforeComment",s[s.CDATASequence=19]="CDATASequence",s[s.InSpecialComment=20]="InSpecialComment",s[s.InCommentLike=21]="InCommentLike",s[s.BeforeSpecialS=22]="BeforeSpecialS",s[s.BeforeSpecialT=23]="BeforeSpecialT",s[s.SpecialStartSequence=24]="SpecialStartSequence",s[s.InSpecialTag=25]="InSpecialTag",s[s.InEntity=26]="InEntity"})(he||(he={}));function xn(s){return s===Re.Space||s===Re.NewLine||s===Re.Tab||s===Re.FormFeed||s===Re.CarriageReturn}function Pc(s){return s===Re.Slash||s===Re.Gt||xn(s)}function dL(s){return s>=Re.LowerA&&s<=Re.LowerZ||s>=Re.UpperA&&s<=Re.UpperZ}var Gi;(function(s){s[s.NoValue=0]="NoValue",s[s.Unquoted=1]="Unquoted",s[s.Single=2]="Single",s[s.Double=3]="Double"})(Gi||(Gi={}));const Pt={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97]),XmpEnd:new Uint8Array([60,47,120,109,112])};let fL=class{constructor({xmlMode:e=!1,decodeEntities:t=!0},i){this.cbs=i,this.state=he.Text,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=he.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.xmlMode=e,this.decodeEntities=t,this.entityDecoder=new oL(e?sL:tL,(a,u)=>this.emitCodePoint(a,u))}reset(){this.state=he.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=he.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(e){this.offset+=this.buffer.length,this.buffer=e,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}stateText(e){e===Re.Lt||!this.decodeEntities&&this.fastForwardTo(Re.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=he.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&e===Re.Amp&&this.startEntity()}stateSpecialStartSequence(e){const t=this.sequenceIndex===this.currentSequence.length;if(!(t?Pc(e):(e|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!t){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=he.InTagName,this.stateInTagName(e)}stateInSpecialTag(e){if(this.sequenceIndex===this.currentSequence.length){if(e===Re.Gt||xn(e)){const t=this.index-this.currentSequence.length;if(this.sectionStart<t){const i=this.index;this.index=t,this.cbs.ontext(this.sectionStart,t),this.index=i}this.isSpecial=!1,this.sectionStart=t+2,this.stateInClosingTagName(e);return}this.sequenceIndex=0}(e|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Pt.TitleEnd?this.decodeEntities&&e===Re.Amp&&this.startEntity():this.fastForwardTo(Re.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(e===Re.Lt)}stateCDATASequence(e){e===Pt.Cdata[this.sequenceIndex]?++this.sequenceIndex===Pt.Cdata.length&&(this.state=he.InCommentLike,this.currentSequence=Pt.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=he.InDeclaration,this.stateInDeclaration(e))}fastForwardTo(e){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===e)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(e){e===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Pt.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=he.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):e!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(e){return this.xmlMode?!Pc(e):dL(e)}startSpecial(e,t){this.isSpecial=!0,this.currentSequence=e,this.sequenceIndex=t,this.state=he.SpecialStartSequence}stateBeforeTagName(e){if(e===Re.ExclamationMark)this.state=he.BeforeDeclaration,this.sectionStart=this.index+1;else if(e===Re.Questionmark)this.state=he.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(e)){const t=e|32;this.sectionStart=this.index,this.xmlMode?this.state=he.InTagName:t===Pt.ScriptEnd[2]?this.state=he.BeforeSpecialS:t===Pt.TitleEnd[2]||t===Pt.XmpEnd[2]?this.state=he.BeforeSpecialT:this.state=he.InTagName}else e===Re.Slash?this.state=he.BeforeClosingTagName:(this.state=he.Text,this.stateText(e))}stateInTagName(e){Pc(e)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=he.BeforeAttributeName,this.stateBeforeAttributeName(e))}stateBeforeClosingTagName(e){xn(e)||(e===Re.Gt?this.state=he.Text:(this.state=this.isTagStartChar(e)?he.InClosingTagName:he.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(e){(e===Re.Gt||xn(e))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=he.AfterClosingTagName,this.stateAfterClosingTagName(e))}stateAfterClosingTagName(e){(e===Re.Gt||this.fastForwardTo(Re.Gt))&&(this.state=he.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(e){e===Re.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=he.InSpecialTag,this.sequenceIndex=0):this.state=he.Text,this.sectionStart=this.index+1):e===Re.Slash?this.state=he.InSelfClosingTag:xn(e)||(this.state=he.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(e){e===Re.Gt?(this.cbs.onselfclosingtag(this.index),this.state=he.Text,this.sectionStart=this.index+1,this.isSpecial=!1):xn(e)||(this.state=he.BeforeAttributeName,this.stateBeforeAttributeName(e))}stateInAttributeName(e){(e===Re.Eq||Pc(e))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=this.index,this.state=he.AfterAttributeName,this.stateAfterAttributeName(e))}stateAfterAttributeName(e){e===Re.Eq?this.state=he.BeforeAttributeValue:e===Re.Slash||e===Re.Gt?(this.cbs.onattribend(Gi.NoValue,this.sectionStart),this.sectionStart=-1,this.state=he.BeforeAttributeName,this.stateBeforeAttributeName(e)):xn(e)||(this.cbs.onattribend(Gi.NoValue,this.sectionStart),this.state=he.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(e){e===Re.DoubleQuote?(this.state=he.InAttributeValueDq,this.sectionStart=this.index+1):e===Re.SingleQuote?(this.state=he.InAttributeValueSq,this.sectionStart=this.index+1):xn(e)||(this.sectionStart=this.index,this.state=he.InAttributeValueNq,this.stateInAttributeValueNoQuotes(e))}handleInAttributeValue(e,t){e===t||!this.decodeEntities&&this.fastForwardTo(t)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(t===Re.DoubleQuote?Gi.Double:Gi.Single,this.index+1),this.state=he.BeforeAttributeName):this.decodeEntities&&e===Re.Amp&&this.startEntity()}stateInAttributeValueDoubleQuotes(e){this.handleInAttributeValue(e,Re.DoubleQuote)}stateInAttributeValueSingleQuotes(e){this.handleInAttributeValue(e,Re.SingleQuote)}stateInAttributeValueNoQuotes(e){xn(e)||e===Re.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(Gi.Unquoted,this.index),this.state=he.BeforeAttributeName,this.stateBeforeAttributeName(e)):this.decodeEntities&&e===Re.Amp&&this.startEntity()}stateBeforeDeclaration(e){e===Re.OpeningSquareBracket?(this.state=he.CDATASequence,this.sequenceIndex=0):this.state=e===Re.Dash?he.BeforeComment:he.InDeclaration}stateInDeclaration(e){(e===Re.Gt||this.fastForwardTo(Re.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=he.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(e){(e===Re.Gt||this.fastForwardTo(Re.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=he.Text,this.sectionStart=this.index+1)}stateBeforeComment(e){e===Re.Dash?(this.state=he.InCommentLike,this.currentSequence=Pt.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=he.InDeclaration}stateInSpecialComment(e){(e===Re.Gt||this.fastForwardTo(Re.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=he.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(e){const t=e|32;t===Pt.ScriptEnd[3]?this.startSpecial(Pt.ScriptEnd,4):t===Pt.StyleEnd[3]?this.startSpecial(Pt.StyleEnd,4):(this.state=he.InTagName,this.stateInTagName(e))}stateBeforeSpecialT(e){switch(e|32){case Pt.TitleEnd[3]:{this.startSpecial(Pt.TitleEnd,4);break}case Pt.TextareaEnd[3]:{this.startSpecial(Pt.TextareaEnd,4);break}case Pt.XmpEnd[3]:{this.startSpecial(Pt.XmpEnd,4);break}default:this.state=he.InTagName,this.stateInTagName(e)}}startEntity(){this.baseState=this.state,this.state=he.InEntity,this.entityStart=this.index,this.entityDecoder.startEntity(this.xmlMode?$i.Strict:this.baseState===he.Text||this.baseState===he.InSpecialTag?$i.Legacy:$i.Attribute)}stateInEntity(){const e=this.entityDecoder.write(this.buffer,this.index-this.offset);e>=0?(this.state=this.baseState,e===0&&(this.index=this.entityStart)):this.index=this.offset+this.buffer.length-1}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===he.Text||this.state===he.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===he.InAttributeValueDq||this.state===he.InAttributeValueSq||this.state===he.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const e=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case he.Text:{this.stateText(e);break}case he.SpecialStartSequence:{this.stateSpecialStartSequence(e);break}case he.InSpecialTag:{this.stateInSpecialTag(e);break}case he.CDATASequence:{this.stateCDATASequence(e);break}case he.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(e);break}case he.InAttributeName:{this.stateInAttributeName(e);break}case he.InCommentLike:{this.stateInCommentLike(e);break}case he.InSpecialComment:{this.stateInSpecialComment(e);break}case he.BeforeAttributeName:{this.stateBeforeAttributeName(e);break}case he.InTagName:{this.stateInTagName(e);break}case he.InClosingTagName:{this.stateInClosingTagName(e);break}case he.BeforeTagName:{this.stateBeforeTagName(e);break}case he.AfterAttributeName:{this.stateAfterAttributeName(e);break}case he.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(e);break}case he.BeforeAttributeValue:{this.stateBeforeAttributeValue(e);break}case he.BeforeClosingTagName:{this.stateBeforeClosingTagName(e);break}case he.AfterClosingTagName:{this.stateAfterClosingTagName(e);break}case he.BeforeSpecialS:{this.stateBeforeSpecialS(e);break}case he.BeforeSpecialT:{this.stateBeforeSpecialT(e);break}case he.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(e);break}case he.InSelfClosingTag:{this.stateInSelfClosingTag(e);break}case he.InDeclaration:{this.stateInDeclaration(e);break}case he.BeforeDeclaration:{this.stateBeforeDeclaration(e);break}case he.BeforeComment:{this.stateBeforeComment(e);break}case he.InProcessingInstruction:{this.stateInProcessingInstruction(e);break}case he.InEntity:{this.stateInEntity();break}}this.index++}this.cleanup()}finish(){this.state===he.InEntity&&(this.entityDecoder.end(),this.state=this.baseState),this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const e=this.buffer.length+this.offset;this.sectionStart>=e||(this.state===he.InCommentLike?this.currentSequence===Pt.CdataEnd?this.cbs.oncdata(this.sectionStart,e,0):this.cbs.oncomment(this.sectionStart,e,0):this.state===he.InTagName||this.state===he.BeforeAttributeName||this.state===he.BeforeAttributeValue||this.state===he.AfterAttributeName||this.state===he.InAttributeName||this.state===he.InAttributeValueSq||this.state===he.InAttributeValueDq||this.state===he.InAttributeValueNq||this.state===he.InClosingTagName||this.cbs.ontext(this.sectionStart,e))}emitCodePoint(e,t){this.baseState!==he.Text&&this.baseState!==he.InSpecialTag?(this.sectionStart<this.entityStart&&this.cbs.onattribdata(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+t,this.index=this.sectionStart-1,this.cbs.onattribentity(e)):(this.sectionStart<this.entityStart&&this.cbs.ontext(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+t,this.index=this.sectionStart-1,this.cbs.ontextentity(e,this.sectionStart))}};const zr=new Set(["input","option","optgroup","select","button","datalist","textarea"]),lt=new Set(["p"]),ux=new Set(["thead","tbody"]),lx=new Set(["dd","dt"]),ox=new Set(["rt","rp"]),hL=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",lt],["h1",lt],["h2",lt],["h3",lt],["h4",lt],["h5",lt],["h6",lt],["select",zr],["input",zr],["output",zr],["button",zr],["datalist",zr],["textarea",zr],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",lx],["dt",lx],["address",lt],["article",lt],["aside",lt],["blockquote",lt],["details",lt],["div",lt],["dl",lt],["fieldset",lt],["figcaption",lt],["figure",lt],["footer",lt],["form",lt],["header",lt],["hr",lt],["main",lt],["nav",lt],["ol",lt],["pre",lt],["section",lt],["table",lt],["ul",lt],["rt",ox],["rp",ox],["tbody",ux],["tfoot",ux]]),mL=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),cx=new Set(["math","svg"]),dx=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),gL=/\s|\//;let pL=class{constructor(e,t={}){var i,a,u,l,c,f;this.options=t,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=e??{},this.htmlMode=!this.options.xmlMode,this.lowerCaseTagNames=(i=t.lowerCaseTags)!==null&&i!==void 0?i:this.htmlMode,this.lowerCaseAttributeNames=(a=t.lowerCaseAttributeNames)!==null&&a!==void 0?a:this.htmlMode,this.recognizeSelfClosing=(u=t.recognizeSelfClosing)!==null&&u!==void 0?u:!this.htmlMode,this.tokenizer=new((l=t.Tokenizer)!==null&&l!==void 0?l:fL)(this.options,this),this.foreignContext=[!this.htmlMode],(f=(c=this.cbs).onparserinit)===null||f===void 0||f.call(c,this)}ontext(e,t){var i,a;const u=this.getSlice(e,t);this.endIndex=t-1,(a=(i=this.cbs).ontext)===null||a===void 0||a.call(i,u),this.startIndex=t}ontextentity(e,t){var i,a;this.endIndex=t-1,(a=(i=this.cbs).ontext)===null||a===void 0||a.call(i,rx(e)),this.startIndex=t}isVoidElement(e){return this.htmlMode&&mL.has(e)}onopentagname(e,t){this.endIndex=t;let i=this.getSlice(e,t);this.lowerCaseTagNames&&(i=i.toLowerCase()),this.emitOpenTag(i)}emitOpenTag(e){var t,i,a,u;this.openTagStart=this.startIndex,this.tagname=e;const l=this.htmlMode&&hL.get(e);if(l)for(;this.stack.length>0&&l.has(this.stack[0]);){const c=this.stack.shift();(i=(t=this.cbs).onclosetag)===null||i===void 0||i.call(t,c,!0)}this.isVoidElement(e)||(this.stack.unshift(e),this.htmlMode&&(cx.has(e)?this.foreignContext.unshift(!0):dx.has(e)&&this.foreignContext.unshift(!1))),(u=(a=this.cbs).onopentagname)===null||u===void 0||u.call(a,e),this.cbs.onopentag&&(this.attribs={})}endOpenTag(e){var t,i;this.startIndex=this.openTagStart,this.attribs&&((i=(t=this.cbs).onopentag)===null||i===void 0||i.call(t,this.tagname,this.attribs,e),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(e){this.endIndex=e,this.endOpenTag(!1),this.startIndex=e+1}onclosetag(e,t){var i,a,u,l,c,f,h,m;this.endIndex=t;let g=this.getSlice(e,t);if(this.lowerCaseTagNames&&(g=g.toLowerCase()),this.htmlMode&&(cx.has(g)||dx.has(g))&&this.foreignContext.shift(),this.isVoidElement(g))this.htmlMode&&g==="br"&&((l=(u=this.cbs).onopentagname)===null||l===void 0||l.call(u,"br"),(f=(c=this.cbs).onopentag)===null||f===void 0||f.call(c,"br",{},!0),(m=(h=this.cbs).onclosetag)===null||m===void 0||m.call(h,"br",!1));else{const E=this.stack.indexOf(g);if(E!==-1)for(let T=0;T<=E;T++){const v=this.stack.shift();(a=(i=this.cbs).onclosetag)===null||a===void 0||a.call(i,v,T!==E)}else this.htmlMode&&g==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=t+1}onselfclosingtag(e){this.endIndex=e,this.recognizeSelfClosing||this.foreignContext[0]?(this.closeCurrentTag(!1),this.startIndex=e+1):this.onopentagend(e)}closeCurrentTag(e){var t,i;const a=this.tagname;this.endOpenTag(e),this.stack[0]===a&&((i=(t=this.cbs).onclosetag)===null||i===void 0||i.call(t,a,!e),this.stack.shift())}onattribname(e,t){this.startIndex=e;const i=this.getSlice(e,t);this.attribname=this.lowerCaseAttributeNames?i.toLowerCase():i}onattribdata(e,t){this.attribvalue+=this.getSlice(e,t)}onattribentity(e){this.attribvalue+=rx(e)}onattribend(e,t){var i,a;this.endIndex=t,(a=(i=this.cbs).onattribute)===null||a===void 0||a.call(i,this.attribname,this.attribvalue,e===Gi.Double?'"':e===Gi.Single?"'":e===Gi.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(e){const t=e.search(gL);let i=t<0?e:e.substr(0,t);return this.lowerCaseTagNames&&(i=i.toLowerCase()),i}ondeclaration(e,t){this.endIndex=t;const i=this.getSlice(e,t);if(this.cbs.onprocessinginstruction){const a=this.getInstructionName(i);this.cbs.onprocessinginstruction(`!${a}`,`!${i}`)}this.startIndex=t+1}onprocessinginstruction(e,t){this.endIndex=t;const i=this.getSlice(e,t);if(this.cbs.onprocessinginstruction){const a=this.getInstructionName(i);this.cbs.onprocessinginstruction(`?${a}`,`?${i}`)}this.startIndex=t+1}oncomment(e,t,i){var a,u,l,c;this.endIndex=t,(u=(a=this.cbs).oncomment)===null||u===void 0||u.call(a,this.getSlice(e,t-i)),(c=(l=this.cbs).oncommentend)===null||c===void 0||c.call(l),this.startIndex=t+1}oncdata(e,t,i){var a,u,l,c,f,h,m,g,E,T;this.endIndex=t;const v=this.getSlice(e,t-i);!this.htmlMode||this.options.recognizeCDATA?((u=(a=this.cbs).oncdatastart)===null||u===void 0||u.call(a),(c=(l=this.cbs).ontext)===null||c===void 0||c.call(l,v),(h=(f=this.cbs).oncdataend)===null||h===void 0||h.call(f)):((g=(m=this.cbs).oncomment)===null||g===void 0||g.call(m,`[CDATA[${v}]]`),(T=(E=this.cbs).oncommentend)===null||T===void 0||T.call(E)),this.startIndex=t+1}onend(){var e,t;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let i=0;i<this.stack.length;i++)this.cbs.onclosetag(this.stack[i],!0)}(t=(e=this.cbs).onend)===null||t===void 0||t.call(e)}reset(){var e,t,i,a;(t=(e=this.cbs).onreset)===null||t===void 0||t.call(e),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(a=(i=this.cbs).onparserinit)===null||a===void 0||a.call(i,this),this.buffers.length=0,this.foreignContext.length=0,this.foreignContext.unshift(!this.htmlMode),this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(e){this.reset(),this.end(e)}getSlice(e,t){for(;e-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let i=this.buffers[0].slice(e-this.bufferOffset,t-this.bufferOffset);for(;t-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),i+=this.buffers[0].slice(0,t-this.bufferOffset);return i}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(e){var t,i;if(this.ended){(i=(t=this.cbs).onerror)===null||i===void 0||i.call(t,new Error(".write() after done!"));return}this.buffers.push(e),this.tokenizer.running&&(this.tokenizer.write(e),this.writeIndex++)}end(e){var t,i;if(this.ended){(i=(t=this.cbs).onerror)===null||i===void 0||i.call(t,new Error(".end() after done!"));return}e&&this.write(e),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(e){this.write(e)}done(e){this.end(e)}};function bL(s,e){const t=new s6(void 0,e);return new pL(t,e).end(s),t.root}var S0;const Kl=(S0=Object.hasOwn)!==null&&S0!==void 0?S0:((s,e)=>Object.prototype.hasOwnProperty.call(s,e)),zl=/\s+/,pm="data-",rg=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,EL=/^{[^]*}$|^\[[^]*]$/;function Td(s,e,t){var i;if(!(!s||!De(s))){if((i=s.attribs)!==null&&i!==void 0||(s.attribs={}),!e)return s.attribs;if(Kl(s.attribs,e))return!t&&rg.test(e)?e:s.attribs[e];if(s.name==="option"&&e==="value")return Yl(s.children);if(s.name==="input"&&(s.attribs.type==="radio"||s.attribs.type==="checkbox")&&e==="value")return"on"}}function nu(s,e,t){t===null?Fy(s,e):s.attribs[e]=`${t}`}function xL(s,e){if(typeof s=="object"||e!==void 0){if(typeof e=="function"){if(typeof s!="string")throw new Error("Bad combination of arguments.");return Tt(this,(t,i)=>{De(t)&&nu(t,s,e.call(t,i,t.attribs[s]))})}return Tt(this,t=>{if(De(t))if(typeof s=="object")for(const i of Object.keys(s)){const a=s[i];nu(t,i,a)}else nu(t,s,e)})}return arguments.length>1?this:Td(this[0],s,this.options.xmlMode)}function fx(s,e,t){return e in s?s[e]:!t&&rg.test(e)?Td(s,e,!1)!==void 0:Td(s,e,t)}function A0(s,e,t,i){e in s?s[e]=t:nu(s,e,!i&&rg.test(e)?t?"":null:`${t}`)}function TL(s,e){var t;if(typeof s=="string"&&e===void 0){const i=this[0];if(!i)return;switch(s){case"style":{const a=this.css(),u=Object.keys(a);for(let l=0;l<u.length;l++)a[l]=u[l];return a.length=u.length,a}case"tagName":case"nodeName":return De(i)?i.name.toUpperCase():void 0;case"href":case"src":{if(!De(i))return;const a=(t=i.attribs)===null||t===void 0?void 0:t[s];return typeof URL<"u"&&(s==="href"&&(i.tagName==="a"||i.tagName==="link")||s==="src"&&(i.tagName==="img"||i.tagName==="iframe"||i.tagName==="audio"||i.tagName==="video"||i.tagName==="source"))&&a!==void 0&&this.options.baseURI?new URL(a,this.options.baseURI).href:a}case"innerText":return bd(i);case"textContent":return Eu(i);case"outerHTML":return i.type===Qm?this.html():this.clone().wrap("<container />").parent().html();case"innerHTML":return this.html();default:return De(i)?fx(i,s,this.options.xmlMode):void 0}}if(typeof s=="object"||e!==void 0){if(typeof e=="function"){if(typeof s=="object")throw new TypeError("Bad combination of arguments.");return Tt(this,(i,a)=>{De(i)&&A0(i,s,e.call(i,a,fx(i,s,this.options.xmlMode)),this.options.xmlMode)})}return Tt(this,i=>{if(De(i))if(typeof s=="object")for(const a of Object.keys(s)){const u=s[a];A0(i,a,u,this.options.xmlMode)}else A0(i,s,e,this.options.xmlMode)})}}function hx(s,e,t){var i;(i=s.data)!==null&&i!==void 0||(s.data={}),typeof e=="object"?Object.assign(s.data,e):typeof e=="string"&&t!==void 0&&(s.data[e]=t)}function yL(s){for(const e of Object.keys(s.attribs)){if(!e.startsWith(pm))continue;const t=J6(e.slice(pm.length));Kl(s.data,t)||(s.data[t]=By(s.attribs[e]))}return s.data}function vL(s,e){const t=pm+eL(e),i=s.data;if(Kl(i,e))return i[e];if(Kl(s.attribs,t))return i[e]=By(s.attribs[t])}function By(s){if(s==="null")return null;if(s==="true")return!0;if(s==="false")return!1;const e=Number(s);if(s===String(e))return e;if(EL.test(s))try{return JSON.parse(s)}catch{}return s}function SL(s,e){var t;const i=this[0];if(!i||!De(i))return;const a=i;return(t=a.data)!==null&&t!==void 0||(a.data={}),s==null?yL(a):typeof s=="object"||e!==void 0?(Tt(this,u=>{De(u)&&(typeof s=="object"?hx(u,s):hx(u,s,e))}),this):vL(a,s)}function AL(s){const e=arguments.length===0,t=this[0];if(!t||!De(t))return e?void 0:this;switch(t.name){case"textarea":return this.text(s);case"select":{const i=this.find("option:selected");if(!e){if(this.attr("multiple")==null&&typeof s=="object")return this;this.find("option").removeAttr("selected");const a=typeof s=="object"?s:[s];for(const u of a)this.find(`option[value="${u}"]`).attr("selected","");return this}return this.attr("multiple")?i.toArray().map(a=>Yl(a.children)):i.attr("value")}case"input":case"option":return e?this.attr("value"):this.attr("value",s)}}function Fy(s,e){!s.attribs||!Kl(s.attribs,e)||delete s.attribs[e]}function yd(s){return s?s.trim().split(zl):[]}function _L(s){const e=yd(s);for(const t of e)Tt(this,i=>{De(i)&&Fy(i,t)});return this}function LL(s){return this.toArray().some(e=>{const t=De(e)&&e.attribs.class;let i=-1;if(t&&s.length>0)for(;(i=t.indexOf(s,i+1))>-1;){const a=i+s.length;if((i===0||zl.test(t[i-1]))&&(a===t.length||zl.test(t[a])))return!0}return!1})}function jy(s){if(typeof s=="function")return Tt(this,(i,a)=>{if(De(i)){const u=i.attribs.class||"";jy.call([i],s.call(i,a,u))}});if(!s||typeof s!="string")return this;const e=s.split(zl),t=this.length;for(let i=0;i<t;i++){const a=this[i];if(!De(a))continue;const u=Td(a,"class",!1);if(u){let l=` ${u} `;for(const c of e){const f=`${c} `;l.includes(` ${f}`)||(l+=f)}nu(a,"class",l.trim())}else nu(a,"class",e.join(" ").trim())}return this}function Hy(s){if(typeof s=="function")return Tt(this,(a,u)=>{De(a)&&Hy.call([a],s.call(a,u,a.attribs.class||""))});const e=yd(s),t=e.length,i=arguments.length===0;return Tt(this,a=>{if(De(a))if(i)a.attribs.class="";else{const u=yd(a.attribs.class);let l=!1;for(let c=0;c<t;c++){const f=u.indexOf(e[c]);f!==-1&&(u.splice(f,1),l=!0,c--)}l&&(a.attribs.class=u.join(" "))}})}function $y(s,e){if(typeof s=="function")return Tt(this,(l,c)=>{De(l)&&$y.call([l],s.call(l,c,l.attribs.class||"",e),e)});if(!s||typeof s!="string")return this;const t=s.split(zl),i=t.length,a=typeof e=="boolean"?e?1:-1:0,u=this.length;for(let l=0;l<u;l++){const c=this[l];if(!De(c))continue;const f=yd(c.attribs.class);for(let h=0;h<i;h++){const m=f.indexOf(t[h]);a>=0&&m===-1?f.push(t[h]):a<=0&&m!==-1&&f.splice(m,1)}c.attribs.class=f.join(" ")}return this}const IL=Object.freeze(Object.defineProperty({__proto__:null,addClass:jy,attr:xL,data:SL,hasClass:LL,prop:TL,removeAttr:_L,removeClass:Hy,toggleClass:$y,val:AL},Symbol.toStringTag,{value:"Module"}));var Le;(function(s){s.Attribute="attribute",s.Pseudo="pseudo",s.PseudoElement="pseudo-element",s.Tag="tag",s.Universal="universal",s.Adjacent="adjacent",s.Child="child",s.Descendant="descendant",s.Parent="parent",s.Sibling="sibling",s.ColumnCombinator="column-combinator"})(Le||(Le={}));var zt;(function(s){s.Any="any",s.Element="element",s.End="end",s.Equals="equals",s.Exists="exists",s.Hyphen="hyphen",s.Not="not",s.Start="start"})(zt||(zt={}));const mx=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,RL=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,NL=new Map([[126,zt.Element],[94,zt.Start],[36,zt.End],[42,zt.Any],[33,zt.Not],[124,zt.Hyphen]]),CL=new Set(["has","not","matches","is","where","host","host-context"]);function Cl(s){switch(s.type){case Le.Adjacent:case Le.Child:case Le.Descendant:case Le.Parent:case Le.Sibling:case Le.ColumnCombinator:return!0;default:return!1}}const DL=new Set(["contains","icontains"]);function OL(s,e,t){const i=parseInt(e,16)-65536;return i!==i||t?e:i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,i&1023|56320)}function vl(s){return s.replace(RL,OL)}function _0(s){return s===39||s===34}function gx(s){return s===32||s===9||s===10||s===12||s===13}function Kd(s){const e=[],t=Gy(e,`${s}`,0);if(t<s.length)throw new Error(`Unmatched selector: ${s.slice(t)}`);return e}function Gy(s,e,t){let i=[];function a(E){const T=e.slice(t+E).match(mx);if(!T)throw new Error(`Expected name, found ${e.slice(t)}`);const[v]=T;return t+=E+v.length,vl(v)}function u(E){for(t+=E;t<e.length&&gx(e.charCodeAt(t));)t++}function l(){t+=1;const E=t;let T=1;for(;T>0&&t<e.length;t++)e.charCodeAt(t)===40&&!c(t)?T++:e.charCodeAt(t)===41&&!c(t)&&T--;if(T)throw new Error("Parenthesis not matched");return vl(e.slice(E,t-1))}function c(E){let T=0;for(;e.charCodeAt(--E)===92;)T++;return(T&1)===1}function f(){if(i.length>0&&Cl(i[i.length-1]))throw new Error("Did not expect successive traversals.")}function h(E){if(i.length>0&&i[i.length-1].type===Le.Descendant){i[i.length-1].type=E;return}f(),i.push({type:E})}function m(E,T){i.push({type:Le.Attribute,name:E,action:T,value:a(1),namespace:null,ignoreCase:"quirks"})}function g(){if(i.length&&i[i.length-1].type===Le.Descendant&&i.pop(),i.length===0)throw new Error("Empty sub-selector");s.push(i)}if(u(0),e.length===t)return t;e:for(;t<e.length;){const E=e.charCodeAt(t);switch(E){case 32:case 9:case 10:case 12:case 13:{(i.length===0||i[0].type!==Le.Descendant)&&(f(),i.push({type:Le.Descendant})),u(1);break}case 62:{h(Le.Child),u(1);break}case 60:{h(Le.Parent),u(1);break}case 126:{h(Le.Sibling),u(1);break}case 43:{h(Le.Adjacent),u(1);break}case 46:{m("class",zt.Element);break}case 35:{m("id",zt.Equals);break}case 91:{u(1);let T,v=null;e.charCodeAt(t)===124?T=a(1):e.startsWith("*|",t)?(v="*",T=a(2)):(T=a(0),e.charCodeAt(t)===124&&e.charCodeAt(t+1)!==61&&(v=T,T=a(1))),u(0);let S=zt.Exists;const A=NL.get(e.charCodeAt(t));if(A){if(S=A,e.charCodeAt(t+1)!==61)throw new Error("Expected `=`");u(2)}else e.charCodeAt(t)===61&&(S=zt.Equals,u(1));let I="",R=null;if(S!=="exists"){if(_0(e.charCodeAt(t))){const k=e.charCodeAt(t);let G=t+1;for(;G<e.length&&(e.charCodeAt(G)!==k||c(G));)G+=1;if(e.charCodeAt(G)!==k)throw new Error("Attribute value didn't end");I=vl(e.slice(t+1,G)),t=G+1}else{const k=t;for(;t<e.length&&(!gx(e.charCodeAt(t))&&e.charCodeAt(t)!==93||c(t));)t+=1;I=vl(e.slice(k,t))}u(0);const D=e.charCodeAt(t)|32;D===115?(R=!1,u(1)):D===105&&(R=!0,u(1))}if(e.charCodeAt(t)!==93)throw new Error("Attribute selector didn't terminate");t+=1;const N={type:Le.Attribute,name:T,action:S,value:I,namespace:v,ignoreCase:R};i.push(N);break}case 58:{if(e.charCodeAt(t+1)===58){i.push({type:Le.PseudoElement,name:a(2).toLowerCase(),data:e.charCodeAt(t)===40?l():null});continue}const T=a(1).toLowerCase();let v=null;if(e.charCodeAt(t)===40)if(CL.has(T)){if(_0(e.charCodeAt(t+1)))throw new Error(`Pseudo-selector ${T} cannot be quoted`);if(v=[],t=Gy(v,e,t+1),e.charCodeAt(t)!==41)throw new Error(`Missing closing parenthesis in :${T} (${e})`);t+=1}else{if(v=l(),DL.has(T)){const S=v.charCodeAt(0);S===v.charCodeAt(v.length-1)&&_0(S)&&(v=v.slice(1,-1))}v=vl(v)}i.push({type:Le.Pseudo,name:T,data:v});break}case 44:{g(),i=[],u(1);break}default:{if(e.startsWith("/*",t)){const S=e.indexOf("*/",t+2);if(S<0)throw new Error("Comment was not terminated");t=S+2,i.length===0&&u(0);break}let T=null,v;if(E===42)t+=1,v="*";else if(E===124){if(v="",e.charCodeAt(t+1)===124){h(Le.ColumnCombinator),u(2);break}}else if(mx.test(e.slice(t)))v=a(0);else break e;e.charCodeAt(t)===124&&e.charCodeAt(t+1)!==124&&(T=v,e.charCodeAt(t+1)===42?(v="*",t+=2):v=a(1)),i.push(v==="*"?{type:Le.Universal,namespace:T}:{type:Le.Tag,name:v,namespace:T})}}}return g(),t}var L0,px;function wL(){return px||(px=1,L0={trueFunc:function(){return!0},falseFunc:function(){return!1}}),L0}var vd=wL();const je=cy(vd),Vy=new Map([[Le.Universal,50],[Le.Tag,30],[Le.Attribute,1],[Le.Pseudo,0]]);function ug(s){return!Vy.has(s.type)}const kL=new Map([[zt.Exists,10],[zt.Equals,8],[zt.Not,7],[zt.Start,6],[zt.End,6],[zt.Any,5]]);function ML(s){const e=s.map(qy);for(let t=1;t<s.length;t++){const i=e[t];if(!(i<0))for(let a=t-1;a>=0&&i<e[a];a--){const u=s[a+1];s[a+1]=s[a],s[a]=u,e[a+1]=e[a],e[a]=i}}}function qy(s){var e,t;let i=(e=Vy.get(s.type))!==null&&e!==void 0?e:-1;return s.type===Le.Attribute?(i=(t=kL.get(s.action))!==null&&t!==void 0?t:4,s.action===zt.Equals&&s.name==="id"&&(i=9),s.ignoreCase&&(i>>=1)):s.type===Le.Pseudo&&(s.data?s.name==="has"||s.name==="contains"?i=0:Array.isArray(s.data)?(i=Math.min(...s.data.map(a=>Math.min(...a.map(qy)))),i<0&&(i=0)):i=2:i=3),i}const PL=/[-[\]{}()*+?.,\\^$|#\s]/g;function bx(s){return s.replace(PL,"\\$&")}const UL=new Set(["accept","accept-charset","align","alink","axis","bgcolor","charset","checked","clear","codetype","color","compact","declare","defer","dir","direction","disabled","enctype","face","frame","hreflang","http-equiv","lang","language","link","media","method","multiple","nohref","noresize","noshade","nowrap","readonly","rel","rev","rules","scope","scrolling","selected","shape","target","text","type","valign","valuetype","vlink"]);function Ha(s,e){return typeof s.ignoreCase=="boolean"?s.ignoreCase:s.ignoreCase==="quirks"?!!e.quirksMode:!e.xmlMode&&UL.has(s.name)}const BL={equals(s,e,t){const{adapter:i}=t,{name:a}=e;let{value:u}=e;return Ha(e,t)?(u=u.toLowerCase(),l=>{const c=i.getAttributeValue(l,a);return c!=null&&c.length===u.length&&c.toLowerCase()===u&&s(l)}):l=>i.getAttributeValue(l,a)===u&&s(l)},hyphen(s,e,t){const{adapter:i}=t,{name:a}=e;let{value:u}=e;const l=u.length;return Ha(e,t)?(u=u.toLowerCase(),function(f){const h=i.getAttributeValue(f,a);return h!=null&&(h.length===l||h.charAt(l)==="-")&&h.substr(0,l).toLowerCase()===u&&s(f)}):function(f){const h=i.getAttributeValue(f,a);return h!=null&&(h.length===l||h.charAt(l)==="-")&&h.substr(0,l)===u&&s(f)}},element(s,e,t){const{adapter:i}=t,{name:a,value:u}=e;if(/\s/.test(u))return je.falseFunc;const l=new RegExp(`(?:^|\\s)${bx(u)}(?:$|\\s)`,Ha(e,t)?"i":"");return function(f){const h=i.getAttributeValue(f,a);return h!=null&&h.length>=u.length&&l.test(h)&&s(f)}},exists(s,{name:e},{adapter:t}){return i=>t.hasAttrib(i,e)&&s(i)},start(s,e,t){const{adapter:i}=t,{name:a}=e;let{value:u}=e;const l=u.length;return l===0?je.falseFunc:Ha(e,t)?(u=u.toLowerCase(),c=>{const f=i.getAttributeValue(c,a);return f!=null&&f.length>=l&&f.substr(0,l).toLowerCase()===u&&s(c)}):c=>{var f;return!!(!((f=i.getAttributeValue(c,a))===null||f===void 0)&&f.startsWith(u))&&s(c)}},end(s,e,t){const{adapter:i}=t,{name:a}=e;let{value:u}=e;const l=-u.length;return l===0?je.falseFunc:Ha(e,t)?(u=u.toLowerCase(),c=>{var f;return((f=i.getAttributeValue(c,a))===null||f===void 0?void 0:f.substr(l).toLowerCase())===u&&s(c)}):c=>{var f;return!!(!((f=i.getAttributeValue(c,a))===null||f===void 0)&&f.endsWith(u))&&s(c)}},any(s,e,t){const{adapter:i}=t,{name:a,value:u}=e;if(u==="")return je.falseFunc;if(Ha(e,t)){const l=new RegExp(bx(u),"i");return function(f){const h=i.getAttributeValue(f,a);return h!=null&&h.length>=u.length&&l.test(h)&&s(f)}}return l=>{var c;return!!(!((c=i.getAttributeValue(l,a))===null||c===void 0)&&c.includes(u))&&s(l)}},not(s,e,t){const{adapter:i}=t,{name:a}=e;let{value:u}=e;return u===""?l=>!!i.getAttributeValue(l,a)&&s(l):Ha(e,t)?(u=u.toLowerCase(),l=>{const c=i.getAttributeValue(l,a);return(c==null||c.length!==u.length||c.toLowerCase()!==u)&&s(l)}):l=>i.getAttributeValue(l,a)!==u&&s(l)}},FL=new Set([9,10,12,13,32]),Ex=48,jL=57;function HL(s){if(s=s.trim().toLowerCase(),s==="even")return[2,0];if(s==="odd")return[2,1];let e=0,t=0,i=u(),a=l();if(e<s.length&&s.charAt(e)==="n"&&(e++,t=i*(a??1),c(),e<s.length?(i=u(),c(),a=l()):i=a=0),a===null||e<s.length)throw new Error(`n-th rule couldn't be parsed ('${s}')`);return[t,i*a];function u(){return s.charAt(e)==="-"?(e++,-1):(s.charAt(e)==="+"&&e++,1)}function l(){const f=e;let h=0;for(;e<s.length&&s.charCodeAt(e)>=Ex&&s.charCodeAt(e)<=jL;)h=h*10+(s.charCodeAt(e)-Ex),e++;return e===f?null:h}function c(){for(;e<s.length&&FL.has(s.charCodeAt(e));)e++}}function $L(s){const e=s[0],t=s[1]-1;if(t<0&&e<=0)return je.falseFunc;if(e===-1)return u=>u<=t;if(e===0)return u=>u===t;if(e===1)return t<0?je.trueFunc:u=>u>=t;const i=Math.abs(e),a=(t%i+i)%i;return e>1?u=>u>=t&&u%i===a:u=>u<=t&&u%i===a}function Uc(s){return $L(HL(s))}function Bc(s,e){return t=>{const i=e.getParent(t);return i!=null&&e.isTag(i)&&s(t)}}const bm={contains(s,e,{adapter:t}){return function(a){return s(a)&&t.getText(a).includes(e)}},icontains(s,e,{adapter:t}){const i=e.toLowerCase();return function(u){return s(u)&&t.getText(u).toLowerCase().includes(i)}},"nth-child"(s,e,{adapter:t,equals:i}){const a=Uc(e);return a===je.falseFunc?je.falseFunc:a===je.trueFunc?Bc(s,t):function(l){const c=t.getSiblings(l);let f=0;for(let h=0;h<c.length&&!i(l,c[h]);h++)t.isTag(c[h])&&f++;return a(f)&&s(l)}},"nth-last-child"(s,e,{adapter:t,equals:i}){const a=Uc(e);return a===je.falseFunc?je.falseFunc:a===je.trueFunc?Bc(s,t):function(l){const c=t.getSiblings(l);let f=0;for(let h=c.length-1;h>=0&&!i(l,c[h]);h--)t.isTag(c[h])&&f++;return a(f)&&s(l)}},"nth-of-type"(s,e,{adapter:t,equals:i}){const a=Uc(e);return a===je.falseFunc?je.falseFunc:a===je.trueFunc?Bc(s,t):function(l){const c=t.getSiblings(l);let f=0;for(let h=0;h<c.length;h++){const m=c[h];if(i(l,m))break;t.isTag(m)&&t.getName(m)===t.getName(l)&&f++}return a(f)&&s(l)}},"nth-last-of-type"(s,e,{adapter:t,equals:i}){const a=Uc(e);return a===je.falseFunc?je.falseFunc:a===je.trueFunc?Bc(s,t):function(l){const c=t.getSiblings(l);let f=0;for(let h=c.length-1;h>=0;h--){const m=c[h];if(i(l,m))break;t.isTag(m)&&t.getName(m)===t.getName(l)&&f++}return a(f)&&s(l)}},root(s,e,{adapter:t}){return i=>{const a=t.getParent(i);return(a==null||!t.isTag(a))&&s(i)}},scope(s,e,t,i){const{equals:a}=t;return!i||i.length===0?bm.root(s,e,t):i.length===1?u=>a(i[0],u)&&s(u):u=>i.includes(u)&&s(u)},hover:I0("isHovered"),visited:I0("isVisited"),active:I0("isActive")};function I0(s){return function(t,i,{adapter:a}){const u=a[s];return typeof u!="function"?je.falseFunc:function(c){return u(c)&&t(c)}}}const xx={empty(s,{adapter:e}){return!e.getChildren(s).some(t=>e.isTag(t)||e.getText(t)!=="")},"first-child"(s,{adapter:e,equals:t}){if(e.prevElementSibling)return e.prevElementSibling(s)==null;const i=e.getSiblings(s).find(a=>e.isTag(a));return i!=null&&t(s,i)},"last-child"(s,{adapter:e,equals:t}){const i=e.getSiblings(s);for(let a=i.length-1;a>=0;a--){if(t(s,i[a]))return!0;if(e.isTag(i[a]))break}return!1},"first-of-type"(s,{adapter:e,equals:t}){const i=e.getSiblings(s),a=e.getName(s);for(let u=0;u<i.length;u++){const l=i[u];if(t(s,l))return!0;if(e.isTag(l)&&e.getName(l)===a)break}return!1},"last-of-type"(s,{adapter:e,equals:t}){const i=e.getSiblings(s),a=e.getName(s);for(let u=i.length-1;u>=0;u--){const l=i[u];if(t(s,l))return!0;if(e.isTag(l)&&e.getName(l)===a)break}return!1},"only-of-type"(s,{adapter:e,equals:t}){const i=e.getName(s);return e.getSiblings(s).every(a=>t(s,a)||!e.isTag(a)||e.getName(a)!==i)},"only-child"(s,{adapter:e,equals:t}){return e.getSiblings(s).every(i=>t(s,i)||!e.isTag(i))}};function Tx(s,e,t,i){if(t===null){if(s.length>i)throw new Error(`Pseudo-class :${e} requires an argument`)}else if(s.length===i)throw new Error(`Pseudo-class :${e} doesn't have any arguments`)}const GL={"any-link":":is(a, area, link)[href]",link:":any-link:not(:visited)",disabled:`:is(
        :is(button, input, select, textarea, optgroup, option)[disabled],
        optgroup[disabled] > option,
        fieldset[disabled]:not(fieldset[disabled] legend:first-of-type *)
    )`,enabled:":not(:disabled)",checked:":is(:is(input[type=radio], input[type=checkbox])[checked], option:selected)",required:":is(input, select, textarea)[required]",optional:":is(input, select, textarea):not([required])",selected:"option:is([selected], select:not([multiple]):not(:has(> option[selected])) > :first-of-type)",checkbox:"[type=checkbox]",file:"[type=file]",password:"[type=password]",radio:"[type=radio]",reset:"[type=reset]",image:"[type=image]",submit:"[type=submit]",parent:":not(:empty)",header:":is(h1, h2, h3, h4, h5, h6)",button:":is(button, input[type=button])",input:":is(input, textarea, select, button)",text:"input:is(:not([type!='']), [type=text])"},Yy={};function VL(s,e){return s===je.falseFunc?je.falseFunc:t=>e.isTag(t)&&s(t)}function Ky(s,e){const t=e.getSiblings(s);if(t.length<=1)return[];const i=t.indexOf(s);return i<0||i===t.length-1?[]:t.slice(i+1).filter(e.isTag)}function Em(s){return{xmlMode:!!s.xmlMode,lowerCaseAttributeNames:!!s.lowerCaseAttributeNames,lowerCaseTags:!!s.lowerCaseTags,quirksMode:!!s.quirksMode,cacheResults:!!s.cacheResults,pseudos:s.pseudos,adapter:s.adapter,equals:s.equals}}const R0=(s,e,t,i,a)=>{const u=a(e,Em(t),i);return u===je.trueFunc?s:u===je.falseFunc?je.falseFunc:l=>u(l)&&s(l)},N0={is:R0,matches:R0,where:R0,not(s,e,t,i,a){const u=a(e,Em(t),i);return u===je.falseFunc?s:u===je.trueFunc?je.falseFunc:l=>!u(l)&&s(l)},has(s,e,t,i,a){const{adapter:u}=t,l=Em(t);l.relativeSelector=!0;const c=e.some(m=>m.some(ug))?[Yy]:void 0,f=a(e,l,c);if(f===je.falseFunc)return je.falseFunc;const h=VL(f,u);if(c&&f!==je.trueFunc){const{shouldTestNextSiblings:m=!1}=f;return g=>{if(!s(g))return!1;c[0]=g;const E=u.getChildren(g),T=m?[...E,...Ky(g,u)]:E;return u.existsOne(h,T)}}return m=>s(m)&&u.existsOne(h,u.getChildren(m))}};function qL(s,e,t,i,a){var u;const{name:l,data:c}=e;if(Array.isArray(c)){if(!(l in N0))throw new Error(`Unknown pseudo-class :${l}(${c})`);return N0[l](s,c,t,i,a)}const f=(u=t.pseudos)===null||u===void 0?void 0:u[l],h=typeof f=="string"?f:GL[l];if(typeof h=="string"){if(c!=null)throw new Error(`Pseudo ${l} doesn't have any arguments`);const m=Kd(h);return N0.is(s,m,t,i,a)}if(typeof f=="function")return Tx(f,l,c,1),m=>f(m,c)&&s(m);if(l in bm)return bm[l](s,c,t,i);if(l in xx){const m=xx[l];return Tx(m,l,c,2),g=>m(g,t,c)&&s(g)}throw new Error(`Unknown pseudo-class :${l}`)}function C0(s,e){const t=e.getParent(s);return t&&e.isTag(t)?t:null}function YL(s,e,t,i,a){const{adapter:u,equals:l}=t;switch(e.type){case Le.PseudoElement:throw new Error("Pseudo-elements are not supported by css-select");case Le.ColumnCombinator:throw new Error("Column combinators are not yet supported by css-select");case Le.Attribute:{if(e.namespace!=null)throw new Error("Namespaced attributes are not yet supported by css-select");return(!t.xmlMode||t.lowerCaseAttributeNames)&&(e.name=e.name.toLowerCase()),BL[e.action](s,e,t)}case Le.Pseudo:return qL(s,e,t,i,a);case Le.Tag:{if(e.namespace!=null)throw new Error("Namespaced tag names are not yet supported by css-select");let{name:c}=e;return(!t.xmlMode||t.lowerCaseTags)&&(c=c.toLowerCase()),function(h){return u.getName(h)===c&&s(h)}}case Le.Descendant:{if(t.cacheResults===!1||typeof WeakSet>"u")return function(h){let m=h;for(;m=C0(m,u);)if(s(m))return!0;return!1};const c=new WeakSet;return function(h){let m=h;for(;m=C0(m,u);)if(!c.has(m)){if(u.isTag(m)&&s(m))return!0;c.add(m)}return!1}}case"_flexibleDescendant":return function(f){let h=f;do if(s(h))return!0;while(h=C0(h,u));return!1};case Le.Parent:return function(f){return u.getChildren(f).some(h=>u.isTag(h)&&s(h))};case Le.Child:return function(f){const h=u.getParent(f);return h!=null&&u.isTag(h)&&s(h)};case Le.Sibling:return function(f){const h=u.getSiblings(f);for(let m=0;m<h.length;m++){const g=h[m];if(l(f,g))break;if(u.isTag(g)&&s(g))return!0}return!1};case Le.Adjacent:return u.prevElementSibling?function(f){const h=u.prevElementSibling(f);return h!=null&&s(h)}:function(f){const h=u.getSiblings(f);let m;for(let g=0;g<h.length;g++){const E=h[g];if(l(f,E))break;u.isTag(E)&&(m=E)}return!!m&&s(m)};case Le.Universal:{if(e.namespace!=null&&e.namespace!=="*")throw new Error("Namespaced universal selectors are not yet supported by css-select");return s}}}function zy(s){return s.type===Le.Pseudo&&(s.name==="scope"||Array.isArray(s.data)&&s.data.some(e=>e.some(zy)))}const KL={type:Le.Descendant},zL={type:"_flexibleDescendant"},QL={type:Le.Pseudo,name:"scope",data:null};function XL(s,{adapter:e},t){const i=!!(t!=null&&t.every(a=>{const u=e.isTag(a)&&e.getParent(a);return a===Yy||u&&e.isTag(u)}));for(const a of s){if(!(a.length>0&&ug(a[0])&&a[0].type!==Le.Descendant))if(i&&!a.some(zy))a.unshift(KL);else continue;a.unshift(QL)}}function Qy(s,e,t){var i;s.forEach(ML),t=(i=e.context)!==null&&i!==void 0?i:t;const a=Array.isArray(t),u=t&&(Array.isArray(t)?t:[t]);if(e.relativeSelector!==!1)XL(s,e,u);else if(s.some(f=>f.length>0&&ug(f[0])))throw new Error("Relative selectors are not allowed when the `relativeSelector` option is disabled");let l=!1;const c=s.map(f=>{if(f.length>=2){const[h,m]=f;h.type!==Le.Pseudo||h.name!=="scope"||(a&&m.type===Le.Descendant?f[1]=zL:(m.type===Le.Adjacent||m.type===Le.Sibling)&&(l=!0))}return WL(f,e,u)}).reduce(ZL,je.falseFunc);return c.shouldTestNextSiblings=l,c}function WL(s,e,t){var i;return s.reduce((a,u)=>a===je.falseFunc?je.falseFunc:YL(a,u,e,t,Qy),(i=e.rootFunc)!==null&&i!==void 0?i:je.trueFunc)}function ZL(s,e){return e===je.falseFunc||s===je.trueFunc?s:s===je.falseFunc||e===je.trueFunc?e:function(i){return s(i)||e(i)}}const Xy=(s,e)=>s===e,JL={adapter:Yd,equals:Xy};function eI(s){var e,t,i,a;const u=s??JL;return(e=u.adapter)!==null&&e!==void 0||(u.adapter=Yd),(t=u.equals)!==null&&t!==void 0||(u.equals=(a=(i=u.adapter)===null||i===void 0?void 0:i.equals)!==null&&a!==void 0?a:Xy),u}function tI(s){return function(t,i,a){const u=eI(i);return s(t,u,a)}}const lg=tI(Qy);function Wy(s,e,t=!1){return t&&(s=sI(s,e)),Array.isArray(s)?e.removeSubsets(s):e.getChildren(s)}function sI(s,e){const t=Array.isArray(s)?s.slice(0):[s],i=t.length;for(let a=0;a<i;a++){const u=Ky(t[a],e);t.push(...u)}return t}const iI=new Set(["first","last","eq","gt","nth","lt","even","odd"]);function Sd(s){return s.type!=="pseudo"?!1:iI.has(s.name)?!0:s.name==="not"&&Array.isArray(s.data)?s.data.some(e=>e.some(Sd)):!1}function nI(s,e,t){const i=e!=null?parseInt(e,10):NaN;switch(s){case"first":return 1;case"nth":case"eq":return isFinite(i)?i>=0?i+1:1/0:0;case"lt":return isFinite(i)?i>=0?Math.min(i,t):1/0:0;case"gt":return isFinite(i)?1/0:0;case"odd":return 2*t;case"even":return 2*t-1;case"last":case"not":return 1/0}}function aI(s){for(;s.parent;)s=s.parent;return s}function og(s){const e=[],t=[];for(const i of s)i.some(Sd)?e.push(i):t.push(i);return[t,e]}const rI={type:Le.Universal,namespace:null},uI={type:Le.Pseudo,name:"scope",data:null};function Zy(s,e,t={}){return Jy([s],e,t)}function Jy(s,e,t={}){if(typeof e=="function")return s.some(e);const[i,a]=og(Kd(e));return i.length>0&&s.some(lg(i,t))||a.some(u=>s2(u,s,t).length>0)}function lI(s,e,t,i){const a=typeof t=="string"?parseInt(t,10):NaN;switch(s){case"first":case"lt":return e;case"last":return e.length>0?[e[e.length-1]]:e;case"nth":case"eq":return isFinite(a)&&Math.abs(a)<e.length?[a<0?e[e.length+a]:e[a]]:[];case"gt":return isFinite(a)?e.slice(a+1):[];case"even":return e.filter((u,l)=>l%2===0);case"odd":return e.filter((u,l)=>l%2===1);case"not":{const u=new Set(t2(t,e,i));return e.filter(l=>!u.has(l))}}}function e2(s,e,t={}){return t2(Kd(s),e,t)}function t2(s,e,t){if(e.length===0)return[];const[i,a]=og(s);let u;if(i.length){const l=Tm(e,i,t);if(a.length===0)return l;l.length&&(u=new Set(l))}for(let l=0;l<a.length&&(u==null?void 0:u.size)!==e.length;l++){const c=a[l];if((u?e.filter(m=>De(m)&&!u.has(m)):e).length===0)break;const h=s2(c,e,t);if(h.length)if(u)h.forEach(m=>u.add(m));else{if(l===a.length-1)return h;u=new Set(h)}}return typeof u<"u"?u.size===e.length?e:e.filter(l=>u.has(l)):[]}function s2(s,e,t){var i;if(s.some(Cl)){const a=(i=t.root)!==null&&i!==void 0?i:aI(e[0]),u={...t,context:e,relativeSelector:!1};return s.push(uI),Ad(a,s,u,!0,e.length)}return Ad(e,s,t,!1,e.length)}function oI(s,e,t={},i=1/0){if(typeof s=="function")return i2(e,s);const[a,u]=og(Kd(s)),l=u.map(c=>Ad(e,c,t,!0,i));return a.length&&l.push(xm(e,a,t,i)),l.length===0?[]:l.length===1?l[0]:Su(l.reduce((c,f)=>[...c,...f]))}function Ad(s,e,t,i,a){const u=e.findIndex(Sd),l=e.slice(0,u),c=e[u],f=e.length-1===u?a:1/0,h=nI(c.name,c.data,f);if(h===0)return[];const g=(l.length===0&&!Array.isArray(s)?qd(s).filter(De):l.length===0?(Array.isArray(s)?s:[s]).filter(De):i||l.some(Cl)?xm(s,[l],t,h):Tm(s,[l],t)).slice(0,h);let E=lI(c.name,g,c.data,t);if(E.length===0||e.length===u+1)return E;const T=e.slice(u+1),v=T.some(Cl);if(v){if(Cl(T[0])){const{type:S}=T[0];(S===Le.Sibling||S===Le.Adjacent)&&(E=Wy(E,Yd,!0)),T.unshift(rI)}t={...t,relativeSelector:!1,rootFunc:S=>E.includes(S)}}else t.rootFunc&&t.rootFunc!==vd.trueFunc&&(t={...t,rootFunc:vd.trueFunc});return T.some(Sd)?Ad(E,T,t,!1,a):v?xm(E,[T],t,a):Tm(E,[T],t)}function xm(s,e,t,i){const a=lg(e,t,s);return i2(s,a,i)}function i2(s,e,t=1/0){const i=Wy(s,Yd,e.shouldTestNextSiblings);return ig(a=>De(a)&&e(a),i,!0,t)}function Tm(s,e,t){const i=(Array.isArray(s)?s:[s]).filter(De);if(i.length===0)return i;const a=lg(e,t);return a===vd.trueFunc?i:i.filter(a)}const cI=/^\s*[+~]/;function dI(s){if(!s)return this._make([]);if(typeof s!="string"){const e=Ln(s)?s.toArray():[s],t=this.toArray();return this._make(e.filter(i=>t.some(a=>Uy(a,i))))}return this._findBySelector(s,Number.POSITIVE_INFINITY)}function fI(s,e){var t;const i=this.toArray(),a=cI.test(s)?i:this.children().toArray(),u={context:i,root:(t=this._root)===null||t===void 0?void 0:t[0],xmlMode:this.options.xmlMode,lowerCaseTags:this.options.lowerCaseTags,lowerCaseAttributeNames:this.options.lowerCaseAttributeNames,pseudos:this.options.pseudos,quirksMode:this.options.quirksMode};return this._make(oI(s,a,u,e))}function cg(s){return function(e,...t){return function(i){var a;let u=s(e,this);return i&&(u=hg(u,i,this.options.xmlMode,(a=this._root)===null||a===void 0?void 0:a[0])),this._make(this.length>1&&u.length>1?t.reduce((l,c)=>c(l),u):u)}}}const lo=cg((s,e)=>{let t=[];for(let i=0;i<e.length;i++){const a=s(e[i]);a.length>0&&(t=t.concat(a))}return t}),dg=cg((s,e)=>{const t=[];for(let i=0;i<e.length;i++){const a=s(e[i]);a!==null&&t.push(a)}return t});function fg(s,...e){let t=null;const i=cg((a,u)=>{const l=[];return Tt(u,c=>{for(let f;(f=a(c))&&!(t!=null&&t(f,l.length));c=f)l.push(f)}),l})(s,...e);return function(a,u){t=typeof a=="string"?c=>Zy(c,a,this.options):a?oo(a):null;const l=i.call(this,u);return t=null,l}}function Au(s){return s.length>1?Array.from(new Set(s)):s}const hI=dg(({parent:s})=>s&&!Ta(s)?s:null,Au),mI=lo(s=>{const e=[];for(;s.parent&&!Ta(s.parent);)e.push(s.parent),s=s.parent;return e},Su,s=>s.reverse()),gI=fg(({parent:s})=>s&&!Ta(s)?s:null,Su,s=>s.reverse());function pI(s){var e;const t=[];if(!s)return this._make(t);const i={xmlMode:this.options.xmlMode,root:(e=this._root)===null||e===void 0?void 0:e[0]},a=typeof s=="string"?u=>Zy(u,s,i):oo(s);return Tt(this,u=>{for(u&&!Ta(u)&&!De(u)&&(u=u.parent);u&&De(u);){if(a(u,0)){t.includes(u)||t.push(u);break}u=u.parent}}),this._make(t)}const bI=dg(s=>tg(s)),EI=lo(s=>{const e=[];for(;s.next;)s=s.next,De(s)&&e.push(s);return e},Au),xI=fg(s=>tg(s),Au),TI=dg(s=>sg(s)),yI=lo(s=>{const e=[];for(;s.prev;)s=s.prev,De(s)&&e.push(s);return e},Au),vI=fg(s=>sg(s),Au),SI=lo(s=>Dy(s).filter(e=>De(e)&&e!==s),Su),AI=lo(s=>qd(s).filter(De),Au);function _I(){const s=this.toArray().reduce((e,t)=>Dt(t)?e.concat(t.children):e,[]);return this._make(s)}function LI(s){let e=0;const t=this.length;for(;e<t&&s.call(this[e],e,this[e])!==!1;)++e;return this}function II(s){let e=[];for(let t=0;t<this.length;t++){const i=this[t],a=s.call(i,t,i);a!=null&&(e=e.concat(a))}return this._make(e)}function oo(s){return typeof s=="function"?(e,t)=>s.call(e,t,e):Ln(s)?e=>Array.prototype.includes.call(s,e):function(e){return s===e}}function RI(s){var e;return this._make(hg(this.toArray(),s,this.options.xmlMode,(e=this._root)===null||e===void 0?void 0:e[0]))}function hg(s,e,t,i){return typeof e=="string"?e2(e,s,{xmlMode:t,root:i}):s.filter(oo(e))}function NI(s){const e=this.toArray();return typeof s=="string"?Jy(e.filter(De),s,this.options):s?e.some(oo(s)):!1}function CI(s){let e=this.toArray();if(typeof s=="string"){const t=new Set(e2(s,e,this.options));e=e.filter(i=>!t.has(i))}else{const t=oo(s);e=e.filter((i,a)=>!t(i,a))}return this._make(e)}function DI(s){return this.filter(typeof s=="string"?`:has(${s})`:(e,t)=>this._make(t).find(s).length>0)}function OI(){return this.length>1?this._make(this[0]):this}function wI(){return this.length>0?this._make(this[this.length-1]):this}function kI(s){var e;return s=+s,s===0&&this.length<=1?this:(s<0&&(s=this.length+s),this._make((e=this[s])!==null&&e!==void 0?e:[]))}function MI(s){return s==null?this.toArray():this[s<0?this.length+s:s]}function PI(){return Array.prototype.slice.call(this)}function UI(s){let e,t;return s==null?(e=this.parent().children(),t=this[0]):typeof s=="string"?(e=this._make(s),t=this[0]):(e=this,t=Ln(s)?s[0]:s),Array.prototype.indexOf.call(e,t)}function BI(s,e){return this._make(Array.prototype.slice.call(this,s,e))}function FI(){var s;return(s=this.prevObject)!==null&&s!==void 0?s:this._make([])}function jI(s,e){const t=this._make(s,e),i=Su([...this.get(),...t.get()]);return this._make(i)}function HI(s){return this.prevObject?this.add(s?this.prevObject.filter(s):this.prevObject):this}const $I=Object.freeze(Object.defineProperty({__proto__:null,_findBySelector:fI,add:jI,addBack:HI,children:AI,closest:pI,contents:_I,each:LI,end:FI,eq:kI,filter:RI,filterArray:hg,find:dI,first:OI,get:MI,has:DI,index:UI,is:NI,last:wI,map:II,next:bI,nextAll:EI,nextUntil:xI,not:CI,parent:hI,parents:mI,parentsUntil:gI,prev:TI,prevAll:yI,prevUntil:vI,siblings:SI,slice:BI,toArray:PI},Symbol.toStringTag,{value:"Module"}));function GI(s){return function(t,i,a,u){if(typeof Buffer<"u"&&Buffer.isBuffer(t)&&(t=t.toString()),typeof t=="string")return s(t,i,a,u);const l=t;if(!Array.isArray(l)&&Ta(l))return l;const c=new sr([]);return ir(l,c),c}}function ir(s,e){const t=Array.isArray(s)?s:[s];e?e.children=t:e=null;for(let i=0;i<t.length;i++){const a=t[i];a.parent&&a.parent.children!==t&&rr(a),e?(a.prev=t[i-1]||null,a.next=t[i+1]||null):a.prev=a.next=null,a.parent=e}return e}function VI(s,e){if(s==null)return[];if(typeof s=="string")return this._parse(s,this.options,!1,null).children.slice(0);if("length"in s){if(s.length===1)return this._makeDomArray(s[0],e);const t=[];for(let i=0;i<s.length;i++){const a=s[i];if(typeof a=="object"){if(a==null)continue;if(!("length"in a)){t.push(e?ql(a,!0):a);continue}}t.push(...this._makeDomArray(a,e))}return t}return[e?ql(s,!0):s]}function n2(s){return function(...e){const t=this.length-1;return Tt(this,(i,a)=>{if(!Dt(i))return;const u=typeof e[0]=="function"?e[0].call(i,a,this._render(i.children)):e,l=this._makeDomArray(u,a<t);s(l,i.children,i)})}}function ya(s,e,t,i,a){var u,l;const c=[e,t,...i],f=e===0?null:s[e-1],h=e+t>=s.length?null:s[e+t];for(let m=0;m<i.length;++m){const g=i[m],E=g.parent;if(E){const v=E.children.indexOf(g);v!==-1&&(E.children.splice(v,1),a===E&&e>v&&c[0]--)}g.parent=a,g.prev&&(g.prev.next=(u=g.next)!==null&&u!==void 0?u:null),g.next&&(g.next.prev=(l=g.prev)!==null&&l!==void 0?l:null),g.prev=m===0?f:i[m-1],g.next=m===i.length-1?h:i[m+1]}return f&&(f.next=i[0]),h&&(h.prev=i[i.length-1]),s.splice(...c)}function qI(s){return(Ln(s)?s:this._make(s)).append(this),this}function YI(s){return(Ln(s)?s:this._make(s)).prepend(this),this}const KI=n2((s,e,t)=>{ya(e,e.length,0,s,t)}),zI=n2((s,e,t)=>{ya(e,0,0,s,t)});function a2(s){return function(e){const t=this.length-1,i=this.parents().last();for(let a=0;a<this.length;a++){const u=this[a],l=typeof e=="function"?e.call(u,a,u):typeof e=="string"&&!mm(e)?i.find(e).clone():e,[c]=this._makeDomArray(l,a<t);if(!c||!Dt(c))continue;let f=c,h=0;for(;h<f.children.length;){const m=f.children[h];De(m)?(f=m,h=0):h++}s(u,f,[c])}return this}}const QI=a2((s,e,t)=>{const{parent:i}=s;if(!i)return;const a=i.children,u=a.indexOf(s);ir([s],e),ya(a,u,0,t,i)}),XI=a2((s,e,t)=>{Dt(s)&&(ir(s.children,e),ir(t,s))});function WI(s){return this.parent(s).not("body").each((e,t)=>{this._make(t).replaceWith(t.children)}),this}function ZI(s){const e=this[0];if(e){const t=this._make(typeof s=="function"?s.call(e,0,e):s).insertBefore(e);let i;for(let u=0;u<t.length;u++)t[u].type===dm&&(i=t[u]);let a=0;for(;i&&a<i.children.length;){const u=i.children[a];u.type===dm?(i=u,a=0):a++}i&&this._make(i).append(this)}return this}function JI(...s){const e=this.length-1;return Tt(this,(t,i)=>{if(!Dt(t)||!t.parent)return;const a=t.parent.children,u=a.indexOf(t);if(u===-1)return;const l=typeof s[0]=="function"?s[0].call(t,i,this._render(t.children)):s,c=this._makeDomArray(l,i<e);ya(a,u+1,0,c,t.parent)})}function eR(s){typeof s=="string"&&(s=this._make(s)),this.remove();const e=[];for(const t of this._makeDomArray(s)){const i=this.clone().toArray(),{parent:a}=t;if(!a)continue;const u=a.children,l=u.indexOf(t);l!==-1&&(ya(u,l+1,0,i,a),e.push(...i))}return this._make(e)}function tR(...s){const e=this.length-1;return Tt(this,(t,i)=>{if(!Dt(t)||!t.parent)return;const a=t.parent.children,u=a.indexOf(t);if(u===-1)return;const l=typeof s[0]=="function"?s[0].call(t,i,this._render(t.children)):s,c=this._makeDomArray(l,i<e);ya(a,u,0,c,t.parent)})}function sR(s){const e=this._make(s);this.remove();const t=[];return Tt(e,i=>{const a=this.clone().toArray(),{parent:u}=i;if(!u)return;const l=u.children,c=l.indexOf(i);c!==-1&&(ya(l,c,0,a,u),t.push(...a))}),this._make(t)}function iR(s){const e=s?this.filter(s):this;return Tt(e,t=>{rr(t),t.prev=t.next=t.parent=null}),this}function nR(s){return Tt(this,(e,t)=>{const{parent:i}=e;if(!i)return;const a=i.children,u=typeof s=="function"?s.call(e,t,e):s,l=this._makeDomArray(u);ir(l,null);const c=a.indexOf(e);ya(a,c,1,l,i),l.includes(e)||(e.parent=e.prev=e.next=null)})}function aR(){return Tt(this,s=>{if(Dt(s)){for(const e of s.children)e.next=e.prev=e.parent=null;s.children.length=0}})}function rR(s){if(s===void 0){const e=this[0];return!e||!Dt(e)?null:this._render(e.children)}return Tt(this,e=>{if(!Dt(e))return;for(const i of e.children)i.next=i.prev=i.parent=null;const t=Ln(s)?s.toArray():this._parse(`${s}`,this.options,!1,e).children;ir(t,e)})}function uR(){return this._render(this)}function lR(s){return s===void 0?Yl(this):typeof s=="function"?Tt(this,(e,t)=>this._make(e).text(s.call(e,t,Yl([e])))):Tt(this,e=>{if(!Dt(e))return;for(const i of e.children)i.next=i.prev=i.parent=null;const t=new Vl(`${s}`);ir(t,e)})}function oR(){const s=Array.prototype.map.call(this.get(),t=>ql(t,!0)),e=new sr(s);for(const t of s)t.parent=e;return this._make(s)}const cR=Object.freeze(Object.defineProperty({__proto__:null,_makeDomArray:VI,after:JI,append:KI,appendTo:qI,before:tR,clone:oR,empty:aR,html:rR,insertAfter:eR,insertBefore:sR,prepend:zI,prependTo:YI,remove:iR,replaceWith:nR,text:lR,toString:uR,unwrap:WI,wrap:QI,wrapAll:ZI,wrapInner:XI},Symbol.toStringTag,{value:"Module"}));function dR(s,e){if(s!=null&&e!=null||typeof s=="object"&&!Array.isArray(s))return Tt(this,(t,i)=>{De(t)&&r2(t,s,e,i)});if(this.length!==0)return u2(this[0],s)}function r2(s,e,t,i){if(typeof e=="string"){const a=u2(s),u=typeof t=="function"?t.call(s,i,a[e]):t;u===""?delete a[e]:u!=null&&(a[e]=u),s.attribs.style=fR(a)}else if(typeof e=="object"){const a=Object.keys(e);for(let u=0;u<a.length;u++){const l=a[u];r2(s,l,e[l],u)}}}function u2(s,e){if(!s||!De(s))return;const t=hR(s.attribs.style);if(typeof e=="string")return t[e];if(Array.isArray(e)){const i={};for(const a of e)t[a]!=null&&(i[a]=t[a]);return i}return t}function fR(s){return Object.keys(s).reduce((e,t)=>`${e}${e?" ":""}${t}: ${s[t]};`,"")}function hR(s){if(s=(s||"").trim(),!s)return{};const e={};let t;for(const i of s.split(";")){const a=i.indexOf(":");if(a<1||a===i.length-1){const u=i.trimEnd();u.length>0&&t!==void 0&&(e[t]+=`;${u}`)}else t=i.slice(0,a).trim(),e[t]=i.slice(a+1).trim()}return e}const mR=Object.freeze(Object.defineProperty({__proto__:null,css:dR},Symbol.toStringTag,{value:"Module"})),yx="input,select,textarea,keygen",gR=/%20/g,vx=/\r?\n/g;function pR(){return this.serializeArray().map(t=>`${encodeURIComponent(t.name)}=${encodeURIComponent(t.value)}`).join("&").replace(gR,"+")}function bR(){return this.map((s,e)=>{const t=this._make(e);return De(e)&&e.name==="form"?t.find(yx).toArray():t.filter(yx).toArray()}).filter('[name!=""]:enabled:not(:submit, :button, :image, :reset, :file):matches([checked], :not(:checkbox, :radio))').map((s,e)=>{var t;const i=this._make(e),a=i.attr("name"),u=(t=i.val())!==null&&t!==void 0?t:"";return Array.isArray(u)?u.map(l=>({name:a,value:l.replace(vx,`\r
`)})):{name:a,value:u.replace(vx,`\r
`)}}).toArray()}const ER=Object.freeze(Object.defineProperty({__proto__:null,serialize:pR,serializeArray:bR},Symbol.toStringTag,{value:"Module"}));function xR(s){var e;return typeof s=="string"?{selector:s,value:"textContent"}:{selector:s.selector,value:(e=s.value)!==null&&e!==void 0?e:"textContent"}}function TR(s){const e={};for(const t in s){const i=s[t],a=Array.isArray(i),{selector:u,value:l}=xR(a?i[0]:i),c=typeof l=="function"?l:typeof l=="string"?f=>this._make(f).prop(l):f=>this._make(f).extract(l);if(a)e[t]=this._findBySelector(u,Number.POSITIVE_INFINITY).map((f,h)=>c(h,t,e)).get();else{const f=this._findBySelector(u,1);e[t]=f.length>0?c(f[0],t,e):void 0}}return e}const yR=Object.freeze(Object.defineProperty({__proto__:null,extract:TR},Symbol.toStringTag,{value:"Module"}));class co{constructor(e,t,i){if(this.length=0,this.options=i,this._root=t,e){for(let a=0;a<e.length;a++)this[a]=e[a];this.length=e.length}}}co.prototype.cheerio="[cheerio object]";co.prototype.splice=Array.prototype.splice;co.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator];Object.assign(co.prototype,IL,$I,cR,mR,ER,yR);function vR(s,e){return function t(i,a,u=!0){if(i==null)throw new Error("cheerio.load() expects a string");const l=hm(a),c=s(i,l,u,null);class f extends co{_make(g,E){const T=h(g,E);return T.prevObject=this,T}_parse(g,E,T,v){return s(g,E,T,v)}_render(g){return e(g,this.options)}}function h(m,g,E=c,T){if(m&&Ln(m))return m;const v=hm(T,l),S=typeof E=="string"?[s(E,v,!1,null)]:"length"in E?E:[E],A=Ln(S)?S:new f(S,null,v);if(A._root=A,!m)return new f(void 0,A,v);const I=typeof m=="string"&&mm(m)?s(m,v,!1,null).children:SR(m)?[m]:Array.isArray(m)?m:void 0,R=new f(I,A,v);if(I)return R;if(typeof m!="string")throw new TypeError("Unexpected type of selector");let N=m;const D=g?typeof g=="string"?mm(g)?new f([s(g,v,!1,null)],A,v):(N=`${g} ${N}`,A):Ln(g)?g:new f(Array.isArray(g)?g:[g],A,v):A;return D?D.find(N):R}return Object.assign(h,Z6,{load:t,_root:c,_options:l,fn:f.prototype,prototype:f.prototype}),h}}function SR(s){return!!s.name||s.type===Qm||s.type===Sy||s.type===Ay}const AR=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),bt="";var O;(function(s){s[s.EOF=-1]="EOF",s[s.NULL=0]="NULL",s[s.TABULATION=9]="TABULATION",s[s.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",s[s.LINE_FEED=10]="LINE_FEED",s[s.FORM_FEED=12]="FORM_FEED",s[s.SPACE=32]="SPACE",s[s.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",s[s.QUOTATION_MARK=34]="QUOTATION_MARK",s[s.AMPERSAND=38]="AMPERSAND",s[s.APOSTROPHE=39]="APOSTROPHE",s[s.HYPHEN_MINUS=45]="HYPHEN_MINUS",s[s.SOLIDUS=47]="SOLIDUS",s[s.DIGIT_0=48]="DIGIT_0",s[s.DIGIT_9=57]="DIGIT_9",s[s.SEMICOLON=59]="SEMICOLON",s[s.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",s[s.EQUALS_SIGN=61]="EQUALS_SIGN",s[s.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",s[s.QUESTION_MARK=63]="QUESTION_MARK",s[s.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",s[s.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",s[s.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",s[s.GRAVE_ACCENT=96]="GRAVE_ACCENT",s[s.LATIN_SMALL_A=97]="LATIN_SMALL_A",s[s.LATIN_SMALL_Z=122]="LATIN_SMALL_Z"})(O||(O={}));const ws={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function l2(s){return s>=55296&&s<=57343}function _R(s){return s>=56320&&s<=57343}function LR(s,e){return(s-55296)*1024+9216+e}function o2(s){return s!==32&&s!==10&&s!==13&&s!==9&&s!==12&&s>=1&&s<=31||s>=127&&s<=159}function c2(s){return s>=64976&&s<=65007||AR.has(s)}var se;(function(s){s.controlCharacterInInputStream="control-character-in-input-stream",s.noncharacterInInputStream="noncharacter-in-input-stream",s.surrogateInInputStream="surrogate-in-input-stream",s.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",s.endTagWithAttributes="end-tag-with-attributes",s.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",s.unexpectedSolidusInTag="unexpected-solidus-in-tag",s.unexpectedNullCharacter="unexpected-null-character",s.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",s.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",s.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",s.missingEndTagName="missing-end-tag-name",s.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",s.unknownNamedCharacterReference="unknown-named-character-reference",s.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",s.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",s.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",s.eofBeforeTagName="eof-before-tag-name",s.eofInTag="eof-in-tag",s.missingAttributeValue="missing-attribute-value",s.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",s.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",s.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",s.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",s.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",s.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",s.missingDoctypePublicIdentifier="missing-doctype-public-identifier",s.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",s.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",s.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",s.cdataInHtmlContent="cdata-in-html-content",s.incorrectlyOpenedComment="incorrectly-opened-comment",s.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",s.eofInDoctype="eof-in-doctype",s.nestedComment="nested-comment",s.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",s.eofInComment="eof-in-comment",s.incorrectlyClosedComment="incorrectly-closed-comment",s.eofInCdata="eof-in-cdata",s.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",s.nullCharacterReference="null-character-reference",s.surrogateCharacterReference="surrogate-character-reference",s.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",s.controlCharacterReference="control-character-reference",s.noncharacterCharacterReference="noncharacter-character-reference",s.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",s.missingDoctypeName="missing-doctype-name",s.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",s.duplicateAttribute="duplicate-attribute",s.nonConformingDoctype="non-conforming-doctype",s.missingDoctype="missing-doctype",s.misplacedDoctype="misplaced-doctype",s.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",s.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",s.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",s.openElementsLeftAfterEof="open-elements-left-after-eof",s.abandonedHeadElementChild="abandoned-head-element-child",s.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",s.nestedNoscriptInHead="nested-noscript-in-head",s.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})(se||(se={}));const IR=65536;class RR{constructor(e){this.handler=e,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=IR,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+ +(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(e,t){const{line:i,col:a,offset:u}=this,l=a+t,c=u+t;return{code:e,startLine:i,endLine:i,startCol:l,endCol:l,startOffset:c,endOffset:c}}_err(e){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(e,0)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(e){if(this.pos!==this.html.length-1){const t=this.html.charCodeAt(this.pos+1);if(_R(t))return this.pos++,this._addGap(),LR(e,t)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,O.EOF;return this._err(se.surrogateInInputStream),e}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(e,t){this.html.length>0?this.html+=e:this.html=e,this.endOfChunkHit=!1,this.lastChunkWritten=t}insertHtmlAtCurrentPos(e){this.html=this.html.substring(0,this.pos+1)+e+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(e,t){if(this.pos+e.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(t)return this.html.startsWith(e,this.pos);for(let i=0;i<e.length;i++)if((this.html.charCodeAt(this.pos+i)|32)!==e.charCodeAt(i))return!1;return!0}peek(e){const t=this.pos+e;if(t>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,O.EOF;const i=this.html.charCodeAt(t);return i===O.CARRIAGE_RETURN?O.LINE_FEED:i}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,O.EOF;let e=this.html.charCodeAt(this.pos);return e===O.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,O.LINE_FEED):e===O.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,l2(e)&&(e=this._processSurrogate(e)),this.handler.onParseError===null||e>31&&e<127||e===O.LINE_FEED||e===O.CARRIAGE_RETURN||e>159&&e<64976||this._checkForProblematicCharacters(e),e)}_checkForProblematicCharacters(e){o2(e)?this._err(se.controlCharacterInInputStream):c2(e)&&this._err(se.noncharacterInInputStream)}retreat(e){for(this.pos-=e;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var Xe;(function(s){s[s.CHARACTER=0]="CHARACTER",s[s.NULL_CHARACTER=1]="NULL_CHARACTER",s[s.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",s[s.START_TAG=3]="START_TAG",s[s.END_TAG=4]="END_TAG",s[s.COMMENT=5]="COMMENT",s[s.DOCTYPE=6]="DOCTYPE",s[s.EOF=7]="EOF",s[s.HIBERNATION=8]="HIBERNATION"})(Xe||(Xe={}));function d2(s,e){for(let t=s.attrs.length-1;t>=0;t--)if(s.attrs[t].name===e)return s.attrs[t].value;return null}const NR=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(s=>s.charCodeAt(0))),CR=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);function DR(s){var e;return s>=55296&&s<=57343||s>1114111?65533:(e=CR.get(s))!==null&&e!==void 0?e:s}var ns;(function(s){s[s.NUM=35]="NUM",s[s.SEMI=59]="SEMI",s[s.EQUALS=61]="EQUALS",s[s.ZERO=48]="ZERO",s[s.NINE=57]="NINE",s[s.LOWER_A=97]="LOWER_A",s[s.LOWER_F=102]="LOWER_F",s[s.LOWER_X=120]="LOWER_X",s[s.LOWER_Z=122]="LOWER_Z",s[s.UPPER_A=65]="UPPER_A",s[s.UPPER_F=70]="UPPER_F",s[s.UPPER_Z=90]="UPPER_Z"})(ns||(ns={}));const OR=32;var ga;(function(s){s[s.VALUE_LENGTH=49152]="VALUE_LENGTH",s[s.BRANCH_LENGTH=16256]="BRANCH_LENGTH",s[s.JUMP_TABLE=127]="JUMP_TABLE"})(ga||(ga={}));function ym(s){return s>=ns.ZERO&&s<=ns.NINE}function wR(s){return s>=ns.UPPER_A&&s<=ns.UPPER_F||s>=ns.LOWER_A&&s<=ns.LOWER_F}function kR(s){return s>=ns.UPPER_A&&s<=ns.UPPER_Z||s>=ns.LOWER_A&&s<=ns.LOWER_Z||ym(s)}function MR(s){return s===ns.EQUALS||kR(s)}var ts;(function(s){s[s.EntityStart=0]="EntityStart",s[s.NumericStart=1]="NumericStart",s[s.NumericDecimal=2]="NumericDecimal",s[s.NumericHex=3]="NumericHex",s[s.NamedEntity=4]="NamedEntity"})(ts||(ts={}));var An;(function(s){s[s.Legacy=0]="Legacy",s[s.Strict=1]="Strict",s[s.Attribute=2]="Attribute"})(An||(An={}));class PR{constructor(e,t,i){this.decodeTree=e,this.emitCodePoint=t,this.errors=i,this.state=ts.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=An.Strict}startEntity(e){this.decodeMode=e,this.state=ts.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,t){switch(this.state){case ts.EntityStart:return e.charCodeAt(t)===ns.NUM?(this.state=ts.NumericStart,this.consumed+=1,this.stateNumericStart(e,t+1)):(this.state=ts.NamedEntity,this.stateNamedEntity(e,t));case ts.NumericStart:return this.stateNumericStart(e,t);case ts.NumericDecimal:return this.stateNumericDecimal(e,t);case ts.NumericHex:return this.stateNumericHex(e,t);case ts.NamedEntity:return this.stateNamedEntity(e,t)}}stateNumericStart(e,t){return t>=e.length?-1:(e.charCodeAt(t)|OR)===ns.LOWER_X?(this.state=ts.NumericHex,this.consumed+=1,this.stateNumericHex(e,t+1)):(this.state=ts.NumericDecimal,this.stateNumericDecimal(e,t))}addToNumericResult(e,t,i,a){if(t!==i){const u=i-t;this.result=this.result*Math.pow(a,u)+Number.parseInt(e.substr(t,u),a),this.consumed+=u}}stateNumericHex(e,t){const i=t;for(;t<e.length;){const a=e.charCodeAt(t);if(ym(a)||wR(a))t+=1;else return this.addToNumericResult(e,i,t,16),this.emitNumericEntity(a,3)}return this.addToNumericResult(e,i,t,16),-1}stateNumericDecimal(e,t){const i=t;for(;t<e.length;){const a=e.charCodeAt(t);if(ym(a))t+=1;else return this.addToNumericResult(e,i,t,10),this.emitNumericEntity(a,2)}return this.addToNumericResult(e,i,t,10),-1}emitNumericEntity(e,t){var i;if(this.consumed<=t)return(i=this.errors)===null||i===void 0||i.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===ns.SEMI)this.consumed+=1;else if(this.decodeMode===An.Strict)return 0;return this.emitCodePoint(DR(this.result),this.consumed),this.errors&&(e!==ns.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,t){const{decodeTree:i}=this;let a=i[this.treeIndex],u=(a&ga.VALUE_LENGTH)>>14;for(;t<e.length;t++,this.excess++){const l=e.charCodeAt(t);if(this.treeIndex=UR(i,a,this.treeIndex+Math.max(1,u),l),this.treeIndex<0)return this.result===0||this.decodeMode===An.Attribute&&(u===0||MR(l))?0:this.emitNotTerminatedNamedEntity();if(a=i[this.treeIndex],u=(a&ga.VALUE_LENGTH)>>14,u!==0){if(l===ns.SEMI)return this.emitNamedEntityData(this.treeIndex,u,this.consumed+this.excess);this.decodeMode!==An.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:t,decodeTree:i}=this,a=(i[t]&ga.VALUE_LENGTH)>>14;return this.emitNamedEntityData(t,a,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,t,i){const{decodeTree:a}=this;return this.emitCodePoint(t===1?a[e]&~ga.VALUE_LENGTH:a[e+1],i),t===3&&this.emitCodePoint(a[e+2],i),i}end(){var e;switch(this.state){case ts.NamedEntity:return this.result!==0&&(this.decodeMode!==An.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case ts.NumericDecimal:return this.emitNumericEntity(0,2);case ts.NumericHex:return this.emitNumericEntity(0,3);case ts.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case ts.EntityStart:return 0}}}function UR(s,e,t,i){const a=(e&ga.BRANCH_LENGTH)>>7,u=e&ga.JUMP_TABLE;if(a===0)return u!==0&&i===u?t:-1;if(u){const f=i-u;return f<0||f>=a?-1:s[t+f]-1}let l=t,c=l+a-1;for(;l<=c;){const f=l+c>>>1,h=s[f];if(h<i)l=f+1;else if(h>i)c=f-1;else return s[f+a]}return-1}var de;(function(s){s.HTML="http://www.w3.org/1999/xhtml",s.MATHML="http://www.w3.org/1998/Math/MathML",s.SVG="http://www.w3.org/2000/svg",s.XLINK="http://www.w3.org/1999/xlink",s.XML="http://www.w3.org/XML/1998/namespace",s.XMLNS="http://www.w3.org/2000/xmlns/"})(de||(de={}));var Ja;(function(s){s.TYPE="type",s.ACTION="action",s.ENCODING="encoding",s.PROMPT="prompt",s.NAME="name",s.COLOR="color",s.FACE="face",s.SIZE="size"})(Ja||(Ja={}));var Ws;(function(s){s.NO_QUIRKS="no-quirks",s.QUIRKS="quirks",s.LIMITED_QUIRKS="limited-quirks"})(Ws||(Ws={}));var K;(function(s){s.A="a",s.ADDRESS="address",s.ANNOTATION_XML="annotation-xml",s.APPLET="applet",s.AREA="area",s.ARTICLE="article",s.ASIDE="aside",s.B="b",s.BASE="base",s.BASEFONT="basefont",s.BGSOUND="bgsound",s.BIG="big",s.BLOCKQUOTE="blockquote",s.BODY="body",s.BR="br",s.BUTTON="button",s.CAPTION="caption",s.CENTER="center",s.CODE="code",s.COL="col",s.COLGROUP="colgroup",s.DD="dd",s.DESC="desc",s.DETAILS="details",s.DIALOG="dialog",s.DIR="dir",s.DIV="div",s.DL="dl",s.DT="dt",s.EM="em",s.EMBED="embed",s.FIELDSET="fieldset",s.FIGCAPTION="figcaption",s.FIGURE="figure",s.FONT="font",s.FOOTER="footer",s.FOREIGN_OBJECT="foreignObject",s.FORM="form",s.FRAME="frame",s.FRAMESET="frameset",s.H1="h1",s.H2="h2",s.H3="h3",s.H4="h4",s.H5="h5",s.H6="h6",s.HEAD="head",s.HEADER="header",s.HGROUP="hgroup",s.HR="hr",s.HTML="html",s.I="i",s.IMG="img",s.IMAGE="image",s.INPUT="input",s.IFRAME="iframe",s.KEYGEN="keygen",s.LABEL="label",s.LI="li",s.LINK="link",s.LISTING="listing",s.MAIN="main",s.MALIGNMARK="malignmark",s.MARQUEE="marquee",s.MATH="math",s.MENU="menu",s.META="meta",s.MGLYPH="mglyph",s.MI="mi",s.MO="mo",s.MN="mn",s.MS="ms",s.MTEXT="mtext",s.NAV="nav",s.NOBR="nobr",s.NOFRAMES="noframes",s.NOEMBED="noembed",s.NOSCRIPT="noscript",s.OBJECT="object",s.OL="ol",s.OPTGROUP="optgroup",s.OPTION="option",s.P="p",s.PARAM="param",s.PLAINTEXT="plaintext",s.PRE="pre",s.RB="rb",s.RP="rp",s.RT="rt",s.RTC="rtc",s.RUBY="ruby",s.S="s",s.SCRIPT="script",s.SEARCH="search",s.SECTION="section",s.SELECT="select",s.SOURCE="source",s.SMALL="small",s.SPAN="span",s.STRIKE="strike",s.STRONG="strong",s.STYLE="style",s.SUB="sub",s.SUMMARY="summary",s.SUP="sup",s.TABLE="table",s.TBODY="tbody",s.TEMPLATE="template",s.TEXTAREA="textarea",s.TFOOT="tfoot",s.TD="td",s.TH="th",s.THEAD="thead",s.TITLE="title",s.TR="tr",s.TRACK="track",s.TT="tt",s.U="u",s.UL="ul",s.SVG="svg",s.VAR="var",s.WBR="wbr",s.XMP="xmp"})(K||(K={}));var y;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.A=1]="A",s[s.ADDRESS=2]="ADDRESS",s[s.ANNOTATION_XML=3]="ANNOTATION_XML",s[s.APPLET=4]="APPLET",s[s.AREA=5]="AREA",s[s.ARTICLE=6]="ARTICLE",s[s.ASIDE=7]="ASIDE",s[s.B=8]="B",s[s.BASE=9]="BASE",s[s.BASEFONT=10]="BASEFONT",s[s.BGSOUND=11]="BGSOUND",s[s.BIG=12]="BIG",s[s.BLOCKQUOTE=13]="BLOCKQUOTE",s[s.BODY=14]="BODY",s[s.BR=15]="BR",s[s.BUTTON=16]="BUTTON",s[s.CAPTION=17]="CAPTION",s[s.CENTER=18]="CENTER",s[s.CODE=19]="CODE",s[s.COL=20]="COL",s[s.COLGROUP=21]="COLGROUP",s[s.DD=22]="DD",s[s.DESC=23]="DESC",s[s.DETAILS=24]="DETAILS",s[s.DIALOG=25]="DIALOG",s[s.DIR=26]="DIR",s[s.DIV=27]="DIV",s[s.DL=28]="DL",s[s.DT=29]="DT",s[s.EM=30]="EM",s[s.EMBED=31]="EMBED",s[s.FIELDSET=32]="FIELDSET",s[s.FIGCAPTION=33]="FIGCAPTION",s[s.FIGURE=34]="FIGURE",s[s.FONT=35]="FONT",s[s.FOOTER=36]="FOOTER",s[s.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",s[s.FORM=38]="FORM",s[s.FRAME=39]="FRAME",s[s.FRAMESET=40]="FRAMESET",s[s.H1=41]="H1",s[s.H2=42]="H2",s[s.H3=43]="H3",s[s.H4=44]="H4",s[s.H5=45]="H5",s[s.H6=46]="H6",s[s.HEAD=47]="HEAD",s[s.HEADER=48]="HEADER",s[s.HGROUP=49]="HGROUP",s[s.HR=50]="HR",s[s.HTML=51]="HTML",s[s.I=52]="I",s[s.IMG=53]="IMG",s[s.IMAGE=54]="IMAGE",s[s.INPUT=55]="INPUT",s[s.IFRAME=56]="IFRAME",s[s.KEYGEN=57]="KEYGEN",s[s.LABEL=58]="LABEL",s[s.LI=59]="LI",s[s.LINK=60]="LINK",s[s.LISTING=61]="LISTING",s[s.MAIN=62]="MAIN",s[s.MALIGNMARK=63]="MALIGNMARK",s[s.MARQUEE=64]="MARQUEE",s[s.MATH=65]="MATH",s[s.MENU=66]="MENU",s[s.META=67]="META",s[s.MGLYPH=68]="MGLYPH",s[s.MI=69]="MI",s[s.MO=70]="MO",s[s.MN=71]="MN",s[s.MS=72]="MS",s[s.MTEXT=73]="MTEXT",s[s.NAV=74]="NAV",s[s.NOBR=75]="NOBR",s[s.NOFRAMES=76]="NOFRAMES",s[s.NOEMBED=77]="NOEMBED",s[s.NOSCRIPT=78]="NOSCRIPT",s[s.OBJECT=79]="OBJECT",s[s.OL=80]="OL",s[s.OPTGROUP=81]="OPTGROUP",s[s.OPTION=82]="OPTION",s[s.P=83]="P",s[s.PARAM=84]="PARAM",s[s.PLAINTEXT=85]="PLAINTEXT",s[s.PRE=86]="PRE",s[s.RB=87]="RB",s[s.RP=88]="RP",s[s.RT=89]="RT",s[s.RTC=90]="RTC",s[s.RUBY=91]="RUBY",s[s.S=92]="S",s[s.SCRIPT=93]="SCRIPT",s[s.SEARCH=94]="SEARCH",s[s.SECTION=95]="SECTION",s[s.SELECT=96]="SELECT",s[s.SOURCE=97]="SOURCE",s[s.SMALL=98]="SMALL",s[s.SPAN=99]="SPAN",s[s.STRIKE=100]="STRIKE",s[s.STRONG=101]="STRONG",s[s.STYLE=102]="STYLE",s[s.SUB=103]="SUB",s[s.SUMMARY=104]="SUMMARY",s[s.SUP=105]="SUP",s[s.TABLE=106]="TABLE",s[s.TBODY=107]="TBODY",s[s.TEMPLATE=108]="TEMPLATE",s[s.TEXTAREA=109]="TEXTAREA",s[s.TFOOT=110]="TFOOT",s[s.TD=111]="TD",s[s.TH=112]="TH",s[s.THEAD=113]="THEAD",s[s.TITLE=114]="TITLE",s[s.TR=115]="TR",s[s.TRACK=116]="TRACK",s[s.TT=117]="TT",s[s.U=118]="U",s[s.UL=119]="UL",s[s.SVG=120]="SVG",s[s.VAR=121]="VAR",s[s.WBR=122]="WBR",s[s.XMP=123]="XMP"})(y||(y={}));const BR=new Map([[K.A,y.A],[K.ADDRESS,y.ADDRESS],[K.ANNOTATION_XML,y.ANNOTATION_XML],[K.APPLET,y.APPLET],[K.AREA,y.AREA],[K.ARTICLE,y.ARTICLE],[K.ASIDE,y.ASIDE],[K.B,y.B],[K.BASE,y.BASE],[K.BASEFONT,y.BASEFONT],[K.BGSOUND,y.BGSOUND],[K.BIG,y.BIG],[K.BLOCKQUOTE,y.BLOCKQUOTE],[K.BODY,y.BODY],[K.BR,y.BR],[K.BUTTON,y.BUTTON],[K.CAPTION,y.CAPTION],[K.CENTER,y.CENTER],[K.CODE,y.CODE],[K.COL,y.COL],[K.COLGROUP,y.COLGROUP],[K.DD,y.DD],[K.DESC,y.DESC],[K.DETAILS,y.DETAILS],[K.DIALOG,y.DIALOG],[K.DIR,y.DIR],[K.DIV,y.DIV],[K.DL,y.DL],[K.DT,y.DT],[K.EM,y.EM],[K.EMBED,y.EMBED],[K.FIELDSET,y.FIELDSET],[K.FIGCAPTION,y.FIGCAPTION],[K.FIGURE,y.FIGURE],[K.FONT,y.FONT],[K.FOOTER,y.FOOTER],[K.FOREIGN_OBJECT,y.FOREIGN_OBJECT],[K.FORM,y.FORM],[K.FRAME,y.FRAME],[K.FRAMESET,y.FRAMESET],[K.H1,y.H1],[K.H2,y.H2],[K.H3,y.H3],[K.H4,y.H4],[K.H5,y.H5],[K.H6,y.H6],[K.HEAD,y.HEAD],[K.HEADER,y.HEADER],[K.HGROUP,y.HGROUP],[K.HR,y.HR],[K.HTML,y.HTML],[K.I,y.I],[K.IMG,y.IMG],[K.IMAGE,y.IMAGE],[K.INPUT,y.INPUT],[K.IFRAME,y.IFRAME],[K.KEYGEN,y.KEYGEN],[K.LABEL,y.LABEL],[K.LI,y.LI],[K.LINK,y.LINK],[K.LISTING,y.LISTING],[K.MAIN,y.MAIN],[K.MALIGNMARK,y.MALIGNMARK],[K.MARQUEE,y.MARQUEE],[K.MATH,y.MATH],[K.MENU,y.MENU],[K.META,y.META],[K.MGLYPH,y.MGLYPH],[K.MI,y.MI],[K.MO,y.MO],[K.MN,y.MN],[K.MS,y.MS],[K.MTEXT,y.MTEXT],[K.NAV,y.NAV],[K.NOBR,y.NOBR],[K.NOFRAMES,y.NOFRAMES],[K.NOEMBED,y.NOEMBED],[K.NOSCRIPT,y.NOSCRIPT],[K.OBJECT,y.OBJECT],[K.OL,y.OL],[K.OPTGROUP,y.OPTGROUP],[K.OPTION,y.OPTION],[K.P,y.P],[K.PARAM,y.PARAM],[K.PLAINTEXT,y.PLAINTEXT],[K.PRE,y.PRE],[K.RB,y.RB],[K.RP,y.RP],[K.RT,y.RT],[K.RTC,y.RTC],[K.RUBY,y.RUBY],[K.S,y.S],[K.SCRIPT,y.SCRIPT],[K.SEARCH,y.SEARCH],[K.SECTION,y.SECTION],[K.SELECT,y.SELECT],[K.SOURCE,y.SOURCE],[K.SMALL,y.SMALL],[K.SPAN,y.SPAN],[K.STRIKE,y.STRIKE],[K.STRONG,y.STRONG],[K.STYLE,y.STYLE],[K.SUB,y.SUB],[K.SUMMARY,y.SUMMARY],[K.SUP,y.SUP],[K.TABLE,y.TABLE],[K.TBODY,y.TBODY],[K.TEMPLATE,y.TEMPLATE],[K.TEXTAREA,y.TEXTAREA],[K.TFOOT,y.TFOOT],[K.TD,y.TD],[K.TH,y.TH],[K.THEAD,y.THEAD],[K.TITLE,y.TITLE],[K.TR,y.TR],[K.TRACK,y.TRACK],[K.TT,y.TT],[K.U,y.U],[K.UL,y.UL],[K.SVG,y.SVG],[K.VAR,y.VAR],[K.WBR,y.WBR],[K.XMP,y.XMP]]);function zd(s){var e;return(e=BR.get(s))!==null&&e!==void 0?e:y.UNKNOWN}const ge=y,FR={[de.HTML]:new Set([ge.ADDRESS,ge.APPLET,ge.AREA,ge.ARTICLE,ge.ASIDE,ge.BASE,ge.BASEFONT,ge.BGSOUND,ge.BLOCKQUOTE,ge.BODY,ge.BR,ge.BUTTON,ge.CAPTION,ge.CENTER,ge.COL,ge.COLGROUP,ge.DD,ge.DETAILS,ge.DIR,ge.DIV,ge.DL,ge.DT,ge.EMBED,ge.FIELDSET,ge.FIGCAPTION,ge.FIGURE,ge.FOOTER,ge.FORM,ge.FRAME,ge.FRAMESET,ge.H1,ge.H2,ge.H3,ge.H4,ge.H5,ge.H6,ge.HEAD,ge.HEADER,ge.HGROUP,ge.HR,ge.HTML,ge.IFRAME,ge.IMG,ge.INPUT,ge.LI,ge.LINK,ge.LISTING,ge.MAIN,ge.MARQUEE,ge.MENU,ge.META,ge.NAV,ge.NOEMBED,ge.NOFRAMES,ge.NOSCRIPT,ge.OBJECT,ge.OL,ge.P,ge.PARAM,ge.PLAINTEXT,ge.PRE,ge.SCRIPT,ge.SECTION,ge.SELECT,ge.SOURCE,ge.STYLE,ge.SUMMARY,ge.TABLE,ge.TBODY,ge.TD,ge.TEMPLATE,ge.TEXTAREA,ge.TFOOT,ge.TH,ge.THEAD,ge.TITLE,ge.TR,ge.TRACK,ge.UL,ge.WBR,ge.XMP]),[de.MATHML]:new Set([ge.MI,ge.MO,ge.MN,ge.MS,ge.MTEXT,ge.ANNOTATION_XML]),[de.SVG]:new Set([ge.TITLE,ge.FOREIGN_OBJECT,ge.DESC]),[de.XLINK]:new Set,[de.XML]:new Set,[de.XMLNS]:new Set},vm=new Set([ge.H1,ge.H2,ge.H3,ge.H4,ge.H5,ge.H6]),jR=new Set([K.STYLE,K.SCRIPT,K.XMP,K.IFRAME,K.NOEMBED,K.NOFRAMES,K.PLAINTEXT]);function HR(s,e){return jR.has(s)||e&&s===K.NOSCRIPT}var w;(function(s){s[s.DATA=0]="DATA",s[s.RCDATA=1]="RCDATA",s[s.RAWTEXT=2]="RAWTEXT",s[s.SCRIPT_DATA=3]="SCRIPT_DATA",s[s.PLAINTEXT=4]="PLAINTEXT",s[s.TAG_OPEN=5]="TAG_OPEN",s[s.END_TAG_OPEN=6]="END_TAG_OPEN",s[s.TAG_NAME=7]="TAG_NAME",s[s.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",s[s.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",s[s.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",s[s.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",s[s.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",s[s.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",s[s.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",s[s.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",s[s.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",s[s.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",s[s.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",s[s.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",s[s.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",s[s.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",s[s.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",s[s.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",s[s.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",s[s.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",s[s.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",s[s.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",s[s.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",s[s.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",s[s.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",s[s.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",s[s.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",s[s.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",s[s.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",s[s.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",s[s.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",s[s.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",s[s.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",s[s.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",s[s.BOGUS_COMMENT=40]="BOGUS_COMMENT",s[s.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",s[s.COMMENT_START=42]="COMMENT_START",s[s.COMMENT_START_DASH=43]="COMMENT_START_DASH",s[s.COMMENT=44]="COMMENT",s[s.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",s[s.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",s[s.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",s[s.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",s[s.COMMENT_END_DASH=49]="COMMENT_END_DASH",s[s.COMMENT_END=50]="COMMENT_END",s[s.COMMENT_END_BANG=51]="COMMENT_END_BANG",s[s.DOCTYPE=52]="DOCTYPE",s[s.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",s[s.DOCTYPE_NAME=54]="DOCTYPE_NAME",s[s.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",s[s.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",s[s.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",s[s.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",s[s.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",s[s.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",s[s.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",s[s.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",s[s.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",s[s.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",s[s.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",s[s.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",s[s.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",s[s.CDATA_SECTION=68]="CDATA_SECTION",s[s.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",s[s.CDATA_SECTION_END=70]="CDATA_SECTION_END",s[s.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",s[s.AMBIGUOUS_AMPERSAND=72]="AMBIGUOUS_AMPERSAND"})(w||(w={}));const Us={DATA:w.DATA,RCDATA:w.RCDATA,RAWTEXT:w.RAWTEXT,SCRIPT_DATA:w.SCRIPT_DATA,PLAINTEXT:w.PLAINTEXT,CDATA_SECTION:w.CDATA_SECTION};function $R(s){return s>=O.DIGIT_0&&s<=O.DIGIT_9}function Ll(s){return s>=O.LATIN_CAPITAL_A&&s<=O.LATIN_CAPITAL_Z}function GR(s){return s>=O.LATIN_SMALL_A&&s<=O.LATIN_SMALL_Z}function ia(s){return GR(s)||Ll(s)}function Sx(s){return ia(s)||$R(s)}function Fc(s){return s+32}function f2(s){return s===O.SPACE||s===O.LINE_FEED||s===O.TABULATION||s===O.FORM_FEED}function Ax(s){return f2(s)||s===O.SOLIDUS||s===O.GREATER_THAN_SIGN}function VR(s){return s===O.NULL?se.nullCharacterReference:s>1114111?se.characterReferenceOutsideUnicodeRange:l2(s)?se.surrogateCharacterReference:c2(s)?se.noncharacterCharacterReference:o2(s)||s===O.CARRIAGE_RETURN?se.controlCharacterReference:null}class qR{constructor(e,t){this.options=e,this.handler=t,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=w.DATA,this.returnState=w.DATA,this.entityStartPos=0,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new RR(t),this.currentLocation=this.getCurrentLocation(-1),this.entityDecoder=new PR(NR,(i,a)=>{this.preprocessor.pos=this.entityStartPos+a-1,this._flushCodePointConsumedAsCharacterReference(i)},t.onParseError?{missingSemicolonAfterCharacterReference:()=>{this._err(se.missingSemicolonAfterCharacterReference,1)},absenceOfDigitsInNumericCharacterReference:i=>{this._err(se.absenceOfDigitsInNumericCharacterReference,this.entityStartPos-this.preprocessor.pos+i)},validateNumericCharacterReference:i=>{const a=VR(i);a&&this._err(a,1)}}:void 0)}_err(e,t=0){var i,a;(a=(i=this.handler).onParseError)===null||a===void 0||a.call(i,this.preprocessor.getError(e,t))}getCurrentLocation(e){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-e,startOffset:this.preprocessor.offset-e,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const e=this._consume();this._ensureHibernation()||this._callState(e)}this.inLoop=!1}}pause(){this.paused=!0}resume(e){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||e==null||e())}write(e,t,i){this.active=!0,this.preprocessor.write(e,t),this._runParsingLoop(),this.paused||i==null||i()}insertHtmlAtCurrentPos(e){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(e),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this.preprocessor.retreat(this.consumedAfterSnapshot),this.consumedAfterSnapshot=0,this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_advanceBy(e){this.consumedAfterSnapshot+=e;for(let t=0;t<e;t++)this.preprocessor.advance()}_consumeSequenceIfMatch(e,t){return this.preprocessor.startsWith(e,t)?(this._advanceBy(e.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:Xe.START_TAG,tagName:"",tagID:y.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:Xe.END_TAG,tagName:"",tagID:y.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(e){this.currentToken={type:Xe.COMMENT,data:"",location:this.getCurrentLocation(e)}}_createDoctypeToken(e){this.currentToken={type:Xe.DOCTYPE,name:e,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(e,t){this.currentCharacterToken={type:e,chars:t,location:this.currentLocation}}_createAttr(e){this.currentAttr={name:e,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var e,t;const i=this.currentToken;if(d2(i,this.currentAttr.name)===null){if(i.attrs.push(this.currentAttr),i.location&&this.currentLocation){const a=(e=(t=i.location).attrs)!==null&&e!==void 0?e:t.attrs=Object.create(null);a[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err(se.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(e){this._emitCurrentCharacterToken(e.location),this.currentToken=null,e.location&&(e.location.endLine=this.preprocessor.line,e.location.endCol=this.preprocessor.col+1,e.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const e=this.currentToken;this.prepareToken(e),e.tagID=zd(e.tagName),e.type===Xe.START_TAG?(this.lastStartTagName=e.tagName,this.handler.onStartTag(e)):(e.attrs.length>0&&this._err(se.endTagWithAttributes),e.selfClosing&&this._err(se.endTagWithTrailingSolidus),this.handler.onEndTag(e)),this.preprocessor.dropParsedChunk()}emitCurrentComment(e){this.prepareToken(e),this.handler.onComment(e),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(e){this.prepareToken(e),this.handler.onDoctype(e),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(e){if(this.currentCharacterToken){switch(e&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=e.startLine,this.currentCharacterToken.location.endCol=e.startCol,this.currentCharacterToken.location.endOffset=e.startOffset),this.currentCharacterToken.type){case Xe.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case Xe.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case Xe.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const e=this.getCurrentLocation(0);e&&(e.endLine=e.startLine,e.endCol=e.startCol,e.endOffset=e.startOffset),this._emitCurrentCharacterToken(e),this.handler.onEof({type:Xe.EOF,location:e}),this.active=!1}_appendCharToCurrentCharacterToken(e,t){if(this.currentCharacterToken)if(this.currentCharacterToken.type===e){this.currentCharacterToken.chars+=t;return}else this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();this._createCharacterToken(e,t)}_emitCodePoint(e){const t=f2(e)?Xe.WHITESPACE_CHARACTER:e===O.NULL?Xe.NULL_CHARACTER:Xe.CHARACTER;this._appendCharToCurrentCharacterToken(t,String.fromCodePoint(e))}_emitChars(e){this._appendCharToCurrentCharacterToken(Xe.CHARACTER,e)}_startCharacterReference(){this.returnState=this.state,this.state=w.CHARACTER_REFERENCE,this.entityStartPos=this.preprocessor.pos,this.entityDecoder.startEntity(this._isCharacterReferenceInAttribute()?An.Attribute:An.Legacy)}_isCharacterReferenceInAttribute(){return this.returnState===w.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===w.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===w.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(e){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(e):this._emitCodePoint(e)}_callState(e){switch(this.state){case w.DATA:{this._stateData(e);break}case w.RCDATA:{this._stateRcdata(e);break}case w.RAWTEXT:{this._stateRawtext(e);break}case w.SCRIPT_DATA:{this._stateScriptData(e);break}case w.PLAINTEXT:{this._statePlaintext(e);break}case w.TAG_OPEN:{this._stateTagOpen(e);break}case w.END_TAG_OPEN:{this._stateEndTagOpen(e);break}case w.TAG_NAME:{this._stateTagName(e);break}case w.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(e);break}case w.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(e);break}case w.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(e);break}case w.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(e);break}case w.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(e);break}case w.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(e);break}case w.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(e);break}case w.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(e);break}case w.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(e);break}case w.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(e);break}case w.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(e);break}case w.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(e);break}case w.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(e);break}case w.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(e);break}case w.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(e);break}case w.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(e);break}case w.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(e);break}case w.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(e);break}case w.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(e);break}case w.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(e);break}case w.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(e);break}case w.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(e);break}case w.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(e);break}case w.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(e);break}case w.ATTRIBUTE_NAME:{this._stateAttributeName(e);break}case w.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(e);break}case w.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(e);break}case w.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(e);break}case w.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(e);break}case w.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(e);break}case w.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(e);break}case w.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(e);break}case w.BOGUS_COMMENT:{this._stateBogusComment(e);break}case w.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(e);break}case w.COMMENT_START:{this._stateCommentStart(e);break}case w.COMMENT_START_DASH:{this._stateCommentStartDash(e);break}case w.COMMENT:{this._stateComment(e);break}case w.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(e);break}case w.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(e);break}case w.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(e);break}case w.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(e);break}case w.COMMENT_END_DASH:{this._stateCommentEndDash(e);break}case w.COMMENT_END:{this._stateCommentEnd(e);break}case w.COMMENT_END_BANG:{this._stateCommentEndBang(e);break}case w.DOCTYPE:{this._stateDoctype(e);break}case w.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(e);break}case w.DOCTYPE_NAME:{this._stateDoctypeName(e);break}case w.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(e);break}case w.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(e);break}case w.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(e);break}case w.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(e);break}case w.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(e);break}case w.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(e);break}case w.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(e);break}case w.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(e);break}case w.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(e);break}case w.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(e);break}case w.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(e);break}case w.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(e);break}case w.BOGUS_DOCTYPE:{this._stateBogusDoctype(e);break}case w.CDATA_SECTION:{this._stateCdataSection(e);break}case w.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(e);break}case w.CDATA_SECTION_END:{this._stateCdataSectionEnd(e);break}case w.CHARACTER_REFERENCE:{this._stateCharacterReference();break}case w.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(e);break}default:throw new Error("Unknown state")}}_stateData(e){switch(e){case O.LESS_THAN_SIGN:{this.state=w.TAG_OPEN;break}case O.AMPERSAND:{this._startCharacterReference();break}case O.NULL:{this._err(se.unexpectedNullCharacter),this._emitCodePoint(e);break}case O.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRcdata(e){switch(e){case O.AMPERSAND:{this._startCharacterReference();break}case O.LESS_THAN_SIGN:{this.state=w.RCDATA_LESS_THAN_SIGN;break}case O.NULL:{this._err(se.unexpectedNullCharacter),this._emitChars(bt);break}case O.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRawtext(e){switch(e){case O.LESS_THAN_SIGN:{this.state=w.RAWTEXT_LESS_THAN_SIGN;break}case O.NULL:{this._err(se.unexpectedNullCharacter),this._emitChars(bt);break}case O.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptData(e){switch(e){case O.LESS_THAN_SIGN:{this.state=w.SCRIPT_DATA_LESS_THAN_SIGN;break}case O.NULL:{this._err(se.unexpectedNullCharacter),this._emitChars(bt);break}case O.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_statePlaintext(e){switch(e){case O.NULL:{this._err(se.unexpectedNullCharacter),this._emitChars(bt);break}case O.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateTagOpen(e){if(ia(e))this._createStartTagToken(),this.state=w.TAG_NAME,this._stateTagName(e);else switch(e){case O.EXCLAMATION_MARK:{this.state=w.MARKUP_DECLARATION_OPEN;break}case O.SOLIDUS:{this.state=w.END_TAG_OPEN;break}case O.QUESTION_MARK:{this._err(se.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=w.BOGUS_COMMENT,this._stateBogusComment(e);break}case O.EOF:{this._err(se.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err(se.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=w.DATA,this._stateData(e)}}_stateEndTagOpen(e){if(ia(e))this._createEndTagToken(),this.state=w.TAG_NAME,this._stateTagName(e);else switch(e){case O.GREATER_THAN_SIGN:{this._err(se.missingEndTagName),this.state=w.DATA;break}case O.EOF:{this._err(se.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err(se.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=w.BOGUS_COMMENT,this._stateBogusComment(e)}}_stateTagName(e){const t=this.currentToken;switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:{this.state=w.BEFORE_ATTRIBUTE_NAME;break}case O.SOLIDUS:{this.state=w.SELF_CLOSING_START_TAG;break}case O.GREATER_THAN_SIGN:{this.state=w.DATA,this.emitCurrentTagToken();break}case O.NULL:{this._err(se.unexpectedNullCharacter),t.tagName+=bt;break}case O.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:t.tagName+=String.fromCodePoint(Ll(e)?Fc(e):e)}}_stateRcdataLessThanSign(e){e===O.SOLIDUS?this.state=w.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=w.RCDATA,this._stateRcdata(e))}_stateRcdataEndTagOpen(e){ia(e)?(this.state=w.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(e)):(this._emitChars("</"),this.state=w.RCDATA,this._stateRcdata(e))}handleSpecialEndTag(e){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const t=this.currentToken;switch(t.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=w.BEFORE_ATTRIBUTE_NAME,!1;case O.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=w.SELF_CLOSING_START_TAG,!1;case O.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=w.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=w.RCDATA,this._stateRcdata(e))}_stateRawtextLessThanSign(e){e===O.SOLIDUS?this.state=w.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=w.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagOpen(e){ia(e)?(this.state=w.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(e)):(this._emitChars("</"),this.state=w.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=w.RAWTEXT,this._stateRawtext(e))}_stateScriptDataLessThanSign(e){switch(e){case O.SOLIDUS:{this.state=w.SCRIPT_DATA_END_TAG_OPEN;break}case O.EXCLAMATION_MARK:{this.state=w.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=w.SCRIPT_DATA,this._stateScriptData(e)}}_stateScriptDataEndTagOpen(e){ia(e)?(this.state=w.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(e)):(this._emitChars("</"),this.state=w.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=w.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStart(e){e===O.HYPHEN_MINUS?(this.state=w.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=w.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStartDash(e){e===O.HYPHEN_MINUS?(this.state=w.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=w.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscaped(e){switch(e){case O.HYPHEN_MINUS:{this.state=w.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case O.LESS_THAN_SIGN:{this.state=w.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case O.NULL:{this._err(se.unexpectedNullCharacter),this._emitChars(bt);break}case O.EOF:{this._err(se.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataEscapedDash(e){switch(e){case O.HYPHEN_MINUS:{this.state=w.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case O.LESS_THAN_SIGN:{this.state=w.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case O.NULL:{this._err(se.unexpectedNullCharacter),this.state=w.SCRIPT_DATA_ESCAPED,this._emitChars(bt);break}case O.EOF:{this._err(se.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=w.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedDashDash(e){switch(e){case O.HYPHEN_MINUS:{this._emitChars("-");break}case O.LESS_THAN_SIGN:{this.state=w.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case O.GREATER_THAN_SIGN:{this.state=w.SCRIPT_DATA,this._emitChars(">");break}case O.NULL:{this._err(se.unexpectedNullCharacter),this.state=w.SCRIPT_DATA_ESCAPED,this._emitChars(bt);break}case O.EOF:{this._err(se.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=w.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedLessThanSign(e){e===O.SOLIDUS?this.state=w.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:ia(e)?(this._emitChars("<"),this.state=w.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(e)):(this._emitChars("<"),this.state=w.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagOpen(e){ia(e)?(this.state=w.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(e)):(this._emitChars("</"),this.state=w.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=w.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscapeStart(e){if(this.preprocessor.startsWith(ws.SCRIPT,!1)&&Ax(this.preprocessor.peek(ws.SCRIPT.length))){this._emitCodePoint(e);for(let t=0;t<ws.SCRIPT.length;t++)this._emitCodePoint(this._consume());this.state=w.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=w.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscaped(e){switch(e){case O.HYPHEN_MINUS:{this.state=w.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case O.LESS_THAN_SIGN:{this.state=w.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case O.NULL:{this._err(se.unexpectedNullCharacter),this._emitChars(bt);break}case O.EOF:{this._err(se.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDash(e){switch(e){case O.HYPHEN_MINUS:{this.state=w.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case O.LESS_THAN_SIGN:{this.state=w.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case O.NULL:{this._err(se.unexpectedNullCharacter),this.state=w.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(bt);break}case O.EOF:{this._err(se.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=w.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDashDash(e){switch(e){case O.HYPHEN_MINUS:{this._emitChars("-");break}case O.LESS_THAN_SIGN:{this.state=w.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case O.GREATER_THAN_SIGN:{this.state=w.SCRIPT_DATA,this._emitChars(">");break}case O.NULL:{this._err(se.unexpectedNullCharacter),this.state=w.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(bt);break}case O.EOF:{this._err(se.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=w.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedLessThanSign(e){e===O.SOLIDUS?(this.state=w.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=w.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateScriptDataDoubleEscapeEnd(e){if(this.preprocessor.startsWith(ws.SCRIPT,!1)&&Ax(this.preprocessor.peek(ws.SCRIPT.length))){this._emitCodePoint(e);for(let t=0;t<ws.SCRIPT.length;t++)this._emitCodePoint(this._consume());this.state=w.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=w.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateBeforeAttributeName(e){switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:break;case O.SOLIDUS:case O.GREATER_THAN_SIGN:case O.EOF:{this.state=w.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case O.EQUALS_SIGN:{this._err(se.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=w.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=w.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateAttributeName(e){switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:case O.SOLIDUS:case O.GREATER_THAN_SIGN:case O.EOF:{this._leaveAttrName(),this.state=w.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case O.EQUALS_SIGN:{this._leaveAttrName(),this.state=w.BEFORE_ATTRIBUTE_VALUE;break}case O.QUOTATION_MARK:case O.APOSTROPHE:case O.LESS_THAN_SIGN:{this._err(se.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(e);break}case O.NULL:{this._err(se.unexpectedNullCharacter),this.currentAttr.name+=bt;break}default:this.currentAttr.name+=String.fromCodePoint(Ll(e)?Fc(e):e)}}_stateAfterAttributeName(e){switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:break;case O.SOLIDUS:{this.state=w.SELF_CLOSING_START_TAG;break}case O.EQUALS_SIGN:{this.state=w.BEFORE_ATTRIBUTE_VALUE;break}case O.GREATER_THAN_SIGN:{this.state=w.DATA,this.emitCurrentTagToken();break}case O.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=w.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateBeforeAttributeValue(e){switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:break;case O.QUOTATION_MARK:{this.state=w.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case O.APOSTROPHE:{this.state=w.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case O.GREATER_THAN_SIGN:{this._err(se.missingAttributeValue),this.state=w.DATA,this.emitCurrentTagToken();break}default:this.state=w.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(e)}}_stateAttributeValueDoubleQuoted(e){switch(e){case O.QUOTATION_MARK:{this.state=w.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case O.AMPERSAND:{this._startCharacterReference();break}case O.NULL:{this._err(se.unexpectedNullCharacter),this.currentAttr.value+=bt;break}case O.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueSingleQuoted(e){switch(e){case O.APOSTROPHE:{this.state=w.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case O.AMPERSAND:{this._startCharacterReference();break}case O.NULL:{this._err(se.unexpectedNullCharacter),this.currentAttr.value+=bt;break}case O.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueUnquoted(e){switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:{this._leaveAttrValue(),this.state=w.BEFORE_ATTRIBUTE_NAME;break}case O.AMPERSAND:{this._startCharacterReference();break}case O.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=w.DATA,this.emitCurrentTagToken();break}case O.NULL:{this._err(se.unexpectedNullCharacter),this.currentAttr.value+=bt;break}case O.QUOTATION_MARK:case O.APOSTROPHE:case O.LESS_THAN_SIGN:case O.EQUALS_SIGN:case O.GRAVE_ACCENT:{this._err(se.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(e);break}case O.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAfterAttributeValueQuoted(e){switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:{this._leaveAttrValue(),this.state=w.BEFORE_ATTRIBUTE_NAME;break}case O.SOLIDUS:{this._leaveAttrValue(),this.state=w.SELF_CLOSING_START_TAG;break}case O.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=w.DATA,this.emitCurrentTagToken();break}case O.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:this._err(se.missingWhitespaceBetweenAttributes),this.state=w.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateSelfClosingStartTag(e){switch(e){case O.GREATER_THAN_SIGN:{const t=this.currentToken;t.selfClosing=!0,this.state=w.DATA,this.emitCurrentTagToken();break}case O.EOF:{this._err(se.eofInTag),this._emitEOFToken();break}default:this._err(se.unexpectedSolidusInTag),this.state=w.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateBogusComment(e){const t=this.currentToken;switch(e){case O.GREATER_THAN_SIGN:{this.state=w.DATA,this.emitCurrentComment(t);break}case O.EOF:{this.emitCurrentComment(t),this._emitEOFToken();break}case O.NULL:{this._err(se.unexpectedNullCharacter),t.data+=bt;break}default:t.data+=String.fromCodePoint(e)}}_stateMarkupDeclarationOpen(e){this._consumeSequenceIfMatch(ws.DASH_DASH,!0)?(this._createCommentToken(ws.DASH_DASH.length+1),this.state=w.COMMENT_START):this._consumeSequenceIfMatch(ws.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(ws.DOCTYPE.length+1),this.state=w.DOCTYPE):this._consumeSequenceIfMatch(ws.CDATA_START,!0)?this.inForeignNode?this.state=w.CDATA_SECTION:(this._err(se.cdataInHtmlContent),this._createCommentToken(ws.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=w.BOGUS_COMMENT):this._ensureHibernation()||(this._err(se.incorrectlyOpenedComment),this._createCommentToken(2),this.state=w.BOGUS_COMMENT,this._stateBogusComment(e))}_stateCommentStart(e){switch(e){case O.HYPHEN_MINUS:{this.state=w.COMMENT_START_DASH;break}case O.GREATER_THAN_SIGN:{this._err(se.abruptClosingOfEmptyComment),this.state=w.DATA;const t=this.currentToken;this.emitCurrentComment(t);break}default:this.state=w.COMMENT,this._stateComment(e)}}_stateCommentStartDash(e){const t=this.currentToken;switch(e){case O.HYPHEN_MINUS:{this.state=w.COMMENT_END;break}case O.GREATER_THAN_SIGN:{this._err(se.abruptClosingOfEmptyComment),this.state=w.DATA,this.emitCurrentComment(t);break}case O.EOF:{this._err(se.eofInComment),this.emitCurrentComment(t),this._emitEOFToken();break}default:t.data+="-",this.state=w.COMMENT,this._stateComment(e)}}_stateComment(e){const t=this.currentToken;switch(e){case O.HYPHEN_MINUS:{this.state=w.COMMENT_END_DASH;break}case O.LESS_THAN_SIGN:{t.data+="<",this.state=w.COMMENT_LESS_THAN_SIGN;break}case O.NULL:{this._err(se.unexpectedNullCharacter),t.data+=bt;break}case O.EOF:{this._err(se.eofInComment),this.emitCurrentComment(t),this._emitEOFToken();break}default:t.data+=String.fromCodePoint(e)}}_stateCommentLessThanSign(e){const t=this.currentToken;switch(e){case O.EXCLAMATION_MARK:{t.data+="!",this.state=w.COMMENT_LESS_THAN_SIGN_BANG;break}case O.LESS_THAN_SIGN:{t.data+="<";break}default:this.state=w.COMMENT,this._stateComment(e)}}_stateCommentLessThanSignBang(e){e===O.HYPHEN_MINUS?this.state=w.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=w.COMMENT,this._stateComment(e))}_stateCommentLessThanSignBangDash(e){e===O.HYPHEN_MINUS?this.state=w.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=w.COMMENT_END_DASH,this._stateCommentEndDash(e))}_stateCommentLessThanSignBangDashDash(e){e!==O.GREATER_THAN_SIGN&&e!==O.EOF&&this._err(se.nestedComment),this.state=w.COMMENT_END,this._stateCommentEnd(e)}_stateCommentEndDash(e){const t=this.currentToken;switch(e){case O.HYPHEN_MINUS:{this.state=w.COMMENT_END;break}case O.EOF:{this._err(se.eofInComment),this.emitCurrentComment(t),this._emitEOFToken();break}default:t.data+="-",this.state=w.COMMENT,this._stateComment(e)}}_stateCommentEnd(e){const t=this.currentToken;switch(e){case O.GREATER_THAN_SIGN:{this.state=w.DATA,this.emitCurrentComment(t);break}case O.EXCLAMATION_MARK:{this.state=w.COMMENT_END_BANG;break}case O.HYPHEN_MINUS:{t.data+="-";break}case O.EOF:{this._err(se.eofInComment),this.emitCurrentComment(t),this._emitEOFToken();break}default:t.data+="--",this.state=w.COMMENT,this._stateComment(e)}}_stateCommentEndBang(e){const t=this.currentToken;switch(e){case O.HYPHEN_MINUS:{t.data+="--!",this.state=w.COMMENT_END_DASH;break}case O.GREATER_THAN_SIGN:{this._err(se.incorrectlyClosedComment),this.state=w.DATA,this.emitCurrentComment(t);break}case O.EOF:{this._err(se.eofInComment),this.emitCurrentComment(t),this._emitEOFToken();break}default:t.data+="--!",this.state=w.COMMENT,this._stateComment(e)}}_stateDoctype(e){switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:{this.state=w.BEFORE_DOCTYPE_NAME;break}case O.GREATER_THAN_SIGN:{this.state=w.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e);break}case O.EOF:{this._err(se.eofInDoctype),this._createDoctypeToken(null);const t=this.currentToken;t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(se.missingWhitespaceBeforeDoctypeName),this.state=w.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e)}}_stateBeforeDoctypeName(e){if(Ll(e))this._createDoctypeToken(String.fromCharCode(Fc(e))),this.state=w.DOCTYPE_NAME;else switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:break;case O.NULL:{this._err(se.unexpectedNullCharacter),this._createDoctypeToken(bt),this.state=w.DOCTYPE_NAME;break}case O.GREATER_THAN_SIGN:{this._err(se.missingDoctypeName),this._createDoctypeToken(null);const t=this.currentToken;t.forceQuirks=!0,this.emitCurrentDoctype(t),this.state=w.DATA;break}case O.EOF:{this._err(se.eofInDoctype),this._createDoctypeToken(null);const t=this.currentToken;t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(e)),this.state=w.DOCTYPE_NAME}}_stateDoctypeName(e){const t=this.currentToken;switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:{this.state=w.AFTER_DOCTYPE_NAME;break}case O.GREATER_THAN_SIGN:{this.state=w.DATA,this.emitCurrentDoctype(t);break}case O.NULL:{this._err(se.unexpectedNullCharacter),t.name+=bt;break}case O.EOF:{this._err(se.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:t.name+=String.fromCodePoint(Ll(e)?Fc(e):e)}}_stateAfterDoctypeName(e){const t=this.currentToken;switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:break;case O.GREATER_THAN_SIGN:{this.state=w.DATA,this.emitCurrentDoctype(t);break}case O.EOF:{this._err(se.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(ws.PUBLIC,!1)?this.state=w.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(ws.SYSTEM,!1)?this.state=w.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err(se.invalidCharacterSequenceAfterDoctypeName),t.forceQuirks=!0,this.state=w.BOGUS_DOCTYPE,this._stateBogusDoctype(e))}}_stateAfterDoctypePublicKeyword(e){const t=this.currentToken;switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:{this.state=w.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case O.QUOTATION_MARK:{this._err(se.missingWhitespaceAfterDoctypePublicKeyword),t.publicId="",this.state=w.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case O.APOSTROPHE:{this._err(se.missingWhitespaceAfterDoctypePublicKeyword),t.publicId="",this.state=w.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case O.GREATER_THAN_SIGN:{this._err(se.missingDoctypePublicIdentifier),t.forceQuirks=!0,this.state=w.DATA,this.emitCurrentDoctype(t);break}case O.EOF:{this._err(se.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(se.missingQuoteBeforeDoctypePublicIdentifier),t.forceQuirks=!0,this.state=w.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypePublicIdentifier(e){const t=this.currentToken;switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:break;case O.QUOTATION_MARK:{t.publicId="",this.state=w.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case O.APOSTROPHE:{t.publicId="",this.state=w.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case O.GREATER_THAN_SIGN:{this._err(se.missingDoctypePublicIdentifier),t.forceQuirks=!0,this.state=w.DATA,this.emitCurrentDoctype(t);break}case O.EOF:{this._err(se.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(se.missingQuoteBeforeDoctypePublicIdentifier),t.forceQuirks=!0,this.state=w.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypePublicIdentifierDoubleQuoted(e){const t=this.currentToken;switch(e){case O.QUOTATION_MARK:{this.state=w.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case O.NULL:{this._err(se.unexpectedNullCharacter),t.publicId+=bt;break}case O.GREATER_THAN_SIGN:{this._err(se.abruptDoctypePublicIdentifier),t.forceQuirks=!0,this.emitCurrentDoctype(t),this.state=w.DATA;break}case O.EOF:{this._err(se.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:t.publicId+=String.fromCodePoint(e)}}_stateDoctypePublicIdentifierSingleQuoted(e){const t=this.currentToken;switch(e){case O.APOSTROPHE:{this.state=w.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case O.NULL:{this._err(se.unexpectedNullCharacter),t.publicId+=bt;break}case O.GREATER_THAN_SIGN:{this._err(se.abruptDoctypePublicIdentifier),t.forceQuirks=!0,this.emitCurrentDoctype(t),this.state=w.DATA;break}case O.EOF:{this._err(se.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:t.publicId+=String.fromCodePoint(e)}}_stateAfterDoctypePublicIdentifier(e){const t=this.currentToken;switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:{this.state=w.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case O.GREATER_THAN_SIGN:{this.state=w.DATA,this.emitCurrentDoctype(t);break}case O.QUOTATION_MARK:{this._err(se.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),t.systemId="",this.state=w.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case O.APOSTROPHE:{this._err(se.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),t.systemId="",this.state=w.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case O.EOF:{this._err(se.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(se.missingQuoteBeforeDoctypeSystemIdentifier),t.forceQuirks=!0,this.state=w.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBetweenDoctypePublicAndSystemIdentifiers(e){const t=this.currentToken;switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:break;case O.GREATER_THAN_SIGN:{this.emitCurrentDoctype(t),this.state=w.DATA;break}case O.QUOTATION_MARK:{t.systemId="",this.state=w.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case O.APOSTROPHE:{t.systemId="",this.state=w.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case O.EOF:{this._err(se.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(se.missingQuoteBeforeDoctypeSystemIdentifier),t.forceQuirks=!0,this.state=w.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateAfterDoctypeSystemKeyword(e){const t=this.currentToken;switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:{this.state=w.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case O.QUOTATION_MARK:{this._err(se.missingWhitespaceAfterDoctypeSystemKeyword),t.systemId="",this.state=w.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case O.APOSTROPHE:{this._err(se.missingWhitespaceAfterDoctypeSystemKeyword),t.systemId="",this.state=w.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case O.GREATER_THAN_SIGN:{this._err(se.missingDoctypeSystemIdentifier),t.forceQuirks=!0,this.state=w.DATA,this.emitCurrentDoctype(t);break}case O.EOF:{this._err(se.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(se.missingQuoteBeforeDoctypeSystemIdentifier),t.forceQuirks=!0,this.state=w.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypeSystemIdentifier(e){const t=this.currentToken;switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:break;case O.QUOTATION_MARK:{t.systemId="",this.state=w.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case O.APOSTROPHE:{t.systemId="",this.state=w.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case O.GREATER_THAN_SIGN:{this._err(se.missingDoctypeSystemIdentifier),t.forceQuirks=!0,this.state=w.DATA,this.emitCurrentDoctype(t);break}case O.EOF:{this._err(se.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(se.missingQuoteBeforeDoctypeSystemIdentifier),t.forceQuirks=!0,this.state=w.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypeSystemIdentifierDoubleQuoted(e){const t=this.currentToken;switch(e){case O.QUOTATION_MARK:{this.state=w.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case O.NULL:{this._err(se.unexpectedNullCharacter),t.systemId+=bt;break}case O.GREATER_THAN_SIGN:{this._err(se.abruptDoctypeSystemIdentifier),t.forceQuirks=!0,this.emitCurrentDoctype(t),this.state=w.DATA;break}case O.EOF:{this._err(se.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:t.systemId+=String.fromCodePoint(e)}}_stateDoctypeSystemIdentifierSingleQuoted(e){const t=this.currentToken;switch(e){case O.APOSTROPHE:{this.state=w.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case O.NULL:{this._err(se.unexpectedNullCharacter),t.systemId+=bt;break}case O.GREATER_THAN_SIGN:{this._err(se.abruptDoctypeSystemIdentifier),t.forceQuirks=!0,this.emitCurrentDoctype(t),this.state=w.DATA;break}case O.EOF:{this._err(se.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:t.systemId+=String.fromCodePoint(e)}}_stateAfterDoctypeSystemIdentifier(e){const t=this.currentToken;switch(e){case O.SPACE:case O.LINE_FEED:case O.TABULATION:case O.FORM_FEED:break;case O.GREATER_THAN_SIGN:{this.emitCurrentDoctype(t),this.state=w.DATA;break}case O.EOF:{this._err(se.eofInDoctype),t.forceQuirks=!0,this.emitCurrentDoctype(t),this._emitEOFToken();break}default:this._err(se.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=w.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBogusDoctype(e){const t=this.currentToken;switch(e){case O.GREATER_THAN_SIGN:{this.emitCurrentDoctype(t),this.state=w.DATA;break}case O.NULL:{this._err(se.unexpectedNullCharacter);break}case O.EOF:{this.emitCurrentDoctype(t),this._emitEOFToken();break}}}_stateCdataSection(e){switch(e){case O.RIGHT_SQUARE_BRACKET:{this.state=w.CDATA_SECTION_BRACKET;break}case O.EOF:{this._err(se.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateCdataSectionBracket(e){e===O.RIGHT_SQUARE_BRACKET?this.state=w.CDATA_SECTION_END:(this._emitChars("]"),this.state=w.CDATA_SECTION,this._stateCdataSection(e))}_stateCdataSectionEnd(e){switch(e){case O.GREATER_THAN_SIGN:{this.state=w.DATA;break}case O.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=w.CDATA_SECTION,this._stateCdataSection(e)}}_stateCharacterReference(){let e=this.entityDecoder.write(this.preprocessor.html,this.preprocessor.pos);if(e<0)if(this.preprocessor.lastChunkWritten)e=this.entityDecoder.end();else{this.active=!1,this.preprocessor.pos=this.preprocessor.html.length-1,this.consumedAfterSnapshot=0,this.preprocessor.endOfChunkHit=!0;return}e===0?(this.preprocessor.pos=this.entityStartPos,this._flushCodePointConsumedAsCharacterReference(O.AMPERSAND),this.state=!this._isCharacterReferenceInAttribute()&&Sx(this.preprocessor.peek(1))?w.AMBIGUOUS_AMPERSAND:this.returnState):this.state=this.returnState}_stateAmbiguousAmpersand(e){Sx(e)?this._flushCodePointConsumedAsCharacterReference(e):(e===O.SEMICOLON&&this._err(se.unknownNamedCharacterReference),this.state=this.returnState,this._callState(e))}}const h2=new Set([y.DD,y.DT,y.LI,y.OPTGROUP,y.OPTION,y.P,y.RB,y.RP,y.RT,y.RTC]),_x=new Set([...h2,y.CAPTION,y.COLGROUP,y.TBODY,y.TD,y.TFOOT,y.TH,y.THEAD,y.TR]),_d=new Set([y.APPLET,y.CAPTION,y.HTML,y.MARQUEE,y.OBJECT,y.TABLE,y.TD,y.TEMPLATE,y.TH]),YR=new Set([..._d,y.OL,y.UL]),KR=new Set([..._d,y.BUTTON]),Lx=new Set([y.ANNOTATION_XML,y.MI,y.MN,y.MO,y.MS,y.MTEXT]),Ix=new Set([y.DESC,y.FOREIGN_OBJECT,y.TITLE]),zR=new Set([y.TR,y.TEMPLATE,y.HTML]),QR=new Set([y.TBODY,y.TFOOT,y.THEAD,y.TEMPLATE,y.HTML]),XR=new Set([y.TABLE,y.TEMPLATE,y.HTML]),WR=new Set([y.TD,y.TH]);class ZR{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(e,t,i){this.treeAdapter=t,this.handler=i,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=y.UNKNOWN,this.current=e}_indexOf(e){return this.items.lastIndexOf(e,this.stackTop)}_isInTemplate(){return this.currentTagId===y.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===de.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(e,t){this.stackTop++,this.items[this.stackTop]=e,this.current=e,this.tagIDs[this.stackTop]=t,this.currentTagId=t,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(e,t,!0)}pop(){const e=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!0)}replace(e,t){const i=this._indexOf(e);this.items[i]=t,i===this.stackTop&&(this.current=t)}insertAfter(e,t,i){const a=this._indexOf(e)+1;this.items.splice(a,0,t),this.tagIDs.splice(a,0,i),this.stackTop++,a===this.stackTop&&this._updateCurrentElement(),this.current&&this.currentTagId!==void 0&&this.handler.onItemPush(this.current,this.currentTagId,a===this.stackTop)}popUntilTagNamePopped(e){let t=this.stackTop+1;do t=this.tagIDs.lastIndexOf(e,t-1);while(t>0&&this.treeAdapter.getNamespaceURI(this.items[t])!==de.HTML);this.shortenToLength(Math.max(t,0))}shortenToLength(e){for(;this.stackTop>=e;){const t=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,this.stackTop<e)}}popUntilElementPopped(e){const t=this._indexOf(e);this.shortenToLength(Math.max(t,0))}popUntilPopped(e,t){const i=this._indexOfTagNames(e,t);this.shortenToLength(Math.max(i,0))}popUntilNumberedHeaderPopped(){this.popUntilPopped(vm,de.HTML)}popUntilTableCellPopped(){this.popUntilPopped(WR,de.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(e,t){for(let i=this.stackTop;i>=0;i--)if(e.has(this.tagIDs[i])&&this.treeAdapter.getNamespaceURI(this.items[i])===t)return i;return-1}clearBackTo(e,t){const i=this._indexOfTagNames(e,t);this.shortenToLength(i+1)}clearBackToTableContext(){this.clearBackTo(XR,de.HTML)}clearBackToTableBodyContext(){this.clearBackTo(QR,de.HTML)}clearBackToTableRowContext(){this.clearBackTo(zR,de.HTML)}remove(e){const t=this._indexOf(e);t>=0&&(t===this.stackTop?this.pop():(this.items.splice(t,1),this.tagIDs.splice(t,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===y.BODY?this.items[1]:null}contains(e){return this._indexOf(e)>-1}getCommonAncestor(e){const t=this._indexOf(e)-1;return t>=0?this.items[t]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===y.HTML}hasInDynamicScope(e,t){for(let i=this.stackTop;i>=0;i--){const a=this.tagIDs[i];switch(this.treeAdapter.getNamespaceURI(this.items[i])){case de.HTML:{if(a===e)return!0;if(t.has(a))return!1;break}case de.SVG:{if(Ix.has(a))return!1;break}case de.MATHML:{if(Lx.has(a))return!1;break}}}return!0}hasInScope(e){return this.hasInDynamicScope(e,_d)}hasInListItemScope(e){return this.hasInDynamicScope(e,YR)}hasInButtonScope(e){return this.hasInDynamicScope(e,KR)}hasNumberedHeaderInScope(){for(let e=this.stackTop;e>=0;e--){const t=this.tagIDs[e];switch(this.treeAdapter.getNamespaceURI(this.items[e])){case de.HTML:{if(vm.has(t))return!0;if(_d.has(t))return!1;break}case de.SVG:{if(Ix.has(t))return!1;break}case de.MATHML:{if(Lx.has(t))return!1;break}}}return!0}hasInTableScope(e){for(let t=this.stackTop;t>=0;t--)if(this.treeAdapter.getNamespaceURI(this.items[t])===de.HTML)switch(this.tagIDs[t]){case e:return!0;case y.TABLE:case y.HTML:return!1}return!0}hasTableBodyContextInTableScope(){for(let e=this.stackTop;e>=0;e--)if(this.treeAdapter.getNamespaceURI(this.items[e])===de.HTML)switch(this.tagIDs[e]){case y.TBODY:case y.THEAD:case y.TFOOT:return!0;case y.TABLE:case y.HTML:return!1}return!0}hasInSelectScope(e){for(let t=this.stackTop;t>=0;t--)if(this.treeAdapter.getNamespaceURI(this.items[t])===de.HTML)switch(this.tagIDs[t]){case e:return!0;case y.OPTION:case y.OPTGROUP:break;default:return!1}return!0}generateImpliedEndTags(){for(;this.currentTagId!==void 0&&h2.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;this.currentTagId!==void 0&&_x.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(e){for(;this.currentTagId!==void 0&&this.currentTagId!==e&&_x.has(this.currentTagId);)this.pop()}}const D0=3;var ji;(function(s){s[s.Marker=0]="Marker",s[s.Element=1]="Element"})(ji||(ji={}));const Rx={type:ji.Marker};class JR{constructor(e){this.treeAdapter=e,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(e,t){const i=[],a=t.length,u=this.treeAdapter.getTagName(e),l=this.treeAdapter.getNamespaceURI(e);for(let c=0;c<this.entries.length;c++){const f=this.entries[c];if(f.type===ji.Marker)break;const{element:h}=f;if(this.treeAdapter.getTagName(h)===u&&this.treeAdapter.getNamespaceURI(h)===l){const m=this.treeAdapter.getAttrList(h);m.length===a&&i.push({idx:c,attrs:m})}}return i}_ensureNoahArkCondition(e){if(this.entries.length<D0)return;const t=this.treeAdapter.getAttrList(e),i=this._getNoahArkConditionCandidates(e,t);if(i.length<D0)return;const a=new Map(t.map(l=>[l.name,l.value]));let u=0;for(let l=0;l<i.length;l++){const c=i[l];c.attrs.every(f=>a.get(f.name)===f.value)&&(u+=1,u>=D0&&this.entries.splice(c.idx,1))}}insertMarker(){this.entries.unshift(Rx)}pushElement(e,t){this._ensureNoahArkCondition(e),this.entries.unshift({type:ji.Element,element:e,token:t})}insertElementAfterBookmark(e,t){const i=this.entries.indexOf(this.bookmark);this.entries.splice(i,0,{type:ji.Element,element:e,token:t})}removeEntry(e){const t=this.entries.indexOf(e);t!==-1&&this.entries.splice(t,1)}clearToLastMarker(){const e=this.entries.indexOf(Rx);e===-1?this.entries.length=0:this.entries.splice(0,e+1)}getElementEntryInScopeWithTagName(e){const t=this.entries.find(i=>i.type===ji.Marker||this.treeAdapter.getTagName(i.element)===e);return t&&t.type===ji.Element?t:null}getElementEntry(e){return this.entries.find(t=>t.type===ji.Element&&t.element===e)}}const Tn={createDocument(){return{nodeName:"#document",mode:Ws.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(s,e,t){return{nodeName:s,tagName:s,attrs:t,namespaceURI:e,childNodes:[],parentNode:null}},createCommentNode(s){return{nodeName:"#comment",data:s,parentNode:null}},createTextNode(s){return{nodeName:"#text",value:s,parentNode:null}},appendChild(s,e){s.childNodes.push(e),e.parentNode=s},insertBefore(s,e,t){const i=s.childNodes.indexOf(t);s.childNodes.splice(i,0,e),e.parentNode=s},setTemplateContent(s,e){s.content=e},getTemplateContent(s){return s.content},setDocumentType(s,e,t,i){const a=s.childNodes.find(u=>u.nodeName==="#documentType");if(a)a.name=e,a.publicId=t,a.systemId=i;else{const u={nodeName:"#documentType",name:e,publicId:t,systemId:i,parentNode:null};Tn.appendChild(s,u)}},setDocumentMode(s,e){s.mode=e},getDocumentMode(s){return s.mode},detachNode(s){if(s.parentNode){const e=s.parentNode.childNodes.indexOf(s);s.parentNode.childNodes.splice(e,1),s.parentNode=null}},insertText(s,e){if(s.childNodes.length>0){const t=s.childNodes[s.childNodes.length-1];if(Tn.isTextNode(t)){t.value+=e;return}}Tn.appendChild(s,Tn.createTextNode(e))},insertTextBefore(s,e,t){const i=s.childNodes[s.childNodes.indexOf(t)-1];i&&Tn.isTextNode(i)?i.value+=e:Tn.insertBefore(s,Tn.createTextNode(e),t)},adoptAttributes(s,e){const t=new Set(s.attrs.map(i=>i.name));for(let i=0;i<e.length;i++)t.has(e[i].name)||s.attrs.push(e[i])},getFirstChild(s){return s.childNodes[0]},getChildNodes(s){return s.childNodes},getParentNode(s){return s.parentNode},getAttrList(s){return s.attrs},getTagName(s){return s.tagName},getNamespaceURI(s){return s.namespaceURI},getTextNodeContent(s){return s.value},getCommentNodeContent(s){return s.data},getDocumentTypeNodeName(s){return s.name},getDocumentTypeNodePublicId(s){return s.publicId},getDocumentTypeNodeSystemId(s){return s.systemId},isTextNode(s){return s.nodeName==="#text"},isCommentNode(s){return s.nodeName==="#comment"},isDocumentTypeNode(s){return s.nodeName==="#documentType"},isElementNode(s){return Object.prototype.hasOwnProperty.call(s,"tagName")},setNodeSourceCodeLocation(s,e){s.sourceCodeLocation=e},getNodeSourceCodeLocation(s){return s.sourceCodeLocation},updateNodeSourceCodeLocation(s,e){s.sourceCodeLocation={...s.sourceCodeLocation,...e}}},m2="html",eN="about:legacy-compat",tN="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",g2=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],sN=[...g2,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],iN=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),p2=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],nN=[...p2,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function Nx(s,e){return e.some(t=>s.startsWith(t))}function aN(s){return s.name===m2&&s.publicId===null&&(s.systemId===null||s.systemId===eN)}function rN(s){if(s.name!==m2)return Ws.QUIRKS;const{systemId:e}=s;if(e&&e.toLowerCase()===tN)return Ws.QUIRKS;let{publicId:t}=s;if(t!==null){if(t=t.toLowerCase(),iN.has(t))return Ws.QUIRKS;let i=e===null?sN:g2;if(Nx(t,i))return Ws.QUIRKS;if(i=e===null?p2:nN,Nx(t,i))return Ws.LIMITED_QUIRKS}return Ws.NO_QUIRKS}const Cx={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},uN="definitionurl",lN="definitionURL",oN=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(s=>[s.toLowerCase(),s])),cN=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:de.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:de.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:de.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:de.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:de.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:de.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:de.XLINK}],["xml:lang",{prefix:"xml",name:"lang",namespace:de.XML}],["xml:space",{prefix:"xml",name:"space",namespace:de.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:de.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:de.XMLNS}]]),dN=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(s=>[s.toLowerCase(),s])),fN=new Set([y.B,y.BIG,y.BLOCKQUOTE,y.BODY,y.BR,y.CENTER,y.CODE,y.DD,y.DIV,y.DL,y.DT,y.EM,y.EMBED,y.H1,y.H2,y.H3,y.H4,y.H5,y.H6,y.HEAD,y.HR,y.I,y.IMG,y.LI,y.LISTING,y.MENU,y.META,y.NOBR,y.OL,y.P,y.PRE,y.RUBY,y.S,y.SMALL,y.SPAN,y.STRONG,y.STRIKE,y.SUB,y.SUP,y.TABLE,y.TT,y.U,y.UL,y.VAR]);function hN(s){const e=s.tagID;return e===y.FONT&&s.attrs.some(({name:i})=>i===Ja.COLOR||i===Ja.SIZE||i===Ja.FACE)||fN.has(e)}function b2(s){for(let e=0;e<s.attrs.length;e++)if(s.attrs[e].name===uN){s.attrs[e].name=lN;break}}function E2(s){for(let e=0;e<s.attrs.length;e++){const t=oN.get(s.attrs[e].name);t!=null&&(s.attrs[e].name=t)}}function mg(s){for(let e=0;e<s.attrs.length;e++){const t=cN.get(s.attrs[e].name);t&&(s.attrs[e].prefix=t.prefix,s.attrs[e].name=t.name,s.attrs[e].namespace=t.namespace)}}function mN(s){const e=dN.get(s.tagName);e!=null&&(s.tagName=e,s.tagID=zd(s.tagName))}function gN(s,e){return e===de.MATHML&&(s===y.MI||s===y.MO||s===y.MN||s===y.MS||s===y.MTEXT)}function pN(s,e,t){if(e===de.MATHML&&s===y.ANNOTATION_XML){for(let i=0;i<t.length;i++)if(t[i].name===Ja.ENCODING){const a=t[i].value.toLowerCase();return a===Cx.TEXT_HTML||a===Cx.APPLICATION_XML}}return e===de.SVG&&(s===y.FOREIGN_OBJECT||s===y.DESC||s===y.TITLE)}function bN(s,e,t,i){return(!i||i===de.HTML)&&pN(s,e,t)||(!i||i===de.MATHML)&&gN(s,e)}const EN="hidden",xN=8,TN=3;var M;(function(s){s[s.INITIAL=0]="INITIAL",s[s.BEFORE_HTML=1]="BEFORE_HTML",s[s.BEFORE_HEAD=2]="BEFORE_HEAD",s[s.IN_HEAD=3]="IN_HEAD",s[s.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",s[s.AFTER_HEAD=5]="AFTER_HEAD",s[s.IN_BODY=6]="IN_BODY",s[s.TEXT=7]="TEXT",s[s.IN_TABLE=8]="IN_TABLE",s[s.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",s[s.IN_CAPTION=10]="IN_CAPTION",s[s.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",s[s.IN_TABLE_BODY=12]="IN_TABLE_BODY",s[s.IN_ROW=13]="IN_ROW",s[s.IN_CELL=14]="IN_CELL",s[s.IN_SELECT=15]="IN_SELECT",s[s.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",s[s.IN_TEMPLATE=17]="IN_TEMPLATE",s[s.AFTER_BODY=18]="AFTER_BODY",s[s.IN_FRAMESET=19]="IN_FRAMESET",s[s.AFTER_FRAMESET=20]="AFTER_FRAMESET",s[s.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",s[s.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(M||(M={}));const yN={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},x2=new Set([y.TABLE,y.TBODY,y.TFOOT,y.THEAD,y.TR]),Dx={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:Tn,onParseError:null};class T2{constructor(e,t,i=null,a=null){this.fragmentContext=i,this.scriptHandler=a,this.currentToken=null,this.stopped=!1,this.insertionMode=M.INITIAL,this.originalInsertionMode=M.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...Dx,...e},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=t??this.treeAdapter.createDocument(),this.tokenizer=new qR(this.options,this),this.activeFormattingElements=new JR(this.treeAdapter),this.fragmentContextID=i?zd(this.treeAdapter.getTagName(i)):y.UNKNOWN,this._setContextModes(i??this.document,this.fragmentContextID),this.openElements=new ZR(this.document,this.treeAdapter,this)}static parse(e,t){const i=new this(t);return i.tokenizer.write(e,!0),i.document}static getFragmentParser(e,t){const i={...Dx,...t};e??(e=i.treeAdapter.createElement(K.TEMPLATE,de.HTML,[]));const a=i.treeAdapter.createElement("documentmock",de.HTML,[]),u=new this(i,a,e);return u.fragmentContextID===y.TEMPLATE&&u.tmplInsertionModeStack.unshift(M.IN_TEMPLATE),u._initTokenizerForFragmentParsing(),u._insertFakeRootElement(),u._resetInsertionMode(),u._findFormInFragmentContext(),u}getFragment(){const e=this.treeAdapter.getFirstChild(this.document),t=this.treeAdapter.createDocumentFragment();return this._adoptNodes(e,t),t}_err(e,t,i){var a;if(!this.onParseError)return;const u=(a=e.location)!==null&&a!==void 0?a:yN,l={code:t,startLine:u.startLine,startCol:u.startCol,startOffset:u.startOffset,endLine:i?u.startLine:u.endLine,endCol:i?u.startCol:u.endCol,endOffset:i?u.startOffset:u.endOffset};this.onParseError(l)}onItemPush(e,t,i){var a,u;(u=(a=this.treeAdapter).onItemPush)===null||u===void 0||u.call(a,e),i&&this.openElements.stackTop>0&&this._setContextModes(e,t)}onItemPop(e,t){var i,a;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(e,this.currentToken),(a=(i=this.treeAdapter).onItemPop)===null||a===void 0||a.call(i,e,this.openElements.current),t){let u,l;this.openElements.stackTop===0&&this.fragmentContext?(u=this.fragmentContext,l=this.fragmentContextID):{current:u,currentTagId:l}=this.openElements,this._setContextModes(u,l)}}_setContextModes(e,t){const i=e===this.document||e&&this.treeAdapter.getNamespaceURI(e)===de.HTML;this.currentNotInHTML=!i,this.tokenizer.inForeignNode=!i&&e!==void 0&&t!==void 0&&!this._isIntegrationPoint(t,e)}_switchToTextParsing(e,t){this._insertElement(e,de.HTML),this.tokenizer.state=t,this.originalInsertionMode=this.insertionMode,this.insertionMode=M.TEXT}switchToPlaintextParsing(){this.insertionMode=M.TEXT,this.originalInsertionMode=M.IN_BODY,this.tokenizer.state=Us.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let e=this.fragmentContext;for(;e;){if(this.treeAdapter.getTagName(e)===K.FORM){this.formElement=e;break}e=this.treeAdapter.getParentNode(e)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==de.HTML))switch(this.fragmentContextID){case y.TITLE:case y.TEXTAREA:{this.tokenizer.state=Us.RCDATA;break}case y.STYLE:case y.XMP:case y.IFRAME:case y.NOEMBED:case y.NOFRAMES:case y.NOSCRIPT:{this.tokenizer.state=Us.RAWTEXT;break}case y.SCRIPT:{this.tokenizer.state=Us.SCRIPT_DATA;break}case y.PLAINTEXT:{this.tokenizer.state=Us.PLAINTEXT;break}}}_setDocumentType(e){const t=e.name||"",i=e.publicId||"",a=e.systemId||"";if(this.treeAdapter.setDocumentType(this.document,t,i,a),e.location){const l=this.treeAdapter.getChildNodes(this.document).find(c=>this.treeAdapter.isDocumentTypeNode(c));l&&this.treeAdapter.setNodeSourceCodeLocation(l,e.location)}}_attachElementToTree(e,t){if(this.options.sourceCodeLocationInfo){const i=t&&{...t,startTag:t};this.treeAdapter.setNodeSourceCodeLocation(e,i)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(e);else{const i=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(i??this.document,e)}}_appendElement(e,t){const i=this.treeAdapter.createElement(e.tagName,t,e.attrs);this._attachElementToTree(i,e.location)}_insertElement(e,t){const i=this.treeAdapter.createElement(e.tagName,t,e.attrs);this._attachElementToTree(i,e.location),this.openElements.push(i,e.tagID)}_insertFakeElement(e,t){const i=this.treeAdapter.createElement(e,de.HTML,[]);this._attachElementToTree(i,null),this.openElements.push(i,t)}_insertTemplate(e){const t=this.treeAdapter.createElement(e.tagName,de.HTML,e.attrs),i=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(t,i),this._attachElementToTree(t,e.location),this.openElements.push(t,e.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(i,null)}_insertFakeRootElement(){const e=this.treeAdapter.createElement(K.HTML,de.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(e,null),this.treeAdapter.appendChild(this.openElements.current,e),this.openElements.push(e,y.HTML)}_appendCommentNode(e,t){const i=this.treeAdapter.createCommentNode(e.data);this.treeAdapter.appendChild(t,i),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(i,e.location)}_insertCharacters(e){let t,i;if(this._shouldFosterParentOnInsertion()?({parent:t,beforeElement:i}=this._findFosterParentingLocation(),i?this.treeAdapter.insertTextBefore(t,e.chars,i):this.treeAdapter.insertText(t,e.chars)):(t=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(t,e.chars)),!e.location)return;const a=this.treeAdapter.getChildNodes(t),u=i?a.lastIndexOf(i):a.length,l=a[u-1];if(this.treeAdapter.getNodeSourceCodeLocation(l)){const{endLine:f,endCol:h,endOffset:m}=e.location;this.treeAdapter.updateNodeSourceCodeLocation(l,{endLine:f,endCol:h,endOffset:m})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(l,e.location)}_adoptNodes(e,t){for(let i=this.treeAdapter.getFirstChild(e);i;i=this.treeAdapter.getFirstChild(e))this.treeAdapter.detachNode(i),this.treeAdapter.appendChild(t,i)}_setEndLocation(e,t){if(this.treeAdapter.getNodeSourceCodeLocation(e)&&t.location){const i=t.location,a=this.treeAdapter.getTagName(e),u=t.type===Xe.END_TAG&&a===t.tagName?{endTag:{...i},endLine:i.endLine,endCol:i.endCol,endOffset:i.endOffset}:{endLine:i.startLine,endCol:i.startCol,endOffset:i.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(e,u)}}shouldProcessStartTagTokenInForeignContent(e){if(!this.currentNotInHTML)return!1;let t,i;return this.openElements.stackTop===0&&this.fragmentContext?(t=this.fragmentContext,i=this.fragmentContextID):{current:t,currentTagId:i}=this.openElements,e.tagID===y.SVG&&this.treeAdapter.getTagName(t)===K.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(t)===de.MATHML?!1:this.tokenizer.inForeignNode||(e.tagID===y.MGLYPH||e.tagID===y.MALIGNMARK)&&i!==void 0&&!this._isIntegrationPoint(i,t,de.HTML)}_processToken(e){switch(e.type){case Xe.CHARACTER:{this.onCharacter(e);break}case Xe.NULL_CHARACTER:{this.onNullCharacter(e);break}case Xe.COMMENT:{this.onComment(e);break}case Xe.DOCTYPE:{this.onDoctype(e);break}case Xe.START_TAG:{this._processStartTag(e);break}case Xe.END_TAG:{this.onEndTag(e);break}case Xe.EOF:{this.onEof(e);break}case Xe.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(e);break}}}_isIntegrationPoint(e,t,i){const a=this.treeAdapter.getNamespaceURI(t),u=this.treeAdapter.getAttrList(t);return bN(e,a,u,i)}_reconstructActiveFormattingElements(){const e=this.activeFormattingElements.entries.length;if(e){const t=this.activeFormattingElements.entries.findIndex(a=>a.type===ji.Marker||this.openElements.contains(a.element)),i=t===-1?e-1:t-1;for(let a=i;a>=0;a--){const u=this.activeFormattingElements.entries[a];this._insertElement(u.token,this.treeAdapter.getNamespaceURI(u.element)),u.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=M.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion(y.P),this.openElements.popUntilTagNamePopped(y.P)}_resetInsertionMode(){for(let e=this.openElements.stackTop;e>=0;e--)switch(e===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[e]){case y.TR:{this.insertionMode=M.IN_ROW;return}case y.TBODY:case y.THEAD:case y.TFOOT:{this.insertionMode=M.IN_TABLE_BODY;return}case y.CAPTION:{this.insertionMode=M.IN_CAPTION;return}case y.COLGROUP:{this.insertionMode=M.IN_COLUMN_GROUP;return}case y.TABLE:{this.insertionMode=M.IN_TABLE;return}case y.BODY:{this.insertionMode=M.IN_BODY;return}case y.FRAMESET:{this.insertionMode=M.IN_FRAMESET;return}case y.SELECT:{this._resetInsertionModeForSelect(e);return}case y.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case y.HTML:{this.insertionMode=this.headElement?M.AFTER_HEAD:M.BEFORE_HEAD;return}case y.TD:case y.TH:{if(e>0){this.insertionMode=M.IN_CELL;return}break}case y.HEAD:{if(e>0){this.insertionMode=M.IN_HEAD;return}break}}this.insertionMode=M.IN_BODY}_resetInsertionModeForSelect(e){if(e>0)for(let t=e-1;t>0;t--){const i=this.openElements.tagIDs[t];if(i===y.TEMPLATE)break;if(i===y.TABLE){this.insertionMode=M.IN_SELECT_IN_TABLE;return}}this.insertionMode=M.IN_SELECT}_isElementCausesFosterParenting(e){return x2.has(e)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this.openElements.currentTagId!==void 0&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let e=this.openElements.stackTop;e>=0;e--){const t=this.openElements.items[e];switch(this.openElements.tagIDs[e]){case y.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(t)===de.HTML)return{parent:this.treeAdapter.getTemplateContent(t),beforeElement:null};break}case y.TABLE:{const i=this.treeAdapter.getParentNode(t);return i?{parent:i,beforeElement:t}:{parent:this.openElements.items[e-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(e){const t=this._findFosterParentingLocation();t.beforeElement?this.treeAdapter.insertBefore(t.parent,e,t.beforeElement):this.treeAdapter.appendChild(t.parent,e)}_isSpecialElement(e,t){const i=this.treeAdapter.getNamespaceURI(e);return FR[i].has(t)}onCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){WC(this,e);return}switch(this.insertionMode){case M.INITIAL:{Sl(this,e);break}case M.BEFORE_HTML:{Dl(this,e);break}case M.BEFORE_HEAD:{Ol(this,e);break}case M.IN_HEAD:{wl(this,e);break}case M.IN_HEAD_NO_SCRIPT:{kl(this,e);break}case M.AFTER_HEAD:{Ml(this,e);break}case M.IN_BODY:case M.IN_CAPTION:case M.IN_CELL:case M.IN_TEMPLATE:{v2(this,e);break}case M.TEXT:case M.IN_SELECT:case M.IN_SELECT_IN_TABLE:{this._insertCharacters(e);break}case M.IN_TABLE:case M.IN_TABLE_BODY:case M.IN_ROW:{O0(this,e);break}case M.IN_TABLE_TEXT:{R2(this,e);break}case M.IN_COLUMN_GROUP:{Ld(this,e);break}case M.AFTER_BODY:{Id(this,e);break}case M.AFTER_AFTER_BODY:{nd(this,e);break}}}onNullCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){XC(this,e);return}switch(this.insertionMode){case M.INITIAL:{Sl(this,e);break}case M.BEFORE_HTML:{Dl(this,e);break}case M.BEFORE_HEAD:{Ol(this,e);break}case M.IN_HEAD:{wl(this,e);break}case M.IN_HEAD_NO_SCRIPT:{kl(this,e);break}case M.AFTER_HEAD:{Ml(this,e);break}case M.TEXT:{this._insertCharacters(e);break}case M.IN_TABLE:case M.IN_TABLE_BODY:case M.IN_ROW:{O0(this,e);break}case M.IN_COLUMN_GROUP:{Ld(this,e);break}case M.AFTER_BODY:{Id(this,e);break}case M.AFTER_AFTER_BODY:{nd(this,e);break}}}onComment(e){if(this.skipNextNewLine=!1,this.currentNotInHTML){Sm(this,e);return}switch(this.insertionMode){case M.INITIAL:case M.BEFORE_HTML:case M.BEFORE_HEAD:case M.IN_HEAD:case M.IN_HEAD_NO_SCRIPT:case M.AFTER_HEAD:case M.IN_BODY:case M.IN_TABLE:case M.IN_CAPTION:case M.IN_COLUMN_GROUP:case M.IN_TABLE_BODY:case M.IN_ROW:case M.IN_CELL:case M.IN_SELECT:case M.IN_SELECT_IN_TABLE:case M.IN_TEMPLATE:case M.IN_FRAMESET:case M.AFTER_FRAMESET:{Sm(this,e);break}case M.IN_TABLE_TEXT:{Al(this,e);break}case M.AFTER_BODY:{RN(this,e);break}case M.AFTER_AFTER_BODY:case M.AFTER_AFTER_FRAMESET:{NN(this,e);break}}}onDoctype(e){switch(this.skipNextNewLine=!1,this.insertionMode){case M.INITIAL:{CN(this,e);break}case M.BEFORE_HEAD:case M.IN_HEAD:case M.IN_HEAD_NO_SCRIPT:case M.AFTER_HEAD:{this._err(e,se.misplacedDoctype);break}case M.IN_TABLE_TEXT:{Al(this,e);break}}}onStartTag(e){this.skipNextNewLine=!1,this.currentToken=e,this._processStartTag(e),e.selfClosing&&!e.ackSelfClosing&&this._err(e,se.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(e){this.shouldProcessStartTagTokenInForeignContent(e)?ZC(this,e):this._startTagOutsideForeignContent(e)}_startTagOutsideForeignContent(e){switch(this.insertionMode){case M.INITIAL:{Sl(this,e);break}case M.BEFORE_HTML:{DN(this,e);break}case M.BEFORE_HEAD:{wN(this,e);break}case M.IN_HEAD:{Ii(this,e);break}case M.IN_HEAD_NO_SCRIPT:{PN(this,e);break}case M.AFTER_HEAD:{BN(this,e);break}case M.IN_BODY:{gs(this,e);break}case M.IN_TABLE:{xu(this,e);break}case M.IN_TABLE_TEXT:{Al(this,e);break}case M.IN_CAPTION:{kC(this,e);break}case M.IN_COLUMN_GROUP:{bg(this,e);break}case M.IN_TABLE_BODY:{Wd(this,e);break}case M.IN_ROW:{Zd(this,e);break}case M.IN_CELL:{UC(this,e);break}case M.IN_SELECT:{D2(this,e);break}case M.IN_SELECT_IN_TABLE:{FC(this,e);break}case M.IN_TEMPLATE:{HC(this,e);break}case M.AFTER_BODY:{GC(this,e);break}case M.IN_FRAMESET:{VC(this,e);break}case M.AFTER_FRAMESET:{YC(this,e);break}case M.AFTER_AFTER_BODY:{zC(this,e);break}case M.AFTER_AFTER_FRAMESET:{QC(this,e);break}}}onEndTag(e){this.skipNextNewLine=!1,this.currentToken=e,this.currentNotInHTML?JC(this,e):this._endTagOutsideForeignContent(e)}_endTagOutsideForeignContent(e){switch(this.insertionMode){case M.INITIAL:{Sl(this,e);break}case M.BEFORE_HTML:{ON(this,e);break}case M.BEFORE_HEAD:{kN(this,e);break}case M.IN_HEAD:{MN(this,e);break}case M.IN_HEAD_NO_SCRIPT:{UN(this,e);break}case M.AFTER_HEAD:{FN(this,e);break}case M.IN_BODY:{Xd(this,e);break}case M.TEXT:{AC(this,e);break}case M.IN_TABLE:{Ql(this,e);break}case M.IN_TABLE_TEXT:{Al(this,e);break}case M.IN_CAPTION:{MC(this,e);break}case M.IN_COLUMN_GROUP:{PC(this,e);break}case M.IN_TABLE_BODY:{Am(this,e);break}case M.IN_ROW:{C2(this,e);break}case M.IN_CELL:{BC(this,e);break}case M.IN_SELECT:{O2(this,e);break}case M.IN_SELECT_IN_TABLE:{jC(this,e);break}case M.IN_TEMPLATE:{$C(this,e);break}case M.AFTER_BODY:{k2(this,e);break}case M.IN_FRAMESET:{qC(this,e);break}case M.AFTER_FRAMESET:{KC(this,e);break}case M.AFTER_AFTER_BODY:{nd(this,e);break}}}onEof(e){switch(this.insertionMode){case M.INITIAL:{Sl(this,e);break}case M.BEFORE_HTML:{Dl(this,e);break}case M.BEFORE_HEAD:{Ol(this,e);break}case M.IN_HEAD:{wl(this,e);break}case M.IN_HEAD_NO_SCRIPT:{kl(this,e);break}case M.AFTER_HEAD:{Ml(this,e);break}case M.IN_BODY:case M.IN_TABLE:case M.IN_CAPTION:case M.IN_COLUMN_GROUP:case M.IN_TABLE_BODY:case M.IN_ROW:case M.IN_CELL:case M.IN_SELECT:case M.IN_SELECT_IN_TABLE:{L2(this,e);break}case M.TEXT:{_C(this,e);break}case M.IN_TABLE_TEXT:{Al(this,e);break}case M.IN_TEMPLATE:{w2(this,e);break}case M.AFTER_BODY:case M.IN_FRAMESET:case M.AFTER_FRAMESET:case M.AFTER_AFTER_BODY:case M.AFTER_AFTER_FRAMESET:{pg(this,e);break}}}onWhitespaceCharacter(e){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,e.chars.charCodeAt(0)===O.LINE_FEED)){if(e.chars.length===1)return;e.chars=e.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(e);return}switch(this.insertionMode){case M.IN_HEAD:case M.IN_HEAD_NO_SCRIPT:case M.AFTER_HEAD:case M.TEXT:case M.IN_COLUMN_GROUP:case M.IN_SELECT:case M.IN_SELECT_IN_TABLE:case M.IN_FRAMESET:case M.AFTER_FRAMESET:{this._insertCharacters(e);break}case M.IN_BODY:case M.IN_CAPTION:case M.IN_CELL:case M.IN_TEMPLATE:case M.AFTER_BODY:case M.AFTER_AFTER_BODY:case M.AFTER_AFTER_FRAMESET:{y2(this,e);break}case M.IN_TABLE:case M.IN_TABLE_BODY:case M.IN_ROW:{O0(this,e);break}case M.IN_TABLE_TEXT:{I2(this,e);break}}}}function vN(s,e){let t=s.activeFormattingElements.getElementEntryInScopeWithTagName(e.tagName);return t?s.openElements.contains(t.element)?s.openElements.hasInScope(e.tagID)||(t=null):(s.activeFormattingElements.removeEntry(t),t=null):_2(s,e),t}function SN(s,e){let t=null,i=s.openElements.stackTop;for(;i>=0;i--){const a=s.openElements.items[i];if(a===e.element)break;s._isSpecialElement(a,s.openElements.tagIDs[i])&&(t=a)}return t||(s.openElements.shortenToLength(Math.max(i,0)),s.activeFormattingElements.removeEntry(e)),t}function AN(s,e,t){let i=e,a=s.openElements.getCommonAncestor(e);for(let u=0,l=a;l!==t;u++,l=a){a=s.openElements.getCommonAncestor(l);const c=s.activeFormattingElements.getElementEntry(l),f=c&&u>=TN;!c||f?(f&&s.activeFormattingElements.removeEntry(c),s.openElements.remove(l)):(l=_N(s,c),i===e&&(s.activeFormattingElements.bookmark=c),s.treeAdapter.detachNode(i),s.treeAdapter.appendChild(l,i),i=l)}return i}function _N(s,e){const t=s.treeAdapter.getNamespaceURI(e.element),i=s.treeAdapter.createElement(e.token.tagName,t,e.token.attrs);return s.openElements.replace(e.element,i),e.element=i,i}function LN(s,e,t){const i=s.treeAdapter.getTagName(e),a=zd(i);if(s._isElementCausesFosterParenting(a))s._fosterParentElement(t);else{const u=s.treeAdapter.getNamespaceURI(e);a===y.TEMPLATE&&u===de.HTML&&(e=s.treeAdapter.getTemplateContent(e)),s.treeAdapter.appendChild(e,t)}}function IN(s,e,t){const i=s.treeAdapter.getNamespaceURI(t.element),{token:a}=t,u=s.treeAdapter.createElement(a.tagName,i,a.attrs);s._adoptNodes(e,u),s.treeAdapter.appendChild(e,u),s.activeFormattingElements.insertElementAfterBookmark(u,a),s.activeFormattingElements.removeEntry(t),s.openElements.remove(t.element),s.openElements.insertAfter(e,u,a.tagID)}function gg(s,e){for(let t=0;t<xN;t++){const i=vN(s,e);if(!i)break;const a=SN(s,i);if(!a)break;s.activeFormattingElements.bookmark=i;const u=AN(s,a,i.element),l=s.openElements.getCommonAncestor(i.element);s.treeAdapter.detachNode(u),l&&LN(s,l,u),IN(s,a,i)}}function Sm(s,e){s._appendCommentNode(e,s.openElements.currentTmplContentOrNode)}function RN(s,e){s._appendCommentNode(e,s.openElements.items[0])}function NN(s,e){s._appendCommentNode(e,s.document)}function pg(s,e){if(s.stopped=!0,e.location){const t=s.fragmentContext?0:2;for(let i=s.openElements.stackTop;i>=t;i--)s._setEndLocation(s.openElements.items[i],e);if(!s.fragmentContext&&s.openElements.stackTop>=0){const i=s.openElements.items[0],a=s.treeAdapter.getNodeSourceCodeLocation(i);if(a&&!a.endTag&&(s._setEndLocation(i,e),s.openElements.stackTop>=1)){const u=s.openElements.items[1],l=s.treeAdapter.getNodeSourceCodeLocation(u);l&&!l.endTag&&s._setEndLocation(u,e)}}}}function CN(s,e){s._setDocumentType(e);const t=e.forceQuirks?Ws.QUIRKS:rN(e);aN(e)||s._err(e,se.nonConformingDoctype),s.treeAdapter.setDocumentMode(s.document,t),s.insertionMode=M.BEFORE_HTML}function Sl(s,e){s._err(e,se.missingDoctype,!0),s.treeAdapter.setDocumentMode(s.document,Ws.QUIRKS),s.insertionMode=M.BEFORE_HTML,s._processToken(e)}function DN(s,e){e.tagID===y.HTML?(s._insertElement(e,de.HTML),s.insertionMode=M.BEFORE_HEAD):Dl(s,e)}function ON(s,e){const t=e.tagID;(t===y.HTML||t===y.HEAD||t===y.BODY||t===y.BR)&&Dl(s,e)}function Dl(s,e){s._insertFakeRootElement(),s.insertionMode=M.BEFORE_HEAD,s._processToken(e)}function wN(s,e){switch(e.tagID){case y.HTML:{gs(s,e);break}case y.HEAD:{s._insertElement(e,de.HTML),s.headElement=s.openElements.current,s.insertionMode=M.IN_HEAD;break}default:Ol(s,e)}}function kN(s,e){const t=e.tagID;t===y.HEAD||t===y.BODY||t===y.HTML||t===y.BR?Ol(s,e):s._err(e,se.endTagWithoutMatchingOpenElement)}function Ol(s,e){s._insertFakeElement(K.HEAD,y.HEAD),s.headElement=s.openElements.current,s.insertionMode=M.IN_HEAD,s._processToken(e)}function Ii(s,e){switch(e.tagID){case y.HTML:{gs(s,e);break}case y.BASE:case y.BASEFONT:case y.BGSOUND:case y.LINK:case y.META:{s._appendElement(e,de.HTML),e.ackSelfClosing=!0;break}case y.TITLE:{s._switchToTextParsing(e,Us.RCDATA);break}case y.NOSCRIPT:{s.options.scriptingEnabled?s._switchToTextParsing(e,Us.RAWTEXT):(s._insertElement(e,de.HTML),s.insertionMode=M.IN_HEAD_NO_SCRIPT);break}case y.NOFRAMES:case y.STYLE:{s._switchToTextParsing(e,Us.RAWTEXT);break}case y.SCRIPT:{s._switchToTextParsing(e,Us.SCRIPT_DATA);break}case y.TEMPLATE:{s._insertTemplate(e),s.activeFormattingElements.insertMarker(),s.framesetOk=!1,s.insertionMode=M.IN_TEMPLATE,s.tmplInsertionModeStack.unshift(M.IN_TEMPLATE);break}case y.HEAD:{s._err(e,se.misplacedStartTagForHeadElement);break}default:wl(s,e)}}function MN(s,e){switch(e.tagID){case y.HEAD:{s.openElements.pop(),s.insertionMode=M.AFTER_HEAD;break}case y.BODY:case y.BR:case y.HTML:{wl(s,e);break}case y.TEMPLATE:{ur(s,e);break}default:s._err(e,se.endTagWithoutMatchingOpenElement)}}function ur(s,e){s.openElements.tmplCount>0?(s.openElements.generateImpliedEndTagsThoroughly(),s.openElements.currentTagId!==y.TEMPLATE&&s._err(e,se.closingOfElementWithOpenChildElements),s.openElements.popUntilTagNamePopped(y.TEMPLATE),s.activeFormattingElements.clearToLastMarker(),s.tmplInsertionModeStack.shift(),s._resetInsertionMode()):s._err(e,se.endTagWithoutMatchingOpenElement)}function wl(s,e){s.openElements.pop(),s.insertionMode=M.AFTER_HEAD,s._processToken(e)}function PN(s,e){switch(e.tagID){case y.HTML:{gs(s,e);break}case y.BASEFONT:case y.BGSOUND:case y.HEAD:case y.LINK:case y.META:case y.NOFRAMES:case y.STYLE:{Ii(s,e);break}case y.NOSCRIPT:{s._err(e,se.nestedNoscriptInHead);break}default:kl(s,e)}}function UN(s,e){switch(e.tagID){case y.NOSCRIPT:{s.openElements.pop(),s.insertionMode=M.IN_HEAD;break}case y.BR:{kl(s,e);break}default:s._err(e,se.endTagWithoutMatchingOpenElement)}}function kl(s,e){const t=e.type===Xe.EOF?se.openElementsLeftAfterEof:se.disallowedContentInNoscriptInHead;s._err(e,t),s.openElements.pop(),s.insertionMode=M.IN_HEAD,s._processToken(e)}function BN(s,e){switch(e.tagID){case y.HTML:{gs(s,e);break}case y.BODY:{s._insertElement(e,de.HTML),s.framesetOk=!1,s.insertionMode=M.IN_BODY;break}case y.FRAMESET:{s._insertElement(e,de.HTML),s.insertionMode=M.IN_FRAMESET;break}case y.BASE:case y.BASEFONT:case y.BGSOUND:case y.LINK:case y.META:case y.NOFRAMES:case y.SCRIPT:case y.STYLE:case y.TEMPLATE:case y.TITLE:{s._err(e,se.abandonedHeadElementChild),s.openElements.push(s.headElement,y.HEAD),Ii(s,e),s.openElements.remove(s.headElement);break}case y.HEAD:{s._err(e,se.misplacedStartTagForHeadElement);break}default:Ml(s,e)}}function FN(s,e){switch(e.tagID){case y.BODY:case y.HTML:case y.BR:{Ml(s,e);break}case y.TEMPLATE:{ur(s,e);break}default:s._err(e,se.endTagWithoutMatchingOpenElement)}}function Ml(s,e){s._insertFakeElement(K.BODY,y.BODY),s.insertionMode=M.IN_BODY,Qd(s,e)}function Qd(s,e){switch(e.type){case Xe.CHARACTER:{v2(s,e);break}case Xe.WHITESPACE_CHARACTER:{y2(s,e);break}case Xe.COMMENT:{Sm(s,e);break}case Xe.START_TAG:{gs(s,e);break}case Xe.END_TAG:{Xd(s,e);break}case Xe.EOF:{L2(s,e);break}}}function y2(s,e){s._reconstructActiveFormattingElements(),s._insertCharacters(e)}function v2(s,e){s._reconstructActiveFormattingElements(),s._insertCharacters(e),s.framesetOk=!1}function jN(s,e){s.openElements.tmplCount===0&&s.treeAdapter.adoptAttributes(s.openElements.items[0],e.attrs)}function HN(s,e){const t=s.openElements.tryPeekProperlyNestedBodyElement();t&&s.openElements.tmplCount===0&&(s.framesetOk=!1,s.treeAdapter.adoptAttributes(t,e.attrs))}function $N(s,e){const t=s.openElements.tryPeekProperlyNestedBodyElement();s.framesetOk&&t&&(s.treeAdapter.detachNode(t),s.openElements.popAllUpToHtmlElement(),s._insertElement(e,de.HTML),s.insertionMode=M.IN_FRAMESET)}function GN(s,e){s.openElements.hasInButtonScope(y.P)&&s._closePElement(),s._insertElement(e,de.HTML)}function VN(s,e){s.openElements.hasInButtonScope(y.P)&&s._closePElement(),s.openElements.currentTagId!==void 0&&vm.has(s.openElements.currentTagId)&&s.openElements.pop(),s._insertElement(e,de.HTML)}function qN(s,e){s.openElements.hasInButtonScope(y.P)&&s._closePElement(),s._insertElement(e,de.HTML),s.skipNextNewLine=!0,s.framesetOk=!1}function YN(s,e){const t=s.openElements.tmplCount>0;(!s.formElement||t)&&(s.openElements.hasInButtonScope(y.P)&&s._closePElement(),s._insertElement(e,de.HTML),t||(s.formElement=s.openElements.current))}function KN(s,e){s.framesetOk=!1;const t=e.tagID;for(let i=s.openElements.stackTop;i>=0;i--){const a=s.openElements.tagIDs[i];if(t===y.LI&&a===y.LI||(t===y.DD||t===y.DT)&&(a===y.DD||a===y.DT)){s.openElements.generateImpliedEndTagsWithExclusion(a),s.openElements.popUntilTagNamePopped(a);break}if(a!==y.ADDRESS&&a!==y.DIV&&a!==y.P&&s._isSpecialElement(s.openElements.items[i],a))break}s.openElements.hasInButtonScope(y.P)&&s._closePElement(),s._insertElement(e,de.HTML)}function zN(s,e){s.openElements.hasInButtonScope(y.P)&&s._closePElement(),s._insertElement(e,de.HTML),s.tokenizer.state=Us.PLAINTEXT}function QN(s,e){s.openElements.hasInScope(y.BUTTON)&&(s.openElements.generateImpliedEndTags(),s.openElements.popUntilTagNamePopped(y.BUTTON)),s._reconstructActiveFormattingElements(),s._insertElement(e,de.HTML),s.framesetOk=!1}function XN(s,e){const t=s.activeFormattingElements.getElementEntryInScopeWithTagName(K.A);t&&(gg(s,e),s.openElements.remove(t.element),s.activeFormattingElements.removeEntry(t)),s._reconstructActiveFormattingElements(),s._insertElement(e,de.HTML),s.activeFormattingElements.pushElement(s.openElements.current,e)}function WN(s,e){s._reconstructActiveFormattingElements(),s._insertElement(e,de.HTML),s.activeFormattingElements.pushElement(s.openElements.current,e)}function ZN(s,e){s._reconstructActiveFormattingElements(),s.openElements.hasInScope(y.NOBR)&&(gg(s,e),s._reconstructActiveFormattingElements()),s._insertElement(e,de.HTML),s.activeFormattingElements.pushElement(s.openElements.current,e)}function JN(s,e){s._reconstructActiveFormattingElements(),s._insertElement(e,de.HTML),s.activeFormattingElements.insertMarker(),s.framesetOk=!1}function eC(s,e){s.treeAdapter.getDocumentMode(s.document)!==Ws.QUIRKS&&s.openElements.hasInButtonScope(y.P)&&s._closePElement(),s._insertElement(e,de.HTML),s.framesetOk=!1,s.insertionMode=M.IN_TABLE}function S2(s,e){s._reconstructActiveFormattingElements(),s._appendElement(e,de.HTML),s.framesetOk=!1,e.ackSelfClosing=!0}function A2(s){const e=d2(s,Ja.TYPE);return e!=null&&e.toLowerCase()===EN}function tC(s,e){s._reconstructActiveFormattingElements(),s._appendElement(e,de.HTML),A2(e)||(s.framesetOk=!1),e.ackSelfClosing=!0}function sC(s,e){s._appendElement(e,de.HTML),e.ackSelfClosing=!0}function iC(s,e){s.openElements.hasInButtonScope(y.P)&&s._closePElement(),s._appendElement(e,de.HTML),s.framesetOk=!1,e.ackSelfClosing=!0}function nC(s,e){e.tagName=K.IMG,e.tagID=y.IMG,S2(s,e)}function aC(s,e){s._insertElement(e,de.HTML),s.skipNextNewLine=!0,s.tokenizer.state=Us.RCDATA,s.originalInsertionMode=s.insertionMode,s.framesetOk=!1,s.insertionMode=M.TEXT}function rC(s,e){s.openElements.hasInButtonScope(y.P)&&s._closePElement(),s._reconstructActiveFormattingElements(),s.framesetOk=!1,s._switchToTextParsing(e,Us.RAWTEXT)}function uC(s,e){s.framesetOk=!1,s._switchToTextParsing(e,Us.RAWTEXT)}function Ox(s,e){s._switchToTextParsing(e,Us.RAWTEXT)}function lC(s,e){s._reconstructActiveFormattingElements(),s._insertElement(e,de.HTML),s.framesetOk=!1,s.insertionMode=s.insertionMode===M.IN_TABLE||s.insertionMode===M.IN_CAPTION||s.insertionMode===M.IN_TABLE_BODY||s.insertionMode===M.IN_ROW||s.insertionMode===M.IN_CELL?M.IN_SELECT_IN_TABLE:M.IN_SELECT}function oC(s,e){s.openElements.currentTagId===y.OPTION&&s.openElements.pop(),s._reconstructActiveFormattingElements(),s._insertElement(e,de.HTML)}function cC(s,e){s.openElements.hasInScope(y.RUBY)&&s.openElements.generateImpliedEndTags(),s._insertElement(e,de.HTML)}function dC(s,e){s.openElements.hasInScope(y.RUBY)&&s.openElements.generateImpliedEndTagsWithExclusion(y.RTC),s._insertElement(e,de.HTML)}function fC(s,e){s._reconstructActiveFormattingElements(),b2(e),mg(e),e.selfClosing?s._appendElement(e,de.MATHML):s._insertElement(e,de.MATHML),e.ackSelfClosing=!0}function hC(s,e){s._reconstructActiveFormattingElements(),E2(e),mg(e),e.selfClosing?s._appendElement(e,de.SVG):s._insertElement(e,de.SVG),e.ackSelfClosing=!0}function wx(s,e){s._reconstructActiveFormattingElements(),s._insertElement(e,de.HTML)}function gs(s,e){switch(e.tagID){case y.I:case y.S:case y.B:case y.U:case y.EM:case y.TT:case y.BIG:case y.CODE:case y.FONT:case y.SMALL:case y.STRIKE:case y.STRONG:{WN(s,e);break}case y.A:{XN(s,e);break}case y.H1:case y.H2:case y.H3:case y.H4:case y.H5:case y.H6:{VN(s,e);break}case y.P:case y.DL:case y.OL:case y.UL:case y.DIV:case y.DIR:case y.NAV:case y.MAIN:case y.MENU:case y.ASIDE:case y.CENTER:case y.FIGURE:case y.FOOTER:case y.HEADER:case y.HGROUP:case y.DIALOG:case y.DETAILS:case y.ADDRESS:case y.ARTICLE:case y.SEARCH:case y.SECTION:case y.SUMMARY:case y.FIELDSET:case y.BLOCKQUOTE:case y.FIGCAPTION:{GN(s,e);break}case y.LI:case y.DD:case y.DT:{KN(s,e);break}case y.BR:case y.IMG:case y.WBR:case y.AREA:case y.EMBED:case y.KEYGEN:{S2(s,e);break}case y.HR:{iC(s,e);break}case y.RB:case y.RTC:{cC(s,e);break}case y.RT:case y.RP:{dC(s,e);break}case y.PRE:case y.LISTING:{qN(s,e);break}case y.XMP:{rC(s,e);break}case y.SVG:{hC(s,e);break}case y.HTML:{jN(s,e);break}case y.BASE:case y.LINK:case y.META:case y.STYLE:case y.TITLE:case y.SCRIPT:case y.BGSOUND:case y.BASEFONT:case y.TEMPLATE:{Ii(s,e);break}case y.BODY:{HN(s,e);break}case y.FORM:{YN(s,e);break}case y.NOBR:{ZN(s,e);break}case y.MATH:{fC(s,e);break}case y.TABLE:{eC(s,e);break}case y.INPUT:{tC(s,e);break}case y.PARAM:case y.TRACK:case y.SOURCE:{sC(s,e);break}case y.IMAGE:{nC(s,e);break}case y.BUTTON:{QN(s,e);break}case y.APPLET:case y.OBJECT:case y.MARQUEE:{JN(s,e);break}case y.IFRAME:{uC(s,e);break}case y.SELECT:{lC(s,e);break}case y.OPTION:case y.OPTGROUP:{oC(s,e);break}case y.NOEMBED:case y.NOFRAMES:{Ox(s,e);break}case y.FRAMESET:{$N(s,e);break}case y.TEXTAREA:{aC(s,e);break}case y.NOSCRIPT:{s.options.scriptingEnabled?Ox(s,e):wx(s,e);break}case y.PLAINTEXT:{zN(s,e);break}case y.COL:case y.TH:case y.TD:case y.TR:case y.HEAD:case y.FRAME:case y.TBODY:case y.TFOOT:case y.THEAD:case y.CAPTION:case y.COLGROUP:break;default:wx(s,e)}}function mC(s,e){if(s.openElements.hasInScope(y.BODY)&&(s.insertionMode=M.AFTER_BODY,s.options.sourceCodeLocationInfo)){const t=s.openElements.tryPeekProperlyNestedBodyElement();t&&s._setEndLocation(t,e)}}function gC(s,e){s.openElements.hasInScope(y.BODY)&&(s.insertionMode=M.AFTER_BODY,k2(s,e))}function pC(s,e){const t=e.tagID;s.openElements.hasInScope(t)&&(s.openElements.generateImpliedEndTags(),s.openElements.popUntilTagNamePopped(t))}function bC(s){const e=s.openElements.tmplCount>0,{formElement:t}=s;e||(s.formElement=null),(t||e)&&s.openElements.hasInScope(y.FORM)&&(s.openElements.generateImpliedEndTags(),e?s.openElements.popUntilTagNamePopped(y.FORM):t&&s.openElements.remove(t))}function EC(s){s.openElements.hasInButtonScope(y.P)||s._insertFakeElement(K.P,y.P),s._closePElement()}function xC(s){s.openElements.hasInListItemScope(y.LI)&&(s.openElements.generateImpliedEndTagsWithExclusion(y.LI),s.openElements.popUntilTagNamePopped(y.LI))}function TC(s,e){const t=e.tagID;s.openElements.hasInScope(t)&&(s.openElements.generateImpliedEndTagsWithExclusion(t),s.openElements.popUntilTagNamePopped(t))}function yC(s){s.openElements.hasNumberedHeaderInScope()&&(s.openElements.generateImpliedEndTags(),s.openElements.popUntilNumberedHeaderPopped())}function vC(s,e){const t=e.tagID;s.openElements.hasInScope(t)&&(s.openElements.generateImpliedEndTags(),s.openElements.popUntilTagNamePopped(t),s.activeFormattingElements.clearToLastMarker())}function SC(s){s._reconstructActiveFormattingElements(),s._insertFakeElement(K.BR,y.BR),s.openElements.pop(),s.framesetOk=!1}function _2(s,e){const t=e.tagName,i=e.tagID;for(let a=s.openElements.stackTop;a>0;a--){const u=s.openElements.items[a],l=s.openElements.tagIDs[a];if(i===l&&(i!==y.UNKNOWN||s.treeAdapter.getTagName(u)===t)){s.openElements.generateImpliedEndTagsWithExclusion(i),s.openElements.stackTop>=a&&s.openElements.shortenToLength(a);break}if(s._isSpecialElement(u,l))break}}function Xd(s,e){switch(e.tagID){case y.A:case y.B:case y.I:case y.S:case y.U:case y.EM:case y.TT:case y.BIG:case y.CODE:case y.FONT:case y.NOBR:case y.SMALL:case y.STRIKE:case y.STRONG:{gg(s,e);break}case y.P:{EC(s);break}case y.DL:case y.UL:case y.OL:case y.DIR:case y.DIV:case y.NAV:case y.PRE:case y.MAIN:case y.MENU:case y.ASIDE:case y.BUTTON:case y.CENTER:case y.FIGURE:case y.FOOTER:case y.HEADER:case y.HGROUP:case y.DIALOG:case y.ADDRESS:case y.ARTICLE:case y.DETAILS:case y.SEARCH:case y.SECTION:case y.SUMMARY:case y.LISTING:case y.FIELDSET:case y.BLOCKQUOTE:case y.FIGCAPTION:{pC(s,e);break}case y.LI:{xC(s);break}case y.DD:case y.DT:{TC(s,e);break}case y.H1:case y.H2:case y.H3:case y.H4:case y.H5:case y.H6:{yC(s);break}case y.BR:{SC(s);break}case y.BODY:{mC(s,e);break}case y.HTML:{gC(s,e);break}case y.FORM:{bC(s);break}case y.APPLET:case y.OBJECT:case y.MARQUEE:{vC(s,e);break}case y.TEMPLATE:{ur(s,e);break}default:_2(s,e)}}function L2(s,e){s.tmplInsertionModeStack.length>0?w2(s,e):pg(s,e)}function AC(s,e){var t;e.tagID===y.SCRIPT&&((t=s.scriptHandler)===null||t===void 0||t.call(s,s.openElements.current)),s.openElements.pop(),s.insertionMode=s.originalInsertionMode}function _C(s,e){s._err(e,se.eofInElementThatCanContainOnlyText),s.openElements.pop(),s.insertionMode=s.originalInsertionMode,s.onEof(e)}function O0(s,e){if(s.openElements.currentTagId!==void 0&&x2.has(s.openElements.currentTagId))switch(s.pendingCharacterTokens.length=0,s.hasNonWhitespacePendingCharacterToken=!1,s.originalInsertionMode=s.insertionMode,s.insertionMode=M.IN_TABLE_TEXT,e.type){case Xe.CHARACTER:{R2(s,e);break}case Xe.WHITESPACE_CHARACTER:{I2(s,e);break}}else fo(s,e)}function LC(s,e){s.openElements.clearBackToTableContext(),s.activeFormattingElements.insertMarker(),s._insertElement(e,de.HTML),s.insertionMode=M.IN_CAPTION}function IC(s,e){s.openElements.clearBackToTableContext(),s._insertElement(e,de.HTML),s.insertionMode=M.IN_COLUMN_GROUP}function RC(s,e){s.openElements.clearBackToTableContext(),s._insertFakeElement(K.COLGROUP,y.COLGROUP),s.insertionMode=M.IN_COLUMN_GROUP,bg(s,e)}function NC(s,e){s.openElements.clearBackToTableContext(),s._insertElement(e,de.HTML),s.insertionMode=M.IN_TABLE_BODY}function CC(s,e){s.openElements.clearBackToTableContext(),s._insertFakeElement(K.TBODY,y.TBODY),s.insertionMode=M.IN_TABLE_BODY,Wd(s,e)}function DC(s,e){s.openElements.hasInTableScope(y.TABLE)&&(s.openElements.popUntilTagNamePopped(y.TABLE),s._resetInsertionMode(),s._processStartTag(e))}function OC(s,e){A2(e)?s._appendElement(e,de.HTML):fo(s,e),e.ackSelfClosing=!0}function wC(s,e){!s.formElement&&s.openElements.tmplCount===0&&(s._insertElement(e,de.HTML),s.formElement=s.openElements.current,s.openElements.pop())}function xu(s,e){switch(e.tagID){case y.TD:case y.TH:case y.TR:{CC(s,e);break}case y.STYLE:case y.SCRIPT:case y.TEMPLATE:{Ii(s,e);break}case y.COL:{RC(s,e);break}case y.FORM:{wC(s,e);break}case y.TABLE:{DC(s,e);break}case y.TBODY:case y.TFOOT:case y.THEAD:{NC(s,e);break}case y.INPUT:{OC(s,e);break}case y.CAPTION:{LC(s,e);break}case y.COLGROUP:{IC(s,e);break}default:fo(s,e)}}function Ql(s,e){switch(e.tagID){case y.TABLE:{s.openElements.hasInTableScope(y.TABLE)&&(s.openElements.popUntilTagNamePopped(y.TABLE),s._resetInsertionMode());break}case y.TEMPLATE:{ur(s,e);break}case y.BODY:case y.CAPTION:case y.COL:case y.COLGROUP:case y.HTML:case y.TBODY:case y.TD:case y.TFOOT:case y.TH:case y.THEAD:case y.TR:break;default:fo(s,e)}}function fo(s,e){const t=s.fosterParentingEnabled;s.fosterParentingEnabled=!0,Qd(s,e),s.fosterParentingEnabled=t}function I2(s,e){s.pendingCharacterTokens.push(e)}function R2(s,e){s.pendingCharacterTokens.push(e),s.hasNonWhitespacePendingCharacterToken=!0}function Al(s,e){let t=0;if(s.hasNonWhitespacePendingCharacterToken)for(;t<s.pendingCharacterTokens.length;t++)fo(s,s.pendingCharacterTokens[t]);else for(;t<s.pendingCharacterTokens.length;t++)s._insertCharacters(s.pendingCharacterTokens[t]);s.insertionMode=s.originalInsertionMode,s._processToken(e)}const N2=new Set([y.CAPTION,y.COL,y.COLGROUP,y.TBODY,y.TD,y.TFOOT,y.TH,y.THEAD,y.TR]);function kC(s,e){const t=e.tagID;N2.has(t)?s.openElements.hasInTableScope(y.CAPTION)&&(s.openElements.generateImpliedEndTags(),s.openElements.popUntilTagNamePopped(y.CAPTION),s.activeFormattingElements.clearToLastMarker(),s.insertionMode=M.IN_TABLE,xu(s,e)):gs(s,e)}function MC(s,e){const t=e.tagID;switch(t){case y.CAPTION:case y.TABLE:{s.openElements.hasInTableScope(y.CAPTION)&&(s.openElements.generateImpliedEndTags(),s.openElements.popUntilTagNamePopped(y.CAPTION),s.activeFormattingElements.clearToLastMarker(),s.insertionMode=M.IN_TABLE,t===y.TABLE&&Ql(s,e));break}case y.BODY:case y.COL:case y.COLGROUP:case y.HTML:case y.TBODY:case y.TD:case y.TFOOT:case y.TH:case y.THEAD:case y.TR:break;default:Xd(s,e)}}function bg(s,e){switch(e.tagID){case y.HTML:{gs(s,e);break}case y.COL:{s._appendElement(e,de.HTML),e.ackSelfClosing=!0;break}case y.TEMPLATE:{Ii(s,e);break}default:Ld(s,e)}}function PC(s,e){switch(e.tagID){case y.COLGROUP:{s.openElements.currentTagId===y.COLGROUP&&(s.openElements.pop(),s.insertionMode=M.IN_TABLE);break}case y.TEMPLATE:{ur(s,e);break}case y.COL:break;default:Ld(s,e)}}function Ld(s,e){s.openElements.currentTagId===y.COLGROUP&&(s.openElements.pop(),s.insertionMode=M.IN_TABLE,s._processToken(e))}function Wd(s,e){switch(e.tagID){case y.TR:{s.openElements.clearBackToTableBodyContext(),s._insertElement(e,de.HTML),s.insertionMode=M.IN_ROW;break}case y.TH:case y.TD:{s.openElements.clearBackToTableBodyContext(),s._insertFakeElement(K.TR,y.TR),s.insertionMode=M.IN_ROW,Zd(s,e);break}case y.CAPTION:case y.COL:case y.COLGROUP:case y.TBODY:case y.TFOOT:case y.THEAD:{s.openElements.hasTableBodyContextInTableScope()&&(s.openElements.clearBackToTableBodyContext(),s.openElements.pop(),s.insertionMode=M.IN_TABLE,xu(s,e));break}default:xu(s,e)}}function Am(s,e){const t=e.tagID;switch(e.tagID){case y.TBODY:case y.TFOOT:case y.THEAD:{s.openElements.hasInTableScope(t)&&(s.openElements.clearBackToTableBodyContext(),s.openElements.pop(),s.insertionMode=M.IN_TABLE);break}case y.TABLE:{s.openElements.hasTableBodyContextInTableScope()&&(s.openElements.clearBackToTableBodyContext(),s.openElements.pop(),s.insertionMode=M.IN_TABLE,Ql(s,e));break}case y.BODY:case y.CAPTION:case y.COL:case y.COLGROUP:case y.HTML:case y.TD:case y.TH:case y.TR:break;default:Ql(s,e)}}function Zd(s,e){switch(e.tagID){case y.TH:case y.TD:{s.openElements.clearBackToTableRowContext(),s._insertElement(e,de.HTML),s.insertionMode=M.IN_CELL,s.activeFormattingElements.insertMarker();break}case y.CAPTION:case y.COL:case y.COLGROUP:case y.TBODY:case y.TFOOT:case y.THEAD:case y.TR:{s.openElements.hasInTableScope(y.TR)&&(s.openElements.clearBackToTableRowContext(),s.openElements.pop(),s.insertionMode=M.IN_TABLE_BODY,Wd(s,e));break}default:xu(s,e)}}function C2(s,e){switch(e.tagID){case y.TR:{s.openElements.hasInTableScope(y.TR)&&(s.openElements.clearBackToTableRowContext(),s.openElements.pop(),s.insertionMode=M.IN_TABLE_BODY);break}case y.TABLE:{s.openElements.hasInTableScope(y.TR)&&(s.openElements.clearBackToTableRowContext(),s.openElements.pop(),s.insertionMode=M.IN_TABLE_BODY,Am(s,e));break}case y.TBODY:case y.TFOOT:case y.THEAD:{(s.openElements.hasInTableScope(e.tagID)||s.openElements.hasInTableScope(y.TR))&&(s.openElements.clearBackToTableRowContext(),s.openElements.pop(),s.insertionMode=M.IN_TABLE_BODY,Am(s,e));break}case y.BODY:case y.CAPTION:case y.COL:case y.COLGROUP:case y.HTML:case y.TD:case y.TH:break;default:Ql(s,e)}}function UC(s,e){const t=e.tagID;N2.has(t)?(s.openElements.hasInTableScope(y.TD)||s.openElements.hasInTableScope(y.TH))&&(s._closeTableCell(),Zd(s,e)):gs(s,e)}function BC(s,e){const t=e.tagID;switch(t){case y.TD:case y.TH:{s.openElements.hasInTableScope(t)&&(s.openElements.generateImpliedEndTags(),s.openElements.popUntilTagNamePopped(t),s.activeFormattingElements.clearToLastMarker(),s.insertionMode=M.IN_ROW);break}case y.TABLE:case y.TBODY:case y.TFOOT:case y.THEAD:case y.TR:{s.openElements.hasInTableScope(t)&&(s._closeTableCell(),C2(s,e));break}case y.BODY:case y.CAPTION:case y.COL:case y.COLGROUP:case y.HTML:break;default:Xd(s,e)}}function D2(s,e){switch(e.tagID){case y.HTML:{gs(s,e);break}case y.OPTION:{s.openElements.currentTagId===y.OPTION&&s.openElements.pop(),s._insertElement(e,de.HTML);break}case y.OPTGROUP:{s.openElements.currentTagId===y.OPTION&&s.openElements.pop(),s.openElements.currentTagId===y.OPTGROUP&&s.openElements.pop(),s._insertElement(e,de.HTML);break}case y.HR:{s.openElements.currentTagId===y.OPTION&&s.openElements.pop(),s.openElements.currentTagId===y.OPTGROUP&&s.openElements.pop(),s._appendElement(e,de.HTML),e.ackSelfClosing=!0;break}case y.INPUT:case y.KEYGEN:case y.TEXTAREA:case y.SELECT:{s.openElements.hasInSelectScope(y.SELECT)&&(s.openElements.popUntilTagNamePopped(y.SELECT),s._resetInsertionMode(),e.tagID!==y.SELECT&&s._processStartTag(e));break}case y.SCRIPT:case y.TEMPLATE:{Ii(s,e);break}}}function O2(s,e){switch(e.tagID){case y.OPTGROUP:{s.openElements.stackTop>0&&s.openElements.currentTagId===y.OPTION&&s.openElements.tagIDs[s.openElements.stackTop-1]===y.OPTGROUP&&s.openElements.pop(),s.openElements.currentTagId===y.OPTGROUP&&s.openElements.pop();break}case y.OPTION:{s.openElements.currentTagId===y.OPTION&&s.openElements.pop();break}case y.SELECT:{s.openElements.hasInSelectScope(y.SELECT)&&(s.openElements.popUntilTagNamePopped(y.SELECT),s._resetInsertionMode());break}case y.TEMPLATE:{ur(s,e);break}}}function FC(s,e){const t=e.tagID;t===y.CAPTION||t===y.TABLE||t===y.TBODY||t===y.TFOOT||t===y.THEAD||t===y.TR||t===y.TD||t===y.TH?(s.openElements.popUntilTagNamePopped(y.SELECT),s._resetInsertionMode(),s._processStartTag(e)):D2(s,e)}function jC(s,e){const t=e.tagID;t===y.CAPTION||t===y.TABLE||t===y.TBODY||t===y.TFOOT||t===y.THEAD||t===y.TR||t===y.TD||t===y.TH?s.openElements.hasInTableScope(t)&&(s.openElements.popUntilTagNamePopped(y.SELECT),s._resetInsertionMode(),s.onEndTag(e)):O2(s,e)}function HC(s,e){switch(e.tagID){case y.BASE:case y.BASEFONT:case y.BGSOUND:case y.LINK:case y.META:case y.NOFRAMES:case y.SCRIPT:case y.STYLE:case y.TEMPLATE:case y.TITLE:{Ii(s,e);break}case y.CAPTION:case y.COLGROUP:case y.TBODY:case y.TFOOT:case y.THEAD:{s.tmplInsertionModeStack[0]=M.IN_TABLE,s.insertionMode=M.IN_TABLE,xu(s,e);break}case y.COL:{s.tmplInsertionModeStack[0]=M.IN_COLUMN_GROUP,s.insertionMode=M.IN_COLUMN_GROUP,bg(s,e);break}case y.TR:{s.tmplInsertionModeStack[0]=M.IN_TABLE_BODY,s.insertionMode=M.IN_TABLE_BODY,Wd(s,e);break}case y.TD:case y.TH:{s.tmplInsertionModeStack[0]=M.IN_ROW,s.insertionMode=M.IN_ROW,Zd(s,e);break}default:s.tmplInsertionModeStack[0]=M.IN_BODY,s.insertionMode=M.IN_BODY,gs(s,e)}}function $C(s,e){e.tagID===y.TEMPLATE&&ur(s,e)}function w2(s,e){s.openElements.tmplCount>0?(s.openElements.popUntilTagNamePopped(y.TEMPLATE),s.activeFormattingElements.clearToLastMarker(),s.tmplInsertionModeStack.shift(),s._resetInsertionMode(),s.onEof(e)):pg(s,e)}function GC(s,e){e.tagID===y.HTML?gs(s,e):Id(s,e)}function k2(s,e){var t;if(e.tagID===y.HTML){if(s.fragmentContext||(s.insertionMode=M.AFTER_AFTER_BODY),s.options.sourceCodeLocationInfo&&s.openElements.tagIDs[0]===y.HTML){s._setEndLocation(s.openElements.items[0],e);const i=s.openElements.items[1];i&&!(!((t=s.treeAdapter.getNodeSourceCodeLocation(i))===null||t===void 0)&&t.endTag)&&s._setEndLocation(i,e)}}else Id(s,e)}function Id(s,e){s.insertionMode=M.IN_BODY,Qd(s,e)}function VC(s,e){switch(e.tagID){case y.HTML:{gs(s,e);break}case y.FRAMESET:{s._insertElement(e,de.HTML);break}case y.FRAME:{s._appendElement(e,de.HTML),e.ackSelfClosing=!0;break}case y.NOFRAMES:{Ii(s,e);break}}}function qC(s,e){e.tagID===y.FRAMESET&&!s.openElements.isRootHtmlElementCurrent()&&(s.openElements.pop(),!s.fragmentContext&&s.openElements.currentTagId!==y.FRAMESET&&(s.insertionMode=M.AFTER_FRAMESET))}function YC(s,e){switch(e.tagID){case y.HTML:{gs(s,e);break}case y.NOFRAMES:{Ii(s,e);break}}}function KC(s,e){e.tagID===y.HTML&&(s.insertionMode=M.AFTER_AFTER_FRAMESET)}function zC(s,e){e.tagID===y.HTML?gs(s,e):nd(s,e)}function nd(s,e){s.insertionMode=M.IN_BODY,Qd(s,e)}function QC(s,e){switch(e.tagID){case y.HTML:{gs(s,e);break}case y.NOFRAMES:{Ii(s,e);break}}}function XC(s,e){e.chars=bt,s._insertCharacters(e)}function WC(s,e){s._insertCharacters(e),s.framesetOk=!1}function M2(s){for(;s.treeAdapter.getNamespaceURI(s.openElements.current)!==de.HTML&&s.openElements.currentTagId!==void 0&&!s._isIntegrationPoint(s.openElements.currentTagId,s.openElements.current);)s.openElements.pop()}function ZC(s,e){if(hN(e))M2(s),s._startTagOutsideForeignContent(e);else{const t=s._getAdjustedCurrentElement(),i=s.treeAdapter.getNamespaceURI(t);i===de.MATHML?b2(e):i===de.SVG&&(mN(e),E2(e)),mg(e),e.selfClosing?s._appendElement(e,i):s._insertElement(e,i),e.ackSelfClosing=!0}}function JC(s,e){if(e.tagID===y.P||e.tagID===y.BR){M2(s),s._endTagOutsideForeignContent(e);return}for(let t=s.openElements.stackTop;t>0;t--){const i=s.openElements.items[t];if(s.treeAdapter.getNamespaceURI(i)===de.HTML){s._endTagOutsideForeignContent(e);break}const a=s.treeAdapter.getTagName(i);if(a.toLowerCase()===e.tagName){e.tagName=a,s.openElements.shortenToLength(t);break}}}function P2(s,e){return function(i){let a,u=0,l="";for(;a=s.exec(i);)u!==a.index&&(l+=i.substring(u,a.index)),l+=e.get(a[0].charCodeAt(0)),u=a.index+1;return l+i.substring(u)}}const e4=P2(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),t4=P2(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]])),s4=new Set([K.AREA,K.BASE,K.BASEFONT,K.BGSOUND,K.BR,K.COL,K.EMBED,K.FRAME,K.HR,K.IMG,K.INPUT,K.KEYGEN,K.LINK,K.META,K.PARAM,K.SOURCE,K.TRACK,K.WBR]);function i4(s,e){return e.treeAdapter.isElementNode(s)&&e.treeAdapter.getNamespaceURI(s)===de.HTML&&s4.has(e.treeAdapter.getTagName(s))}const n4={treeAdapter:Tn,scriptingEnabled:!0};function a4(s,e){const t={...n4,...e};return U2(s,t)}function r4(s,e){let t="";const i=e.treeAdapter.isElementNode(s)&&e.treeAdapter.getTagName(s)===K.TEMPLATE&&e.treeAdapter.getNamespaceURI(s)===de.HTML?e.treeAdapter.getTemplateContent(s):s,a=e.treeAdapter.getChildNodes(i);if(a)for(const u of a)t+=U2(u,e);return t}function U2(s,e){return e.treeAdapter.isElementNode(s)?u4(s,e):e.treeAdapter.isTextNode(s)?o4(s,e):e.treeAdapter.isCommentNode(s)?c4(s,e):e.treeAdapter.isDocumentTypeNode(s)?d4(s,e):""}function u4(s,e){const t=e.treeAdapter.getTagName(s);return`<${t}${l4(s,e)}>${i4(s,e)?"":`${r4(s,e)}</${t}>`}`}function l4(s,{treeAdapter:e}){let t="";for(const i of e.getAttrList(s)){if(t+=" ",i.namespace)switch(i.namespace){case de.XML:{t+=`xml:${i.name}`;break}case de.XMLNS:{i.name!=="xmlns"&&(t+="xmlns:"),t+=i.name;break}case de.XLINK:{t+=`xlink:${i.name}`;break}default:t+=`${i.prefix}:${i.name}`}else t+=i.name;t+=`="${e4(i.value)}"`}return t}function o4(s,e){const{treeAdapter:t}=e,i=t.getTextNodeContent(s),a=t.getParentNode(s),u=a&&t.isElementNode(a)&&t.getTagName(a);return u&&t.getNamespaceURI(a)===de.HTML&&HR(u,e.scriptingEnabled)?i:t4(i)}function c4(s,{treeAdapter:e}){return`<!--${e.getCommentNodeContent(s)}-->`}function d4(s,{treeAdapter:e}){return`<!DOCTYPE ${e.getDocumentTypeNodeName(s)}>`}function f4(s,e){return T2.parse(s,e)}function h4(s,e,t){typeof s=="string"&&(t=e,e=s,s=null);const i=T2.getFragmentParser(s,t);return i.tokenizer.write(e,!0),i.getFragment()}function kx(s){const e=s.includes('"')?"'":'"';return e+s+e}function m4(s,e,t){let i="!DOCTYPE ";return s&&(i+=s),e?i+=` PUBLIC ${kx(e)}`:t&&(i+=" SYSTEM"),t&&(i+=` ${kx(t)}`),i}const na={isCommentNode:Gd,isElementNode:De,isTextNode:Ki,createDocument(){const s=new sr([]);return s["x-mode"]=Ws.NO_QUIRKS,s},createDocumentFragment(){return new sr([])},createElement(s,e,t){const i=Object.create(null),a=Object.create(null),u=Object.create(null);for(let c=0;c<t.length;c++){const f=t[c].name;i[f]=t[c].value,a[f]=t[c].namespace,u[f]=t[c].prefix}const l=new eg(s,i,[]);return l.namespace=e,l["x-attribsNamespace"]=a,l["x-attribsPrefix"]=u,l},createCommentNode(s){return new Wm(s)},createTextNode(s){return new Vl(s)},appendChild(s,e){const t=s.children[s.children.length-1];t&&(t.next=e,e.prev=t),s.children.push(e),e.parent=s},insertBefore(s,e,t){const i=s.children.indexOf(t),{prev:a}=t;a&&(a.next=e,e.prev=a),t.prev=e,e.next=t,s.children.splice(i,0,e),e.parent=s},setTemplateContent(s,e){na.appendChild(s,e)},getTemplateContent(s){return s.children[0]},setDocumentType(s,e,t,i){const a=m4(e,t,i);let u=s.children.find(l=>fm(l)&&l.name==="!doctype");u?u.data=a??null:(u=new Zm("!doctype",a),na.appendChild(s,u)),u["x-name"]=e,u["x-publicId"]=t,u["x-systemId"]=i},setDocumentMode(s,e){s["x-mode"]=e},getDocumentMode(s){return s["x-mode"]},detachNode(s){if(s.parent){const e=s.parent.children.indexOf(s),{prev:t,next:i}=s;s.prev=null,s.next=null,t&&(t.next=i),i&&(i.prev=t),s.parent.children.splice(e,1),s.parent=null}},insertText(s,e){const t=s.children[s.children.length-1];t&&Ki(t)?t.data+=e:na.appendChild(s,na.createTextNode(e))},insertTextBefore(s,e,t){const i=s.children[s.children.indexOf(t)-1];i&&Ki(i)?i.data+=e:na.insertBefore(s,na.createTextNode(e),t)},adoptAttributes(s,e){for(let t=0;t<e.length;t++){const i=e[t].name;s.attribs[i]===void 0&&(s.attribs[i]=e[t].value,s["x-attribsNamespace"][i]=e[t].namespace,s["x-attribsPrefix"][i]=e[t].prefix)}},getFirstChild(s){return s.children[0]},getChildNodes(s){return s.children},getParentNode(s){return s.parent},getAttrList(s){return s.attributes},getTagName(s){return s.name},getNamespaceURI(s){return s.namespace},getTextNodeContent(s){return s.data},getCommentNodeContent(s){return s.data},getDocumentTypeNodeName(s){var e;return(e=s["x-name"])!==null&&e!==void 0?e:""},getDocumentTypeNodePublicId(s){var e;return(e=s["x-publicId"])!==null&&e!==void 0?e:""},getDocumentTypeNodeSystemId(s){var e;return(e=s["x-systemId"])!==null&&e!==void 0?e:""},isDocumentTypeNode(s){return fm(s)&&s.name==="!doctype"},setNodeSourceCodeLocation(s,e){e&&(s.startIndex=e.startOffset,s.endIndex=e.endOffset),s.sourceCodeLocation=e},getNodeSourceCodeLocation(s){return s.sourceCodeLocation},updateNodeSourceCodeLocation(s,e){e.endOffset!=null&&(s.endIndex=e.endOffset),s.sourceCodeLocation={...s.sourceCodeLocation,...e}}};function g4(s,e,t,i){var a;return(a=e.treeAdapter)!==null&&a!==void 0||(e.treeAdapter=na),e.scriptingEnabled!==!1&&(e.scriptingEnabled=!0),t?f4(s,e):h4(i,s,e)}const p4={treeAdapter:na};function b4(s){const e="length"in s?s:[s];for(let i=0;i<e.length;i+=1){const a=e[i];Ta(a)&&Array.prototype.splice.call(e,i,1,...a.children)}let t="";for(let i=0;i<e.length;i+=1){const a=e[i];t+=a4(a,p4)}return t}const E4=GI((s,e,t,i)=>e._useHtmlParser2?bL(s,e):g4(s,e,t,i)),Jd=vR(E4,(s,e)=>e._useHtmlParser2?Vd(s,e):b4(s)),x4={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Cache-Control":"no-store","Accept-Language":"en-US,en;q=0.9",DNT:"1","sec-ch-ua":'"Not_A Brand";v="8", "Chromium";v="120", "Microsoft Edge";v="120"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36 Edg/131.0.0.0"},T4=async({filter:s,page:e,providerContext:t,signal:i})=>{const a=t.baseUrl,u=`${a}/${s}/page/${e}/`;return B2(a,u,i)},y4=async({searchQuery:s,page:e,providerContext:t,signal:i})=>{const a=t.baseUrl,u=`${a}/page/${e}/?s=${s}`;return B2(a,u,i)};async function B2(s,e,t){try{const i=await Li.get(e,{headers:{...x4,Referer:s},signal:t}),a=Jd(i.data),u=[];return a(".blog-items, .post-list").children("article").each((l,c)=>{const f=a(c),h=f.find("a").first();let m=h.attr("title")||f.find(".post-title").text()||"";m=m.replace("Download","").trim();const g=m.match(/^(.*?)\s*\((\d{4})\)|^(.*?)\s*\((Season \d+)\)/);g&&(m=(g[1]||g[3]||m).trim());const E=h.attr("href")||"";let T=f.find("img").attr("data-lazy-src")||f.find("img").attr("data-src")||f.find("img").attr("src")||"";T.startsWith("//")&&(T="https:"+T),m&&E&&u.push({id:E,title:m,link:E,image:T,type:m.toLowerCase().includes("season")?"tv":"movie",provider:"vega"})}),u}catch(i){return console.error("Vega posts error:",i),[]}}const v4={hubcloudExtracter:async(s,e)=>{var t;try{const i=[],a=await Li.get(s,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Referer:s},signal:e}),u=Jd(a.data);u("source").each((E,T)=>{const v=u(T).attr("src"),S=u(T).attr("type");v&&i.push({server:"HubCloud Direct",link:v.startsWith("http")?v:`https:${v}`,type:S!=null&&S.includes("m3u8")?"m3u8":"direct",quality:"1080"})}),u("video").each((E,T)=>{const v=u(T).attr("src");v&&i.push({server:"HubCloud Video",link:v.startsWith("http")?v:`https:${v}`,type:"direct",quality:"1080"})}),u("iframe").each((E,T)=>{const v=u(T).attr("src");v&&(v.includes("cloud")||v.includes("hub"))&&i.push({server:"HubCloud Embed",link:v.startsWith("http")?v:`https:${v}`,type:"iframe",quality:"720"})});const l=a.data,c=/(https?:\/\/[^\s"']+\.m3u8[^\s"']*)/g,f=l.match(c);f&&f.forEach(E=>{i.push({server:"HubCloud M3U8",link:E,type:"m3u8",quality:"1080"})});const h=/(https?:\/\/[^\s"']+\.mp4[^\s"']*)/g,m=l.match(h);return m&&m.forEach(E=>{i.push({server:"HubCloud MP4",link:E,type:"direct",quality:"720"})}),i.filter((E,T,v)=>T===v.findIndex(S=>S.link===E.link))}catch(i){const a=i;return(t=a.message)!=null&&t.includes("aborted")?[]:(console.error("HubCloud extractor error:",a.message),[])}}},S4={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Cache-Control":"no-store","Accept-Language":"en-US,en;q=0.9",DNT:"1","sec-ch-ua":'"Not_A Brand";v="8", "Chromium";v="120", "Microsoft Edge";v="120"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36 Edg/131.0.0.0"},A4=async({link:s,type:e,signal:t,providerContext:i})=>{var l,c,f,h;const{hubcloudExtracter:a}=v4,u=[];try{if(e==="movie"){const g=(await Li.get(s,{headers:S4,signal:t})).data,E=g.match(/<a\s+href="([^"]*cloud\.[^"]*)"/i);let T=E?E[1]:null;try{const S=Jd(g)('.btn.btn-sm.btn-outline[style="background:linear-gradient(135deg,rgb(252,185,0) 0%,rgb(0,0,0)); color: #fdf8f2;"]').parent().attr("href");if(S){const A=S.split("/").pop(),I=S.split("/").slice(0,-2).join("/"),R=await Li.post(`${I}/api/file/downlaod/`,{id:A,method:"indexDownlaod",captchaValue:null},{headers:{"Content-Type":"application/json",Referer:I}});if((l=R.data)!=null&&l.status){const N=R.data.data,D=await Li.post(`${I}/api/file/downlaod2/`,{id:N,method:"indexDownlaod",captchaValue:null},{headers:{"Content-Type":"application/json",Referer:I}});(f=(c=D.data)==null?void 0:c.data)!=null&&f[0]&&u.push({server:"filepress",link:D.data.data[0],type:"direct",quality:"720",headers:{Referer:I}})}}}catch(v){console.error("FilePress extraction failed:",v)}if(T){const v=await a(T,t);u.push(...v)}}return u}catch(m){return(h=m.message)!=null&&h.includes("Aborted")?[]:(console.error("Vega stream error:",m),[])}},_4={config:{id:"vega",name:"VegaMovies",baseUrl:"https://vegamovies.dad",enabled:!0,priority:25,type:"scraper",catalog:[{title:"Latest",filter:"",type:"both"},{title:"Movies",filter:"category/movies",type:"movie"},{title:"Web Series",filter:"category/web-series",type:"tv"},{title:"Bollywood",filter:"category/bollywood-movies",type:"movie"},{title:"Hollywood",filter:"category/hollywood-movies",type:"movie"},{title:"South Indian",filter:"category/south-indian-movies",type:"movie"},{title:"Dual Audio",filter:"category/dual-audio-movies",type:"movie"},{title:"4K Movies",filter:"category/4k-movies",type:"movie"}],genres:[]},getPosts:T4,getSearchPosts:y4,getStream:A4,getMeta:async({link:s,providerContext:e})=>{try{const t=await Li.get(s,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"}}),i=Jd(t.data),a=i("h1.entry-title").text().trim()||"Unknown Title",u=i("div.entry-content p").first().text().trim()||"",l=i("div.entry-content img").first().attr("src")||"",c=[];return i('strong:contains("Cast:")').parent().text().replace("Cast:","").split(",").forEach(f=>c.push(f.trim())),{title:a,synopsis:u,image:l,provider:"vega",cast:c,linkList:[]}}catch(t){return console.error("Vega getMeta error:",t),{title:"Error",synopsis:"Failed to load metadata",image:"",provider:"vega"}}}},Lt=[];Lt.push({config:{id:"vidsrc",name:"VidSrc",baseUrl:"https://vidsrc.xyz",enabled:!0,priority:1,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("VidSrc",Gt.vidsrc),getSearchPosts:jt});Lt.push({config:{id:"embedapi",name:"Embed-API",baseUrl:"https://player.embed-api.stream",enabled:!0,priority:2,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("Embed-API",Gt.embedapi),getSearchPosts:jt});Lt.push({config:{id:"superembed",name:"SuperEmbed",baseUrl:"https://multiembed.mov",enabled:!0,priority:3,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("SuperEmbed",Gt.superembed),getSearchPosts:jt});Lt.push({config:{id:"2embed",name:"2Embed",baseUrl:"https://www.2embed.cc",enabled:!0,priority:4,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("2Embed",Gt["2embed"]),getSearchPosts:jt});Lt.push({config:{id:"godriveplayer",name:"GoDrivePlayer",baseUrl:"https://godriveplayer.com",enabled:!0,priority:5,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("GoDrivePlayer",Gt.godriveplayer),getSearchPosts:jt});Lt.push({config:{id:"embedsu",name:"Embed.su",baseUrl:"https://embed.su",enabled:!0,priority:6,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("Embed.su",Gt.embedsu),getSearchPosts:jt});Lt.push({config:{id:"nontongo",name:"NontonGo",baseUrl:"https://www.nontongo.win",enabled:!0,priority:7,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("NontonGo",Gt.nontongo),getSearchPosts:jt});Lt.push({config:{id:"autoembed",name:"Autoembed",baseUrl:"https://autoembed.co",enabled:!0,priority:8,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("Autoembed",Gt.autoembed),getSearchPosts:jt});Lt.push({config:{id:"vidlink",name:"VidLink",baseUrl:"https://vidlink.pro",enabled:!0,priority:9,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("VidLink",Gt.vidlink),getSearchPosts:jt});Lt.push({config:{id:"smashystream",name:"Smashystream",baseUrl:"https://player.smashy.stream",enabled:!0,priority:10,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("Smashystream",Gt.smashystream),getSearchPosts:jt});Lt.push({config:{id:"moviesapi",name:"MoviesAPI",baseUrl:"https://moviesapi.club",enabled:!0,priority:11,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("MoviesAPI",Gt.moviesapi),getSearchPosts:jt});Lt.push({config:{id:"embedsoap",name:"Embedsoap",baseUrl:"https://www.embedsoap.com",enabled:!0,priority:12,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("Embedsoap",Gt.embedsoap),getSearchPosts:jt});Lt.push({config:{id:"embedflix",name:"Embedflix",baseUrl:"https://embedflix.net",enabled:!0,priority:13,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("Embedflix",Gt.embedflix),getSearchPosts:jt});Lt.push({config:{id:"frembed",name:"Frembed",baseUrl:"https://frembed.com",enabled:!0,priority:14,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("Frembed",Gt.frembed),getSearchPosts:jt});Lt.push({config:{id:"embedplayer",name:"Embedplayer",baseUrl:"https://embedplayer.site",enabled:!0,priority:15,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("Embedplayer",Gt.embedplayer),getSearchPosts:jt});Lt.push({config:{id:"vidbinge",name:"Vidbinge",baseUrl:"https://vidbinge.com",enabled:!0,priority:16,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("Vidbinge",Gt.vidbinge),getSearchPosts:jt});Lt.push({config:{id:"vidfast",name:"VidFast",baseUrl:"https://vidfast.to",enabled:!0,priority:17,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("VidFast",Gt.vidfast),getSearchPosts:jt});Lt.push({config:{id:"moviee",name:"Moviee",baseUrl:"https://moviee.tv",enabled:!0,priority:18,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("Moviee",Gt.moviee),getSearchPosts:jt});Lt.push({config:{id:"warezcdn",name:"WarezCDN",baseUrl:"https://embed.warezcdn.com",enabled:!0,priority:19,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("WarezCDN",Gt.warezcdn),getSearchPosts:jt});Lt.push({config:{id:"embedv",name:"EmbedV",baseUrl:"https://www.embedv.net",enabled:!0,priority:20,type:"api",catalog:Ut,genres:Bt},getPosts:Ft,getMeta:Ht,getStream:$t("EmbedV",Gt.embedv),getSearchPosts:jt});Lt.push(_4);const L4=Lt,I4=3600*1e3,R4="/providers/config/providerUrls.json";let Il=null,F2=0;async function N4(){try{const s=await fetch(R4);if(!s.ok)throw new Error(`Failed to fetch provider URLs: ${s.statusText}`);return await s.json()}catch(s){return console.error("Error fetching provider URLs:",s),{}}}function C4(){return Il!==null&&Date.now()-F2<I4}async function D4(){return C4()&&Il||(Il=await N4(),F2=Date.now()),Il}async function O4(){try{await D4()}catch(s){console.error("Failed to prefetch provider URLs:",s)}}class Qe{constructor(e,t){this.config=e,this.embedUrlPattern=t}async getStream(e){try{const{link:t,type:i}=e,a=this.extractTmdbId(t);if(!a)return[];const u=this.embedUrlPattern.replace("{type}",i).replace("{tmdbId}",a);return[{server:this.config.name,link:u,type:"iframe",quality:"auto"}]}catch(t){return console.error(`${this.config.name} error:`,t),[]}}extractTmdbId(e){const t=e.match(/(?:movie|tv)\/(\d+)|^(\d+)$/);return t?t[1]||t[2]:null}async getPosts(){return[]}async getMeta(){return{title:"",image:"",synopsis:"",provider:this.config.id,linkList:[]}}async getSearchPosts(){return[]}}const w4=new Qe({id:"vidplay",name:"Vidplay",baseUrl:"https://vidplay.online",enabled:!0,priority:50,type:"scraper",catalog:[]},"https://vidplay.online/embed/{type}/{tmdbId}"),k4=new Qe({id:"filemoon",name:"Filemoon",baseUrl:"https://filemoon.sx",enabled:!0,priority:51,type:"scraper",catalog:[]},"https://filemoon.sx/e/{tmdbId}"),M4=new Qe({id:"doodstream",name:"Doodstream",baseUrl:"https://dood.wf",enabled:!0,priority:52,type:"scraper",catalog:[]},"https://dood.wf/e/{tmdbId}"),P4=new Qe({id:"streamtape",name:"Streamtape",baseUrl:"https://streamtape.com",enabled:!0,priority:53,type:"scraper",catalog:[]},"https://streamtape.com/e/{tmdbId}"),U4=new Qe({id:"mixdrop",name:"Mixdrop",baseUrl:"https://mixdrop.co",enabled:!0,priority:54,type:"scraper",catalog:[]},"https://mixdrop.co/e/{tmdbId}"),B4=new Qe({id:"upstream",name:"Upstream",baseUrl:"https://upstream.to",enabled:!0,priority:55,type:"scraper",catalog:[]},"https://upstream.to/embed-{tmdbId}.html"),F4=new Qe({id:"streamwish",name:"Streamwish",baseUrl:"https://streamwish.to",enabled:!0,priority:56,type:"scraper",catalog:[]},"https://streamwish.to/e/{tmdbId}"),j4=new Qe({id:"voe",name:"Voe",baseUrl:"https://voe.sx",enabled:!0,priority:57,type:"scraper",catalog:[]},"https://voe.sx/e/{tmdbId}"),H4=new Qe({id:"streamsb",name:"StreamSB",baseUrl:"https://streamsb.net",enabled:!0,priority:58,type:"scraper",catalog:[]},"https://streamsb.net/e/{tmdbId}"),$4=new Qe({id:"fembed",name:"Fembed",baseUrl:"https://fembed.com",enabled:!0,priority:59,type:"scraper",catalog:[]},"https://fembed.com/v/{tmdbId}"),G4=new Qe({id:"vidoza",name:"Vidoza",baseUrl:"https://vidoza.net",enabled:!0,priority:60,type:"scraper",catalog:[]},"https://vidoza.net/embed-{tmdbId}.html"),V4=new Qe({id:"streamlare",name:"Streamlare",baseUrl:"https://streamlare.com",enabled:!0,priority:61,type:"scraper",catalog:[]},"https://streamlare.com/e/{tmdbId}"),q4=new Qe({id:"vidmoly",name:"Vidmoly",baseUrl:"https://vidmoly.to",enabled:!0,priority:62,type:"scraper",catalog:[]},"https://vidmoly.to/embed-{tmdbId}.html"),Y4=new Qe({id:"upcloud",name:"UpCloud",baseUrl:"https://upcloud.to",enabled:!0,priority:63,type:"scraper",catalog:[]},"https://upcloud.to/embed-{tmdbId}.html"),K4=new Qe({id:"videovard",name:"VideoVard",baseUrl:"https://videovard.sx",enabled:!0,priority:64,type:"scraper",catalog:[]},"https://videovard.sx/v/{tmdbId}"),z4=new Qe({id:"superembed2",name:"SuperEmbed",baseUrl:"https://superembed.stream",enabled:!0,priority:65,type:"scraper",catalog:[]},"https://multiembed.mov/?video_id={tmdbId}&tmdb=1"),Q4=new Qe({id:"godriveplayer",name:"GoDrivePlayer",baseUrl:"https://database.gdriveplayer.us",enabled:!0,priority:66,type:"scraper",catalog:[]},"https://database.gdriveplayer.us/player.php?type={type}&tmdb={tmdbId}"),X4=new Qe({id:"embedsu2",name:"Embed.su",baseUrl:"https://embed.su",enabled:!0,priority:67,type:"scraper",catalog:[]},"https://embed.su/embed/{type}/{tmdbId}"),W4=new Qe({id:"autoembed2",name:"Autoembed",baseUrl:"https://player.autoembed.cc",enabled:!0,priority:68,type:"scraper",catalog:[]},"https://player.autoembed.cc/embed/{type}/{tmdbId}"),Z4=new Qe({id:"vidlink",name:"VidLink",baseUrl:"https://vidlink.pro",enabled:!0,priority:69,type:"scraper",catalog:[]},"https://vidlink.pro/embed/{type}/{tmdbId}"),J4=new Qe({id:"smashystream",name:"Smashy Stream",baseUrl:"https://player.smashy.stream",enabled:!0,priority:70,type:"scraper",catalog:[]},"https://player.smashy.stream/{type}/{tmdbId}"),eD=new Qe({id:"moviesapi2",name:"MoviesAPI",baseUrl:"https://moviesapi.club",enabled:!0,priority:71,type:"scraper",catalog:[]},"https://moviesapi.club/{type}/{tmdbId}"),tD=new Qe({id:"vidfast",name:"VidFast",baseUrl:"https://vidfast.to",enabled:!0,priority:72,type:"scraper",catalog:[]},"https://vidfast.to/embed/{type}/{tmdbId}"),sD=new Qe({id:"nontongo",name:"NontonGo",baseUrl:"https://nontongo.win",enabled:!0,priority:73,type:"scraper",catalog:[]},"https://nontongo.win/embed/{type}/{tmdbId}"),iD=new Qe({id:"warezcdn",name:"WarezCDN",baseUrl:"https://embed.warezcdn.com",enabled:!0,priority:74,type:"scraper",catalog:[]},"https://embed.warezcdn.com/filme/{tmdbId}"),nD=new Qe({id:"embedsoap",name:"EmbedSoap",baseUrl:"https://www.embedsoap.com",enabled:!0,priority:75,type:"scraper",catalog:[]},"https://www.embedsoap.com/embed/{type}/{tmdbId}"),aD=new Qe({id:"frembed",name:"Frembed",baseUrl:"https://frembed.com",enabled:!0,priority:76,type:"scraper",catalog:[]},"https://frembed.com/api/film.php?id={tmdbId}"),rD=new Qe({id:"embedplayer",name:"EmbedPlayer",baseUrl:"https://embedplayer.site",enabled:!0,priority:77,type:"scraper",catalog:[]},"https://embedplayer.site/e/{tmdbId}"),uD=new Qe({id:"vidbinge",name:"Vidbinge",baseUrl:"https://vidbinge.com",enabled:!0,priority:78,type:"scraper",catalog:[]},"https://vidbinge.com/embed/{type}/{tmdbId}"),lD=new Qe({id:"vidzee",name:"VidZee",baseUrl:"https://vidzee.cc",enabled:!0,priority:79,type:"scraper",catalog:[]},"https://vidzee.cc/embed/{type}/{tmdbId}"),oD=new Qe({id:"vixsrc",name:"Vixsrc",baseUrl:"https://vixsrc.com",enabled:!0,priority:80,type:"scraper",catalog:[]},"https://vixsrc.com/embed/{type}/{tmdbId}"),cD=new Qe({id:"mp4hydra",name:"MP4Hydra",baseUrl:"https://mp4hydra.com",enabled:!0,priority:81,type:"scraper",catalog:[]},"https://mp4hydra.com/embed/{type}/{tmdbId}"),dD=new Qe({id:"4khdhub2",name:"4KHDHub",baseUrl:"https://4khdhub.com",enabled:!0,priority:82,type:"scraper",catalog:[]},"https://4khdhub.com/embed/{type}/{tmdbId}"),fD=new Qe({id:"showbox2",name:"Showbox",baseUrl:"https://showbox.media",enabled:!0,priority:83,type:"scraper",catalog:[]},"https://showbox.media/embed/{type}/{tmdbId}"),j2=[w4,k4,M4,P4,U4,B4,F4,j4,H4,$4,G4,V4,q4,Y4,K4,z4,Q4,X4,W4,Z4,J4,eD,tD,sD,iD,nD,aD,rD,uD,lD,oD,cD,dD,fD];console.log(` ${j2.length} real embed providers ready`);const hD=[...j2];async function H2(){O4().catch(s=>{console.error("Failed to prefetch provider URLs:",s)}),L4.forEach(s=>{sd.register(s)}),hD.forEach(s=>{sd.register(s)}),sd.getStats()}const jc="watch_history",$2=()=>{const[s,e]=ie.useState([]);return ie.useEffect(()=>{const u=localStorage.getItem(jc);if(u)try{e(JSON.parse(u))}catch(l){console.error("Failed to parse watch history",l)}},[]),{history:s,addToHistory:u=>{e(l=>{const c=l.filter(m=>m.id!==u.id),h=[{...u,lastWatched:Date.now()},...c].slice(0,100);return localStorage.setItem(jc,JSON.stringify(h)),h})},clearHistory:()=>{e([]),localStorage.removeItem(jc)},removeFromHistory:u=>{e(l=>{const c=l.filter(f=>f.id!==u);return localStorage.setItem(jc,JSON.stringify(c)),c})}}},mD=()=>{const{movieId:s}=Fd(),e=ro(),[t,i]=ie.useState(null),[a,u]=ie.useState(!0),[l,c]=ie.useState([]),[f,h]=ie.useState(0),[m,g]=ie.useState(!0),[E,T]=ie.useState(!1),{saveProgress:v}=vy(),{addToHistory:S}=$2();if(ie.useEffect(()=>{H2()},[]),ie.useEffect(()=>{(async()=>{if(s){u(!0);try{const R=await He.getDetails(s,"movie");i(R),v({id:R.id.toString(),tmdbId:R.id.toString(),title:R.title||R.name||"Unknown",poster_path:R.poster_path||"",backdrop_path:R.backdrop_path||"",progress:0,timestamp:Date.now(),type:"movie"}),S({id:R.id.toString(),tmdbId:R.id.toString(),title:R.title||R.name||"Unknown",poster_path:R.poster_path||"",backdrop_path:R.backdrop_path||"",progress:0,timestamp:Date.now(),type:"movie"});const N=await sd.getStreamsFromAll(`/movie/${s}`,"movie");c(N)}catch(R){console.error("Failed to fetch movie details:",R)}finally{u(!1)}}})()},[s]),ie.useEffect(()=>{g(!0),T(!1)},[f]),a)return b.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:b.jsxs("div",{className:"flex flex-col items-center gap-4",children:[b.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin"}),b.jsx("p",{className:"text-primary text-xl font-medium",children:"Loading player..."})]})});if(!t||!s)return b.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center gap-4",children:[b.jsx("p",{className:"text-red-500 text-xl",children:"Movie not found"}),b.jsx(gt,{to:"/",className:"px-6 py-3 bg-primary text-black font-bold rounded-lg hover:bg-blue-400 transition-all",children:"Go Home"})]});const A=l[f]||l[0];return b.jsxs("div",{className:"min-h-screen bg-background",children:[b.jsx("div",{className:"bg-surface/80 backdrop-blur-xl border-b border-white/10 sticky top-0 z-50",children:b.jsx("div",{className:"max-w-[1800px] mx-auto px-4 md:px-8 py-4",children:b.jsxs("div",{className:"flex items-center justify-between gap-4",children:[b.jsxs("div",{className:"flex items-center gap-3 md:gap-4 flex-1 min-w-0",children:[b.jsx("button",{onClick:()=>e(-1),className:"flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-lg bg-white/5 hover:bg-white/10 text-text hover:text-primary transition-all border border-white/10","aria-label":"Go back",children:b.jsx(qm,{size:20})}),b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("h1",{className:"text-lg md:text-xl font-bold text-text truncate",children:t.title||t.name}),b.jsxs("div",{className:"flex items-center gap-3 text-xs md:text-sm text-text-muted",children:[b.jsxs("span",{className:"flex items-center gap-1",children:[b.jsx(md,{size:14}),new Date(t.release_date||t.first_air_date||"").getFullYear()]}),t.runtime&&b.jsxs("span",{className:"flex items-center gap-1",children:[b.jsx(pa,{size:14}),t.runtime," min"]}),b.jsxs("span",{className:"flex items-center gap-1",children:[b.jsx(ys,{size:14,className:"fill-yellow-500 text-yellow-500"}),t.vote_average.toFixed(1)]})]})]})]}),b.jsxs(gt,{to:`/movies/${s}`,className:"flex-shrink-0 flex items-center gap-2 px-4 py-2.5 bg-white/90 dark:bg-white/10 text-gray-900 dark:text-white rounded-lg hover:bg-white dark:hover:bg-white/20 transition-all border border-black/10 dark:border-white/10 font-medium text-sm",children:[b.jsx(hd,{size:16}),b.jsx("span",{className:"hidden sm:inline",children:"Details"})]})]})})}),b.jsxs("div",{className:"max-w-[1800px] mx-auto px-4 md:px-8 py-6 md:py-8",children:[l.length>0&&b.jsx("div",{className:"mb-6",children:b.jsxs("div",{className:"bg-surface/50 backdrop-blur-sm border border-white/10 rounded-xl p-4",children:[b.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[b.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center",children:b.jsx(FE,{size:16,className:"text-primary"})}),b.jsxs("h3",{className:"text-sm font-semibold text-text",children:["Select Server (",l.length," available)"]})]}),b.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:l.map((I,R)=>b.jsx("button",{onClick:()=>h(R),className:`px-4 py-2.5 rounded-lg text-sm font-medium transition-all ${f===R?"bg-primary text-black shadow-lg shadow-primary/20 scale-105":"bg-white/5 text-text hover:bg-white/10 border border-white/10 hover:border-white/20"}`,children:I.server},R))})]})}),b.jsxs("div",{className:"relative w-full aspect-video bg-black rounded-2xl overflow-hidden shadow-2xl border border-white/10 mb-8",children:[m&&!E&&b.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-black via-gray-900 to-black z-10",children:b.jsxs("div",{className:"flex flex-col items-center gap-4",children:[b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"w-20 h-20 border-4 border-primary/20 rounded-full"}),b.jsx("div",{className:"w-20 h-20 border-4 border-primary border-t-transparent rounded-full animate-spin absolute top-0"})]}),b.jsxs("div",{className:"text-center",children:[b.jsxs("p",{className:"text-white text-base font-medium mb-1",children:["Loading ",(A==null?void 0:A.server)||"player"]}),b.jsx("p",{className:"text-gray-400 text-sm",children:"Please wait..."})]})]})}),E&&b.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-black via-gray-900 to-black z-10",children:b.jsxs("div",{className:"flex flex-col items-center gap-4 text-center px-4 max-w-md",children:[b.jsx("div",{className:"w-16 h-16 rounded-full bg-red-500/10 flex items-center justify-center",children:b.jsx(FE,{size:32,className:"text-red-500"})}),b.jsxs("div",{children:[b.jsx("p",{className:"text-red-500 text-lg font-bold mb-2",children:"Failed to load video player"}),b.jsxs("p",{className:"text-gray-400 text-sm",children:["The ",(A==null?void 0:A.server)||"selected"," server is currently unavailable. Please try a different server."]})]}),b.jsx("button",{onClick:()=>{T(!1),g(!0)},className:"px-6 py-3 bg-primary text-black font-bold rounded-lg hover:bg-blue-400 transition-all shadow-lg",children:"Retry"})]})}),A&&b.jsx("iframe",{src:A.link,className:"w-full h-full",frameBorder:"0",allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",title:t.title||t.name,onLoad:()=>g(!1),onError:()=>{g(!1),T(!0)}})]}),b.jsxs("div",{className:"bg-surface/50 backdrop-blur-sm border border-white/10 rounded-2xl p-6 md:p-8 mb-8",children:[b.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-text mb-4 flex items-center gap-3",children:[b.jsx("div",{className:"w-1 h-8 bg-primary rounded-full"}),"About This Movie"]}),b.jsx("p",{className:"text-text-muted leading-relaxed mb-6 text-base",children:t.overview}),b.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[b.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[b.jsxs("div",{className:"flex items-center gap-2 text-text-muted text-sm mb-1",children:[b.jsx(ys,{size:16,className:"text-yellow-500"}),b.jsx("span",{children:"Rating"})]}),b.jsxs("p",{className:"text-text font-bold text-xl",children:[t.vote_average.toFixed(1),b.jsx("span",{className:"text-text-muted text-base font-normal",children:"/10"})]})]}),b.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[b.jsxs("div",{className:"flex items-center gap-2 text-text-muted text-sm mb-1",children:[b.jsx(md,{size:16}),b.jsx("span",{children:"Release Date"})]}),b.jsx("p",{className:"text-text font-bold text-lg",children:new Date(t.release_date||t.first_air_date||"").toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})})]}),t.runtime&&b.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[b.jsxs("div",{className:"flex items-center gap-2 text-text-muted text-sm mb-1",children:[b.jsx(pa,{size:16}),b.jsx("span",{children:"Runtime"})]}),b.jsxs("p",{className:"text-text font-bold text-lg",children:[t.runtime," min"]})]}),b.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[b.jsx("div",{className:"text-text-muted text-sm mb-1",children:"Genres"}),b.jsx("div",{className:"flex flex-wrap gap-1",children:t.genres.slice(0,3).map(I=>b.jsx("span",{className:"text-text font-medium text-sm bg-primary/10 px-2 py-1 rounded",children:I.name},I.id))})]})]})]}),t.similar&&t.similar.results.length>0&&b.jsxs("div",{children:[b.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-text mb-6 flex items-center gap-3",children:[b.jsx("div",{className:"w-1 h-8 bg-primary rounded-full"}),"You May Also Like"]}),b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:t.similar.results.slice(0,6).map(I=>b.jsxs(gt,{to:`/watch/${I.id}`,className:"group",children:[b.jsx("div",{className:"aspect-[2/3] rounded-xl overflow-hidden mb-2 bg-surface border border-white/10 group-hover:border-primary/50 transition-all",children:b.jsx("img",{src:He.getImageUrl(I.poster_path),alt:I.title||I.name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"})}),b.jsx("p",{className:"text-sm font-medium text-text truncate group-hover:text-primary transition-colors",children:I.title||I.name}),b.jsxs("div",{className:"flex items-center gap-1 text-xs text-text-muted",children:[b.jsx(ys,{size:12,className:"fill-yellow-500 text-yellow-500"}),I.vote_average.toFixed(1)]})]},I.id))})]})]})]})},ho=(s,e)=>{const t=ie.useRef(null);return ie.useCallback(a=>{e||(t.current&&t.current.disconnect(),t.current=new IntersectionObserver(u=>{u[0].isIntersecting&&s()}),a&&t.current.observe(a))},[e,s])},gD=()=>{const[s,e]=ie.useState(!1),[t,i]=ie.useState([]),[a,u]=ie.useState(!1),[l,c]=ie.useState(1),[f,h]=ie.useState(!0),[m,g]=ie.useState(!1),[E,T]=ie.useState(""),[v,S]=ie.useState("top-weekly"),[A,I]=ie.useState(null),[R,N]=ie.useState(null),[D,k]=ie.useState(!1),G=ro(),U=[{id:"top-weekly",name:"Top Weekly",icon:Nl},{id:"top-monthly",name:"Top Monthly",icon:ys},{id:"top-rated",name:"Top Rated",icon:ys},{id:"most-viewed",name:"Most Viewed",icon:eu},{id:"latest-updates",name:"Latest",icon:pa},{id:"jav",name:"JAV",icon:Nl}];ie.useEffect(()=>{localStorage.getItem("is18PlusConfirmed")==="true"&&(e(!0),H(1,v,E))},[]),ie.useEffect(()=>{s&&(c(1),h(!0),i([]),H(1,v,E))},[v,s]);const H=async(J,pe,fe)=>{try{J===1?u(!0):g(!0);const ce=await K_.getVideos(fe,J,20,pe);ce.length===0?h(!1):(i(xe=>J===1?ce:[...xe,...ce]),J===1&&ce.length>0&&I(ce[0]))}catch(ce){console.error("Failed to load videos",ce)}finally{u(!1),g(!1)}},$=ie.useCallback(()=>{if(!m&&f){const J=l+1;c(J),H(J,v,E)}},[m,f,l,v,E]),F=ho($,m),ee=J=>{J.preventDefault(),c(1),h(!0),i([]),H(1,v,E)},me=J=>{S(J)},be=J=>{N(J),k(!0)},Te=()=>{k(!1),setTimeout(()=>N(null),300)},ne=()=>{localStorage.setItem("is18PlusConfirmed","true"),e(!0),H(1,v,E)},B=()=>{G("/")},W=()=>R?t.filter(J=>J.id!==R.id):[];if(!s)return b.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-black p-4",children:b.jsxs("div",{className:"max-w-md w-full glass-panel p-8 rounded-2xl border border-secondary/50 text-center space-y-6 animate-fade-in",children:[b.jsx("div",{className:"w-20 h-20 bg-secondary/20 rounded-full flex items-center justify-center mx-auto animate-pulse",children:b.jsx(Za,{className:"w-10 h-10 text-secondary"})}),b.jsx("h1",{className:"text-3xl font-bold text-secondary",children:"Restricted Access"}),b.jsx("p",{className:"text-gray-300",children:"The following content contains material of an adult nature and is intended for viewers 18 years of age or older."}),b.jsxs("div",{className:"bg-secondary/10 p-4 rounded-lg border border-secondary/20 flex gap-3 text-left",children:[b.jsx(Q3,{className:"text-secondary shrink-0"}),b.jsx("span",{className:"text-xs text-gray-400",children:"By entering, you confirm you are at least 18 years old and consent to viewing sexually explicit content."})]}),b.jsxs("div",{className:"flex flex-col gap-3",children:[b.jsx("button",{onClick:ne,className:"w-full bg-secondary hover:bg-red-600 text-white font-bold py-3 rounded-lg transition-all transform hover:scale-105",children:"I am 18+ - Enter"}),b.jsx("button",{onClick:B,className:"w-full bg-white/10 hover:bg-white/20 text-white font-medium py-3 rounded-lg transition-colors",children:"Exit to Safe Home"})]})]})});const te=W();return b.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[D&&R&&b.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-black/95 p-4 overflow-y-auto animate-fade-in",children:b.jsxs("div",{className:"relative w-full max-w-7xl my-8",children:[b.jsx("button",{onClick:Te,className:"absolute top-4 right-4 z-10 w-10 h-10 bg-black/50 hover:bg-black/70 rounded-full flex items-center justify-center transition-colors",children:b.jsx(iu,{className:"text-white",size:24})}),b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[b.jsx("div",{className:"lg:col-span-2 space-y-6",children:b.jsxs("div",{className:"bg-surface rounded-2xl overflow-hidden shadow-2xl",children:[b.jsx("div",{className:"aspect-video w-full bg-black",children:b.jsx("iframe",{src:R.embed||R.url,className:"w-full h-full",frameBorder:"0",referrerPolicy:"no-referrer",allowFullScreen:!0,allow:"autoplay; encrypted-media",title:R.title})}),b.jsxs("div",{className:"p-6 space-y-4",children:[b.jsx("h2",{className:"text-2xl font-bold text-text",children:R.title}),b.jsxs("div",{className:"flex items-center gap-6 text-sm text-text-muted",children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(eu,{size:16}),b.jsxs("span",{children:[R.views.toLocaleString()," views"]})]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(pa,{size:16}),b.jsx("span",{children:R.length_min})]}),R.rate&&b.jsxs("div",{className:"flex items-center gap-2 text-green-400",children:[b.jsx(ys,{size:16,className:"fill-current"}),b.jsx("span",{children:R.rate})]})]})]})]})}),b.jsx("div",{className:"lg:col-span-1",children:b.jsxs("div",{className:"bg-surface/50 backdrop-blur-xl border border-white/10 rounded-2xl p-4 sticky top-4",children:[b.jsxs("h3",{className:"text-lg font-bold text-text mb-4 flex items-center gap-2",children:[b.jsx(Nl,{size:20,className:"text-secondary"}),"Suggested Videos"]}),b.jsx("div",{className:"space-y-3 max-h-[calc(100vh-200px)] overflow-y-auto pr-2 custom-scrollbar",children:te.map(J=>b.jsxs("button",{onClick:()=>be(J),className:"group w-full bg-white/5 hover:bg-white/10 rounded-lg overflow-hidden transition-all flex gap-3 p-2",children:[b.jsxs("div",{className:"relative w-32 h-20 flex-shrink-0 rounded overflow-hidden",children:[b.jsx("img",{src:J.default_thumb.src,alt:J.title,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"}),b.jsx("div",{className:"absolute bottom-1 right-1 bg-black/80 text-white text-xs px-1 py-0.5 rounded",children:J.length_min}),b.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center",children:b.jsx(Yi,{size:20,className:"text-white opacity-0 group-hover:opacity-100 transition-opacity",fill:"white"})})]}),b.jsxs("div",{className:"flex-1 text-left min-w-0",children:[b.jsx("h4",{className:"text-sm font-medium text-text line-clamp-2 group-hover:text-primary transition-colors",children:J.title}),b.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-text-muted",children:[b.jsxs("span",{className:"flex items-center gap-1",children:[b.jsx(eu,{size:10}),(J.views/1e3).toFixed(0),"K"]}),b.jsx("span",{className:"text-green-400",children:J.rate})]})]})]},J.id))})]})})]})]})}),A&&b.jsxs("div",{className:"relative h-[70vh] md:h-[80vh] w-full overflow-hidden",children:[b.jsxs("div",{className:"absolute inset-0",children:[b.jsx("img",{src:A.default_thumb.src,alt:A.title,className:"w-full h-full object-cover scale-105 blur-sm"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-background/60 to-transparent"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-background/90 via-background/40 to-transparent"})]}),b.jsx("div",{className:"absolute bottom-0 left-0 w-full p-6 md:p-12 lg:p-16 z-30",children:b.jsxs("div",{className:"max-w-4xl space-y-6 animate-fade-in",children:[b.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[b.jsxs("span",{className:"px-4 py-1.5 bg-secondary/20 backdrop-blur-md border border-secondary/30 rounded-full text-secondary text-xs font-bold uppercase tracking-wider flex items-center gap-2",children:[b.jsx("span",{className:"bg-secondary text-black text-xs px-2 py-0.5 rounded font-black",children:"18+"}),"Adult Content"]}),A.rate&&b.jsxs("span",{className:"px-4 py-1.5 bg-green-500/20 backdrop-blur-md border border-green-500/30 rounded-full text-green-400 text-xs font-bold flex items-center gap-2",children:[b.jsx(ys,{size:14,className:"fill-current"}),A.rate," Rating"]})]}),b.jsx("h1",{className:"text-4xl md:text-6xl lg:text-7xl font-black drop-shadow-2xl leading-tight line-clamp-2",style:{color:"var(--color-hero-text)"},children:A.title}),b.jsxs("div",{className:"flex items-center gap-6 text-sm",style:{color:"var(--color-text-muted)"},children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(eu,{size:16}),b.jsxs("span",{children:[A.views.toLocaleString()," views"]})]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(pa,{size:16}),b.jsx("span",{children:A.length_min})]})]}),b.jsx("div",{className:"flex items-center gap-4 pt-4 flex-wrap",children:b.jsxs("button",{onClick:()=>be(A),className:"group bg-secondary text-white font-bold px-8 py-4 rounded-xl flex items-center gap-3 hover:bg-red-600 transition-all transform hover:scale-105 hover:shadow-2xl hover:shadow-secondary/50",children:[b.jsx(Yi,{size:22,fill:"currentColor"}),b.jsx("span",{className:"text-lg",children:"Watch Now"})]})})]})})]}),b.jsxs("div",{className:"w-full max-w-[2000px] mx-auto px-4 md:px-8 mt-8 md:-mt-12 relative z-10",children:[b.jsxs("div",{className:"backdrop-blur-xl rounded-2xl p-6 mb-8 bg-surface border border-border",children:[b.jsxs("form",{onSubmit:ee,className:"flex flex-col md:flex-row gap-4",children:[b.jsxs("div",{className:"flex-1 relative",children:[b.jsx(bu,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-text-muted",size:20}),b.jsx("input",{type:"text",placeholder:"Search videos...",value:E,onChange:J=>T(J.target.value),className:"w-full rounded-xl pl-12 pr-4 py-3 focus:outline-none focus:border-secondary/50 transition-all bg-input-bg border border-input-border text-black placeholder:text-gray-500"})]}),b.jsx("button",{type:"submit",className:"bg-secondary hover:bg-red-600 text-white font-bold px-8 py-3 rounded-xl transition-all transform hover:scale-105",children:"Search"})]}),b.jsxs("div",{className:"mt-6",children:[b.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[b.jsx(hy,{size:18,className:"text-text-muted"}),b.jsx("span",{className:"text-sm font-medium text-text-muted",children:"Filter by:"})]}),b.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:U.map(J=>{const pe=J.icon;return b.jsxs("button",{onClick:()=>me(J.id),className:`px-4 py-2 rounded-full text-sm font-medium transition-all flex items-center gap-2 ${v===J.id?"bg-secondary text-white shadow-lg shadow-secondary/30":"bg-white/5 text-text-muted hover:bg-white/10 hover:text-text"}`,children:[b.jsx(pe,{size:16}),J.name]},J.id)})})]})]}),a?b.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[b.jsx("div",{className:"w-16 h-16 border-4 border-secondary border-t-transparent rounded-full animate-spin"}),b.jsx("p",{className:"text-secondary font-medium",children:"Loading content..."})]}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:t.map((J,pe)=>b.jsxs("div",{ref:pe===t.length-1?F:null,className:"group relative rounded-xl overflow-hidden hover:border-secondary/50 transition-all transform hover:-translate-y-1 hover:shadow-2xl hover:shadow-secondary/20 cursor-pointer bg-card-bg border border-border",onClick:()=>be(J),children:[b.jsxs("div",{className:"block aspect-video overflow-hidden relative",children:[b.jsx("img",{src:J.default_thumb.src,alt:J.title,loading:"lazy",className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),b.jsx("div",{className:"absolute bottom-2 right-2 bg-black/80 text-white text-xs px-2 py-1 rounded font-mono",children:J.length_min}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center",children:b.jsx("div",{className:"w-16 h-16 bg-secondary/90 rounded-full flex items-center justify-center transform scale-0 group-hover:scale-100 transition-transform duration-300",children:b.jsx(Yi,{size:28,fill:"white",className:"text-white ml-1"})})})]}),b.jsxs("div",{className:"p-3",children:[b.jsx("h3",{className:"text-sm font-medium line-clamp-2 group-hover:text-secondary transition-colors text-text",children:J.title}),b.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-text-muted",children:[b.jsxs("span",{className:"flex items-center gap-1",children:[b.jsx(eu,{size:12}),J.views.toLocaleString()]}),b.jsxs("span",{className:"text-green-400 flex items-center gap-1",children:[b.jsx(ys,{size:12,className:"fill-current"}),J.rate]})]})]})]},`${J.id}-${pe}`))}),m&&b.jsx("div",{className:"flex justify-center py-8",children:b.jsx("div",{className:"w-12 h-12 border-4 border-secondary border-t-transparent rounded-full animate-spin"})}),!f&&t.length>0&&b.jsx("div",{className:"text-center py-8 text-text-muted",children:b.jsx("p",{children:"No more videos to load"})})]}),b.jsxs("div",{className:"mt-12 py-8 border-t border-white/5 text-center text-xs text-text-muted space-y-4",children:[b.jsx("p",{children:"Compliance Notice: All adult content is provided via 3rd party public APIs. We do not host any files."}),b.jsx("p",{className:"text-text-muted",children:"Provider: Eporner API"}),b.jsx("button",{onClick:()=>{localStorage.removeItem("is18PlusConfirmed"),e(!1)},className:"mt-2 text-secondary underline hover:text-red-400 transition-colors",children:"Reset Age Gate"})]})]}),b.jsx("div",{className:"fixed top-1/4 left-0 w-96 h-96 bg-secondary/3 rounded-full blur-3xl pointer-events-none -z-10"}),b.jsx("div",{className:"fixed bottom-1/4 right-0 w-96 h-96 bg-secondary/3 rounded-full blur-3xl pointer-events-none -z-10"})]})},pD=()=>{const[s]=H3(),e=s.get("q")||"",[t,i]=ie.useState([]),[a,u]=ie.useState(!1),[l,c]=ie.useState(1),[f,h]=ie.useState(!0),[m,g]=ie.useState(!1),E=ie.useCallback(async(S,A)=>{if(!A){i([]);return}try{S===1?u(!0):g(!0);const R=(await He.search(A,S)).filter(N=>N.media_type!=="person"&&(N.poster_path||N.backdrop_path));R.length===0?h(!1):i(N=>S===1?R:[...N,...R])}catch(I){console.error("Search failed",I)}finally{u(!1),g(!1)}},[]);ie.useEffect(()=>{c(1),i([]),h(!0);const S=setTimeout(()=>{E(1,e)},500);return()=>clearTimeout(S)},[e,E]);const T=ie.useCallback(()=>{if(!m&&f){const S=l+1;c(S),E(S,e)}},[m,f,l,e,E]),v=ho(T,m);return b.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20 px-4",children:b.jsxs("div",{className:"w-full max-w-[2000px] mx-auto px-4 md:px-8",children:[b.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[b.jsx(bu,{className:"text-primary w-8 h-8"}),b.jsxs("h1",{className:"text-3xl font-bold text-text",children:["Search Results for ",b.jsxs("span",{className:"text-primary",children:['"',e,'"']})]})]}),a&&l===1?b.jsx("div",{className:"flex justify-center py-20",children:b.jsx(In,{className:"animate-spin text-primary w-10 h-10"})}):t.length>0?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6",children:t.map((S,A)=>b.jsx("div",{ref:A===t.length-1?v:null,children:b.jsx(tr,{movie:S})},`${S.id}-${A}`))}),m&&b.jsx("div",{className:"flex justify-center py-8",children:b.jsx(In,{className:"animate-spin text-primary w-8 h-8"})})]}):b.jsxs("div",{className:"text-center py-20 text-text-muted",children:[b.jsxs("p",{className:"text-xl",children:['No results found for "',e,'"']}),b.jsx("p",{className:"mt-2",children:"Try searching for a different movie or TV show."})]})]})})},Mx=[{id:28,name:"Action"},{id:12,name:"Adventure"},{id:16,name:"Animation"},{id:35,name:"Comedy"},{id:80,name:"Crime"},{id:99,name:"Documentary"},{id:18,name:"Drama"},{id:10751,name:"Family"},{id:14,name:"Fantasy"},{id:36,name:"History"},{id:27,name:"Horror"},{id:10402,name:"Music"},{id:9648,name:"Mystery"},{id:10749,name:"Romance"},{id:878,name:"Sci-Fi"},{id:53,name:"Thriller"},{id:10752,name:"War"},{id:37,name:"Western"}],Px=()=>{var I;const{genreId:s}=Fd(),e=ro(),[t,i]=ie.useState([]),[a,u]=ie.useState(!0),[l,c]=ie.useState(1),[f,h]=ie.useState(!0),[m,g]=ie.useState(!1),E=s||"28",T=((I=Mx.find(R=>R.id.toString()===E))==null?void 0:I.name)||"Unknown",v=ie.useCallback(async(R,N)=>{try{R===1?u(!0):g(!0);const D=await He.getMoviesByGenre(N,R);D.length===0?h(!1):i(k=>R===1?D:[...k,...D])}catch(D){console.error("Failed to fetch genre movies",D)}finally{u(!1),g(!1)}},[]);ie.useEffect(()=>{c(1),i([]),h(!0),v(1,E)},[E,v]);const S=ie.useCallback(()=>{if(!m&&f){const R=l+1;c(R),v(R,E)}},[m,f,l,E,v]),A=ho(S,m);return b.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20 px-4",children:b.jsx("div",{className:"w-full max-w-[2000px] mx-auto px-4 md:px-8",children:b.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[b.jsx("div",{className:"w-full md:w-64 flex-shrink-0",children:b.jsxs("div",{className:"bg-surface p-4 rounded-xl border border-white/10 sticky top-24",children:[b.jsxs("div",{className:"flex items-center gap-2 mb-4 text-primary font-bold",children:[b.jsx(hy,{size:20}),b.jsx("h2",{children:"Select Genre"})]}),b.jsx("div",{className:"flex flex-wrap md:flex-col gap-2",children:Mx.map(R=>b.jsx("button",{onClick:()=>e(`/genres/${R.id}`),className:`px-3 py-2 rounded-lg text-sm text-left transition-colors ${E===R.id.toString()?"bg-primary text-black font-bold":"bg-surface text-text-muted hover:bg-white/10 hover:text-text"}`,children:R.name},R.id))})]})}),b.jsxs("div",{className:"flex-1",children:[b.jsxs("h1",{className:"text-3xl font-bold text-text mb-6 border-l-4 border-primary pl-4",children:[T," Movies"]}),a&&l===1?b.jsx("div",{className:"flex justify-center py-20",children:b.jsx(In,{className:"animate-spin text-primary w-10 h-10"})}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6",children:t.map((R,N)=>b.jsx("div",{ref:N===t.length-1?A:null,children:b.jsx(tr,{movie:R})},`${R.id}-${N}`))}),m&&b.jsx("div",{className:"flex justify-center py-8",children:b.jsx(In,{className:"animate-spin text-primary w-8 h-8"})})]})]})]})})})},bD=()=>{const[s,e]=ie.useState([]),[t,i]=ie.useState(!0),[a,u]=ie.useState(1),[l,c]=ie.useState(!0),[f,h]=ie.useState(!1),m=ie.useCallback(async T=>{try{T===1?i(!0):h(!0);const v=await He.getPopular("movie",T);v.length===0?c(!1):e(S=>T===1?v:[...S,...v])}catch(v){console.error("Failed to fetch movies",v)}finally{i(!1),h(!1)}},[]);ie.useEffect(()=>{m(1)},[m]);const g=ie.useCallback(()=>{if(!f&&l){const T=a+1;u(T),m(T)}},[f,l,a,m]),E=ho(g,f);return b.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20 px-4",children:b.jsxs("div",{className:"w-full max-w-[2000px] mx-auto px-4 md:px-8",children:[b.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[b.jsx(am,{className:"text-primary w-8 h-8"}),b.jsx("h1",{className:"text-3xl font-bold text-text",children:"Movies"})]}),t&&a===1?b.jsx("div",{className:"flex justify-center py-20",children:b.jsx(In,{className:"animate-spin text-primary w-10 h-10"})}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-7 min-[1800px]:grid-cols-8 gap-4 md:gap-6",children:s.map((T,v)=>b.jsx("div",{ref:v===s.length-1?E:null,children:b.jsx(tr,{movie:T})},`${T.id}-${v}`))}),f&&b.jsx("div",{className:"flex justify-center py-8",children:b.jsx(In,{className:"animate-spin text-primary w-8 h-8"})})]})]})})},ED=()=>{const[s,e]=ie.useState([]),[t,i]=ie.useState(!0),[a,u]=ie.useState(1),[l,c]=ie.useState(!0),[f,h]=ie.useState(!1),m=ie.useCallback(async T=>{try{T===1?i(!0):h(!0);const v=await He.getDiscoverTV(T);v.length===0?c(!1):e(S=>T===1?v:[...S,...v])}catch(v){console.error("Failed to fetch TV shows",v)}finally{i(!1),h(!1)}},[]);ie.useEffect(()=>{m(1)},[m]);const g=ie.useCallback(()=>{if(!f&&l){const T=a+1;u(T),m(T)}},[f,l,a,m]),E=ho(g,f);return b.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20 px-4",children:b.jsxs("div",{className:"w-full max-w-[2000px] mx-auto px-4 md:px-8",children:[b.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[b.jsx(Hl,{className:"text-primary w-8 h-8"}),b.jsx("h1",{className:"text-3xl font-bold text-text",children:"Web Series & TV Shows"})]}),t&&a===1?b.jsx("div",{className:"flex justify-center py-20",children:b.jsx(In,{className:"animate-spin text-primary w-10 h-10"})}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6",children:s.map((T,v)=>b.jsx("div",{ref:v===s.length-1?E:null,children:b.jsx(tr,{movie:T})},`${T.id}-${v}`))}),f&&b.jsx("div",{className:"flex justify-center py-8",children:b.jsx(In,{className:"animate-spin text-primary w-8 h-8"})})]})]})})},xD=()=>{const[s,e]=ie.useState([]);ie.useEffect(()=>{const i=localStorage.getItem("watchlist");i&&e(JSON.parse(i))},[]);const t=i=>{const a=s.filter(u=>u.id!==i);e(a),localStorage.setItem("watchlist",JSON.stringify(a))};return b.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20 px-4",children:b.jsxs("div",{className:"w-full max-w-[2000px] mx-auto px-4 md:px-8",children:[b.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[b.jsx(rm,{className:"text-red-500 w-8 h-8",fill:"currentColor"}),b.jsx("h1",{className:"text-3xl font-bold text-text",children:"My Watchlist"})]}),s.length>0?b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6",children:s.map(i=>b.jsxs("div",{className:"relative group",children:[b.jsx(tr,{movie:i}),b.jsx("button",{onClick:a=>{a.preventDefault(),t(i.id)},className:"absolute top-2 right-2 bg-black/60 p-2 rounded-full text-red-500 opacity-0 group-hover:opacity-100 transition-opacity hover:bg-white",title:"Remove from Watchlist",children:b.jsx(gd,{size:16})})]},i.id))}):b.jsxs("div",{className:"text-center py-20 text-text-muted",children:[b.jsx(rm,{size:64,className:"mx-auto mb-4 opacity-20"}),b.jsx("p",{className:"text-xl font-medium text-text-muted",children:"Your watchlist is empty"}),b.jsx("p",{className:"mt-2 mb-6",children:"Start adding movies and shows you want to watch!"}),b.jsx(gt,{to:"/",className:"bg-primary text-black font-bold px-6 py-2 rounded-lg hover:bg-blue-400 transition-colors",children:"Browse Movies"})]})]})})},TD=()=>{const{history:s,clearHistory:e,removeFromHistory:t}=$2();return b.jsx("div",{className:"min-h-screen bg-background pt-24 px-4 md:px-8 pb-20",children:b.jsxs("div",{className:"max-w-[1800px] mx-auto",children:[b.jsxs("div",{className:"flex items-center justify-between mb-8",children:[b.jsxs("h1",{className:"text-3xl font-bold text-text flex items-center gap-3",children:[b.jsx(pa,{className:"text-primary"}),"Watch History"]}),s.length>0&&b.jsxs("button",{onClick:()=>{window.confirm("Are you sure you want to clear your watch history?")&&e()},className:"flex items-center gap-2 px-4 py-2 bg-red-500/10 hover:bg-red-500/20 text-red-500 rounded-lg transition-colors",children:[b.jsx(gd,{size:16}),"Clear History"]})]}),s.length===0?b.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-text-muted",children:[b.jsx(pa,{size:64,className:"mb-4 opacity-20"}),b.jsx("p",{className:"text-xl",children:"Your watch history is empty"}),b.jsx(gt,{to:"/",className:"mt-4 text-primary hover:underline",children:"Start watching something!"})]}):b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:s.map(i=>b.jsxs("div",{className:"group relative",children:[b.jsx("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),t(i.id)},className:"absolute top-2 right-2 z-20 w-8 h-8 bg-black/80 hover:bg-red-500 rounded-full flex items-center justify-center transition-all opacity-100 md:opacity-0 md:group-hover:opacity-100 border border-white/20 hover:border-red-500",title:"Remove from History",children:b.jsx(gd,{size:14,className:"text-white"})}),b.jsxs(gt,{to:`/watch/${i.tmdbId}`,className:"block bg-surface rounded-xl overflow-hidden border border-white/10 hover:border-primary/50 transition-all",children:[b.jsxs("div",{className:"aspect-[2/3] relative",children:[b.jsx("img",{src:He.getImageUrl(i.poster_path),alt:i.title,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"}),b.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:b.jsx(Yi,{className:"w-12 h-12 text-white fill-current"})})]}),b.jsxs("div",{className:"p-3",children:[b.jsx("h3",{className:"text-sm font-medium text-text truncate group-hover:text-primary transition-colors",children:i.title}),b.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["Watched ",new Date(i.lastWatched).toLocaleDateString()]})]})]})]},`${i.id}-${i.lastWatched}`))})]})})},Ee=Number.isFinite||function(s){return typeof s=="number"&&isFinite(s)},yD=Number.isSafeInteger||function(s){return typeof s=="number"&&Math.abs(s)<=vD},vD=Number.MAX_SAFE_INTEGER||9007199254740991;let Ae=(function(s){return s.NETWORK_ERROR="networkError",s.MEDIA_ERROR="mediaError",s.KEY_SYSTEM_ERROR="keySystemError",s.MUX_ERROR="muxError",s.OTHER_ERROR="otherError",s})({}),Y=(function(s){return s.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",s.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",s.KEY_SYSTEM_NO_SESSION="keySystemNoSession",s.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",s.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",s.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",s.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",s.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",s.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",s.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",s.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",s.MANIFEST_LOAD_ERROR="manifestLoadError",s.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",s.MANIFEST_PARSING_ERROR="manifestParsingError",s.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",s.LEVEL_EMPTY_ERROR="levelEmptyError",s.LEVEL_LOAD_ERROR="levelLoadError",s.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",s.LEVEL_PARSING_ERROR="levelParsingError",s.LEVEL_SWITCH_ERROR="levelSwitchError",s.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",s.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",s.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",s.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",s.FRAG_LOAD_ERROR="fragLoadError",s.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",s.FRAG_DECRYPT_ERROR="fragDecryptError",s.FRAG_PARSING_ERROR="fragParsingError",s.FRAG_GAP="fragGap",s.REMUX_ALLOC_ERROR="remuxAllocError",s.KEY_LOAD_ERROR="keyLoadError",s.KEY_LOAD_TIMEOUT="keyLoadTimeOut",s.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",s.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",s.BUFFER_APPEND_ERROR="bufferAppendError",s.BUFFER_APPENDING_ERROR="bufferAppendingError",s.BUFFER_STALLED_ERROR="bufferStalledError",s.BUFFER_FULL_ERROR="bufferFullError",s.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",s.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",s.ASSET_LIST_LOAD_ERROR="assetListLoadError",s.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",s.ASSET_LIST_PARSING_ERROR="assetListParsingError",s.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",s.INTERNAL_EXCEPTION="internalException",s.INTERNAL_ABORTED="aborted",s.ATTACH_MEDIA_ERROR="attachMediaError",s.UNKNOWN="unknown",s})({}),L=(function(s){return s.MEDIA_ATTACHING="hlsMediaAttaching",s.MEDIA_ATTACHED="hlsMediaAttached",s.MEDIA_DETACHING="hlsMediaDetaching",s.MEDIA_DETACHED="hlsMediaDetached",s.MEDIA_ENDED="hlsMediaEnded",s.STALL_RESOLVED="hlsStallResolved",s.BUFFER_RESET="hlsBufferReset",s.BUFFER_CODECS="hlsBufferCodecs",s.BUFFER_CREATED="hlsBufferCreated",s.BUFFER_APPENDING="hlsBufferAppending",s.BUFFER_APPENDED="hlsBufferAppended",s.BUFFER_EOS="hlsBufferEos",s.BUFFERED_TO_END="hlsBufferedToEnd",s.BUFFER_FLUSHING="hlsBufferFlushing",s.BUFFER_FLUSHED="hlsBufferFlushed",s.MANIFEST_LOADING="hlsManifestLoading",s.MANIFEST_LOADED="hlsManifestLoaded",s.MANIFEST_PARSED="hlsManifestParsed",s.LEVEL_SWITCHING="hlsLevelSwitching",s.LEVEL_SWITCHED="hlsLevelSwitched",s.LEVEL_LOADING="hlsLevelLoading",s.LEVEL_LOADED="hlsLevelLoaded",s.LEVEL_UPDATED="hlsLevelUpdated",s.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",s.LEVELS_UPDATED="hlsLevelsUpdated",s.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",s.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",s.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",s.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",s.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",s.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",s.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",s.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",s.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",s.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",s.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",s.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",s.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",s.CUES_PARSED="hlsCuesParsed",s.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",s.INIT_PTS_FOUND="hlsInitPtsFound",s.FRAG_LOADING="hlsFragLoading",s.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",s.FRAG_LOADED="hlsFragLoaded",s.FRAG_DECRYPTED="hlsFragDecrypted",s.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",s.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",s.FRAG_PARSING_METADATA="hlsFragParsingMetadata",s.FRAG_PARSED="hlsFragParsed",s.FRAG_BUFFERED="hlsFragBuffered",s.FRAG_CHANGED="hlsFragChanged",s.FPS_DROP="hlsFpsDrop",s.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",s.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",s.ERROR="hlsError",s.DESTROYING="hlsDestroying",s.KEY_LOADING="hlsKeyLoading",s.KEY_LOADED="hlsKeyLoaded",s.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",s.BACK_BUFFER_REACHED="hlsBackBufferReached",s.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",s.ASSET_LIST_LOADING="hlsAssetListLoading",s.ASSET_LIST_LOADED="hlsAssetListLoaded",s.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",s.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",s.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",s.INTERSTITIAL_STARTED="hlsInterstitialStarted",s.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",s.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",s.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",s.INTERSTITIAL_ENDED="hlsInterstitialEnded",s.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",s.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",s.EVENT_CUE_ENTER="hlsEventCueEnter",s})({});var Fe={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ye={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Qr{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class SD{constructor(e,t,i,a=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Qr(e),this.fast_=new Qr(t),this.defaultTTFB_=a,this.ttfb_=new Qr(e)}update(e,t){const{slow_:i,fast_:a,ttfb_:u}=this;i.halfLife!==e&&(this.slow_=new Qr(e,i.getEstimate(),i.getTotalWeight())),a.halfLife!==t&&(this.fast_=new Qr(t,a.getEstimate(),a.getTotalWeight())),u.halfLife!==e&&(this.ttfb_=new Qr(e,u.getEstimate(),u.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,a=e/1e3,u=i/a;this.fast_.sample(a,u),this.slow_.sample(a,u)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function AD(s,e,t){return(e=LD(e))in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function ot(){return ot=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(s[i]=t[i])}return s},ot.apply(null,arguments)}function Ux(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);e&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(s,a).enumerable})),t.push.apply(t,i)}return t}function it(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ux(Object(t),!0).forEach(function(i){AD(s,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):Ux(Object(t)).forEach(function(i){Object.defineProperty(s,i,Object.getOwnPropertyDescriptor(t,i))})}return s}function _D(s,e){if(typeof s!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var i=t.call(s,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function LD(s){var e=_D(s,"string");return typeof e=="symbol"?e:e+""}class gi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=aa,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const aa=function(){},ID={trace:aa,debug:aa,log:aa,warn:aa,info:aa,error:aa};function _m(){return ot({},ID)}function RD(s,e){const t=self.console[s];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${s}] >`):aa}function Bx(s,e,t){return e[s]?e[s].bind(e):RD(s,t)}const Lm=_m();function ND(s,e,t){const i=_m();if(typeof console=="object"&&s===!0||typeof s=="object"){const a=["debug","log","info","warn","error"];a.forEach(u=>{i[u]=Bx(u,s,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return _m()}a.forEach(u=>{Lm[u]=Bx(u,s)})}else ot(Lm,i);return i}const nt=Lm;function Ea(s=!0){return typeof self>"u"?void 0:(s||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function CD(s){return typeof self<"u"&&s===self.ManagedMediaSource}function G2(s,e){const t=Object.keys(s),i=Object.keys(e),a=t.length,u=i.length;return!a||!u||a===u&&!t.some(l=>i.indexOf(l)===-1)}function Js(s,e=!1){if(typeof TextDecoder<"u"){const h=new TextDecoder("utf-8").decode(s);if(e){const m=h.indexOf("\0");return m!==-1?h.substring(0,m):h}return h.replace(/\0/g,"")}const t=s.length;let i,a,u,l="",c=0;for(;c<t;){if(i=s[c++],i===0&&e)return l;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(i);break;case 12:case 13:a=s[c++],l+=String.fromCharCode((i&31)<<6|a&63);break;case 14:a=s[c++],u=s[c++],l+=String.fromCharCode((i&15)<<12|(a&63)<<6|(u&63)<<0);break}}return l}function fs(s){let e="";for(let t=0;t<s.length;t++){let i=s[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}function V2(s){return Uint8Array.from(s.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function DD(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var w0={exports:{}},Fx;function OD(){return Fx||(Fx=1,(function(s,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,a=/^(?=([^\/?#]*))\1([^]*)$/,u=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(f,h,m){if(m=m||{},f=f.trim(),h=h.trim(),!h){if(!m.alwaysNormalize)return f;var g=c.parseURL(f);if(!g)throw new Error("Error trying to parse base URL.");return g.path=c.normalizePath(g.path),c.buildURLFromParts(g)}var E=c.parseURL(h);if(!E)throw new Error("Error trying to parse relative URL.");if(E.scheme)return m.alwaysNormalize?(E.path=c.normalizePath(E.path),c.buildURLFromParts(E)):h;var T=c.parseURL(f);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var v=a.exec(T.path);T.netLoc=v[1],T.path=v[2]}T.netLoc&&!T.path&&(T.path="/");var S={scheme:T.scheme,netLoc:E.netLoc,path:null,params:E.params,query:E.query,fragment:E.fragment};if(!E.netLoc&&(S.netLoc=T.netLoc,E.path[0]!=="/"))if(!E.path)S.path=T.path,E.params||(S.params=T.params,E.query||(S.query=T.query));else{var A=T.path,I=A.substring(0,A.lastIndexOf("/")+1)+E.path;S.path=c.normalizePath(I)}return S.path===null&&(S.path=m.alwaysNormalize?c.normalizePath(E.path):E.path),c.buildURLFromParts(S)},parseURL:function(f){var h=i.exec(f);return h?{scheme:h[1]||"",netLoc:h[2]||"",path:h[3]||"",params:h[4]||"",query:h[5]||"",fragment:h[6]||""}:null},normalizePath:function(f){for(f=f.split("").reverse().join("").replace(u,"");f.length!==(f=f.replace(l,"")).length;);return f.split("").reverse().join("")},buildURLFromParts:function(f){return f.scheme+f.netLoc+f.path+f.params+f.query+f.fragment}};s.exports=c})()})(w0)),w0.exports}var Eg=OD();class xg{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var dt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class q2{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,kD(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let a;i.length===1?a=(t==null?void 0:t.byteRangeEndOffset)||0:a=parseInt(i[1]),this._byteRange=[a,parseInt(i[0])+a]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[dt.AUDIO]:null,[dt.VIDEO]:null,[dt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new xg),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Eg.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[dt.AUDIO]=null,e[dt.VIDEO]=null,e[dt.AUDIOVIDEO]=null}}function Ct(s){return s.sn!=="initSegment"}class k0 extends q2{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Ee(e)&&Ee(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const i=Object.keys(t);if(i.length===1){const a=this._decryptdata=t[i[0]]||null;a&&(this._decryptdata=a.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Ee(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const i=Object.keys(this.levelkeys),a=i.length;if(a>1||a===1&&(t=this.levelkeys[i[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Ee(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Ct(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var i;const a=t[e];a&&!((i=this._decryptdata)!=null&&i.keyId)&&(this._decryptdata=a.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,a,u,l=!1){const{elementaryStreams:c}=this,f=c[e];if(!f){c[e]={startPTS:t,endPTS:i,startDTS:a,endDTS:u,partial:l};return}f.startPTS=Math.min(f.startPTS,t),f.endPTS=Math.max(f.endPTS,i),f.startDTS=Math.min(f.startDTS,a),f.endDTS=Math.max(f.endDTS,u)}}class wD extends q2{constructor(e,t,i,a,u){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=a;const l=e.enumeratedString("BYTERANGE");l&&this.setByteRange(l,u),u&&(this.fragOffset=u.fragOffset+u.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Y2(s,e){const t=Object.getPrototypeOf(s);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||Y2(t,e)}}function kD(s,e){const t=Y2(s,e);t&&(t.enumerable=!0,Object.defineProperty(s,e,t))}const jx=Math.pow(2,32)-1,MD=[].push,K2={video:1,audio:2,id3:3,text:4};function Yt(s){return String.fromCharCode.apply(null,s)}function z2(s,e){const t=s[e]<<8|s[e+1];return t<0?65536+t:t}function Oe(s,e){const t=Q2(s,e);return t<0?4294967296+t:t}function Hx(s,e){let t=Oe(s,e);return t*=Math.pow(2,32),t+=Oe(s,e+4),t}function Q2(s,e){return s[e]<<24|s[e+1]<<16|s[e+2]<<8|s[e+3]}function PD(s){const e=s.byteLength;for(let t=0;t<e;){const i=Oe(s,t);if(i>8&&s[t+4]===109&&s[t+5]===111&&s[t+6]===111&&s[t+7]===102)return!0;t=i>1?t+i:e}return!1}function Be(s,e){const t=[];if(!e.length)return t;const i=s.byteLength;for(let a=0;a<i;){const u=Oe(s,a),l=Yt(s.subarray(a+4,a+8)),c=u>1?a+u:i;if(l===e[0])if(e.length===1)t.push(s.subarray(a+8,c));else{const f=Be(s.subarray(a+8,c),e.slice(1));f.length&&MD.apply(t,f)}a=c}return t}function UD(s){const e=[],t=s[0];let i=8;const a=Oe(s,i);i+=4;let u=0,l=0;t===0?(u=Oe(s,i),l=Oe(s,i+4),i+=8):(u=Hx(s,i),l=Hx(s,i+8),i+=16),i+=2;let c=s.length+l;const f=z2(s,i);i+=2;for(let h=0;h<f;h++){let m=i;const g=Oe(s,m);m+=4;const E=g&2147483647;if((g&2147483648)>>>31===1)return nt.warn("SIDX has hierarchical references (not supported)"),null;const v=Oe(s,m);m+=4,e.push({referenceSize:E,subsegmentDuration:v,info:{duration:v/a,start:c,end:c+E-1}}),c+=E,m+=4,i=m}return{earliestPresentationTime:u,timescale:a,version:t,referencesCount:f,references:e}}function X2(s){const e=[],t=Be(s,["moov","trak"]);for(let a=0;a<t.length;a++){const u=t[a],l=Be(u,["tkhd"])[0];if(l){let c=l[0];const f=Oe(l,c===0?12:20),h=Be(u,["mdia","mdhd"])[0];if(h){c=h[0];const m=Oe(h,c===0?12:20),g=Be(u,["mdia","hdlr"])[0];if(g){const E=Yt(g.subarray(8,12)),T={soun:dt.AUDIO,vide:dt.VIDEO}[E],v=Be(u,["mdia","minf","stbl","stsd"])[0],S=BD(v);T?(e[f]={timescale:m,type:T,stsd:S},e[T]=it({timescale:m,id:f},S)):e[f]={timescale:m,type:E,stsd:S}}}}}return Be(s,["moov","mvex","trex"]).forEach(a=>{const u=Oe(a,4),l=e[u];l&&(l.default={duration:Oe(a,12),flags:Oe(a,20)})}),e}function BD(s){const e=s.subarray(8),t=e.subarray(86),i=Yt(e.subarray(4,8));let a=i,u;const l=i==="enca"||i==="encv";if(l){const h=Be(e,[i])[0].subarray(i==="enca"?28:78);Be(h,["sinf"]).forEach(g=>{const E=Be(g,["schm"])[0];if(E){const T=Yt(E.subarray(4,8));if(T==="cbcs"||T==="cenc"){const v=Be(g,["frma"])[0];v&&(a=Yt(v))}}})}const c=a;switch(a){case"avc1":case"avc2":case"avc3":case"avc4":{const f=Be(t,["avcC"])[0];f&&f.length>3&&(a+="."+$c(f[1])+$c(f[2])+$c(f[3]),u=Hc(c==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const f=Be(e,[i])[0],h=Be(f.subarray(28),["esds"])[0];if(h&&h.length>7){let m=4;if(h[m++]!==3)break;m=M0(h,m),m+=2;const g=h[m++];if(g&128&&(m+=2),g&64&&(m+=h[m++]),h[m++]!==4)break;m=M0(h,m);const E=h[m++];if(E===64)a+="."+$c(E);else break;if(m+=12,h[m++]!==5)break;m=M0(h,m);const T=h[m++];let v=(T&248)>>3;v===31&&(v+=1+((T&7)<<3)+((h[m]&224)>>5)),a+="."+v}break}case"hvc1":case"hev1":{const f=Be(t,["hvcC"])[0];if(f&&f.length>12){const h=f[1],m=["","A","B","C"][h>>6],g=h&31,E=Oe(f,2),T=(h&32)>>5?"H":"L",v=f[12],S=f.subarray(6,12);a+="."+m+g,a+="."+FD(E).toString(16).toUpperCase(),a+="."+T+v;let A="";for(let I=S.length;I--;){const R=S[I];(R||A)&&(A="."+R.toString(16).toUpperCase()+A)}a+=A}u=Hc(c=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{a=Hc(a,t)||a;break}case"vp09":{const f=Be(t,["vpcC"])[0];if(f&&f.length>6){const h=f[4],m=f[5],g=f[6]>>4&15;a+="."+Mi(h)+"."+Mi(m)+"."+Mi(g)}break}case"av01":{const f=Be(t,["av1C"])[0];if(f&&f.length>2){const h=f[1]>>>5,m=f[1]&31,g=f[2]>>>7?"H":"M",E=(f[2]&64)>>6,T=(f[2]&32)>>5,v=h===2&&E?T?12:10:E?10:8,S=(f[2]&16)>>4,A=(f[2]&8)>>3,I=(f[2]&4)>>2,R=f[2]&3;a+="."+h+"."+Mi(m)+g+"."+Mi(v)+"."+S+"."+A+I+R+"."+Mi(1)+"."+Mi(1)+"."+Mi(1)+"."+0,u=Hc("dav1",t)}break}}return{codec:a,encrypted:l,supplemental:u}}function Hc(s,e){const t=Be(e,["dvvC"]),i=t.length?t[0]:Be(e,["dvcC"])[0];if(i){const a=i[2]>>1&127,u=i[2]<<5&32|i[3]>>3&31;return s+"."+Mi(a)+"."+Mi(u)}}function FD(s){let e=0;for(let t=0;t<32;t++)e|=(s>>t&1)<<31-t;return e>>>0}function M0(s,e){const t=e+5;for(;s[e++]&128&&e<t;);return e}function $c(s){return("0"+s.toString(16).toUpperCase()).slice(-2)}function Mi(s){return(s<10?"0":"")+s}function jD(s,e){if(!s||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&W2(s,(i,a)=>{const u=i.subarray(8,24);u.some(l=>l!==0)||(nt.log(`[eme] Patching keyId in 'enc${a?"a":"v"}>sinf>>tenc' box: ${fs(u)} -> ${fs(t)}`),i.set(t,8))})}function HD(s){const e=[];return W2(s,t=>e.push(t.subarray(8,24))),e}function W2(s,e){Be(s,["moov","trak"]).forEach(i=>{const a=Be(i,["mdia","minf","stbl","stsd"])[0];if(!a)return;const u=a.subarray(8);let l=Be(u,["enca"]);const c=l.length>0;c||(l=Be(u,["encv"])),l.forEach(f=>{const h=c?f.subarray(28):f.subarray(78);Be(h,["sinf"]).forEach(g=>{const E=Z2(g);E&&e(E,c)})})})}function Z2(s){const e=Be(s,["schm"])[0];if(e){const t=Yt(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const i=Be(s,["schi","tenc"])[0];if(i)return i}}}function $D(s,e,t){const i={},a=Be(s,["moof","traf"]);for(let u=0;u<a.length;u++){const l=a[u],c=Be(l,["tfhd"])[0],f=Oe(c,4),h=e[f];if(!h)continue;i[f]||(i[f]={start:NaN,duration:0,sampleCount:0,timescale:h.timescale,type:h.type});const m=i[f],g=Be(l,["tfdt"])[0];if(g){const N=g[0];let D=Oe(g,4);N===1&&(D===jx?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(D*=jx+1,D+=Oe(g,8))),Ee(D)&&(!Ee(m.start)||D<m.start)&&(m.start=D)}const E=h.default,T=Oe(c,0)|(E==null?void 0:E.flags);let v=(E==null?void 0:E.duration)||0;T&8&&(T&2?v=Oe(c,12):v=Oe(c,8));const S=Be(l,["trun"]);let A=m.start||0,I=0,R=v;for(let N=0;N<S.length;N++){const D=S[N],k=Oe(D,4),G=m.sampleCount;m.sampleCount+=k;const U=D[3]&1,H=D[3]&4,$=D[2]&1,F=D[2]&2,ee=D[2]&4,me=D[2]&8;let be=8,Te=k;for(U&&(be+=4),H&&k&&(!(D[be+1]&1)&&m.keyFrameIndex===void 0&&(m.keyFrameIndex=G),be+=4,$?(R=Oe(D,be),be+=4):R=v,F&&(be+=4),me&&(be+=4),A+=R,I+=R,Te--);Te--;)$?(R=Oe(D,be),be+=4):R=v,F&&(be+=4),ee&&(D[be+1]&1||m.keyFrameIndex===void 0&&(m.keyFrameIndex=m.sampleCount-(Te+1),m.keyFrameStart=A),be+=4),me&&(be+=4),A+=R,I+=R;!I&&v&&(I+=v*k)}m.duration+=I}if(!Object.keys(i).some(u=>i[u].duration)){let u=1/0,l=0;const c=Be(s,["sidx"]);for(let f=0;f<c.length;f++){const h=UD(c[f]);if(h!=null&&h.references){u=Math.min(u,h.earliestPresentationTime/h.timescale);const m=h.references.reduce((g,E)=>g+E.info.duration||0,0);l=Math.max(l,m+h.earliestPresentationTime/h.timescale)}}l&&Ee(l)&&Object.keys(i).forEach(f=>{i[f].duration||(i[f].duration=l*i[f].timescale-i[f].start)})}return i}function GD(s){const e={valid:null,remainder:null},t=Be(s,["moof"]);if(t.length<2)return e.remainder=s,e;const i=t[t.length-1];return e.valid=s.slice(0,i.byteOffset-8),e.remainder=s.slice(i.byteOffset-8),e}function mi(s,e){const t=new Uint8Array(s.length+e.length);return t.set(s),t.set(e,s.length),t}function $x(s,e){const t=[],i=e.samples,a=e.timescale,u=e.id;let l=!1;return Be(i,["moof"]).map(f=>{const h=f.byteOffset-8;Be(f,["traf"]).map(g=>{const E=Be(g,["tfdt"]).map(T=>{const v=T[0];let S=Oe(T,4);return v===1&&(S*=Math.pow(2,32),S+=Oe(T,8)),S/a})[0];return E!==void 0&&(s=E),Be(g,["tfhd"]).map(T=>{const v=Oe(T,4),S=Oe(T,0)&16777215,A=(S&1)!==0,I=(S&2)!==0,R=(S&8)!==0;let N=0;const D=(S&16)!==0;let k=0;const G=(S&32)!==0;let U=8;v===u&&(A&&(U+=8),I&&(U+=4),R&&(N=Oe(T,U),U+=4),D&&(k=Oe(T,U),U+=4),G&&(U+=4),e.type==="video"&&(l=ef(e.codec)),Be(g,["trun"]).map(H=>{const $=H[0],F=Oe(H,0)&16777215,ee=(F&1)!==0;let me=0;const be=(F&4)!==0,Te=(F&256)!==0;let ne=0;const B=(F&512)!==0;let W=0;const te=(F&1024)!==0,J=(F&2048)!==0;let pe=0;const fe=Oe(H,4);let ce=8;ee&&(me=Oe(H,ce),ce+=4),be&&(ce+=4);let xe=me+h;for(let Ce=0;Ce<fe;Ce++){if(Te?(ne=Oe(H,ce),ce+=4):ne=N,B?(W=Oe(H,ce),ce+=4):W=k,te&&(ce+=4),J&&($===0?pe=Oe(H,ce):pe=Q2(H,ce),ce+=4),e.type===dt.VIDEO){let Ne=0;for(;Ne<W;){const Me=Oe(i,xe);if(xe+=4,VD(l,i[xe])){const It=i.subarray(xe,xe+Me);Tg(It,l?2:1,s+pe/a,t)}xe+=Me,Ne+=Me+4}}s+=ne/a}}))})})}),t}function ef(s){if(!s)return!1;const e=s.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function VD(s,e){if(s){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Tg(s,e,t,i){const a=J2(s);let u=0;u+=e;let l=0,c=0,f=0;for(;u<a.length;){l=0;do{if(u>=a.length)break;f=a[u++],l+=f}while(f===255);c=0;do{if(u>=a.length)break;f=a[u++],c+=f}while(f===255);const h=a.length-u;let m=u;if(c<h)u+=c;else if(c>h){nt.error(`Malformed SEI payload. ${c} is too small, only ${h} bytes left to parse.`);break}if(l===4){if(a[m++]===181){const E=z2(a,m);if(m+=2,E===49){const T=Oe(a,m);if(m+=4,T===1195456820){const v=a[m++];if(v===3){const S=a[m++],A=31&S,I=64&S,R=I?2+A*3:0,N=new Uint8Array(R);if(I){N[0]=S;for(let D=1;D<R;D++)N[D]=a[m++]}i.push({type:v,payloadType:l,pts:t,bytes:N})}}}}}else if(l===5&&c>16){const g=[];for(let v=0;v<16;v++){const S=a[m++].toString(16);g.push(S.length==1?"0"+S:S),(v===3||v===5||v===7||v===9)&&g.push("-")}const E=c-16,T=new Uint8Array(E);for(let v=0;v<E;v++)T[v]=a[m++];i.push({payloadType:l,pts:t,uuid:g.join(""),userData:Js(T),userDataBytes:T})}}}function J2(s){const e=s.byteLength,t=[];let i=1;for(;i<e-2;)s[i]===0&&s[i+1]===0&&s[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return s;const a=e-t.length,u=new Uint8Array(a);let l=0;for(i=0;i<a;l++,i++)l===t[0]&&(l++,t.shift()),u[i]=s[l];return u}function qD(s){const e=s[0];let t="",i="",a=0,u=0,l=0,c=0,f=0,h=0;if(e===0){for(;Yt(s.subarray(h,h+1))!=="\0";)t+=Yt(s.subarray(h,h+1)),h+=1;for(t+=Yt(s.subarray(h,h+1)),h+=1;Yt(s.subarray(h,h+1))!=="\0";)i+=Yt(s.subarray(h,h+1)),h+=1;i+=Yt(s.subarray(h,h+1)),h+=1,a=Oe(s,12),u=Oe(s,16),c=Oe(s,20),f=Oe(s,24),h=28}else if(e===1){h+=4,a=Oe(s,h),h+=4;const g=Oe(s,h);h+=4;const E=Oe(s,h);for(h+=4,l=2**32*g+E,yD(l)||(l=Number.MAX_SAFE_INTEGER,nt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=Oe(s,h),h+=4,f=Oe(s,h),h+=4;Yt(s.subarray(h,h+1))!=="\0";)t+=Yt(s.subarray(h,h+1)),h+=1;for(t+=Yt(s.subarray(h,h+1)),h+=1;Yt(s.subarray(h,h+1))!=="\0";)i+=Yt(s.subarray(h,h+1)),h+=1;i+=Yt(s.subarray(h,h+1)),h+=1}const m=s.subarray(h,s.byteLength);return{schemeIdUri:t,value:i,timeScale:a,presentationTime:l,presentationTimeDelta:u,eventDuration:c,id:f,payload:m}}function YD(s,...e){const t=e.length;let i=8,a=t;for(;a--;)i+=e[a].byteLength;const u=new Uint8Array(i);for(u[0]=i>>24&255,u[1]=i>>16&255,u[2]=i>>8&255,u[3]=i&255,u.set(s,4),a=0,i=8;a<t;a++)u.set(e[a],i),i+=e[a].byteLength;return u}function KD(s,e,t){if(s.byteLength!==16)throw new RangeError("Invalid system id");let i,a;i=0,a=new Uint8Array;let u;i>0?(u=new Uint8Array(4),e.length>0&&new DataView(u.buffer).setUint32(0,e.length,!1)):u=new Uint8Array;const l=new Uint8Array(4);return t.byteLength>0&&new DataView(l.buffer).setUint32(0,t.byteLength,!1),YD([112,115,115,104],new Uint8Array([i,0,0,0]),s,u,a,l,t)}function zD(s){const e=[];if(s instanceof ArrayBuffer){const t=s.byteLength;let i=0;for(;i+32<t;){const a=new DataView(s,i),u=QD(a);e.push(u),i+=u.size}}return e}function QD(s){const e=s.getUint32(0),t=s.byteOffset,i=s.byteLength;if(i<e)return{offset:t,size:i};if(s.getUint32(4)!==1886614376)return{offset:t,size:e};const u=s.getUint32(8)>>>24;if(u!==0&&u!==1)return{offset:t,size:e};const l=s.buffer,c=fs(new Uint8Array(l,t+12,16));let f=null,h=null,m=0;if(u===0)m=28;else{const E=s.getUint32(28);if(!E||i<32+E*16)return{offset:t,size:e};f=[];for(let T=0;T<E;T++)f.push(new Uint8Array(l,t+32+T*16,16));m=32+E*16}if(!m)return{offset:t,size:e};const g=s.getUint32(m);return e-32<g?{offset:t,size:e}:(h=new Uint8Array(l,t+m+4,g),{version:u,systemId:c,kids:f,data:h,offset:t,size:e})}const ev=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Tu={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function yg(s,e){const t=Tu[e];return!!t&&!!t[s.slice(0,4)]}function Xl(s,e,t=!0){return!s.split(",").some(i=>!vg(i,e,t))}function vg(s,e,t=!0){var i;const a=Ea(t);return(i=a==null?void 0:a.isTypeSupported(Wl(s,e)))!=null?i:!1}function Wl(s,e){return`${e}/mp4;codecs=${s}`}function Gx(s){if(s){const e=s.substring(0,4);return Tu.video[e]}return 2}function Rd(s){const e=ev();return s.split(",").reduce((t,i)=>{const u=e&&ef(i)?9:Tu.video[i];return u?(u*2+t)/(t?3:2):(Tu.audio[i]+t)/(t?2:1)},0)}const P0={};function XD(s,e=!0){if(P0[s])return P0[s];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[s];for(let a=0;a<t.length;a++){var i;if(vg(t[a],"audio",e))return P0[s]=t[a],t[a];if(t[a]==="mp3"&&(i=Ea(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return s}const WD=/flac|opus|mp4a\.40\.34/i;function Nd(s,e=!0){return s.replace(WD,t=>XD(t.toLowerCase(),e))}function ZD(s,e){const t=[];if(s){const i=s.split(",");for(let a=0;a<i.length;a++)yg(i[a],"video")||t.push(i[a])}return e&&t.push(e),t.join(",")}function ad(s,e){if(s&&(s.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(s)!==-1)&&(Vx(s,"audio")||Vx(s,"video")))return s;if(e){const t=e.split(",");if(t.length>1){if(s){for(let i=t.length;i--;)if(t[i].substring(0,4)===s.substring(0,4))return t[i]}return t[0]}}return e||s}function Vx(s,e){return yg(s,e)&&vg(s,e)}function JD(s){const e=s.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function e8(s){if(s.startsWith("av01.")){const e=s.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return s}function qx(s){const e=Ea(s)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Im(s){return s.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const t8={supported:!0,powerEfficient:!0,smooth:!0},s8={supported:!1,smooth:!1,powerEfficient:!1},tv={supported:!0,configurations:[],decodingInfoResults:[t8]};function sv(s,e){return{supported:!1,configurations:e,decodingInfoResults:[s8],error:s}}function i8(s,e,t,i,a,u){const l=s.videoCodec,c=s.audioCodec?s.audioGroups:null,f=u==null?void 0:u.audioCodec,h=u==null?void 0:u.channels,m=h?parseInt(h):f?1/0:2;let g=null;if(c!=null&&c.length)try{c.length===1&&c[0]?g=e.groups[c[0]].channels:g=c.reduce((E,T)=>{if(T){const v=e.groups[T];if(!v)throw new Error(`Audio track group ${T} not found`);Object.keys(v.channels).forEach(S=>{E[S]=(E[S]||0)+v.channels[S]})}return E},{2:0})}catch{return!0}return l!==void 0&&(l.split(",").some(E=>ef(E))||s.width>1920&&s.height>1088||s.height>1920&&s.width>1088||s.frameRate>Math.max(i,30)||s.videoRange!=="SDR"&&s.videoRange!==t||s.bitrate>Math.max(a,8e6))||!!g&&Ee(m)&&Object.keys(g).some(E=>parseInt(E)>m)}function iv(s,e,t,i={}){const a=s.videoCodec;if(!a&&!s.audioCodec||!t)return Promise.resolve(tv);const u=[],l=n8(s),c=l.length,f=a8(s,e,c>0),h=f.length;for(let m=c||1*h||1;m--;){const g={type:"media-source"};if(c&&(g.video=l[m%c]),h){g.audio=f[m%h];const E=g.audio.bitrate;g.video&&E&&(g.video.bitrate-=E)}u.push(g)}if(a){const m=navigator.userAgent;if(a.split(",").some(g=>ef(g))&&ev())return Promise.resolve(sv(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${m})`),u))}return Promise.all(u.map(m=>{const g=u8(m);return i[g]||(i[g]=t.decodingInfo(m))})).then(m=>({supported:!m.some(g=>!g.supported),configurations:u,decodingInfoResults:m})).catch(m=>({supported:!1,configurations:u,decodingInfoResults:[],error:m}))}function n8(s){var e;const t=(e=s.videoCodec)==null?void 0:e.split(","),i=nv(s),a=s.width||640,u=s.height||480,l=s.frameRate||30,c=s.videoRange.toLowerCase();return t?t.map(f=>{const h={contentType:Wl(e8(f),"video"),width:a,height:u,bitrate:i,framerate:l};return c!=="sdr"&&(h.transferFunction=c),h}):[]}function a8(s,e,t){var i;const a=(i=s.audioCodec)==null?void 0:i.split(","),u=nv(s);return a&&s.audioGroups?s.audioGroups.reduce((l,c)=>{var f;const h=c?(f=e.groups[c])==null?void 0:f.tracks:null;return h?h.reduce((m,g)=>{if(g.groupId===c){const E=parseFloat(g.channels||"");a.forEach(T=>{const v={contentType:Wl(T,"audio"),bitrate:t?r8(T,u):u};E&&(v.channels=""+E),m.push(v)})}return m},l):l},[]):[]}function r8(s,e){if(e<=1)return 1;let t=128e3;return s==="ec-3"?t=768e3:s==="ac-3"&&(t=64e4),Math.min(e/2,t)}function nv(s){return Math.ceil(Math.max(s.bitrate*.9,s.averageBitrate)/1e3)*1e3||1}function u8(s){let e="";const{audio:t,video:i}=s;if(i){const a=Im(i.contentType);e+=`${a}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(t){const a=Im(t.contentType);e+=`${i?"_":""}${a}_c${t.channels}`}return e}const Rm=["NONE","TYPE-0","TYPE-1",null];function l8(s){return Rm.indexOf(s)>-1}const Cd=["SDR","PQ","HLG"];function o8(s){return!!s&&Cd.indexOf(s)>-1}var rd={No:"",Yes:"YES",v2:"v2"};function Yx(s){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=s,a=i<e/2;return e&&a?t?rd.v2:rd.Yes:rd.No}class Kx{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Zl{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return zx(this._audioGroups,e)}hasSubtitleGroup(e){return zx(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function zx(s,e){return!e||!s?!1:s.indexOf(e)!==-1}function c8(){if(typeof matchMedia=="function"){const s=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(s.media!==e.media)return s.matches===!0}return!1}function d8(s,e){let t=!1,i=[];if(s&&(t=s!=="SDR",i=[s]),e){i=e.allowedVideoRanges||Cd.slice(0);const a=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:a&&c8(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const f8=s=>{const e=new WeakSet;return(t,i)=>{if(s&&(i=s(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},ft=(s,e)=>JSON.stringify(s,f8(e));function h8(s,e,t,i,a){const u=Object.keys(s),l=i==null?void 0:i.channels,c=i==null?void 0:i.audioCodec,f=a==null?void 0:a.videoCodec,h=l&&parseInt(l)===2;let m=!1,g=!1,E=1/0,T=1/0,v=1/0,S=1/0,A=0,I=[];const{preferHDR:R,allowedVideoRanges:N}=d8(e,a);for(let H=u.length;H--;){const $=s[u[H]];m||(m=$.channels[2]>0),E=Math.min(E,$.minHeight),T=Math.min(T,$.minFramerate),v=Math.min(v,$.minBitrate),N.filter(ee=>$.videoRanges[ee]>0).length>0&&(g=!0)}E=Ee(E)?E:0,T=Ee(T)?T:0;const D=Math.max(1080,E),k=Math.max(30,T);v=Ee(v)?v:t,t=Math.max(v,t),g||(e=void 0);const G=u.length>1;return{codecSet:u.reduce((H,$)=>{const F=s[$];if($===H)return H;if(I=g?N.filter(ee=>F.videoRanges[ee]>0):[],G){if(F.minBitrate>t)return wi($,`min bitrate of ${F.minBitrate} > current estimate of ${t}`),H;if(!F.hasDefaultAudio)return wi($,"no renditions with default or auto-select sound found"),H;if(c&&$.indexOf(c.substring(0,4))%5!==0)return wi($,`audio codec preference "${c}" not found`),H;if(l&&!h){if(!F.channels[l])return wi($,`no renditions with ${l} channel sound found (channels options: ${Object.keys(F.channels)})`),H}else if((!c||h)&&m&&F.channels[2]===0)return wi($,"no renditions with stereo sound found"),H;if(F.minHeight>D)return wi($,`min resolution of ${F.minHeight} > maximum of ${D}`),H;if(F.minFramerate>k)return wi($,`min framerate of ${F.minFramerate} > maximum of ${k}`),H;if(!I.some(ee=>F.videoRanges[ee]>0))return wi($,`no variants with VIDEO-RANGE of ${ft(I)} found`),H;if(f&&$.indexOf(f.substring(0,4))%5!==0)return wi($,`video codec preference "${f}" not found`),H;if(F.maxScore<A)return wi($,`max score of ${F.maxScore} < selected max of ${A}`),H}return H&&(Rd($)>=Rd(H)||F.fragmentError>s[H].fragmentError)?H:(S=F.minIndex,A=F.maxScore,$)},void 0),videoRanges:I,preferHDR:R,minFramerate:T,minBitrate:v,minIndex:S}}function wi(s,e){nt.log(`[abr] start candidates with "${s}" ignored because ${e}`)}function av(s){return s.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const a=t.channels||"2";return i.channels[a]=(i.channels[a]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function m8(s,e,t,i){return s.slice(t,i+1).reduce((a,u,l)=>{if(!u.codecSet)return a;const c=u.audioGroups;let f=a[u.codecSet];f||(a[u.codecSet]=f={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:l,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),f.minBitrate=Math.min(f.minBitrate,u.bitrate);const h=Math.min(u.height,u.width);return f.minHeight=Math.min(f.minHeight,h),f.minFramerate=Math.min(f.minFramerate,u.frameRate),f.minIndex=Math.min(f.minIndex,l),f.maxScore=Math.max(f.maxScore,u.score),f.fragmentError+=u.fragmentError,f.videoRanges[u.videoRange]=(f.videoRanges[u.videoRange]||0)+1,c&&c.forEach(m=>{if(!m)return;const g=e.groups[m];g&&(f.hasDefaultAudio=f.hasDefaultAudio||e.hasDefaultAudio?g.hasDefault:g.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(g.channels).forEach(E=>{f.channels[E]=(f.channels[E]||0)+g.channels[E]}))}),a},{})}function Qx(s){if(!s)return s;const{lang:e,assocLang:t,characteristics:i,channels:a,audioCodec:u}=s;return{lang:e,assocLang:t,characteristics:i,channels:a,audioCodec:u}}function Vi(s,e,t){if("attrs"in s){const i=e.indexOf(s);if(i!==-1)return i}for(let i=0;i<e.length;i++){const a=e[i];if(er(s,a,t))return i}return-1}function er(s,e,t){const{groupId:i,name:a,lang:u,assocLang:l,default:c}=s,f=s.forced;return(i===void 0||e.groupId===i)&&(a===void 0||e.name===a)&&(u===void 0||g8(u,e.lang))&&(u===void 0||e.assocLang===l)&&(c===void 0||e.default===c)&&(f===void 0||e.forced===f)&&(!("characteristics"in s)||p8(s.characteristics||"",e.characteristics))&&(t===void 0||t(s,e))}function g8(s,e="--"){return s.length===e.length?s===e:s.startsWith(e)||e.startsWith(s)}function p8(s,e=""){const t=s.split(","),i=e.split(",");return t.length===i.length&&!t.some(a=>i.indexOf(a)===-1)}function Va(s,e){const{audioCodec:t,channels:i}=s;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function b8(s,e,t,i,a){const u=e[i],c=e.reduce((E,T,v)=>{const S=T.uri;return(E[S]||(E[S]=[])).push(v),E},{})[u.uri];c.length>1&&(i=Math.max.apply(Math,c));const f=u.videoRange,h=u.frameRate,m=u.codecSet.substring(0,4),g=Xx(e,i,E=>{if(E.videoRange!==f||E.frameRate!==h||E.codecSet.substring(0,4)!==m)return!1;const T=E.audioGroups,v=t.filter(S=>!T||T.indexOf(S.groupId)!==-1);return Vi(s,v,a)>-1});return g>-1?g:Xx(e,i,E=>{const T=E.audioGroups,v=t.filter(S=>!T||T.indexOf(S.groupId)!==-1);return Vi(s,v,a)>-1})}function Xx(s,e,t){for(let i=e;i>-1;i--)if(t(s[i]))return i;for(let i=e+1;i<s.length;i++)if(t(s[i]))return i;return-1}function Dd(s,e){var t;return!!s&&s!==((t=e.loadLevelObj)==null?void 0:t.uri)}class E8 extends gi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:a,partCurrent:u,hls:l}=this,{autoLevelEnabled:c,media:f}=l;if(!a||!f)return;const h=performance.now(),m=u?u.stats:a.stats,g=u?u.duration:a.duration,E=h-m.loading.start,T=l.minAutoLevel,v=a.level,S=this._nextAutoLevel;if(m.aborted||m.loaded&&m.loaded===m.total||v<=T){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const A=S>-1&&S!==v,I=!!t||A;if(!I&&(f.paused||!f.playbackRate||!f.readyState))return;const R=l.mainForwardBufferInfo;if(!I&&R===null)return;const N=this.bwEstimator.getEstimateTTFB(),D=Math.abs(f.playbackRate);if(E<=Math.max(N,1e3*(g/(D*2))))return;const k=R?R.len/D:0,G=m.loading.first?m.loading.first-m.loading.start:-1,U=m.loaded&&G>-1,H=this.getBwEstimate(),$=l.levels,F=$[v],ee=Math.max(m.loaded,Math.round(g*(a.bitrate||F.averageBitrate)/8));let me=U?E-G:E;me<1&&U&&(me=Math.min(E,m.loaded*8/H));const be=U?m.loaded*1e3/me:0,Te=N/1e3,ne=be?(ee-m.loaded)/be:ee*8/H+Te;if(ne<=k)return;const B=be?be*8:H,W=((i=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,te=this.hls.config.abrBandWidthUpFactor;let J=Number.POSITIVE_INFINITY,pe;for(pe=v-1;pe>T;pe--){const Ce=$[pe].maxBitrate,Ne=!$[pe].details||W;if(J=this.getTimeToLoadFrag(Te,B,g*Ce,Ne),J<Math.min(k,g+Te))break}if(J>=ne||J>g*10)return;U?this.bwEstimator.sample(E-Math.min(N,G),m.loaded):this.bwEstimator.sampleTTFB(E);const fe=$[pe].maxBitrate;this.getBwEstimate()*te>fe&&this.resetEstimator(fe);const ce=this.findBestLevel(fe,T,pe,0,k,1,1);ce>-1&&(pe=ce),this.warn(`Fragment ${a.sn}${u?" part "+u.index:""} of level ${v} is loading too slowly;
      Fragment duration: ${a.duration.toFixed(3)}
      Time to underbuffer: ${k.toFixed(3)} s
      Estimated load time for current fragment: ${ne.toFixed(3)} s
      Estimated load time for down switch fragment: ${J.toFixed(3)} s
      TTFB estimate: ${G|0} ms
      Current BW estimate: ${Ee(H)?H|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${pe} @ ${fe|0} bps`),l.nextLoadLevel=l.nextAutoLevel=pe,this.clearTimer();const xe=()=>{if(this.clearTimer(),this.fragCurrent===a&&this.hls.loadLevel===pe&&pe>0){const Ce=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${pe>0?"and switching down":""}
      Fragment duration: ${a.duration.toFixed(3)} s
      Time to underbuffer: ${Ce.toFixed(3)} s`),a.abortRequests(),this.fragCurrent=this.partCurrent=null,pe>T){let Ne=this.findBestLevel(this.hls.levels[T].bitrate,T,pe,0,Ce,1,1);Ne===-1&&(Ne=T),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Ne,this.resetEstimator(this.hls.levels[Ne].bitrate)}}};A||ne>J*2?xe():this.timer=self.setInterval(xe,J*1e3),l.trigger(L.FRAG_LOAD_EMERGENCY_ABORTED,{frag:a,part:u,stats:m})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new SD(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(L.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var a;this.fragCurrent=i,this.partCurrent=(a=t.part)!=null?a:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Y.BUFFER_ADD_CODEC_ERROR:case Y.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Y.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:a,partCurrent:u}=this;if(i&&a&&i.sn===a.sn&&i.level===a.level){const l=performance.now(),c=u?u.stats:i.stats,f=l-c.loading.start,h=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&h>-1){const g=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(f-Math.min(g,h),c.loaded)}else this.bwEstimator.sampleTTFB(f)}break}}}getTimeToLoadFrag(e,t,i,a){const u=e+i/t,l=a?e+this.lastLevelLoadSec:0;return u+l}onLevelLoaded(e,t){const i=this.hls.config,{loading:a}=t.stats,u=a.end-a.first;Ee(u)&&(this.lastLevelLoadSec=u/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const a=i?i.stats:t.stats;if(t.type===ye.MAIN&&this.bwEstimator.sampleTTFB(a.loading.first-a.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const u=i?i.duration:t.duration,l=this.hls.levels[t.level],c=(l.loaded?l.loaded.bytes:0)+a.loaded,f=(l.loaded?l.loaded.duration:0)+u;l.loaded={bytes:c,duration:f},l.realBitrate=Math.round(8*c/f)}if(t.bitrateTest){const u={stats:a,frag:t,part:i,id:t.type};this.onFragBuffered(L.FRAG_BUFFERED,u),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:a}=t,u=a!=null&&a.stats.loaded?a.stats:i.stats;if(u.aborted||this.ignoreFragment(i))return;const l=u.parsing.end-u.loading.start-Math.min(u.loading.first-u.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,u.loaded),u.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ye.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),a=this.hls.config.maxStarvationDelay,u=this.findBestLevel(i,t,e,0,a,1,1);if(u>-1)return u;const l=this.hls.firstLevel,c=Math.min(Math.max(l,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${l} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),a=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!a||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const u=i&&a?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const l=this.hls.levels;if(l.length>Math.max(e,u)&&l[e].loadError<=l[u].loadError)return e}return this._nextAutoLevel=u,this.nextAutoLevelKey=this.getAutoLevelKey(),u}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:a,config:u,minAutoLevel:l}=i,c=t?t.duration:e?e.duration:0,f=this.getBwEstimate(),h=this.getStarvationDelay();let m=u.abrBandWidthFactor,g=u.abrBandWidthUpFactor;if(h){const A=this.findBestLevel(f,l,a,h,0,m,g);if(A>=0)return this.rebufferNotice=-1,A}let E=c?Math.min(c,u.maxStarvationDelay):u.maxStarvationDelay;if(!h){const A=this.bitrateTestDelay;A&&(E=(c?Math.min(c,u.maxLoadingDelay):u.maxLoadingDelay)-A,this.info(`bitrate test took ${Math.round(1e3*A)}ms, set first fragment max fetchDuration to ${Math.round(1e3*E)} ms`),m=g=1)}const T=this.findBestLevel(f,l,a,h,E,m,g);if(this.rebufferNotice!==T&&(this.rebufferNotice=T,this.info(`${h?"rebuffering expected":"buffer is empty"}, optimal quality level ${T}`)),T>-1)return T;const v=i.levels[l],S=i.loadLevelObj;return S&&(v==null?void 0:v.bitrate)<S.bitrate?l:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,a=e.mainForwardBufferInfo;return(a?a.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,a,u,l,c){var f;const h=a+u,m=this.lastLoadedFragLevel,g=m===-1?this.hls.firstLevel:m,{fragCurrent:E,partCurrent:T}=this,{levels:v,allAudioTracks:S,loadLevel:A,config:I}=this.hls;if(v.length===1)return 0;const R=v[g],N=!!((f=this.hls.latestLevelDetails)!=null&&f.live),D=A===-1||m===-1;let k,G="SDR",U=(R==null?void 0:R.frameRate)||0;const{audioPreference:H,videoPreference:$}=I,F=this.audioTracksByGroup||(this.audioTracksByGroup=av(S));let ee=-1;if(D){if(this.firstSelection!==-1)return this.firstSelection;const B=this.codecTiers||(this.codecTiers=m8(v,F,t,i)),W=h8(B,G,e,H,$),{codecSet:te,videoRanges:J,minFramerate:pe,minBitrate:fe,minIndex:ce,preferHDR:xe}=W;ee=ce,k=te,G=xe?J[J.length-1]:J[0],U=pe,e=Math.max(e,fe),this.log(`picked start tier ${ft(W)}`)}else k=R==null?void 0:R.codecSet,G=R==null?void 0:R.videoRange;const me=T?T.duration:E?E.duration:0,be=this.bwEstimator.getEstimateTTFB()/1e3,Te=[];for(let B=i;B>=t;B--){var ne;const W=v[B],te=B>g;if(!W)continue;if(I.useMediaCapabilities&&!W.supportedResult&&!W.supportedPromise){const Ne=navigator.mediaCapabilities;typeof(Ne==null?void 0:Ne.decodingInfo)=="function"&&i8(W,F,G,U,e,H)?(W.supportedPromise=iv(W,F,Ne,this.supportedCache),W.supportedPromise.then(Me=>{if(!this.hls)return;W.supportedResult=Me;const It=this.hls.levels,yt=It.indexOf(W);Me.error?this.warn(`MediaCapabilities decodingInfo error: "${Me.error}" for level ${yt} ${ft(Me)}`):Me.supported?Me.decodingInfoResults.some(Vt=>Vt.smooth===!1||Vt.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${yt} not smooth or powerEfficient: ${ft(Me)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${yt} ${ft(Me)}`),yt>-1&&It.length>1&&(this.log(`Removing unsupported level ${yt}`),this.hls.removeLevel(yt),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(Me=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${Me}`)})):W.supportedResult=tv}if((k&&W.codecSet!==k||G&&W.videoRange!==G||te&&U>W.frameRate||!te&&U>0&&U<W.frameRate||(ne=W.supportedResult)!=null&&(ne=ne.decodingInfoResults)!=null&&ne.some(Ne=>Ne.smooth===!1))&&(!D||B!==ee)){Te.push(B);continue}const J=W.details,pe=(T?J==null?void 0:J.partTarget:J==null?void 0:J.averagetargetduration)||me;let fe;te?fe=c*e:fe=l*e;const ce=me&&a>=me*2&&u===0?W.averageBitrate:W.maxBitrate,xe=this.getTimeToLoadFrag(be,fe,ce*pe,J===void 0);if(fe>=ce&&(B===m||W.loadError===0&&W.fragmentError===0)&&(xe<=be||!Ee(xe)||N&&!this.bitrateTestDelay||xe<h)){const Ne=this.forcedAutoLevel;return B!==A&&(Ne===-1||Ne!==A)&&(Te.length&&this.trace(`Skipped level(s) ${Te.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${v[Te[0]].codecs}" ${v[Te[0]].videoRange}; not compatible with "${k}" ${G}`),this.info(`switch candidate:${g}->${B} adjustedbw(${Math.round(fe)})-bitrate=${Math.round(fe-ce)} ttfb:${be.toFixed(1)} avgDuration:${pe.toFixed(1)} maxFetchDuration:${h.toFixed(1)} fetchDuration:${xe.toFixed(1)} firstSelection:${D} codecSet:${W.codecSet} videoRange:${W.videoRange} hls.loadLevel:${A}`)),D&&(this.firstSelection=B),B}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const rv={search:function(s,e){let t=0,i=s.length-1,a=null,u=null;for(;t<=i;){a=(t+i)/2|0,u=s[a];const l=e(u);if(l>0)t=a+1;else if(l<0)i=a-1;else return u}return null}};function x8(s,e,t){if(e===null||!Array.isArray(s)||!s.length||!Ee(e))return null;const i=s[0].programDateTime;if(e<(i||0))return null;const a=s[s.length-1].endProgramDateTime;if(e>=(a||0))return null;for(let u=0;u<s.length;++u){const l=s[u];if(y8(e,t,l))return l}return null}function nr(s,e,t=0,i=0,a=.005){let u=null;if(s){u=e[1+s.sn-e[0].sn]||null;const c=s.endDTS-t;c>0&&c<15e-7&&(t+=15e-7),u&&s.level!==u.level&&u.end<=s.end&&(u=e[2+s.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(u=e[0]);if(u&&((!s||s.level===u.level)&&Wx(t,i,u)===0||T8(u,s,Math.min(a,i))))return u;const l=rv.search(e,Wx.bind(null,t,i));return l&&(l!==s||!u)?l:u}function T8(s,e,t){if(e&&e.start===0&&e.level<s.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((a,u)=>(u[0]==="INF"&&(a+=parseFloat(u[1])),a),t);return s.start<=i}return!1}function Wx(s=0,e=0,t){if(t.start<=s&&t.start+t.duration>s)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=s?1:t.start-i>s&&t.start?-1:0}function y8(s,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>s}function uv(s,e,t){if(s&&s.startCC<=e&&s.endCC>=e){let i=s.fragments;const{fragmentHint:a}=s;a&&(i=i.concat(a));let u;return rv.search(i,l=>l.cc<e?1:l.cc>e?-1:(u=l,l.end<=t?1:l.start>t?-1:0)),u||null}return null}function Od(s){switch(s.details){case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_TIMEOUT:case Y.LEVEL_LOAD_TIMEOUT:case Y.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function lv(s){return s.details.startsWith("key")}function ov(s){return lv(s)&&!!s.frag&&!s.frag.decryptdata}function Zx(s,e){const t=Od(e);return s.default[`${t?"timeout":"error"}Retry`]}function Sg(s,e){const t=s.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*s.retryDelayMs,s.maxRetryDelayMs)}function Jx(s){return it(it({},s),{errorRetry:null,timeoutRetry:null})}function wd(s,e,t,i){if(!s)return!1;const a=i==null?void 0:i.code,u=e<s.maxNumRetry&&(v8(a)||!!t);return s.shouldRetry?s.shouldRetry(s,e,t,i,u):u}function v8(s){return Nm(s)||!!s&&(s<400||s>499)}function Nm(s){return s===0&&navigator.onLine===!1}var ds={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Qs={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class S8 extends gi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.ERROR,this.onError,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.ERROR,this.onError,this),e.off(L.ERROR,this.onErrorOut,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===ye.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,i=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||i===-1?t.loadLevel:i}variantHasKey(e,t){if(e){var i;if((i=e.details)!=null&&i.hasKey(t))return!0;const a=e.audioGroups;if(a)return this.hls.allAudioTracks.filter(l=>a.indexOf(l.groupId)>=0).some(l=>{var c;return(c=l.details)==null?void 0:c.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const a=this.hls,u=t.context;switch(t.details){case Y.FRAG_LOAD_ERROR:case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_ERROR:case Y.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Y.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=au();return}case Y.FRAG_GAP:case Y.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=ds.SendAlternateToPenaltyBox;return}case Y.LEVEL_EMPTY_ERROR:case Y.LEVEL_PARSING_ERROR:{var l;const f=t.parent===ye.MAIN?t.level:a.loadLevel;t.details===Y.LEVEL_EMPTY_ERROR&&((l=t.context)!=null&&(l=l.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,f):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,f))}return;case Y.LEVEL_LOAD_ERROR:case Y.LEVEL_LOAD_TIMEOUT:typeof(u==null?void 0:u.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u.level));return;case Y.AUDIO_TRACK_LOAD_ERROR:case Y.AUDIO_TRACK_LOAD_TIMEOUT:case Y.SUBTITLE_LOAD_ERROR:case Y.SUBTITLE_TRACK_LOAD_TIMEOUT:if(u){const f=a.loadLevelObj;if(f&&(u.type===Fe.AUDIO_TRACK&&f.hasAudioGroup(u.groupId)||u.type===Fe.SUBTITLE_TRACK&&f.hasSubtitleGroup(u.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.loadLevel),t.errorAction.action=ds.SendAlternateToPenaltyBox,t.errorAction.flags=Qs.MoveAllAlternatesMatchingHost;return}}return;case Y.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:ds.SendAlternateToPenaltyBox,flags:Qs.MoveAllAlternatesMatchingHDCP};return;case Y.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Y.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Y.KEY_SYSTEM_NO_SESSION:t.errorAction={action:ds.SendAlternateToPenaltyBox,flags:Qs.MoveAllAlternatesMatchingKey};return;case Y.BUFFER_ADD_CODEC_ERROR:case Y.REMUX_ALLOC_ERROR:case Y.BUFFER_APPEND_ERROR:if(!t.errorAction){var c;t.errorAction=this.getLevelSwitchAction(t,(c=t.level)!=null?c:a.loadLevel)}return;case Y.INTERNAL_EXCEPTION:case Y.BUFFER_APPENDING_ERROR:case Y.BUFFER_FULL_ERROR:case Y.LEVEL_SWITCH_ERROR:case Y.BUFFER_STALLED_ERROR:case Y.BUFFER_SEEK_OVER_HOLE:case Y.BUFFER_NUDGE_ON_STALL:t.errorAction=au();return}t.type===Ae.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=au())}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,a=Zx(i.config.playlistLoadPolicy,e),u=this.playlistError++;if(wd(a,u,Od(e),e.response))return{action:ds.RetryRequest,flags:Qs.None,retryConfig:a,retryCount:u};const c=this.getLevelSwitchAction(e,t);return a&&(c.retryConfig=a,c.retryCount=u),c}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),a=t.levels[i],{fragLoadPolicy:u,keyLoadPolicy:l}=t.config,c=Zx(lv(e)?l:u,e),f=t.levels.reduce((m,g)=>m+g.fragmentError,0);if(a&&(e.details!==Y.FRAG_GAP&&a.fragmentError++,!ov(e)&&wd(c,f,Od(e),e.response)))return{action:ds.RetryRequest,flags:Qs.None,retryConfig:c,retryCount:f};const h=this.getLevelSwitchAction(e,i);return c&&(h.retryConfig=c,h.retryCount=f),h}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const a=this.hls.levels[t];if(a){var u,l;const h=e.details;a.loadError++,h===Y.BUFFER_APPEND_ERROR&&a.fragmentError++;let m=-1;const{levels:g,loadLevel:E,minAutoLevel:T,maxAutoLevel:v}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const S=(u=e.frag)==null?void 0:u.type,I=(S===ye.AUDIO&&h===Y.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(h===Y.BUFFER_ADD_CODEC_ERROR||h===Y.BUFFER_APPEND_ERROR))&&g.some(({audioCodec:G})=>a.audioCodec!==G),N=e.sourceBufferName==="video"&&(h===Y.BUFFER_ADD_CODEC_ERROR||h===Y.BUFFER_APPEND_ERROR)&&g.some(({codecSet:G,audioCodec:U})=>a.codecSet!==G&&a.audioCodec===U),{type:D,groupId:k}=(l=e.context)!=null?l:{};for(let G=g.length;G--;){const U=(G+E)%g.length;if(U!==E&&U>=T&&U<=v&&g[U].loadError===0){var c,f;const H=g[U];if(h===Y.FRAG_GAP&&S===ye.MAIN&&e.frag){const $=g[U].details;if($){const F=nr(e.frag,$.fragments,e.frag.start);if(F!=null&&F.gap)continue}}else{if(D===Fe.AUDIO_TRACK&&H.hasAudioGroup(k)||D===Fe.SUBTITLE_TRACK&&H.hasSubtitleGroup(k))continue;if(S===ye.AUDIO&&(c=a.audioGroups)!=null&&c.some($=>H.hasAudioGroup($))||S===ye.SUBTITLE&&(f=a.subtitleGroups)!=null&&f.some($=>H.hasSubtitleGroup($))||I&&a.audioCodec===H.audioCodec||N&&a.codecSet===H.codecSet||!I&&a.codecSet!==H.codecSet)continue}m=U;break}}if(m>-1&&i.loadLevel!==m)return e.levelRetry=!0,this.playlistError=0,{action:ds.SendAlternateToPenaltyBox,flags:Qs.None,nextAutoLevel:m}}return{action:ds.SendAlternateToPenaltyBox,flags:Qs.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case ds.DoNothing:break;case ds.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Y.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:a}=i,u=i.nextAutoLevel;switch(a){case Qs.None:this.switchLevel(e,u);break;case Qs.MoveAllAlternatesMatchingHDCP:{const f=this.getVariantLevelIndex(e.frag),h=t.levels[f],m=h==null?void 0:h.attrs["HDCP-LEVEL"];if(i.hdcpLevel=m,m==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(m){t.maxHdcpLevel=Rm[Rm.indexOf(m)-1],i.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Qs.MoveAllAlternatesMatchingKey:{const f=e.decryptdata;if(f){const h=this.hls.levels,m=h.length;for(let E=m;E--;)if(this.variantHasKey(h[E],f)){var l,c;this.log(`Banned key found in level ${E} (${h[E].bitrate}bps) or audio group "${(l=h[E].audioGroups)==null?void 0:l.join(",")}" (${(c=e.frag)==null?void 0:c.type} fragment) ${fs(f.keyId||[])}`),h[E].fragmentError++,h[E].loadError++,this.log(`Removing level ${E} with key error (${e.error})`),this.hls.removeLevel(E)}const g=e.frag;if(this.hls.levels.length<m)i.resolved=!0;else if(g&&g.type!==ye.MAIN){const E=g.decryptdata;E&&!f.matches(E)&&(i.resolved=!0)}}break}}i.resolved||this.switchLevel(e,u)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Y.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=Im(e.mimeType),a=this.hls.levels;for(let u=a.length;u--;)a[u][`${e.sourceBufferName}Codec`]===i&&(this.log(`Removing level ${u} for ${e.details} ("${i}" not supported)`),this.hls.removeLevel(u))}}}function au(s){const e={action:ds.DoNothing,flags:Qs.None};return s&&(e.resolved=!0),e}var Kt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class A8{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let a=i.length;a--;){const u=i[a];if(!u)break;if(u.start<=e&&e<=u.end&&u.loaded)return u}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:a}=this,u=Object.keys(a);for(let l=u.length;l--;){const c=a[u[l]];if((c==null?void 0:c.body.type)===t&&(!i||c.buffered)){const f=c.body;if(f.start<=e&&e<=f.end)return f}}return null}detectEvictedFragments(e,t,i,a,u){this.timeRanges&&(this.timeRanges[e]=t);const l=(a==null?void 0:a.fragment.sn)||-1;Object.keys(this.fragments).forEach(c=>{const f=this.fragments[c];if(!f||l>=f.body.sn)return;if(!f.buffered&&(!f.loaded||u)){f.body.type===i&&this.removeFragment(f.body);return}const h=f.range[e];if(h){if(h.time.length===0){this.removeFragment(f.body);return}h.time.some(m=>{const g=!this.isTimeBuffered(m.startPTS,m.endPTS,t);return g&&this.removeFragment(f.body),g})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,a=Xr(i),u=this.fragments[a];if(!u||u.buffered&&i.gap)return;const l=!i.relurl;Object.keys(t).forEach(c=>{const f=i.elementaryStreams[c];if(!f)return;const h=t[c],m=l||f.partial===!0;u.range[c]=this.getBufferedTimes(i,e.part,m,h)}),u.loaded=null,Object.keys(u.range).length?(this.bufferedEnd(u,i),Gc(u)||this.removeParts(i.sn-1,i.type)):this.removeFragment(u.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=eT(i,a=>a.fragment.sn>=e))}fragBuffered(e,t){const i=Xr(e);let a=this.fragments[i];!a&&t&&(a=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),a&&(a.loaded=null,this.bufferedEnd(a,e))}getBufferedTimes(e,t,i,a){const u={time:[],partial:i},l=e.start,c=e.end,f=e.minEndPTS||c,h=e.maxStartPTS||l;for(let m=0;m<a.length;m++){const g=a.start(m)-this.bufferPadding,E=a.end(m)+this.bufferPadding;if(h>=g&&f<=E){u.time.push({startPTS:Math.max(l,a.start(m)),endPTS:Math.min(c,a.end(m))});break}else if(l<E&&c>g){const T=Math.max(l,a.start(m)),v=Math.min(c,a.end(m));v>T&&(u.partial=!0,u.time.push({startPTS:T,endPTS:v}))}else if(c<=g)break}return u}getPartialFragment(e){let t=null,i,a,u,l=0;const{bufferPadding:c,fragments:f}=this;return Object.keys(f).forEach(h=>{const m=f[h];m&&Gc(m)&&(a=m.body.start-c,u=m.body.end+c,e>=a&&e<=u&&(i=Math.min(e-a,u-e),l<=i&&(t=m.body,l=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Gc(t))}getState(e){const t=Xr(e),i=this.fragments[t];return i?i.buffered?Gc(i)?Kt.PARTIAL:Kt.OK:Kt.APPENDING:Kt.NOT_LOADED}isTimeBuffered(e,t,i){let a,u;for(let l=0;l<i.length;l++){if(a=i.start(l)-this.bufferPadding,u=i.end(l)+this.bufferPadding,e>=a&&t<=u)return!0;if(t<=a)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,a=t.part?null:t,u=Xr(i);this.fragments[u]={body:i,appendedPTS:null,loaded:a,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:a,timeRanges:u,type:l}=t;if(i.sn==="initSegment")return;const c=i.type;if(a){let h=this.activePartLists[c];h||(this.activePartLists[c]=h=[]),h.push(a)}this.timeRanges=u;const f=u[l];this.detectEvictedFragments(l,f,c,a)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Xr(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let a=i.length;a--;){const u=t[i[a]];if((u==null?void 0:u.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,a,u){a&&!this.hasGaps||Object.keys(this.fragments).forEach(l=>{const c=this.fragments[l];if(!c)return;const f=c.body;f.type!==i||a&&!f.gap||f.start<t&&f.end>e&&(c.buffered||u)&&this.removeFragment(f)})}removeFragment(e){const t=Xr(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const a=e.sn;this.activePartLists[e.type]=eT(i,u=>u.fragment.sn!==a)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(i=>i.clearElementaryStreamInfo())}}function Gc(s){var e,t,i;return s.buffered&&!!(s.body.gap||(e=s.range.video)!=null&&e.partial||(t=s.range.audio)!=null&&t.partial||(i=s.range.audiovideo)!=null&&i.partial)}function Xr(s){return`${s.type}_${s.level}_${s.sn}`}function eT(s,e){return s.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var xa={cbc:0,ctr:1};class _8{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case xa.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case xa.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function L8(s){const e=s.byteLength,t=e&&new DataView(s.buffer).getUint8(e-1);return t?s.slice(0,e-t):s}class I8{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let a=0;a<4;a++)i[a]=t.getUint32(a*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,a=i[0],u=i[1],l=i[2],c=i[3],f=this.invSubMix,h=f[0],m=f[1],g=f[2],E=f[3],T=new Uint32Array(256);let v=0,S=0,A=0;for(A=0;A<256;A++)A<128?T[A]=A<<1:T[A]=A<<1^283;for(A=0;A<256;A++){let I=S^S<<1^S<<2^S<<3^S<<4;I=I>>>8^I&255^99,e[v]=I,t[I]=v;const R=T[v],N=T[R],D=T[N];let k=T[I]*257^I*16843008;a[v]=k<<24|k>>>8,u[v]=k<<16|k>>>16,l[v]=k<<8|k>>>24,c[v]=k,k=D*16843009^N*65537^R*257^v*16843008,h[I]=k<<24|k>>>8,m[I]=k<<16|k>>>16,g[I]=k<<8|k>>>24,E[I]=k,v?(v=R^T[T[T[D^R]]],S^=T[T[S]]):v=S=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,a=0;for(;a<t.length&&i;)i=t[a]===this.key[a],a++;if(i)return;this.key=t;const u=this.keySize=t.length;if(u!==4&&u!==6&&u!==8)throw new Error("Invalid aes key size="+u);const l=this.ksRows=(u+6+1)*4;let c,f;const h=this.keySchedule=new Uint32Array(l),m=this.invKeySchedule=new Uint32Array(l),g=this.sBox,E=this.rcon,T=this.invSubMix,v=T[0],S=T[1],A=T[2],I=T[3];let R,N;for(c=0;c<l;c++){if(c<u){R=h[c]=t[c];continue}N=R,c%u===0?(N=N<<8|N>>>24,N=g[N>>>24]<<24|g[N>>>16&255]<<16|g[N>>>8&255]<<8|g[N&255],N^=E[c/u|0]<<24):u>6&&c%u===4&&(N=g[N>>>24]<<24|g[N>>>16&255]<<16|g[N>>>8&255]<<8|g[N&255]),h[c]=R=(h[c-u]^N)>>>0}for(f=0;f<l;f++)c=l-f,f&3?N=h[c]:N=h[c-4],f<4||c<=4?m[f]=N:m[f]=v[g[N>>>24]]^S[g[N>>>16&255]]^A[g[N>>>8&255]]^I[g[N&255]],m[f]=m[f]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const a=this.keySize+6,u=this.invKeySchedule,l=this.invSBox,c=this.invSubMix,f=c[0],h=c[1],m=c[2],g=c[3],E=this.uint8ArrayToUint32Array_(i);let T=E[0],v=E[1],S=E[2],A=E[3];const I=new Int32Array(e),R=new Int32Array(I.length);let N,D,k,G,U,H,$,F,ee,me,be,Te,ne,B;const W=this.networkToHostOrderSwap;for(;t<I.length;){for(ee=W(I[t]),me=W(I[t+1]),be=W(I[t+2]),Te=W(I[t+3]),U=ee^u[0],H=Te^u[1],$=be^u[2],F=me^u[3],ne=4,B=1;B<a;B++)N=f[U>>>24]^h[H>>16&255]^m[$>>8&255]^g[F&255]^u[ne],D=f[H>>>24]^h[$>>16&255]^m[F>>8&255]^g[U&255]^u[ne+1],k=f[$>>>24]^h[F>>16&255]^m[U>>8&255]^g[H&255]^u[ne+2],G=f[F>>>24]^h[U>>16&255]^m[H>>8&255]^g[$&255]^u[ne+3],U=N,H=D,$=k,F=G,ne=ne+4;N=l[U>>>24]<<24^l[H>>16&255]<<16^l[$>>8&255]<<8^l[F&255]^u[ne],D=l[H>>>24]<<24^l[$>>16&255]<<16^l[F>>8&255]<<8^l[U&255]^u[ne+1],k=l[$>>>24]<<24^l[F>>16&255]<<16^l[U>>8&255]<<8^l[H&255]^u[ne+2],G=l[F>>>24]<<24^l[U>>16&255]<<16^l[H>>8&255]<<8^l[$&255]^u[ne+3],R[t]=W(N^T),R[t+1]=W(G^v),R[t+2]=W(k^S),R[t+3]=W(D^A),T=ee,v=me,S=be,A=Te,t=t+4}return R.buffer}}class R8{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=N8(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function N8(s){switch(s){case xa.cbc:return"AES-CBC";case xa.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${s}`)}}const C8=16;class Ag{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?L8(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,a){return this.useSoftware?new Promise((u,l)=>{const c=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(c,t,i,a);const f=this.flush();f?u(f.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,a)}softwareDecrypt(e,t,i,a){const{currentIV:u,currentResult:l,remainderData:c}=this;if(a!==xa.cbc||t.byteLength!==16)return nt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(e=mi(c,e),this.remainderData=null);const f=this.getValidChunk(e);if(!f.length)return null;u&&(i=u);let h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new I8),h.expandKey(t);const m=l;return this.currentResult=h.decrypt(f.buffer,0,i),this.currentIV=f.slice(-16).buffer,m||null}webCryptoDecrypt(e,t,i,a){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,a));this.key=t,this.fastAesKey=new R8(this.subtle,t,a)}return this.fastAesKey.expandKey().then(u=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new _8(this.subtle,new Uint8Array(i),a).decrypt(e.buffer,u)):Promise.reject(new Error("web crypto not initialized"))).catch(u=>(nt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${u.name}: ${u.message}`),this.onWebCryptoError(e,t,i,a)))}onWebCryptoError(e,t,i,a){const u=this.enableSoftwareAES;if(u){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,a);const l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(u?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%C8;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(nt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const tT=Math.pow(2,17);class D8{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new yn({type:Ae.NETWORK_ERROR,details:Y.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const a=this.config,u=a.fLoader,l=a.loader;return new Promise((c,f)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(v=>v[0]==="GAP")){f(iT(e));return}else e.gap=!1;const h=this.loader=u?new u(a):new l(a),m=sT(e);e.loader=h;const g=Jx(a.fragLoadPolicy.default),E={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:tT};e.stats=h.stats;const T={onSuccess:(v,S,A,I)=>{this.resetLoader(e,h);let R=v.data;A.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(R.slice(0,16)),R=R.slice(16)),c({frag:e,part:null,payload:R,networkDetails:I})},onError:(v,S,A,I)=>{this.resetLoader(e,h),f(new yn({type:Ae.NETWORK_ERROR,details:Y.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:it({url:i,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:A,stats:I}))},onAbort:(v,S,A)=>{this.resetLoader(e,h),f(new yn({type:Ae.NETWORK_ERROR,details:Y.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:A,stats:v}))},onTimeout:(v,S,A)=>{this.resetLoader(e,h),f(new yn({type:Ae.NETWORK_ERROR,details:Y.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${E.timeout}ms`),networkDetails:A,stats:v}))}};t&&(T.onProgress=(v,S,A,I)=>t({frag:e,part:null,payload:A,networkDetails:I})),h.load(m,E,T)})}loadPart(e,t,i){this.abort();const a=this.config,u=a.fLoader,l=a.loader;return new Promise((c,f)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){f(iT(e,t));return}const h=this.loader=u?new u(a):new l(a),m=sT(e,t);e.loader=h;const g=Jx(a.fragLoadPolicy.default),E={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:tT};t.stats=h.stats,h.load(m,E,{onSuccess:(T,v,S,A)=>{this.resetLoader(e,h),this.updateStatsFromPart(e,t);const I={frag:e,part:t,payload:T.data,networkDetails:A};i(I),c(I)},onError:(T,v,S,A)=>{this.resetLoader(e,h),f(new yn({type:Ae.NETWORK_ERROR,details:Y.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:it({url:m.url,data:void 0},T),error:new Error(`HTTP Error ${T.code} ${T.text}`),networkDetails:S,stats:A}))},onAbort:(T,v,S)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,h),f(new yn({type:Ae.NETWORK_ERROR,details:Y.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:S,stats:T}))},onTimeout:(T,v,S)=>{this.resetLoader(e,h),f(new yn({type:Ae.NETWORK_ERROR,details:Y.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${E.timeout}ms`),networkDetails:S,stats:T}))}})})}updateStatsFromPart(e,t){const i=e.stats,a=t.stats,u=a.total;if(i.loaded+=a.loaded,u){const f=Math.round(e.duration/t.duration),h=Math.min(Math.round(i.loaded/u),f),g=(f-h)*Math.round(i.loaded/h);i.total=i.loaded+g}else i.total=Math.max(i.loaded,i.total);const l=i.loading,c=a.loading;l.start?l.first+=c.first-c.start:(l.start=c.start,l.first=c.first),l.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function sT(s,e=null){const t=e||s,i={frag:s,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},a=t.byteRangeStartOffset,u=t.byteRangeEndOffset;if(Ee(a)&&Ee(u)){var l;let c=a,f=u;if(s.sn==="initSegment"&&O8((l=s.decryptdata)==null?void 0:l.method)){const h=u-a;h%16&&(f=u+(16-h%16)),a!==0&&(i.resetIV=!0,c=a-16)}i.rangeStart=c,i.rangeEnd=f}return i}function iT(s,e){const t=new Error(`GAP ${s.gap?"tag":"attribute"} found`),i={type:Ae.MEDIA_ERROR,details:Y.FRAG_GAP,fatal:!1,frag:s,error:t,networkDetails:null};return e&&(i.part=e),(e||s).stats.aborted=!0,new yn(i)}function O8(s){return s==="AES-128"||s==="AES-256"}class yn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class cv extends gi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class _g{constructor(e,t,i,a=0,u=-1,l=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Vc(),this.buffering={audio:Vc(),video:Vc(),audiovideo:Vc()},this.level=e,this.sn=t,this.id=i,this.size=a,this.part=u,this.partial=l}}function Vc(){return{start:0,executeStart:0,executeEnd:0,end:0}}const nT={length:0,start:()=>0,end:()=>0};class ke{static isBuffered(e,t){if(e){const i=ke.getBuffered(e);for(let a=i.length;a--;)if(t>=i.start(a)&&t<=i.end(a))return!0}return!1}static bufferedRanges(e){if(e){const t=ke.getBuffered(e);return ke.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const a=ke.bufferedRanges(e);if(a.length)return ke.bufferedInfo(a,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((m,g)=>m.start-g.start||g.end-m.end);let a=-1,u=[];if(i)for(let m=0;m<e.length;m++){t>=e[m].start&&t<=e[m].end&&(a=m);const g=u.length;if(g){const E=u[g-1].end;e[m].start-E<i?e[m].end>E&&(u[g-1].end=e[m].end):u.push(e[m])}else u.push(e[m])}else u=e;let l=0,c,f=t,h=t;for(let m=0;m<u.length;m++){const g=u[m].start,E=u[m].end;if(a===-1&&t>=g&&t<=E&&(a=m),t+i>=g&&t<E)f=g,h=E,l=h-t;else if(t+i<g){c=g;break}}return{len:l,start:f||0,end:h||0,nextStart:c,buffered:e,bufferedIndex:a}}static getBuffered(e){try{return e.buffered||nT}catch(t){return nt.log("failed to get media.buffered",t),nT}}}const dv=/\{\$([a-zA-Z0-9-_]+)\}/g;function aT(s){return dv.test(s)}function Cm(s,e){if(s.variableList!==null||s.hasVariableRefs){const t=s.variableList;return e.replace(dv,i=>{const a=i.substring(2,i.length-1),u=t==null?void 0:t[a];return u===void 0?(s.playlistParsingError||(s.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${a}"`)),i):u})}return e}function rT(s,e,t){let i=s.variableList;i||(s.variableList=i={});let a,u;if("QUERYPARAM"in e){a=e.QUERYPARAM;try{const l=new self.URL(t).searchParams;if(l.has(a))u=l.get(a);else throw new Error(`"${a}" does not match any query parameter in URI: "${t}"`)}catch(l){s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${l.message}`))}}else a=e.NAME,u=e.VALUE;a in i?s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${a}"`)):i[a]=u||""}function w8(s,e,t){const i=e.IMPORT;if(t&&i in t){let a=s.variableList;a||(s.variableList=a={}),a[i]=t[i]}else s.playlistParsingError||(s.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const k8=/^(\d+)x(\d+)$/,uT=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Et{constructor(e,t){typeof e=="string"&&(e=Et.parseAttrList(e,t)),ot(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let a=0;a<t.length/2;a++)i[a]=parseInt(t.slice(a*2,a*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((a,u)=>(a[u.toLowerCase()]=!0,a),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=k8.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const a={};for(uT.lastIndex=0;(i=uT.exec(e))!==null;){const l=i[1].trim();let c=i[2];const f=c.indexOf('"')===0&&c.lastIndexOf('"')===c.length-1;let h=!1;if(f)c=c.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":h=!0}if(t&&(f||h))c=Cm(t,c);else if(!h&&!f)switch(l){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":nt.warn(`${e}: attribute ${l} is missing quotes`)}a[l]=c}return a}}const M8="com.apple.hls.interstitial";function P8(s){return s!=="ID"&&s!=="CLASS"&&s!=="CUE"&&s!=="START-DATE"&&s!=="DURATION"&&s!=="END-DATE"&&s!=="END-ON-NEXT"}function U8(s){return s==="SCTE35-OUT"||s==="SCTE35-IN"||s==="SCTE35-CMD"}class fv{constructor(e,t,i=0){var a;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(a=t==null?void 0:t.tagOrder)!=null?a:i,t){const u=t.attr;for(const l in u)if(Object.prototype.hasOwnProperty.call(e,l)&&e[l]!==u[l]){nt.warn(`DATERANGE tag attribute: "${l}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=l;break}e=ot(new Et({}),u,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const u=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Ee(u.getTime())&&(this._endDate=u)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(nt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Ee(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===M8}get isValid(){return!!this.id&&!this._badValueForSameId&&Ee(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const B8=10;class F8{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let i=t.decryptdata;return i||(t.setKeyFormat(e.keyFormat),i=t.decryptdata),!!i&&e.matches(i)})}get hasProgramDateTime(){return this.fragments.length?Ee(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||B8}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function kd(s,e){return s.length===e.length?!s.some((t,i)=>t!==e[i]):!1}function lT(s,e){return!s&&!e?!0:!s||!e?!1:kd(s,e)}function ru(s){return s==="AES-128"||s==="AES-256"||s==="AES-256-CTR"}function Lg(s){switch(s){case"AES-128":case"AES-256":return xa.cbc;case"AES-256-CTR":return xa.ctr;default:throw new Error(`invalid full segment method ${s}`)}}function Ig(s){return Uint8Array.from(atob(s),e=>e.charCodeAt(0))}function Dm(s){return Uint8Array.from(unescape(encodeURIComponent(s)),e=>e.charCodeAt(0))}function j8(s){const e=Dm(s).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function hv(s){const e=function(i,a,u){const l=i[a];i[a]=i[u],i[u]=l};e(s,0,3),e(s,1,2),e(s,4,5),e(s,6,7)}function mv(s){const e=s.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),a=i[i.length-1].split(",");if(a.length===2){const u=a[0]==="base64",l=a[1];u?(i.splice(-1,1),t=Ig(l)):t=j8(l)}}return t}const Md=typeof self<"u"?self:void 0;var xt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},hs={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function ud(s){switch(s){case hs.FAIRPLAY:return xt.FAIRPLAY;case hs.PLAYREADY:return xt.PLAYREADY;case hs.WIDEVINE:return xt.WIDEVINE;case hs.CLEARKEY:return xt.CLEARKEY}}function U0(s){switch(s){case xt.FAIRPLAY:return hs.FAIRPLAY;case xt.PLAYREADY:return hs.PLAYREADY;case xt.WIDEVINE:return hs.WIDEVINE;case xt.CLEARKEY:return hs.CLEARKEY}}function Rl(s){const{drmSystems:e,widevineLicenseUrl:t}=s,i=e?[xt.FAIRPLAY,xt.WIDEVINE,xt.PLAYREADY,xt.CLEARKEY].filter(a=>!!e[a]):[];return!i[xt.WIDEVINE]&&t&&i.push(xt.WIDEVINE),i}const gv=(function(s){return Md!=null&&(s=Md.navigator)!=null&&s.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function H8(s,e,t,i){let a;switch(s){case xt.FAIRPLAY:a=["cenc","sinf"];break;case xt.WIDEVINE:case xt.PLAYREADY:a=["cenc"];break;case xt.CLEARKEY:a=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${s}`)}return $8(a,e,t,i)}function $8(s,e,t,i){return[{initDataTypes:s,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(u=>({contentType:`audio/mp4; codecs=${u}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(u=>({contentType:`video/mp4; codecs=${u}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function G8(s){var e;return!!s&&(s.sessionType==="persistent-license"||!!((e=s.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function pv(s){const e=new Uint16Array(s.buffer,s.byteOffset,s.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),l=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(l){const c=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(c){const f=Ig(c).subarray(0,16);return hv(f),f}}return null}let Wr={};class ba{static clearKeyUriToKeyIdMap(){Wr={}}static setKeyIdForUri(e,t){Wr[e]=t}static addKeyIdForUri(e){const t=Object.keys(Wr).length%Number.MAX_SAFE_INTEGER,i=new Uint8Array(16);return new DataView(i.buffer,12,4).setUint32(0,t),Wr[e]=i,i}constructor(e,t,i,a=[1],u=null,l){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=a,this.iv=u,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ru(e),l!=null&&l.startsWith("0x")&&(this.keyId=new Uint8Array(V2(l)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&kd(e.keyFormatVersions,this.keyFormatVersions)&&lT(e.iv,this.iv)&&lT(e.keyId,this.keyId)}isSupported(){if(this.method){if(ru(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case hs.FAIRPLAY:case hs.WIDEVINE:case hs.PLAYREADY:case hs.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(ru(this.method)){let u=this.iv;return u||(typeof e!="number"&&(nt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),u=q8(e)),new ba(this.method,this.uri,"identity",this.keyFormatVersions,u)}if(this.keyId){const u=Wr[this.uri];if(u&&!kd(this.keyId,u)&&ba.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const i=mv(this.uri);if(i)switch(this.keyFormat){case hs.WIDEVINE:if(this.pssh=i,!this.keyId){const u=zD(i.buffer);if(u.length){var a;const l=u[0];this.keyId=(a=l.kids)!=null&&a.length?l.kids[0]:null}}this.keyId||(this.keyId=oT(t));break;case hs.PLAYREADY:{const u=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=KD(u,null,i),this.keyId=pv(i);break}default:{let u=i.subarray(0,16);if(u.length!==16){const l=new Uint8Array(16);l.set(u,16-u.length),u=l}this.keyId=u;break}}if(!this.keyId||this.keyId.byteLength!==16){let u;u=V8(t),u||(u=oT(t),u||(u=Wr[this.uri])),u&&(this.keyId=u,ba.setKeyIdForUri(this.uri,u))}return this}}function V8(s){const e=s==null?void 0:s[hs.WIDEVINE];return e?e.keyId:null}function oT(s){const e=s==null?void 0:s[hs.PLAYREADY];if(e){const t=mv(e.uri);if(t)return pv(t)}return null}function q8(s){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=s>>8*(15-t)&255;return e}const cT=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,dT=/#EXT-X-MEDIA:(.*)/g,Y8=/^#EXT(?:INF|-X-TARGETDURATION):/m,B0=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),K8=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class qi{static findGroup(e,t){for(let i=0;i<e.length;i++){const a=e[i];if(a.id===t)return a}}static resolve(e,t){return Eg.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Y8.test(e)}static parseMasterPlaylist(e,t){const i=aT(e),a={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},u=[];if(cT.lastIndex=0,!e.startsWith("#EXTM3U"))return a.playlistParsingError=new Error("no EXTM3U delimiter"),a;let l;for(;(l=cT.exec(e))!=null;)if(l[1]){var c;const h=new Et(l[1],a),m=Cm(a,l[2]),g={attrs:h,bitrate:h.decimalInteger("BANDWIDTH")||h.decimalInteger("AVERAGE-BANDWIDTH"),name:h.NAME,url:qi.resolve(m,t)},E=h.decimalResolution("RESOLUTION");E&&(g.width=E.width,g.height=E.height),mT(h.CODECS,g);const T=h["SUPPLEMENTAL-CODECS"];T&&(g.supplemental={},mT(T,g.supplemental)),(c=g.unknownCodecs)!=null&&c.length||u.push(g),a.levels.push(g)}else if(l[3]){const h=l[3],m=l[4];switch(h){case"SESSION-DATA":{const g=new Et(m,a),E=g["DATA-ID"];E&&(a.sessionData===null&&(a.sessionData={}),a.sessionData[E]=g);break}case"SESSION-KEY":{const g=fT(m,t,a);g.encrypted&&g.isSupported()?(a.sessionKeys===null&&(a.sessionKeys=[]),a.sessionKeys.push(g)):nt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${m}"`);break}case"DEFINE":{{const g=new Et(m,a);rT(a,g,t)}break}case"CONTENT-STEERING":{const g=new Et(m,a);a.contentSteering={uri:qi.resolve(g["SERVER-URI"],t),pathwayId:g["PATHWAY-ID"]||"."};break}case"START":{a.startTimeOffset=hT(m);break}}}const f=u.length>0&&u.length<a.levels.length;return a.levels=f?u:a.levels,a.levels.length===0&&(a.playlistParsingError=new Error("no levels found in manifest")),a}static parseMasterPlaylistMedia(e,t,i){let a;const u={},l=i.levels,c={AUDIO:l.map(h=>({id:h.attrs.AUDIO,audioCodec:h.audioCodec})),SUBTITLES:l.map(h=>({id:h.attrs.SUBTITLES,textCodec:h.textCodec})),"CLOSED-CAPTIONS":[]};let f=0;for(dT.lastIndex=0;(a=dT.exec(e))!==null;){const h=new Et(a[1],i),m=h.TYPE;if(m){const g=c[m],E=u[m]||[];u[m]=E;const T=h.LANGUAGE,v=h["ASSOC-LANGUAGE"],S=h.CHANNELS,A=h.CHARACTERISTICS,I=h["INSTREAM-ID"],R={attrs:h,bitrate:0,id:f++,groupId:h["GROUP-ID"]||"",name:h.NAME||T||"",type:m,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:T,url:h.URI?qi.resolve(h.URI,t):""};if(v&&(R.assocLang=v),S&&(R.channels=S),A&&(R.characteristics=A),I&&(R.instreamId=I),g!=null&&g.length){const N=qi.findGroup(g,R.groupId)||g[0];gT(R,N,"audioCodec"),gT(R,N,"textCodec")}E.push(R)}}return u}static parseLevelPlaylist(e,t,i,a,u,l){var c;const f={url:t},h=new F8(t),m=h.fragments,g=[];let E=null,T=0,v=0,S=0,A=0,I=0,R=null,N=new k0(a,f),D,k,G,U=-1,H=!1,$=null,F;if(B0.lastIndex=0,h.m3u8=e,h.hasVariableRefs=aT(e),((c=B0.exec(e))==null?void 0:c[0])!=="#EXTM3U")return h.playlistParsingError=new Error("Missing format identifier #EXTM3U"),h;for(;(D=B0.exec(e))!==null;){H&&(H=!1,N=new k0(a,f),N.playlistOffset=S,N.setStart(S),N.sn=T,N.cc=A,I&&(N.bitrate=I),N.level=i,E&&(N.initSegment=E,E.rawProgramDateTime&&(N.rawProgramDateTime=E.rawProgramDateTime,E.rawProgramDateTime=null),$&&(N.setByteRange($),$=null)));const Te=D[1];if(Te){N.duration=parseFloat(Te);const ne=(" "+D[2]).slice(1);N.title=ne||null,N.tagList.push(ne?["INF",Te,ne]:["INF",Te])}else if(D[3]){if(Ee(N.duration)){N.playlistOffset=S,N.setStart(S),G&&bT(N,G,h),N.sn=T,N.level=i,N.cc=A,m.push(N);const ne=(" "+D[3]).slice(1);N.relurl=Cm(h,ne),Om(N,R,g),R=N,S+=N.duration,T++,v=0,H=!0}}else{if(D=D[0].match(K8),!D){nt.warn("No matches on slow regex match for level playlist!");continue}for(k=1;k<D.length&&D[k]===void 0;k++);const ne=(" "+D[k]).slice(1),B=(" "+D[k+1]).slice(1),W=D[k+2]?(" "+D[k+2]).slice(1):null;switch(ne){case"BYTERANGE":R?N.setByteRange(B,R):N.setByteRange(B);break;case"PROGRAM-DATE-TIME":N.rawProgramDateTime=B,N.tagList.push(["PROGRAM-DATE-TIME",B]),U===-1&&(U=m.length);break;case"PLAYLIST-TYPE":h.type&&pn(h,ne,D),h.type=B.toUpperCase();break;case"MEDIA-SEQUENCE":h.startSN!==0?pn(h,ne,D):m.length>0&&ET(h,ne,D),T=h.startSN=parseInt(B);break;case"SKIP":{h.skippedSegments&&pn(h,ne,D);const te=new Et(B,h),J=te.decimalInteger("SKIPPED-SEGMENTS");if(Ee(J)){h.skippedSegments+=J;for(let fe=J;fe--;)m.push(null);T+=J}const pe=te.enumeratedString("RECENTLY-REMOVED-DATERANGES");pe&&(h.recentlyRemovedDateranges=(h.recentlyRemovedDateranges||[]).concat(pe.split("	")));break}case"TARGETDURATION":h.targetduration!==0&&pn(h,ne,D),h.targetduration=Math.max(parseInt(B),1);break;case"VERSION":h.version!==null&&pn(h,ne,D),h.version=parseInt(B);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":h.live||pn(h,ne,D),h.live=!1;break;case"#":(B||W)&&N.tagList.push(W?[B,W]:[B]);break;case"DISCONTINUITY":A++,N.tagList.push(["DIS"]);break;case"GAP":N.gap=!0,N.tagList.push([ne]);break;case"BITRATE":N.tagList.push([ne,B]),I=parseInt(B)*1e3,Ee(I)?N.bitrate=I:I=0;break;case"DATERANGE":{const te=new Et(B,h),J=new fv(te,h.dateRanges[te.ID],h.dateRangeTagCount);h.dateRangeTagCount++,J.isValid||h.skippedSegments?h.dateRanges[J.id]=J:nt.warn(`Ignoring invalid DATERANGE tag: "${B}"`),N.tagList.push(["EXT-X-DATERANGE",B]);break}case"DEFINE":{{const te=new Et(B,h);"IMPORT"in te?w8(h,te,l):rT(h,te,t)}break}case"DISCONTINUITY-SEQUENCE":h.startCC!==0?pn(h,ne,D):m.length>0&&ET(h,ne,D),h.startCC=A=parseInt(B);break;case"KEY":{const te=fT(B,t,h);if(te.isSupported()){if(te.method==="NONE"){G=void 0;break}G||(G={});const J=G[te.keyFormat];J!=null&&J.matches(te)||(J&&(G=ot({},G)),G[te.keyFormat]=te)}else nt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${B}"`);break}case"START":h.startTimeOffset=hT(B);break;case"MAP":{const te=new Et(B,h);if(N.duration){const J=new k0(a,f);pT(J,te,i,G),E=J,N.initSegment=E,E.rawProgramDateTime&&!N.rawProgramDateTime&&(N.rawProgramDateTime=E.rawProgramDateTime)}else{const J=N.byteRangeEndOffset;if(J){const pe=N.byteRangeStartOffset;$=`${J-pe}@${pe}`}else $=null;pT(N,te,i,G),E=N,H=!0}E.cc=A;break}case"SERVER-CONTROL":{F&&pn(h,ne,D),F=new Et(B),h.canBlockReload=F.bool("CAN-BLOCK-RELOAD"),h.canSkipUntil=F.optionalFloat("CAN-SKIP-UNTIL",0),h.canSkipDateRanges=h.canSkipUntil>0&&F.bool("CAN-SKIP-DATERANGES"),h.partHoldBack=F.optionalFloat("PART-HOLD-BACK",0),h.holdBack=F.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{h.partTarget&&pn(h,ne,D);const te=new Et(B);h.partTarget=te.decimalFloatingPoint("PART-TARGET");break}case"PART":{let te=h.partList;te||(te=h.partList=[]);const J=v>0?te[te.length-1]:void 0,pe=v++,fe=new Et(B,h),ce=new wD(fe,N,f,pe,J);te.push(ce),N.duration+=ce.duration;break}case"PRELOAD-HINT":{const te=new Et(B,h);h.preloadHint=te;break}case"RENDITION-REPORT":{const te=new Et(B,h);h.renditionReports=h.renditionReports||[],h.renditionReports.push(te);break}default:nt.warn(`line parsed but not handled: ${D}`);break}}}R&&!R.relurl?(m.pop(),S-=R.duration,h.partList&&(h.fragmentHint=R)):h.partList&&(Om(N,R,g),N.cc=A,h.fragmentHint=N,G&&bT(N,G,h)),h.targetduration||(h.playlistParsingError=new Error("Missing Target Duration"));const ee=m.length,me=m[0],be=m[ee-1];if(S+=h.skippedSegments*h.targetduration,S>0&&ee&&be){h.averagetargetduration=S/ee;const Te=be.sn;h.endSN=Te!=="initSegment"?Te:0,h.live||(be.endList=!0),U>0&&(Q8(m,U),me&&g.unshift(me))}return h.fragmentHint&&(S+=h.fragmentHint.duration),h.totalduration=S,g.length&&h.dateRangeTagCount&&me&&bv(g,h),h.endCC=A,h}}function bv(s,e){let t=s.length;if(!t)if(e.hasProgramDateTime){const c=e.fragments[e.fragments.length-1];s.push(c),t++}else return;const i=s[t-1],a=e.live?1/0:e.totalduration,u=Object.keys(e.dateRanges);for(let c=u.length;c--;){const f=e.dateRanges[u[c]],h=f.startDate.getTime();f.tagAnchor=i.ref;for(let m=t;m--;){var l;if(((l=s[m])==null?void 0:l.sn)<e.startSN)break;const g=z8(e,h,s,m,a);if(g!==-1){f.tagAnchor=e.fragments[g].ref;break}}}}function z8(s,e,t,i,a){const u=t[i];if(u){const c=u.programDateTime;if(e>=c||i===0){var l;const f=(((l=t[i+1])==null?void 0:l.start)||a)-u.start;if(e<=c+f*1e3){const h=t[i].sn-s.startSN;if(h<0)return-1;const m=s.fragments;if(m.length>t.length){const E=(t[i+1]||m[m.length-1]).sn-s.startSN;for(let T=E;T>h;T--){const v=m[T].programDateTime;if(e>=v&&e<v+m[T].duration*1e3)return T}}return h}}}return-1}function fT(s,e,t){var i,a;const u=new Et(s,t),l=(i=u.METHOD)!=null?i:"",c=u.URI,f=u.hexadecimalInteger("IV"),h=u.KEYFORMATVERSIONS,m=(a=u.KEYFORMAT)!=null?a:"identity";c&&u.IV&&!f&&nt.error(`Invalid IV: ${u.IV}`);const g=c?qi.resolve(c,e):"",E=(h||"1").split("/").map(Number).filter(Number.isFinite);return new ba(l,g,m,E,f,u.KEYID)}function hT(s){const t=new Et(s).decimalFloatingPoint("TIME-OFFSET");return Ee(t)?t:null}function mT(s,e){let t=(s||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const a=t.filter(u=>yg(u,i));a.length&&(e[`${i}Codec`]=a.map(u=>u.split("/")[0]).join(","),t=t.filter(u=>a.indexOf(u)===-1))}),e.unknownCodecs=t}function gT(s,e,t){const i=e[t];i&&(s[t]=i)}function Q8(s,e){let t=s[e];for(let i=e;i--;){const a=s[i];if(!a)return;a.programDateTime=t.programDateTime-a.duration*1e3,t=a}}function Om(s,e,t){s.rawProgramDateTime?t.push(s):e!=null&&e.programDateTime&&(s.programDateTime=e.endProgramDateTime)}function pT(s,e,t,i){s.relurl=e.URI,e.BYTERANGE&&s.setByteRange(e.BYTERANGE),s.level=t,s.sn="initSegment",i&&(s.levelkeys=i),s.initSegment=null}function bT(s,e,t){s.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(a=>e[a].isCommonEncryption)&&i.push(s)}function pn(s,e,t){s.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function ET(s,e,t){s.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function F0(s,e){const t=e.startPTS;if(Ee(t)){let i=0,a;e.sn>s.sn?(i=t-s.start,a=s):(i=s.start-t,a=e),a.duration!==i&&a.setDuration(i)}else e.sn>s.sn?s.cc===e.cc&&s.minEndPTS?e.setStart(s.start+(s.minEndPTS-s.start)):e.setStart(s.start+s.duration):e.setStart(Math.max(s.start-e.duration,0))}function Ev(s,e,t,i,a,u,l){i-t<=0&&(l.warn("Fragment should have a positive duration",e),i=t+e.duration,u=a+e.duration);let f=t,h=i;const m=e.startPTS,g=e.endPTS;if(Ee(m)){const I=Math.abs(m-t);s&&I>s.totalduration?l.warn(`media timestamps and playlist times differ by ${I}s for level ${e.level} ${s.url}`):Ee(e.deltaPTS)?e.deltaPTS=Math.max(I,e.deltaPTS):e.deltaPTS=I,f=Math.max(t,m),t=Math.min(t,m),a=e.startDTS!==void 0?Math.min(a,e.startDTS):a,h=Math.min(i,g),i=Math.max(i,g),u=e.endDTS!==void 0?Math.max(u,e.endDTS):u}const E=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=f,e.startDTS=a,e.endPTS=i,e.minEndPTS=h,e.endDTS=u;const T=e.sn;if(!s||T<s.startSN||T>s.endSN)return 0;let v;const S=T-s.startSN,A=s.fragments;for(A[S]=e,v=S;v>0;v--)F0(A[v],A[v-1]);for(v=S;v<A.length-1;v++)F0(A[v],A[v+1]);return s.fragmentHint&&F0(A[A.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,E}function X8(s,e,t){if(s===e)return;let i=null;const a=s.fragments;for(let m=a.length-1;m>=0;m--){const g=a[m].initSegment;if(g){i=g;break}}s.fragmentHint&&delete s.fragmentHint.endPTS;let u;J8(s,e,(m,g,E,T)=>{if((!e.startCC||e.skippedSegments)&&g.cc!==m.cc){const v=m.cc-g.cc;for(let S=E;S<T.length;S++)T[S].cc+=v;e.endCC=T[T.length-1].cc}Ee(m.startPTS)&&Ee(m.endPTS)&&(g.setStart(g.startPTS=m.startPTS),g.startDTS=m.startDTS,g.maxStartPTS=m.maxStartPTS,g.endPTS=m.endPTS,g.endDTS=m.endDTS,g.minEndPTS=m.minEndPTS,g.setDuration(m.endPTS-m.startPTS),g.duration&&(u=g),e.PTSKnown=e.alignedSliding=!0),m.hasStreams&&(g.elementaryStreams=m.elementaryStreams),g.loader=m.loader,m.hasStats&&(g.stats=m.stats),m.initSegment&&(g.initSegment=m.initSegment,i=m.initSegment)});const l=e.fragments,c=e.fragmentHint?l.concat(e.fragmentHint):l;if(i&&c.forEach(m=>{var g;m&&(!m.initSegment||m.initSegment.relurl===((g=i)==null?void 0:g.relurl))&&(m.initSegment=i)}),e.skippedSegments){if(e.deltaUpdateFailed=l.some(m=>!m),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let m=e.skippedSegments;m--;)l.shift();e.startSN=l[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=W8(s.dateRanges,e,t));const m=s.fragments.filter(g=>g.rawProgramDateTime);if(s.hasProgramDateTime&&!e.hasProgramDateTime)for(let g=1;g<c.length;g++)c[g].programDateTime===null&&Om(c[g],c[g-1],m);bv(m,e)}e.endCC=l[l.length-1].cc}if(!e.startCC){var f;const m=yv(s,e.startSN-1);e.startCC=(f=m==null?void 0:m.cc)!=null?f:l[0].cc}Z8(s.partList,e.partList,(m,g)=>{g.elementaryStreams=m.elementaryStreams,g.stats=m.stats}),u?Ev(e,u,u.startPTS,u.endPTS,u.startDTS,u.endDTS,t):xv(s,e),l.length&&(e.totalduration=e.edge-l[0].start),e.driftStartTime=s.driftStartTime,e.driftStart=s.driftStart;const h=e.advancedDateTime;if(e.advanced&&h){const m=e.edge;e.driftStart||(e.driftStartTime=h,e.driftStart=m),e.driftEndTime=h,e.driftEnd=m}else e.driftEndTime=s.driftEndTime,e.driftEnd=s.driftEnd,e.advancedDateTime=s.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=s.requestScheduled)}function W8(s,e,t){const{dateRanges:i,recentlyRemovedDateranges:a}=e,u=ot({},s);a&&a.forEach(f=>{delete u[f]});const c=Object.keys(u).length;return c?(Object.keys(i).forEach(f=>{const h=u[f],m=new fv(i[f].attr,h);m.isValid?(u[f]=m,h||(m.tagOrder+=c)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${ft(i[f].attr)}"`)}),u):i}function Z8(s,e,t){if(s&&e){let i=0;for(let a=0,u=s.length;a<=u;a++){const l=s[a],c=e[a+i];l&&c&&l.index===c.index&&l.fragment.sn===c.fragment.sn?t(l,c):i--}}}function J8(s,e,t){const i=e.skippedSegments,a=Math.max(s.startSN,e.startSN)-e.startSN,u=(s.fragmentHint?1:0)+(i?e.endSN:Math.min(s.endSN,e.endSN))-e.startSN,l=e.startSN-s.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,f=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments;for(let h=a;h<=u;h++){const m=f[l+h];let g=c[h];if(i&&!g&&m&&(g=e.fragments[h]=m),m&&g){t(m,g,h,c);const E=m.relurl,T=g.relurl;if(E&&eO(E,T)){e.playlistParsingError=xT(`media sequence mismatch ${g.sn}:`,s,e,m,g);return}else if(m.cc!==g.cc){e.playlistParsingError=xT(`discontinuity sequence mismatch (${m.cc}!=${g.cc})`,s,e,m,g);return}}}}function xT(s,e,t,i,a){return new Error(`${s} ${a.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function xv(s,e,t=!0){const i=e.startSN+e.skippedSegments-s.startSN,a=s.fragments,u=i>=0;let l=0;if(u&&i<a.length)l=a[i].start;else if(u&&e.startSN===s.endSN+1)l=s.fragmentEnd;else if(u&&t)l=s.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)l=s.fragmentStart;else return;wm(e,l)}function wm(s,e){if(e){const t=s.fragments;for(let i=s.skippedSegments;i<t.length;i++)t[i].addStart(e);s.fragmentHint&&s.fragmentHint.addStart(e)}}function Tv(s,e=1/0){let t=1e3*s.targetduration;if(s.updated){const i=s.fragments;if(i.length&&t*4>e){const u=i[i.length-1].duration*1e3;u<t&&(t=u)}}else t/=2;return Math.round(t)}function yv(s,e,t){if(!s)return null;let i=s.fragments[e-s.startSN];return i||(i=s.fragmentHint,i&&i.sn===e)?i:e<s.startSN&&t&&t.sn===e?t:null}function TT(s,e,t){return s?vv(s.partList,e,t):null}function vv(s,e,t){if(s)for(let i=s.length;i--;){const a=s[i];if(a.index===t&&a.fragment.sn===e)return a}return null}function Sv(s){s.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(a=>{a.level=t,a.initSegment&&(a.initSegment.level=t)})})}function eO(s,e){return s!==e&&e?yT(s)!==yT(e):!1}function yT(s){return s.replace(/\?[^?]*$/,"")}function Pl(s,e){for(let i=0,a=s.length;i<a;i++){var t;if(((t=s[i])==null?void 0:t.cc)===e)return s[i]}return null}function tO(s,e){return!!(s&&e.startCC<s.endCC&&e.endCC>s.startCC)}function vT(s,e){const t=s.start+e;s.startPTS=t,s.setStart(t),s.endPTS=t+s.duration}function Av(s,e){const t=e.fragments;for(let i=0,a=t.length;i<a;i++)vT(t[i],s);e.fragmentHint&&vT(e.fragmentHint,s),e.alignedSliding=!0}function sO(s,e){s&&(_v(e,s),e.alignedSliding||Pd(e,s),!e.alignedSliding&&!e.skippedSegments&&xv(s,e,!1))}function _v(s,e){if(!tO(e,s))return;const t=Math.min(e.endCC,s.endCC),i=Pl(e.fragments,t),a=Pl(s.fragments,t);if(!i||!a)return;nt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const u=i.start-a.start;Av(u,s)}function Pd(s,e){if(!s.hasProgramDateTime||!e.hasProgramDateTime)return;const t=s.fragments,i=e.fragments;if(!t.length||!i.length)return;let a,u;const l=Math.min(e.endCC,s.endCC);e.startCC<l&&s.startCC<l&&(a=Pl(i,l),u=Pl(t,l)),(!a||!u)&&(a=i[Math.floor(i.length/2)],u=Pl(t,a.cc)||t[Math.floor(t.length/2)]);const c=a.programDateTime,f=u.programDateTime;if(!c||!f)return;const h=(f-c)/1e3-(u.start-a.start);Av(h,s)}function vs(s,e,t){Bs(s,e,t),s.addEventListener(e,t)}function Bs(s,e,t){s.removeEventListener(e,t)}const iO={toString:function(s){let e="";const t=s.length;for(let i=0;i<t;i++)e+=`[${s.start(i).toFixed(3)}-${s.end(i).toFixed(3)}]`;return e}},ue={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Rg extends cv{constructor(e,t,i,a,u){super(a,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ue.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:l,fragCurrent:c,media:f,mediaBuffer:h,state:m}=this,g=f?f.currentTime:0,E=ke.bufferInfo(h||f,g,l.maxBufferHole),T=!E.len;if(this.log(`Media seeking to ${Ee(g)?g.toFixed(3):g}, state: ${m}, ${T?"out of":"in"} buffer`),this.state===ue.ENDED)this.resetLoadingState();else if(c){const v=l.maxFragLookUpTolerance,S=c.start-v,A=c.start+c.duration+v;if(T||A<E.start||S>E.end){const I=g>A;(g<S||I)&&(I&&c.loader&&(this.log(`Cancelling fragment load for seek (sn: ${c.sn})`),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(f){this.fragmentTracker.removeFragmentsInRange(g,1/0,this.playlistType,!0);const v=this.lastCurrentTime;if(g>v&&(this.lastCurrentTime=g),!this.loadingParts){const S=Math.max(E.end,g),A=this.shouldLoadParts(this.getLevelDetails(),S);A&&(this.log(`LL-Part loading ON after seeking to ${g.toFixed(2)} with buffer @${S.toFixed(2)}`),this.loadingParts=A)}}this.hls.hasEnoughToStart||(this.log(`Setting ${T?"startPosition":"nextLoadPosition"} to ${g} for seek without enough to start`),this.nextLoadPosition=g,T&&(this.startPosition=g)),T&&this.state===ue.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=u,this.hls=e,this.fragmentLoader=new D8(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Ag(e.config)}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ue.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ue.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,a=this.config.timelineOffset||0;if(i<=a)return!1;const u=e.buffered;this.config.maxBufferHole&&u&&u.length>1&&(e=ke.bufferedInfo(u,e.start,0));const l=e.nextStart;if(l&&l>a&&l<t.edge||this.media.currentTime<e.start)return!1;const f=t.partList;if(f!=null&&f.length){const m=f[f.length-1];return ke.isBuffered(this.media,m.start+m.duration/2)}const h=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(h)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;vs(i,"seeking",this.onMediaSeeking),vs(i,"ended",this.onMediaEnded);const a=this.config;this.levels&&a.autoStartLoad&&this.state===ue.STOPPED&&this.startLoad(a.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,a=this.media;if(a!==null){if(a.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Bs(a,"seeking",this.onMediaSeeking),Bs(a,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ue.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const a=u=>{const l=u.frag;if(this.fragContextChanged(l)){this.warn(`${l.type} sn: ${l.sn}${u.part?" part: "+u.part.index:""} of ${this.fragInfo(l,!1,u.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(l);return}l.stats.chunkCount++,this._handleFragmentLoadProgress(u)};this._doFragLoad(e,t,i,a).then(u=>{if(!u)return;const l=this.state,c=u.frag;if(this.fragContextChanged(c)){(l===ue.FRAG_LOADING||!this.fragCurrent&&l===ue.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=ue.IDLE);return}"payload"in u&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(L.FRAG_LOADED,u)),this._handleFragmentLoadComplete(u)}).catch(u=>{this.state===ue.STOPPED||this.state===ue.ERROR||(this.warn(`Frag error: ${(u==null?void 0:u.message)||u}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===Kt.APPENDING){const u=e.type,l=this.getFwdBufferInfo(this.mediaBuffer,u),c=Math.max(e.duration,l?l.len:this.config.maxBufferLength),f=this.backtrackFragment;((f?e.sn-f.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===Kt.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const a={startOffset:e,endOffset:t,type:i};this.hls.trigger(L.BUFFER_FLUSHING,a)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const a=i==null?void 0:i.frag;if(!a||this.fragContextChanged(a)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:a}=this,{frag:u,payload:l}=i,c=u.decryptdata;if(l&&l.byteLength>0&&c!=null&&c.key&&c.iv&&ru(c.method)){const f=self.performance.now();return this.decrypter.decrypt(new Uint8Array(l),c.key.buffer,c.iv.buffer,Lg(c.method)).catch(h=>{throw a.trigger(L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.FRAG_DECRYPT_ERROR,fatal:!1,error:h,reason:h.message,frag:u}),h}).then(h=>{const m=self.performance.now();return a.trigger(L.FRAG_DECRYPTED,{frag:u,payload:h,stats:{tstart:f,tdecrypt:m}}),i.payload=h,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===ue.STOPPED||this.state===ue.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==ue.STOPPED&&(this.state=ue.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var i,a;const u=e.tracks;if(u&&!t.encrypted&&((i=u.audio)!=null&&i.encrypted||(a=u.video)!=null&&a.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const l=this.media,c=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${l?"attached mediaKeys: "+l.mediaKeys:"detached"})`);return this.warn(c.message),!l||l.mediaKeys?!1:(this.hls.trigger(L.ERROR,{type:Ae.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_KEYS,fatal:!1,error:c,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?iO.toString(ke.getBuffered(i)):"(detached)"})`),Ct(e)){var a;if(e.type!==ye.SUBTITLE){const l=e.elementaryStreams;if(!Object.keys(l).some(c=>!!l[c])){this.state=ue.IDLE;return}}const u=(a=this.levels)==null?void 0:a[e.level];u!=null&&u.fragmentError&&(this.log(`Resetting level fragment error count of ${u.fragmentError} on frag buffered`),u.fragmentError=0)}this.state=ue.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:a,partsLoaded:u}=e,l=!u||u.length===0||u.some(f=>!f),c=new _g(i.level,i.sn,i.stats.chunkCount+1,0,a?a.index:-1,!l);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,a){var u;this.fragCurrent=e;const l=t.details;if(!this.levels||!l)throw new Error(`frag load aborted, missing level${l?"":" detail"}s`);let c=null;if(e.encrypted&&!((u=e.decryptdata)!=null&&u.key)){if(this.log(`Loading key for ${e.sn} of [${l.startSN}-${l.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ue.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(E=>{if(!this.fragContextChanged(E.frag))return this.hls.trigger(L.KEY_LOADED,E),this.state===ue.KEY_LOADING&&(this.state=ue.IDLE),E}),this.hls.trigger(L.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(c=this.keyLoader.loadClear(e,l.encryptedFragments,this.startFragRequested),c&&this.log("[eme] blocking frag load until media-keys acquired"));const f=this.fragPrevious;if(Ct(e)&&(!f||e.sn!==f.sn)){const E=this.shouldLoadParts(t.details,e.end);E!==this.loadingParts&&(this.log(`LL-Part loading ${E?"ON":"OFF"} loading sn ${f==null?void 0:f.sn}->${e.sn}`),this.loadingParts=E)}if(i=Math.max(e.start,i||0),this.loadingParts&&Ct(e)){const E=l.partList;if(E&&a){i>l.fragmentEnd&&l.fragmentHint&&(e=l.fragmentHint);const T=this.getNextPart(E,e,i);if(T>-1){const v=E[T];e=this.fragCurrent=v.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${v.index} (${T}/${E.length-1}) of ${this.fragInfo(e,!1,v)}) cc: ${e.cc} [${l.startSN}-${l.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=v.start+v.duration,this.state=ue.FRAG_LOADING;let S;return c?S=c.then(A=>!A||this.fragContextChanged(A.frag)?null:this.doFragPartsLoad(e,v,t,a)).catch(A=>this.handleFragLoadError(A)):S=this.doFragPartsLoad(e,v,t,a).catch(A=>this.handleFragLoadError(A)),this.hls.trigger(L.FRAG_LOADING,{frag:e,part:v,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):S}else if(!e.url||this.loadedEndOfParts(E,i))return Promise.resolve(null)}}if(Ct(e)&&this.loadingParts){var h;this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(h=l.partList)==null?void 0:h.filter(E=>E.loaded).map(E=>`[${E.start}-${E.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+l.startSN+"-"+l.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),Ee(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ue.FRAG_LOADING;const m=this.config.progressive&&e.type!==ye.SUBTITLE;let g;return m&&c?g=c.then(E=>!E||this.fragContextChanged(E.frag)?null:this.fragmentLoader.load(e,a)).catch(E=>this.handleFragLoadError(E)):g=Promise.all([this.fragmentLoader.load(e,m?a:void 0),c]).then(([E])=>(!m&&a&&a(E),E)).catch(E=>this.handleFragLoadError(E)),this.hls.trigger(L.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):g}doFragPartsLoad(e,t,i,a){return new Promise((u,l)=>{var c;const f=[],h=(c=i.details)==null?void 0:c.partList,m=g=>{this.fragmentLoader.loadPart(e,g,a).then(E=>{f[g.index]=E;const T=E.part;this.hls.trigger(L.FRAG_LOADED,E);const v=TT(i.details,e.sn,g.index+1)||vv(h,e.sn,g.index+1);if(v)m(v);else return u({frag:e,part:T,partsLoaded:f})}).catch(l)};m(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Y.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Ae.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(L.ERROR,t)}else this.hls.trigger(L.ERROR,{type:Ae.OTHER_ERROR,details:Y.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ue.PARSING){!this.fragCurrent&&this.state!==ue.STOPPED&&this.state!==ue.ERROR&&(this.state=ue.IDLE);return}const{frag:i,part:a,level:u}=t,l=self.performance.now();i.stats.parsing.end=l,a&&(a.stats.parsing.end=l);const c=this.getLevelDetails(),h=c&&i.sn>c.endSN||this.shouldLoadParts(c,i.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=h),this.updateLevelTiming(i,a,u,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i;const u=e.partList[0];if(u.fragment.type===ye.SUBTITLE)return!1;const l=u.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=l){var a;if((this.hls.hasEnoughToStart?((a=this.media)==null?void 0:a.currentTime)||this.lastCurrentTime:this.getLoadPosition())>u.start-u.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:a,sn:u,part:l}=e;if(!(t!=null&&t[a]))return this.warn(`Levels object was unset while buffering fragment ${u} of ${this.playlistLabel()} ${a}. The current chunk will not be buffered.`),null;const c=t[a],f=c.details,h=l>-1?TT(f,u,l):null,m=h?h.fragment:yv(f,u,i);return m?(i&&i!==m&&(m.stats=i.stats),{frag:m,part:h,level:c}):null}bufferFragmentData(e,t,i,a,u){if(this.state!==ue.PARSING)return;const{data1:l,data2:c}=e;let f=l;if(c&&(f=mi(l,c)),!f.length)return;const h=this.initPTS[t.cc],m=h?-h.baseTime/h.timescale:void 0,g={type:e.type,frag:t,part:i,chunkMeta:a,offset:m,parent:t.type,data:f};if(this.hls.trigger(L.BUFFER_APPENDING,g),e.dropped&&e.independent&&!i){if(u)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!ke.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,a=ke.bufferInfo(t,i,0),u=e.duration,l=Math.min(this.config.maxFragLookUpTolerance*2,u*.25),c=Math.max(Math.min(e.start-l,a.end-l),i+l);e.start-c>l&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){var i;const a=this.getLoadPosition();if(!Ee(a))return null;const l=this.lastCurrentTime>a||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,a,t,l)}getFwdBufferInfoAtPos(e,t,i,a){const u=ke.bufferInfo(e,t,a);if(u.len===0&&u.nextStart!==void 0){const l=this.fragmentTracker.getBufferedFrag(t,i);if(l&&(u.nextStart<=l.end||l.gap)){const c=Math.max(Math.min(u.nextStart,l.end)-t,a);return ke.bufferInfo(e,t,c)}}return u}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,a=Math.max(Math.min(e-t,i.maxBufferLength),t),u=Math.max(e-t*3,i.maxMaxBufferLength/2,a);return u>=a?(i.maxMaxBufferLength=u,this.warn(`Reduce max buffer length to ${u}s`),!0):!1}getAppendedFrag(e,t=ye.MAIN){const i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,a=i.length;if(!a)return null;const{config:u}=this,l=i[0].start,c=u.lowLatencyMode&&!!t.partList;let f=null;if(t.live){const g=u.initialLiveManifestSize;if(a<g)return this.warn(`Not enough fragments to start playback (have: ${a}, need: ${g})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<l){var h;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),f=this.getInitialLiveFragment(t);const E=this.hls.startPosition,T=this.hls.liveSyncPosition,v=f?(E!==-1&&E>=l?E:T)||f.start:e;this.log(`Setting startPosition to ${v} to match start frag at live edge. mainStart: ${E} liveSyncPosition: ${T} frag.start: ${(h=f)==null?void 0:h.start}`),this.startPosition=this.nextLoadPosition=v}}else e<=l&&(f=i[0]);if(!f){const g=this.loadingParts?t.partEnd:t.fragmentEnd;f=this.getFragmentAtPosition(e,g,t)}let m=this.filterReplacedPrimary(f,t);if(!m&&f){const g=f.sn-t.startSN;m=this.filterReplacedPrimary(i[g+1]||null,t)}return this.mapToInitFragWhenRequired(m)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===Kt.OK||i===Kt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,a,u){let l=null;if(e.gap&&(l=this.getNextFragment(this.nextLoadPosition,t),l&&!l.gap&&i.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,a,0);if(c!==null&&i.len+c.len>=u){const f=l.sn;return this.loopSn!==f&&(this.log(`buffer full after gaps in "${a}" playlist starting at sn: ${f}`),this.loopSn=f),null}}return this.loopSn=void 0,l}get primaryPrefetch(){if(ST(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(ST(this.config)&&e.type!==ye.SUBTITLE){const i=this.hls.interstitialsManager,a=i==null?void 0:i.bufferingItem;if(a){const l=a.event;if(l){if(l.appendInPlace||Math.abs(e.start-a.start)>1||a.start===0)return null}else if(e.end<=a.start&&(t==null?void 0:t.live)===!1||e.start>a.end&&a.nextEvent&&(a.nextEvent.appendInPlace||e.start-a.end>1))return null}const u=i==null?void 0:i.playerQueue;if(u)for(let l=u.length;l--;){const c=u[l].interstitial;if(c.appendInPlace&&e.start>=c.startTime&&e.end<=c.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let a=-1,u=!1,l=!0;for(let c=0,f=e.length;c<f;c++){const h=e[c];if(l=l&&!h.independent,a>-1&&i<h.start)break;const m=h.loaded;m?a=-1:(u||(h.independent||l)&&h.fragment===t)&&(h.fragment!==t&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${h.start}`),a=c),u=m}return a}loadedEndOfParts(e,t){let i;for(let a=e.length;a--;){if(i=e[a],!i.loaded)return!1;if(t>i.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,i=this.fragPrevious;let a=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),a=x8(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!a){const u=i.sn+1;if(u>=e.startSN&&u<=e.endSN){const l=t[u-e.startSN];i.cc===l.cc&&(a=l,this.log(`Live playlist, switching playlist, load frag with next SN: ${a.sn}`))}a||(a=uv(e,i.cc,i.end),a&&this.log(`Live playlist, switching playlist, load frag with same CC: ${a.sn}`))}}else{const u=this.hls.liveSyncPosition;u!==null&&(a=this.getFragmentAtPosition(u,this.bitrateTest?e.fragmentEnd:e.edge,e))}return a}getFragmentAtPosition(e,t,i){const{config:a}=this;let{fragPrevious:u}=this,{fragments:l,endSN:c}=i;const{fragmentHint:f}=i,{maxFragLookUpTolerance:h}=a,m=i.partList,g=!!(this.loadingParts&&m!=null&&m.length&&f);g&&!this.bitrateTest&&m[m.length-1].fragment.sn===f.sn&&(l=l.concat(f),c=f.sn);let E;if(e<t){var T;const S=e<this.lastCurrentTime||e>t-h||(T=this.media)!=null&&T.paused||!this.startFragRequested?0:h;E=nr(u,l,e,S)}else E=l[l.length-1];if(E){const v=E.sn-i.startSN,S=this.fragmentTracker.getState(E);if((S===Kt.OK||S===Kt.PARTIAL&&E.gap)&&(u=E),u&&E.sn===u.sn&&(!g||m[0].fragment.sn>E.sn||!i.live)&&E.level===u.level){const I=l[v+1];E.sn<c&&this.fragmentTracker.getState(I)!==Kt.OK?E=I:E=null}}return E}alignPlaylists(e,t,i){const a=e.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;const u=e.fragmentStart,l=!t,c=e.alignedSliding&&Ee(u);if(l||!c&&!u){sO(i,e);const f=e.fragmentStart;return this.log(`Live playlist sliding: ${f.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${a}`),f}return u}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const a=this.timelineOffset;if(i===-1){const u=this.startTimeOffset!==null,l=u?this.startTimeOffset:e.startTimeOffset;l!==null&&Ee(l)?(i=t+l,l<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${l} found in ${u?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+a}this.nextLoadPosition=i+a}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Ct(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ue.FRAG_LOADING_WAITING_RETRY)&&(this.state=ue.IDLE)}onFragmentOrKeyLoadError(e,t){var i;if(t.chunkMeta&&!t.frag){const I=this.getCurrentContext(t.chunkMeta);I&&(t.frag=I.frag)}const a=t.frag;if(!a||a.type!==e||!this.levels)return;if(this.fragContextChanged(a)){var u;this.warn(`Frag load error must match current frag to retry ${a.url} > ${(u=this.fragCurrent)==null?void 0:u.url}`);return}const l=t.details===Y.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(a,!0);const c=t.errorAction;if(!c){this.state=ue.ERROR;return}const{action:f,flags:h,retryCount:m=0,retryConfig:g}=c,E=!!g,T=E&&f===ds.RetryRequest,v=E&&!c.resolved&&h===Qs.MoveAllAlternatesMatchingHost,S=(i=this.hls.latestLevelDetails)==null?void 0:i.live;if(!T&&v&&Ct(a)&&!a.endList&&S&&!ov(t))this.resetFragmentErrors(e),this.treatAsGap(a),c.resolved=!0;else if((T||v)&&m<g.maxNumRetry){var A;const I=Nm((A=t.response)==null?void 0:A.code),R=Sg(g,m);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+R,this.state=ue.FRAG_LOADING_WAITING_RETRY,c.resolved=!0,I){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${a.sn} of ${e} ${a.level} errored with ${t.details}, retrying loading ${m+1}/${g.maxNumRetry} in ${R}ms`)}else if(g)if(this.resetFragmentErrors(e),m<g.maxNumRetry)!l&&f!==ds.RemoveAlternatePermanently&&(c.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${m})`);return}else f===ds.SendAlternateToPenaltyBox?this.state=ue.WAITING_LEVEL:this.state=ue.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,i=t===1/0;(!t||e>=t||i&&!Nm(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ue.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ue.PARSING||this.state===ue.PARSED){const t=e.frag,i=e.parent,a=this.getFwdBufferInfo(this.mediaBuffer,i),u=a&&a.len>.5;u&&this.reduceMaxBufferLength(a.len,(t==null?void 0:t.duration)||10);const l=!u;return l&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),l}return!1}resetFragmentErrors(e){e===ye.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ue.STOPPED&&(this.state=ue.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const a=ke.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,a,i),this.state===ue.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ue.STOPPED&&(this.state=ue.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,a){const u=i.details;if(!u){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((f,h)=>{const m=e.elementaryStreams[h];if(m){const g=m.endPTS-m.startPTS;if(g<=0)return this.warn(`Could not parse fragment ${e.sn} ${h} duration reliably (${g})`),f||!1;const E=a?0:Ev(u,e,m.startPTS,m.endPTS,m.startDTS,m.endDTS,this);return this.hls.trigger(L.LEVEL_PTS_UPDATED,{details:u,level:i,drift:E,type:h,frag:e,start:m.startPTS,end:m.endPTS}),!0}return f},!1)){var c;const f=((c=this.transmuxer)==null?void 0:c.error)===null;if((i.fragmentError===0||f&&(i.fragmentError<2||e.endList))&&this.treatAsGap(e,i),f){const h=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(h.message),this.hls.trigger(L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!1,error:h,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ue.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(L.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ye.MAIN?"level":"track"}fragInfo(e,t=!0,i){var a,u;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((a=t&&!i?e.startPTS:(i||e).start)!=null?a:NaN).toFixed(3)}-${((u=t&&!i?e.endPTS:(i||e).end)!=null?u:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function ST(s){return!!s.interstitialsController&&s.enableInterstitialPlayback!==!1}class Lv{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=nO(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function nO(s,e){const t=new Uint8Array(e);let i=0;for(let a=0;a<s.length;a++){const u=s[a];t.set(u,i),i+=u.length}return t}var j0={exports:{}},AT;function aO(){return AT||(AT=1,(function(s){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function a(f,h,m){this.fn=f,this.context=h,this.once=m||!1}function u(f,h,m,g,E){if(typeof m!="function")throw new TypeError("The listener must be a function");var T=new a(m,g||f,E),v=t?t+h:h;return f._events[v]?f._events[v].fn?f._events[v]=[f._events[v],T]:f._events[v].push(T):(f._events[v]=T,f._eventsCount++),f}function l(f,h){--f._eventsCount===0?f._events=new i:delete f._events[h]}function c(){this._events=new i,this._eventsCount=0}c.prototype.eventNames=function(){var h=[],m,g;if(this._eventsCount===0)return h;for(g in m=this._events)e.call(m,g)&&h.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(m)):h},c.prototype.listeners=function(h){var m=t?t+h:h,g=this._events[m];if(!g)return[];if(g.fn)return[g.fn];for(var E=0,T=g.length,v=new Array(T);E<T;E++)v[E]=g[E].fn;return v},c.prototype.listenerCount=function(h){var m=t?t+h:h,g=this._events[m];return g?g.fn?1:g.length:0},c.prototype.emit=function(h,m,g,E,T,v){var S=t?t+h:h;if(!this._events[S])return!1;var A=this._events[S],I=arguments.length,R,N;if(A.fn){switch(A.once&&this.removeListener(h,A.fn,void 0,!0),I){case 1:return A.fn.call(A.context),!0;case 2:return A.fn.call(A.context,m),!0;case 3:return A.fn.call(A.context,m,g),!0;case 4:return A.fn.call(A.context,m,g,E),!0;case 5:return A.fn.call(A.context,m,g,E,T),!0;case 6:return A.fn.call(A.context,m,g,E,T,v),!0}for(N=1,R=new Array(I-1);N<I;N++)R[N-1]=arguments[N];A.fn.apply(A.context,R)}else{var D=A.length,k;for(N=0;N<D;N++)switch(A[N].once&&this.removeListener(h,A[N].fn,void 0,!0),I){case 1:A[N].fn.call(A[N].context);break;case 2:A[N].fn.call(A[N].context,m);break;case 3:A[N].fn.call(A[N].context,m,g);break;case 4:A[N].fn.call(A[N].context,m,g,E);break;default:if(!R)for(k=1,R=new Array(I-1);k<I;k++)R[k-1]=arguments[k];A[N].fn.apply(A[N].context,R)}}return!0},c.prototype.on=function(h,m,g){return u(this,h,m,g,!1)},c.prototype.once=function(h,m,g){return u(this,h,m,g,!0)},c.prototype.removeListener=function(h,m,g,E){var T=t?t+h:h;if(!this._events[T])return this;if(!m)return l(this,T),this;var v=this._events[T];if(v.fn)v.fn===m&&(!E||v.once)&&(!g||v.context===g)&&l(this,T);else{for(var S=0,A=[],I=v.length;S<I;S++)(v[S].fn!==m||E&&!v[S].once||g&&v[S].context!==g)&&A.push(v[S]);A.length?this._events[T]=A.length===1?A[0]:A:l(this,T)}return this},c.prototype.removeAllListeners=function(h){var m;return h?(m=t?t+h:h,this._events[m]&&l(this,m)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,s.exports=c})(j0)),j0.exports}var rO=aO(),Ng=DD(rO);const Jl="1.6.15",yu={};function uO(){return typeof __HLS_WORKER_BUNDLE__=="function"}function lO(){const s=yu[Jl];if(s)return s.clientCount++,s;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),a={worker:new self.Worker(t),objectURL:t,clientCount:1};return yu[Jl]=a,a}function oO(s){const e=yu[s];if(e)return e.clientCount++,e;const t=new self.URL(s,self.location.href).href,a={worker:new self.Worker(t),scriptURL:t,clientCount:1};return yu[s]=a,a}function cO(s){const e=yu[s||Jl];if(e&&e.clientCount--===1){const{worker:i,objectURL:a}=e;delete yu[s||Jl],a&&self.URL.revokeObjectURL(a),i.terminate()}}function Iv(s,e){return e+10<=s.length&&s[e]===51&&s[e+1]===68&&s[e+2]===73&&s[e+3]<255&&s[e+4]<255&&s[e+6]<128&&s[e+7]<128&&s[e+8]<128&&s[e+9]<128}function Cg(s,e){return e+10<=s.length&&s[e]===73&&s[e+1]===68&&s[e+2]===51&&s[e+3]<255&&s[e+4]<255&&s[e+6]<128&&s[e+7]<128&&s[e+8]<128&&s[e+9]<128}function tf(s,e){let t=0;return t=(s[e]&127)<<21,t|=(s[e+1]&127)<<14,t|=(s[e+2]&127)<<7,t|=s[e+3]&127,t}function eo(s,e){const t=e;let i=0;for(;Cg(s,e);){i+=10;const a=tf(s,e+6);i+=a,Iv(s,e+10)&&(i+=10),e+=i}if(i>0)return s.subarray(t,t+i)}function dO(s,e,t,i){const a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],u=e[t+2],l=u>>2&15;if(l>12){const T=new Error(`invalid ADTS sampling index:${l}`);s.emit(L.ERROR,L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!0,error:T,reason:T.message});return}const c=(u>>6&3)+1,f=e[t+3]>>6&3|(u&1)<<2,h="mp4a.40."+c,m=a[l];let g=l;(c===5||c===29)&&(g-=3);const E=[c<<3|(g&14)>>1,(g&1)<<7|f<<3];return nt.log(`manifest codec:${i}, parsed codec:${h}, channels:${f}, rate:${m} (ADTS object type:${c} sampling index:${l})`),{config:E,samplerate:m,channelCount:f,codec:h,parsedCodec:h,manifestCodec:i}}function Rv(s,e){return s[e]===255&&(s[e+1]&246)===240}function Nv(s,e){return s[e+1]&1?7:9}function Dg(s,e){return(s[e+3]&3)<<11|s[e+4]<<3|(s[e+5]&224)>>>5}function fO(s,e){return e+5<s.length}function Ud(s,e){return e+1<s.length&&Rv(s,e)}function hO(s,e){return fO(s,e)&&Rv(s,e)&&Dg(s,e)<=s.length-e}function mO(s,e){if(Ud(s,e)){const t=Nv(s,e);if(e+t>=s.length)return!1;const i=Dg(s,e);if(i<=t)return!1;const a=e+i;return a===s.length||Ud(s,a)}return!1}function Cv(s,e,t,i,a){if(!s.samplerate){const u=dO(e,t,i,a);if(!u)return;ot(s,u)}}function Dv(s){return 1024*9e4/s}function gO(s,e){const t=Nv(s,e);if(e+t<=s.length){const i=Dg(s,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function Ov(s,e,t,i,a){const u=Dv(s.samplerate),l=i+a*u,c=gO(e,t);let f;if(c){const{frameLength:g,headerLength:E}=c,T=E+g,v=Math.max(0,t+T-e.length);v?(f=new Uint8Array(T-E),f.set(e.subarray(t+E,e.length),0)):f=e.subarray(t+E,t+T);const S={unit:f,pts:l};return v||s.samples.push(S),{sample:S,length:T,missing:v}}const h=e.length-t;return f=new Uint8Array(h),f.set(e.subarray(t,e.length),0),{sample:{unit:f,pts:l},length:h,missing:-1}}function pO(s,e){return Cg(s,e)&&tf(s,e+6)+10<=s.length-e}function bO(s){return s instanceof ArrayBuffer?s:s.byteOffset==0&&s.byteLength==s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer}function H0(s,e=0,t=1/0){return EO(s,e,t,Uint8Array)}function EO(s,e,t,i){const a=xO(s);let u=1;"BYTES_PER_ELEMENT"in i&&(u=i.BYTES_PER_ELEMENT);const l=TO(s)?s.byteOffset:0,c=(l+s.byteLength)/u,f=(l+e)/u,h=Math.floor(Math.max(0,Math.min(f,c))),m=Math.floor(Math.min(h+Math.max(t,0),c));return new i(a,h,m-h)}function xO(s){return s instanceof ArrayBuffer?s:s.buffer}function TO(s){return s&&s.buffer instanceof ArrayBuffer&&s.byteLength!==void 0&&s.byteOffset!==void 0}function yO(s){const e={key:s.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(s.size<2)return;if(s.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=s.data.subarray(1).indexOf(0);if(i===-1)return;const a=Js(H0(s.data,1,i)),u=s.data[2+i],l=s.data.subarray(3+i).indexOf(0);if(l===-1)return;const c=Js(H0(s.data,3+i,l));let f;return a==="-->"?f=Js(H0(s.data,4+i+l)):f=bO(s.data.subarray(4+i+l)),e.mimeType=a,e.pictureType=u,e.description=c,e.data=f,e}function vO(s){if(s.size<2)return;const e=Js(s.data,!0),t=new Uint8Array(s.data.subarray(e.length+1));return{key:s.type,info:e,data:t.buffer}}function SO(s){if(s.size<2)return;if(s.type==="TXXX"){let t=1;const i=Js(s.data.subarray(t),!0);t+=i.length+1;const a=Js(s.data.subarray(t));return{key:s.type,info:i,data:a}}const e=Js(s.data.subarray(1));return{key:s.type,info:"",data:e}}function AO(s){if(s.type==="WXXX"){if(s.size<2)return;let t=1;const i=Js(s.data.subarray(t),!0);t+=i.length+1;const a=Js(s.data.subarray(t));return{key:s.type,info:i,data:a}}const e=Js(s.data);return{key:s.type,info:"",data:e}}function _O(s){return s.type==="PRIV"?vO(s):s.type[0]==="W"?AO(s):s.type==="APIC"?yO(s):SO(s)}function LO(s){const e=String.fromCharCode(s[0],s[1],s[2],s[3]),t=tf(s,4),i=10;return{type:e,size:t,data:s.subarray(i,i+t)}}const qc=10,IO=10;function wv(s){let e=0;const t=[];for(;Cg(s,e);){const i=tf(s,e+6);s[e+5]>>6&1&&(e+=qc),e+=qc;const a=e+i;for(;e+IO<a;){const u=LO(s.subarray(e)),l=_O(u);l&&t.push(l),e+=u.size+qc}Iv(s,e)&&(e+=qc)}return t}function kv(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"}function RO(s){if(s.data.byteLength===8){const e=new Uint8Array(s.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function Og(s){const e=wv(s);for(let t=0;t<e.length;t++){const i=e[t];if(kv(i))return RO(i)}}let Zs=(function(s){return s.audioId3="org.id3",s.dateRange="com.apple.quicktime.HLS",s.emsg="https://aomedia.org/emsg/ID3",s.misbklv="urn:misb:KLV:bin:1910.1",s})({});function Hi(s="",e=9e4){return{type:s,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class wg{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,a){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=mi(this.cachedData,e),this.cachedData=null);let i=eo(e,0),a=i?i.length:0,u;const l=this._audioTrack,c=this._id3Track,f=i?Og(i):void 0,h=e.length;for((this.basePTS===null||this.frameIndex===0&&Ee(f))&&(this.basePTS=NO(f,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Zs.audioId3,duration:Number.POSITIVE_INFINITY});a<h;){if(this.canParse(e,a)){const m=this.appendFrame(l,e,a);m?(this.frameIndex++,this.lastPTS=m.sample.pts,a+=m.length,u=a):a=h}else pO(e,a)?(i=eo(e,a),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Zs.audioId3,duration:Number.POSITIVE_INFINITY}),a+=i.length,u=a):a++;if(a===h&&u!==h){const m=e.slice(u);this.cachedData?this.cachedData=mi(this.cachedData,m):this.cachedData=m}}return{audioTrack:l,videoTrack:Hi(),id3Track:c,textTrack:Hi()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Hi(),id3Track:this._id3Track,textTrack:Hi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const NO=(s,e,t)=>{if(Ee(s))return s*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let Yc=null;const CO=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],DO=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],OO=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],wO=[0,1,1,4];function Mv(s,e,t,i,a){if(t+24>e.length)return;const u=Pv(e,t);if(u&&t+u.frameLength<=e.length){const l=u.samplesPerFrame*9e4/u.sampleRate,c=i+a*l,f={unit:e.subarray(t,t+u.frameLength),pts:c,dts:c};return s.config=[],s.channelCount=u.channelCount,s.samplerate=u.sampleRate,s.samples.push(f),{sample:f,length:u.frameLength,missing:0}}}function Pv(s,e){const t=s[e+1]>>3&3,i=s[e+1]>>1&3,a=s[e+2]>>4&15,u=s[e+2]>>2&3;if(t!==1&&a!==0&&a!==15&&u!==3){const l=s[e+2]>>1&1,c=s[e+3]>>6,f=t===3?3-i:i===3?3:4,h=CO[f*14+a-1]*1e3,g=DO[(t===3?0:t===2?1:2)*3+u],E=c===3?1:2,T=OO[t][i],v=wO[i],S=T*8*v,A=Math.floor(T*h/g+l)*v;if(Yc===null){const N=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Yc=N?parseInt(N[1]):0}return!!Yc&&Yc<=87&&i===2&&h>=224e3&&c===0&&(s[e+3]=s[e+3]|128),{sampleRate:g,channelCount:E,frameLength:A,samplesPerFrame:S}}}function kg(s,e){return s[e]===255&&(s[e+1]&224)===224&&(s[e+1]&6)!==0}function Uv(s,e){return e+1<s.length&&kg(s,e)}function kO(s,e){return kg(s,e)&&4<=s.length-e}function Bv(s,e){if(e+1<s.length&&kg(s,e)){const i=Pv(s,e);let a=4;i!=null&&i.frameLength&&(a=i.frameLength);const u=e+a;return u===s.length||Uv(s,u)}return!1}class MO extends wg{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,a){super.resetInitSegment(e,t,i,a),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=eo(e,0);let a=(i==null?void 0:i.length)||0;if(Bv(e,a))return!1;for(let u=e.length;a<u;a++)if(mO(e,a))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return hO(e,t)}appendFrame(e,t,i){Cv(e,this.observer,t,i,e.manifestCodec);const a=Ov(e,t,i,this.basePTS,this.frameIndex);if(a&&a.missing===0)return a}}const Fv=(s,e)=>{let t=0,i=5;e+=i;const a=new Uint32Array(1),u=new Uint32Array(1),l=new Uint8Array(1);for(;i>0;){l[0]=s[e];const c=Math.min(i,8),f=8-c;u[0]=4278190080>>>24+f<<f,a[0]=(l[0]&u[0])>>f,t=t?t<<c|a[0]:a[0],e+=1,i-=c}return t};class PO extends wg{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,a){super.resetInitSegment(e,t,i,a),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const a=jv(e,t,i,this.basePTS,this.frameIndex);if(a!==-1)return{sample:e.samples[e.samples.length-1],length:a,missing:0}}static probe(e){if(!e)return!1;const t=eo(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&Og(t)!==void 0&&Fv(e,i)<16}}function jv(s,e,t,i,a){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const u=e[t+4]>>6;if(u>=3)return-1;const c=[48e3,44100,32e3][u],f=e[t+4]&63,m=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][f*3+u]*2;if(t+m>e.length)return-1;const g=e[t+6]>>5;let E=0;g===2?E+=2:(g&1&&g!==1&&(E+=2),g&4&&(E+=2));const T=(e[t+6]<<8|e[t+7])>>12-E&1,S=[2,1,2,3,3,4,4,5][g]+T,A=e[t+5]>>3,I=e[t+5]&7,R=new Uint8Array([u<<6|A<<1|I>>2,(I&3)<<6|g<<3|T<<2|f>>4,f<<4&224]),N=1536/c*9e4,D=i+a*N,k=e.subarray(t,t+m);return s.config=R,s.channelCount=S,s.samplerate=c,s.samples.push({unit:k,pts:D}),m}class UO extends wg{resetInitSegment(e,t,i,a){super.resetInitSegment(e,t,i,a),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=eo(e,0);let i=(t==null?void 0:t.length)||0;if(t&&e[i]===11&&e[i+1]===119&&Og(t)!==void 0&&Fv(e,i)<=16)return!1;for(let a=e.length;i<a;i++)if(Bv(e,i))return nt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return kO(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return Mv(e,t,i,this.basePTS,this.frameIndex)}}const BO=/\/emsg[-/]ID3/i;class FO{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,a){const u=this.videoTrack=Hi("video",1),l=this.audioTrack=Hi("audio",1),c=this.txtTrack=Hi("text",1);if(this.id3Track=Hi("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const f=X2(e);if(f.video){const{id:h,timescale:m,codec:g,supplemental:E}=f.video;u.id=h,u.timescale=c.timescale=m,u.codec=g,u.supplemental=E}if(f.audio){const{id:h,timescale:m,codec:g}=f.audio;l.id=h,l.timescale=m,l.codec=g}c.id=K2.text,u.sampleDuration=0,u.duration=l.duration=a}resetContiguity(){this.remainderData=null}static probe(e){return PD(e)}demux(e,t){this.timeOffset=t;let i=e;const a=this.videoTrack,u=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=mi(this.remainderData,e));const c=GD(i);this.remainderData=c.remainder,a.samples=c.valid||new Uint8Array}else a.samples=i;const l=this.extractID3Track(a,t);return u.samples=$x(t,a),{videoTrack:a,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const a=this.extractID3Track(t,this.timeOffset);return i.samples=$x(e,t),{videoTrack:t,audioTrack:Hi(),id3Track:a,textTrack:Hi()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const a=Be(e.samples,["emsg"]);a&&a.forEach(u=>{const l=qD(u);if(BO.test(l.schemeIdUri)){const c=_T(l,t);let f=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;f<=.001&&(f=Number.POSITIVE_INFINITY);const h=l.payload;i.samples.push({data:h,len:h.byteLength,dts:c,pts:c,type:Zs.emsg,duration:f})}else if(this.config.enableEmsgKLVMetadata&&l.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=_T(l,t);i.samples.push({data:l.payload,len:l.payload.byteLength,dts:c,pts:c,type:Zs.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function _T(s,e){return Ee(s.presentationTime)?s.presentationTime/s.timeScale:e+s.presentationTimeDelta/s.timeScale}class jO{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Ag(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,xa.cbc)}decryptAacSample(e,t,i){const a=e[t].unit;if(a.length<=16)return;const u=a.subarray(16,a.length-a.length%16),l=u.buffer.slice(u.byteOffset,u.byteOffset+u.length);this.decryptBuffer(l).then(c=>{const f=new Uint8Array(c);a.set(f,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)}).catch(i)}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let a=0;for(let u=32;u<e.length-16;u+=160,a+=16)i.set(e.subarray(u,u+16),a);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let a=0;for(let u=32;u<e.length-16;u+=160,a+=16)e.set(i.subarray(a,a+16),u);return e}decryptAvcSample(e,t,i,a,u){const l=J2(u.data),c=this.getAvcEncryptedData(l);this.decryptBuffer(c.buffer).then(f=>{u.data=this.getAvcDecryptedUnit(l,f),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,a)}).catch(a)}decryptAvcSamples(e,t,i,a){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){a();return}const u=e[t].units;for(;!(i>=u.length);i++){const l=u[i];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(e,t,i,a,l),!this.decrypter.isSync()))return}}}}class Hv{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,a;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const u=i.units;a=u[u.length-1]}return a}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,a=i.length;if(a){const u=i[a-1];e.pts=u.pts,e.dts=u.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const a=t.byteLength;let u=e.naluState||0;const l=u,c=[];let f=0,h,m,g,E=-1,T=0;for(u===-1&&(E=0,T=this.getNALuType(t,0),u=0,f=1);f<a;){if(h=t[f++],!u){u=h?0:1;continue}if(u===1){u=h?0:2;continue}if(!h)u=3;else if(h===1){if(m=f-u-1,E>=0){const v={data:t.subarray(E,m),type:T};c.push(v)}else{const v=this.getLastNalUnit(e.samples);v&&(l&&f<=4-l&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-l)),m>0&&(v.data=mi(v.data,t.subarray(0,m)),v.state=0))}f<a?(g=this.getNALuType(t,f),E=f,T=g,u=0):u=-1}else u=0}if(E>=0&&u>=0){const v={data:t.subarray(E,a),type:T,state:u};c.push(v)}if(c.length===0){const v=this.getLastNalUnit(e.samples);v&&(v.data=mi(v.data,t))}return e.naluState=u,c}}class Ul{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,a=new Uint8Array(4),u=Math.min(4,t);if(u===0)throw new Error("no bytes available");a.set(e.subarray(i,i+u)),this.word=new DataView(a.buffer).getUint32(0),this.bitsAvailable=u*8,this.bytesAvailable-=u}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&nt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class HO extends Hv{parsePES(e,t,i,a){const u=this.parseNALu(e,i.data,a);let l=this.VideoSample,c,f=!1;i.data=null,l&&u.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),u.forEach(h=>{var m,g;switch(h.type){case 1:{let S=!1;c=!0;const A=h.data;if(f&&A.length>4){const I=this.readSliceType(A);(I===2||I===4||I===7||I===9)&&(S=!0)}if(S){var E;(E=l)!=null&&E.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),l.frame=!0,l.key=S;break}case 5:c=!0,(m=l)!=null&&m.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),l.key=!0,l.frame=!0;break;case 6:{c=!0,Tg(h.data,1,i.pts,t.samples);break}case 7:{var T,v;c=!0,f=!0;const S=h.data,A=this.readSPS(S);if(!e.sps||e.width!==A.width||e.height!==A.height||((T=e.pixelRatio)==null?void 0:T[0])!==A.pixelRatio[0]||((v=e.pixelRatio)==null?void 0:v[1])!==A.pixelRatio[1]){e.width=A.width,e.height=A.height,e.pixelRatio=A.pixelRatio,e.sps=[S];const I=S.subarray(1,4);let R="avc1.";for(let N=0;N<3;N++){let D=I[N].toString(16);D.length<2&&(D="0"+D),R+=D}e.codec=R}break}case 8:c=!0,e.pps=[h.data];break;case 9:c=!0,e.audFound=!0,(g=l)!=null&&g.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:c=!0;break;default:c=!1;break}l&&c&&l.units.push(h)}),a&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Ul(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,a=8,u;for(let l=0;l<e;l++)a!==0&&(u=t.readEG(),a=(i+u+256)%256),i=a===0?i:a}readSPS(e){const t=new Ul(e);let i=0,a=0,u=0,l=0,c,f,h;const m=t.readUByte.bind(t),g=t.readBits.bind(t),E=t.readUEG.bind(t),T=t.readBoolean.bind(t),v=t.skipBits.bind(t),S=t.skipEG.bind(t),A=t.skipUEG.bind(t),I=this.skipScalingList.bind(this);m();const R=m();if(g(5),v(3),m(),A(),R===100||R===110||R===122||R===244||R===44||R===83||R===86||R===118||R===128){const H=E();if(H===3&&v(1),A(),A(),v(1),T())for(f=H!==3?8:12,h=0;h<f;h++)T()&&(h<6?I(16,t):I(64,t))}A();const N=E();if(N===0)E();else if(N===1)for(v(1),S(),S(),c=E(),h=0;h<c;h++)S();A(),v(1);const D=E(),k=E(),G=g(1);G===0&&v(1),v(1),T()&&(i=E(),a=E(),u=E(),l=E());let U=[1,1];if(T()&&T())switch(m()){case 1:U=[1,1];break;case 2:U=[12,11];break;case 3:U=[10,11];break;case 4:U=[16,11];break;case 5:U=[40,33];break;case 6:U=[24,11];break;case 7:U=[20,11];break;case 8:U=[32,11];break;case 9:U=[80,33];break;case 10:U=[18,11];break;case 11:U=[15,11];break;case 12:U=[64,33];break;case 13:U=[160,99];break;case 14:U=[4,3];break;case 15:U=[3,2];break;case 16:U=[2,1];break;case 255:{U=[m()<<8|m(),m()<<8|m()];break}}return{width:Math.ceil((D+1)*16-i*2-a*2),height:(2-G)*(k+1)*16-(G?2:4)*(u+l),pixelRatio:U}}}class $O extends Hv{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,a){const u=this.parseNALu(e,i.data,a);let l=this.VideoSample,c,f=!1;i.data=null,l&&u.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),u.forEach(h=>{var m,g;switch(h.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:l||(l=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),l.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,f){var E;(E=l)!=null&&E.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),l.key=!0,l.frame=!0;break;case 19:case 20:c=!0,(m=l)!=null&&m.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),l.key=!0,l.frame=!0;break;case 39:c=!0,Tg(h.data,2,i.pts,t.samples);break;case 32:c=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ot(e.params,this.readVPS(h.data)),this.initVPS=h.data),e.vps=[h.data];break;case 33:if(c=!0,f=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],h.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const T=this.readSPS(h.data);e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.codec=T.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const v in T.params)e.params[v]=T.params[v]}this.pushParameterSet(e.sps,h.data,e.vps),l||(l=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),l.key=!0;break;case 34:if(c=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const T=this.readPPS(h.data);for(const v in T)e.params[v]=T[v]}this.pushParameterSet(e.pps,h.data,e.vps)}break;case 35:c=!0,e.audFound=!0,(g=l)!=null&&g.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:c=!1;break}l&&c&&l.units.push(h)}),a&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let a=0;a<e.byteLength;a++)a>=2&&e[a]===3&&e[a-1]===0&&e[a-2]===0||(t[i]=e[a],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Ul(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),a=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:a}}readSPS(e){const t=new Ul(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const a=t.readBits(2),u=t.readBoolean(),l=t.readBits(5),c=t.readUByte(),f=t.readUByte(),h=t.readUByte(),m=t.readUByte(),g=t.readUByte(),E=t.readUByte(),T=t.readUByte(),v=t.readUByte(),S=t.readUByte(),A=t.readUByte(),I=t.readUByte(),R=[],N=[];for(let Ve=0;Ve<i;Ve++)R.push(t.readBoolean()),N.push(t.readBoolean());if(i>0)for(let Ve=i;Ve<8;Ve++)t.readBits(2);for(let Ve=0;Ve<i;Ve++)R[Ve]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),N[Ve]&&t.readUByte();t.readUEG();const D=t.readUEG();D==3&&t.skipBits(1);const k=t.readUEG(),G=t.readUEG(),U=t.readBoolean();let H=0,$=0,F=0,ee=0;U&&(H+=t.readUEG(),$+=t.readUEG(),F+=t.readUEG(),ee+=t.readUEG());const me=t.readUEG(),be=t.readUEG(),Te=t.readUEG(),ne=t.readBoolean();for(let Ve=ne?0:i;Ve<=i;Ve++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Qt=0;Qt<4;Qt++)for(let ps=0;ps<(Qt===3?2:6);ps++)if(!t.readBoolean())t.readUEG();else{const bs=Math.min(64,1<<4+(Qt<<1));Qt>1&&t.readEG();for(let Ri=0;Ri<bs;Ri++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const te=t.readUEG();let J=0;for(let Ve=0;Ve<te;Ve++){let Qt=!1;if(Ve!==0&&(Qt=t.readBoolean()),Qt){Ve===te&&t.readUEG(),t.readBoolean(),t.readUEG();let ps=0;for(let bi=0;bi<=J;bi++){const bs=t.readBoolean();let Ri=!1;bs||(Ri=t.readBoolean()),(bs||Ri)&&ps++}J=ps}else{const ps=t.readUEG(),bi=t.readUEG();J=ps+bi;for(let bs=0;bs<ps;bs++)t.readUEG(),t.readBoolean();for(let bs=0;bs<bi;bs++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ve=t.readUEG();for(let Qt=0;Qt<Ve;Qt++){for(let ps=0;ps<Te+4;ps++)t.readBits(1);t.readBits(1)}}let fe=0,ce=1,xe=1,Ce=!0,Ne=1,Me=0;t.readBoolean(),t.readBoolean();let It=!1;if(t.readBoolean()){if(t.readBoolean()){const Xi=t.readUByte(),go=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Xt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Xi>0&&Xi<16?(ce=go[Xi-1],xe=Xt[Xi-1]):Xi===255&&(ce=t.readBits(16),xe=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),It=t.readBoolean(),It&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(Ne=t.readBits(32),Me=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Xt=t.readBoolean(),po=t.readBoolean();let Rn=!1;(Xt||po)&&(Rn=t.readBoolean(),Rn&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Rn&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Lu=0;Lu<=i;Lu++){Ce=t.readBoolean();const or=Ce||t.readBoolean();let bo=!1;or?t.readEG():bo=t.readBoolean();const Iu=bo?1:t.readUEG()+1;if(Xt)for(let va=0;va<Iu;va++)t.readUEG(),t.readUEG(),Rn&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(po)for(let va=0;va<Iu;va++)t.readUEG(),t.readUEG(),Rn&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),fe=t.readUEG())}let Vt=k,Ss=G;if(U){let Ve=1,Qt=1;D===1?Ve=Qt=2:D==2&&(Ve=2),Vt=k-Ve*$-Ve*H,Ss=G-Qt*ee-Qt*F}const ei=a?["A","B","C"][a]:"",_u=c<<24|f<<16|h<<8|m;let lr=0;for(let Ve=0;Ve<32;Ve++)lr=(lr|(_u>>Ve&1)<<31-Ve)>>>0;let pi=lr.toString(16);return l===1&&pi==="2"&&(pi="6"),{codecString:`hvc1.${ei}${l}.${pi}.${u?"H":"L"}${I}.B0`,params:{general_tier_flag:u,general_profile_idc:l,general_profile_space:a,general_profile_compatibility_flags:[c,f,h,m],general_constraint_indicator_flags:[g,E,T,v,S,A],general_level_idc:I,bit_depth:me+8,bit_depth_luma_minus8:me,bit_depth_chroma_minus8:be,min_spatial_segmentation_idc:fe,chroma_format_idc:D,frame_rate:{fixed:Ce,fps:Me/Ne}},width:Vt,height:Ss,pixelRatio:[ce,xe]}}readPPS(e){const t=new Ul(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const a=t.readBoolean(),u=t.readBoolean();let l=1;return u&&a?l=0:u?l=3:a&&(l=2),{parallelismType:l}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Jt=188;class ra{constructor(e,t,i,a){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=a,this.videoParser=null}static probe(e,t){const i=ra.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(Jt*5,t-Jt)+1,a=0;for(;a<i;){let u=!1,l=-1,c=0;for(let f=a;f<t;f+=Jt)if(e[f]===71&&(t-f===Jt||e[f+Jt]===71)){if(c++,l===-1&&(l=f,l!==0&&(i=Math.min(l+Jt*99,e.length-Jt)+1)),u||(u=km(e,f)===0),u&&c>1&&(l===0&&c>2||f+Jt>i))return l}else{if(c)return-1;break}a++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:K2[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,a){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=ra.createTrack("video"),this._videoTrack.duration=a,this._audioTrack=ra.createTrack("audio",a),this._id3Track=ra.createTrack("id3"),this._txtTrack=ra.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,a=!1){i||(this.sampleAes=null);let u;const l=this._videoTrack,c=this._audioTrack,f=this._id3Track,h=this._txtTrack;let m=l.pid,g=l.pesData,E=c.pid,T=f.pid,v=c.pesData,S=f.pesData,A=null,I=this.pmtParsed,R=this._pmtId,N=e.length;if(this.remainderData&&(e=mi(this.remainderData,e),N=e.length,this.remainderData=null),N<Jt&&!a)return this.remainderData=e,{audioTrack:c,videoTrack:l,id3Track:f,textTrack:h};const D=Math.max(0,ra.syncOffset(e));N-=(N-D)%Jt,N<e.byteLength&&!a&&(this.remainderData=new Uint8Array(e.buffer,N,e.buffer.byteLength-N));let k=0;for(let U=D;U<N;U+=Jt)if(e[U]===71){const H=!!(e[U+1]&64),$=km(e,U),F=(e[U+3]&48)>>4;let ee;if(F>1){if(ee=U+5+e[U+4],ee===U+Jt)continue}else ee=U+4;switch($){case m:H&&(g&&(u=Zr(g,this.logger))&&(this.readyVideoParser(l.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(l,h,u,!1)),g={data:[],size:0}),g&&(g.data.push(e.subarray(ee,U+Jt)),g.size+=U+Jt-ee);break;case E:if(H){if(v&&(u=Zr(v,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,u);break;case"mp3":this.parseMPEGPES(c,u);break;case"ac3":this.parseAC3PES(c,u);break}v={data:[],size:0}}v&&(v.data.push(e.subarray(ee,U+Jt)),v.size+=U+Jt-ee);break;case T:H&&(S&&(u=Zr(S,this.logger))&&this.parseID3PES(f,u),S={data:[],size:0}),S&&(S.data.push(e.subarray(ee,U+Jt)),S.size+=U+Jt-ee);break;case 0:H&&(ee+=e[ee]+1),R=this._pmtId=GO(e,ee);break;case R:{H&&(ee+=e[ee]+1);const me=VO(e,ee,this.typeSupported,i,this.observer,this.logger);m=me.videoPid,m>0&&(l.pid=m,l.segmentCodec=me.segmentVideoCodec),E=me.audioPid,E>0&&(c.pid=E,c.segmentCodec=me.segmentAudioCodec),T=me.id3Pid,T>0&&(f.pid=T),A!==null&&!I&&(this.logger.warn(`MPEG-TS PMT found at ${U} after unknown PID '${A}'. Backtracking to sync byte @${D} to parse all TS packets.`),A=null,U=D-188),I=this.pmtParsed=!0;break}case 17:case 8191:break;default:A=$;break}}else k++;k>0&&Mm(this.observer,new Error(`Found ${k} TS packet/s that do not start with 0x47`),void 0,this.logger),l.pesData=g,c.pesData=v,f.pesData=S;const G={audioTrack:c,videoTrack:l,id3Track:f,textTrack:h};return a&&this.extractRemainingSamples(G),G}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:a,textTrack:u}=e,l=i.pesData,c=t.pesData,f=a.pesData;let h;if(l&&(h=Zr(l,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,u,h,!0),i.pesData=null)):i.pesData=l,c&&(h=Zr(c,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,h);break;case"mp3":this.parseMPEGPES(t,h);break;case"ac3":this.parseAC3PES(t,h);break}t.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;f&&(h=Zr(f,this.logger))?(this.parseID3PES(a,h),a.pesData=null):a.pesData=f}demuxSampleAes(e,t,i){const a=this.demux(e,i,!0,!this.config.progressive),u=this.sampleAes=new jO(this.observer,this.config,t);return this.decrypt(a,u)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new HO:e==="hevc"&&(this.videoParser=new $O))}decrypt(e,t){return new Promise(i=>{const{audioTrack:a,videoTrack:u}=e;a.samples&&a.segmentCodec==="aac"?t.decryptAacSamples(a.samples,0,()=>{u.samples?t.decryptAvcSamples(u.samples,0,0,()=>{i(e)}):i(e)}):u.samples&&t.decryptAvcSamples(u.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const a=this.aacOverFlow;let u=t.data;if(a){this.aacOverFlow=null;const g=a.missing,E=a.sample.unit.byteLength;if(g===-1)u=mi(a.sample.unit,u);else{const T=E-g;a.sample.unit.set(u.subarray(0,g),T),e.samples.push(a.sample),i=a.missing}}let l,c;for(l=i,c=u.length;l<c-1&&!Ud(u,l);l++);if(l!==i){let g;const E=l<c-1;if(E?g=`AAC PES did not start with ADTS header,offset:${l}`:g="No ADTS header found in AAC PES",Mm(this.observer,new Error(g),E,this.logger),!E)return}Cv(e,this.observer,u,l,this.audioCodec);let f;if(t.pts!==void 0)f=t.pts;else if(a){const g=Dv(e.samplerate);f=a.sample.pts+g}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let h=0,m;for(;l<c;)if(m=Ov(e,u,l,f,h),l+=m.length,m.missing){this.aacOverFlow=m;break}else for(h++;l<c-1&&!Ud(u,l);l++);}parseMPEGPES(e,t){const i=t.data,a=i.length;let u=0,l=0;const c=t.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<a;)if(Uv(i,l)){const f=Mv(e,i,l,c,u);if(f)l+=f.length,u++;else break}else l++}parseAC3PES(e,t){{const i=t.data,a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const u=i.length;let l=0,c=0,f;for(;c<u&&(f=jv(e,i,c,a,l++))>0;)c+=f}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=ot({},t,{type:this._videoTrack?Zs.emsg:Zs.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function km(s,e){return((s[e+1]&31)<<8)+s[e+2]}function GO(s,e){return(s[e+10]&31)<<8|s[e+11]}function VO(s,e,t,i,a,u){const l={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(s[e+1]&15)<<8|s[e+2],f=e+3+c-4,h=(s[e+10]&15)<<8|s[e+11];for(e+=12+h;e<f;){const m=km(s,e),g=(s[e+3]&15)<<8|s[e+4];switch(s[e]){case 207:if(!i){$0("ADTS AAC",u);break}case 15:l.audioPid===-1&&(l.audioPid=m);break;case 21:l.id3Pid===-1&&(l.id3Pid=m);break;case 219:if(!i){$0("H.264",u);break}case 27:l.videoPid===-1&&(l.videoPid=m);break;case 3:case 4:!t.mpeg&&!t.mp3?u.log("MPEG audio found, not supported in this browser"):l.audioPid===-1&&(l.audioPid=m,l.segmentAudioCodec="mp3");break;case 193:if(!i){$0("AC-3",u);break}case 129:t.ac3?l.audioPid===-1&&(l.audioPid=m,l.segmentAudioCodec="ac3"):u.log("AC-3 audio found, not supported in this browser");break;case 6:if(l.audioPid===-1&&g>0){let E=e+5,T=g;for(;T>2;){switch(s[E]){case 106:t.ac3!==!0?u.log("AC-3 audio found, not supported in this browser for now"):(l.audioPid=m,l.segmentAudioCodec="ac3");break}const S=s[E+1]+2;E+=S,T-=S}}break;case 194:case 135:return Mm(a,new Error("Unsupported EC-3 in M2TS found"),void 0,u),l;case 36:l.videoPid===-1&&(l.videoPid=m,l.segmentVideoCodec="hevc",u.log("HEVC in M2TS found"));break}e+=g+5}return l}function Mm(s,e,t,i){i.warn(`parsing error: ${e.message}`),s.emit(L.ERROR,L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function $0(s,e){e.log(`${s} with AES-128-CBC encryption found in unencrypted stream`)}function Zr(s,e){let t=0,i,a,u,l,c;const f=s.data;if(!s||s.size===0)return null;for(;f[0].length<19&&f.length>1;)f[0]=mi(f[0],f[1]),f.splice(1,1);if(i=f[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(a=(i[4]<<8)+i[5],a&&a>s.size-6)return null;const m=i[7];m&192&&(l=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,m&64?(c=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,l-c>60*9e4&&(e.warn(`${Math.round((l-c)/9e4)}s delta between PTS and DTS, align them`),l=c)):c=l),u=i[8];let g=u+9;if(s.size<=g)return null;s.size-=g;const E=new Uint8Array(s.size);for(let T=0,v=f.length;T<v;T++){i=f[T];let S=i.byteLength;if(g)if(g>S){g-=S;continue}else i=i.subarray(g),S-=g,g=0;E.set(i,t),t+=S}return a&&(a-=u+3),{data:E,pts:l,dts:c,len:a}}return null}class qO{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const ea=Math.pow(2,32)-1;class q{static init(){q.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in q.types)q.types.hasOwnProperty(e)&&(q.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);q.HDLR_TYPES={video:t,audio:i};const a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),u=new Uint8Array([0,0,0,0,0,0,0,0]);q.STTS=q.STSC=q.STCO=u,q.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),q.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),q.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),q.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const l=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),f=new Uint8Array([0,0,0,1]);q.FTYP=q.box(q.types.ftyp,l,f,l,c),q.DINF=q.box(q.types.dinf,q.box(q.types.dref,a))}static box(e,...t){let i=8,a=t.length;const u=a;for(;a--;)i+=t[a].byteLength;const l=new Uint8Array(i);for(l[0]=i>>24&255,l[1]=i>>16&255,l[2]=i>>8&255,l[3]=i&255,l.set(e,4),a=0,i=8;a<u;a++)l.set(t[a],i),i+=t[a].byteLength;return l}static hdlr(e){return q.box(q.types.hdlr,q.HDLR_TYPES[e])}static mdat(e){return q.box(q.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(ea+1)),a=Math.floor(t%(ea+1));return q.box(q.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,a>>24,a>>16&255,a>>8&255,a&255,85,196,0,0]))}static mdia(e){return q.box(q.types.mdia,q.mdhd(e.timescale||0,e.duration||0),q.hdlr(e.type),q.minf(e))}static mfhd(e){return q.box(q.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?q.box(q.types.minf,q.box(q.types.smhd,q.SMHD),q.DINF,q.stbl(e)):q.box(q.types.minf,q.box(q.types.vmhd,q.VMHD),q.DINF,q.stbl(e))}static moof(e,t,i){return q.box(q.types.moof,q.mfhd(e),q.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=q.trak(e[t]);return q.box.apply(null,[q.types.moov,q.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(q.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=q.trex(e[t]);return q.box.apply(null,[q.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(ea+1)),a=Math.floor(t%(ea+1)),u=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,a>>24,a>>16&255,a>>8&255,a&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return q.box(q.types.mvhd,u)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let a,u;for(a=0;a<t.length;a++)u=t[a].flags,i[a+4]=u.dependsOn<<4|u.isDependedOn<<2|u.hasRedundancy;return q.box(q.types.sdtp,i)}static stbl(e){return q.box(q.types.stbl,q.stsd(e),q.box(q.types.stts,q.STTS),q.box(q.types.stsc,q.STSC),q.box(q.types.stsz,q.STSZ),q.box(q.types.stco,q.STCO))}static avc1(e){let t=[],i=[],a,u,l;for(a=0;a<e.sps.length;a++)u=e.sps[a],l=u.byteLength,t.push(l>>>8&255),t.push(l&255),t=t.concat(Array.prototype.slice.call(u));for(a=0;a<e.pps.length;a++)u=e.pps[a],l=u.byteLength,i.push(l>>>8&255),i.push(l&255),i=i.concat(Array.prototype.slice.call(u));const c=q.box(q.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),f=e.width,h=e.height,m=e.pixelRatio[0],g=e.pixelRatio[1];return q.box(q.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,q.box(q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),q.box(q.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,g>>24,g>>16&255,g>>8&255,g&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return q.box(q.types.mp4a,q.audioStsd(e),q.box(q.types.esds,q.esds(e)))}static mp3(e){return q.box(q.types[".mp3"],q.audioStsd(e))}static ac3(e){return q.box(q.types["ac-3"],q.audioStsd(e),q.box(q.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return q.box(q.types.stsd,q.STSD,q.mp4a(e));if(t==="ac3"&&e.config)return q.box(q.types.stsd,q.STSD,q.ac3(e));if(t==="mp3"&&e.codec==="mp3")return q.box(q.types.stsd,q.STSD,q.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return q.box(q.types.stsd,q.STSD,q.avc1(e));if(t==="hevc"&&e.vps)return q.box(q.types.stsd,q.STSD,q.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),a=e.width||0,u=e.height||0,l=Math.floor(i/(ea+1)),c=Math.floor(i%(ea+1));return q.box(q.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,a&255,0,0,u>>8&255,u&255,0,0]))}static traf(e,t){const i=q.sdtp(e),a=e.id,u=Math.floor(t/(ea+1)),l=Math.floor(t%(ea+1));return q.box(q.types.traf,q.box(q.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255])),q.box(q.types.tfdt,new Uint8Array([1,0,0,0,u>>24,u>>16&255,u>>8&255,u&255,l>>24,l>>16&255,l>>8&255,l&255])),q.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,q.box(q.types.trak,q.tkhd(e),q.mdia(e))}static trex(e){const t=e.id;return q.box(q.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],a=i.length,u=12+16*a,l=new Uint8Array(u);let c,f,h,m,g,E;for(t+=8+u,l.set([e.type==="video"?1:0,0,15,1,a>>>24&255,a>>>16&255,a>>>8&255,a&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<a;c++)f=i[c],h=f.duration,m=f.size,g=f.flags,E=f.cts,l.set([h>>>24&255,h>>>16&255,h>>>8&255,h&255,m>>>24&255,m>>>16&255,m>>>8&255,m&255,g.isLeading<<2|g.dependsOn,g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|g.isNonSync,g.degradPrio&61440,g.degradPrio&15,E>>>24&255,E>>>16&255,E>>>8&255,E&255],12+16*c);return q.box(q.types.trun,l)}static initSegment(e){q.types||q.init();const t=q.moov(e);return mi(q.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],a=4,u=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),a-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let l=u.length;for(let v=0;v<i.length;v+=1){l+=3;for(let S=0;S<i[v].length;S+=1)l+=2+i[v][S].length}const c=new Uint8Array(l);c.set(u,0),l=u.length;const f=i.length-1;for(let v=0;v<i.length;v+=1){c.set(new Uint8Array([32+v|(v===f?128:0),0,i[v].length]),l),l+=3;for(let S=0;S<i[v].length;S+=1)c.set(new Uint8Array([i[v][S].length>>8,i[v][S].length&255]),l),l+=2,c.set(i[v][S],l),l+=i[v][S].length}const h=q.box(q.types.hvcC,c),m=e.width,g=e.height,E=e.pixelRatio[0],T=e.pixelRatio[1];return q.box(q.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,g>>8&255,g&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,q.box(q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),q.box(q.types.pasp,new Uint8Array([E>>24,E>>16&255,E>>8&255,E&255,T>>24,T>>16&255,T>>8&255,T&255])))}}q.types=void 0;q.HDLR_TYPES=void 0;q.STTS=void 0;q.STSC=void 0;q.STCO=void 0;q.STSZ=void 0;q.VMHD=void 0;q.SMHD=void 0;q.STSD=void 0;q.FTYP=void 0;q.DINF=void 0;const $v=9e4;function Mg(s,e,t=1,i=!1){const a=s*e*t;return i?Math.round(a):a}function YO(s,e,t=1,i=!1){return Mg(s,e,1/t,i)}function _l(s,e=!1){return Mg(s,1e3,1/$v,e)}function KO(s,e=1){return Mg(s,$v,1/e)}function LT(s){const{baseTime:e,timescale:t,trackId:i}=s;return`${e/t} (${e}/${t}) trackId: ${i}`}const zO=10*1e3,QO=1024,XO=1152,WO=1536;let Jr=null,G0=null;function IT(s,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:s?2:1,isNonSync:s?0:1}}}class ld extends gi{constructor(e,t,i,a){if(super("mp4-remuxer",a),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,Jr===null){const l=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Jr=l?parseInt(l[1]):0}if(G0===null){const u=navigator.userAgent.match(/Safari\/(\d+)/i);G0=u?parseInt(u[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&LT(t)} > ${e&&LT(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,a=e.reduce((u,l)=>{let c=l.pts,f=c-u;return f<-4294967296&&(t=!0,c=Xs(c,i),f=c-u),f>0?u:c},i);return t&&this.debug("PTS rollover detected"),a}remux(e,t,i,a,u,l,c,f){let h,m,g,E,T,v,S=u,A=u;const I=e.pid>-1,R=t.pid>-1,N=t.samples.length,D=e.samples.length>0,k=c&&N>0||N>1;if((!I||D)&&(!R||k)||this.ISGenerated||c){if(this.ISGenerated){var U,H,$,F;const Te=this.videoTrackConfig;(Te&&(t.width!==Te.width||t.height!==Te.height||((U=t.pixelRatio)==null?void 0:U[0])!==((H=Te.pixelRatio)==null?void 0:H[0])||(($=t.pixelRatio)==null?void 0:$[1])!==((F=Te.pixelRatio)==null?void 0:F[1]))||!Te&&k||this.nextAudioTs===null&&D)&&this.resetInitSegment()}this.ISGenerated||(g=this.generateIS(e,t,u,l));const ee=this.isVideoContiguous;let me=-1,be;if(k&&(me=ZO(t.samples),!ee&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,me>0){this.warn(`Dropped ${me} out of ${N} video samples due to a missing keyframe`);const Te=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(me),t.dropped+=me,A+=(t.samples[0].pts-Te)/t.inputTimeScale,be=A}else me===-1&&(this.warn(`No keyframe found out of ${N} video samples`),v=!1);if(this.ISGenerated){if(D&&k){const Te=this.getVideoStartPts(t.samples),B=(Xs(e.samples[0].pts,Te)-Te)/t.inputTimeScale;S+=Math.max(0,B),A+=Math.max(0,-B)}if(D){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),g=this.generateIS(e,t,u,l)),m=this.remuxAudio(e,S,this.isAudioContiguous,l,R||k||f===ye.AUDIO?A:void 0),k){const Te=m?m.endPTS-m.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),g=this.generateIS(e,t,u,l)),h=this.remuxVideo(t,A,ee,Te)}}else k&&(h=this.remuxVideo(t,A,ee,0));h&&(h.firstKeyFrame=me,h.independent=me!==-1,h.firstKeyFramePTS=be)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(T=Gv(i,u,this._initPTS,this._initDTS)),a.samples.length&&(E=Vv(a,u,this._initPTS))),{audio:m,video:h,initSegment:g,independent:v,text:E,id3:T}}computeInitPts(e,t,i,a){const u=Math.round(i*t);let l=Xs(e,u);if(l<u+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(u-l)/t} ${a}`);l<u+t;)l+=8589934592;return l-u}generateIS(e,t,i,a){const u=e.samples,l=t.samples,c=this.typeSupported,f={},h=this._initPTS;let m=!h||a,g="audio/mp4",E,T,v,S=-1;if(m&&(E=T=1/0),e.config&&u.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(g="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}f.audio={id:"audio",container:g,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):q.initSegment([e]),metadata:{channelCount:e.channelCount}},m&&(S=e.id,v=e.inputTimeScale,!h||v!==h.timescale?E=T=this.computeInitPts(u[0].pts,v,i,"audio"):m=!1)}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:q.initSegment([t]),metadata:{width:t.width,height:t.height}},m)if(S=t.id,v=t.inputTimeScale,!h||v!==h.timescale){const A=this.getVideoStartPts(l),I=Xs(l[0].dts,A),R=this.computeInitPts(I,v,i,"video"),N=this.computeInitPts(A,v,i,"video");T=Math.min(T,R),E=Math.min(E,N)}else m=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(f).length)return this.ISGenerated=!0,m?(h&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${i} ${E/v} != initPTS: ${h.baseTime/h.timescale} (${h.baseTime}/${h.timescale}) trackId: ${h.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${E/v} (${E}/${v}) trackId: ${S}`),this._initPTS={baseTime:E,timescale:v,trackId:S},this._initDTS={baseTime:T,timescale:v,trackId:S}):E=v=void 0,{tracks:f,initPTS:E,timescale:v,trackId:S}}remuxVideo(e,t,i,a){const u=e.inputTimeScale,l=e.samples,c=[],f=l.length,h=this._initPTS,m=h.baseTime*u/h.timescale;let g=this.nextVideoTs,E=8,T=this.videoSampleDuration,v,S,A=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY,R=!1;if(!i||g===null){const fe=m+t*u,ce=l[0].pts-Xs(l[0].dts,l[0].pts);Jr&&g!==null&&Math.abs(fe-ce-(g+m))<15e3?i=!0:g=fe-ce-m}const N=g+m;for(let fe=0;fe<f;fe++){const ce=l[fe];ce.pts=Xs(ce.pts,N),ce.dts=Xs(ce.dts,N),ce.dts<l[fe>0?fe-1:fe].dts&&(R=!0)}R&&l.sort(function(fe,ce){const xe=fe.dts-ce.dts,Ce=fe.pts-ce.pts;return xe||Ce}),v=l[0].dts,S=l[l.length-1].dts;const D=S-v,k=D?Math.round(D/(f-1)):T||e.inputTimeScale/30;if(i){const fe=v-N,ce=fe>k,xe=fe<-1;if((ce||xe)&&(ce?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${_l(fe,!0)} ms (${fe}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${_l(-fe,!0)} ms (${fe}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!xe||N>=l[0].pts||Jr)){v=N;const Ce=l[0].pts-fe;if(ce)l[0].dts=v,l[0].pts=Ce;else{let Ne=!0;for(let Me=0;Me<l.length&&!(l[Me].dts>Ce&&Ne);Me++){const It=l[Me].pts;if(l[Me].dts-=fe,l[Me].pts-=fe,Me<l.length-1){const yt=l[Me+1].pts,Vt=l[Me].pts,Ss=yt<=Vt,ei=yt<=It;Ne=Ss==ei}}}this.log(`Video: Initial PTS/DTS adjusted: ${_l(Ce,!0)}/${_l(v,!0)}, delta: ${_l(fe,!0)} ms`)}}v=Math.max(0,v);let G=0,U=0,H=v;for(let fe=0;fe<f;fe++){const ce=l[fe],xe=ce.units,Ce=xe.length;let Ne=0;for(let Me=0;Me<Ce;Me++)Ne+=xe[Me].data.length;U+=Ne,G+=Ce,ce.length=Ne,ce.dts<H?(ce.dts=H,H+=k/4|0||1):H=ce.dts,A=Math.min(ce.pts,A),I=Math.max(ce.pts,I)}S=l[f-1].dts;const $=U+4*G+8;let F;try{F=new Uint8Array($)}catch(fe){this.observer.emit(L.ERROR,L.ERROR,{type:Ae.MUX_ERROR,details:Y.REMUX_ALLOC_ERROR,fatal:!1,error:fe,bytes:$,reason:`fail allocating video mdat ${$}`});return}const ee=new DataView(F.buffer);ee.setUint32(0,$),F.set(q.types.mdat,4);let me=!1,be=Number.POSITIVE_INFINITY,Te=Number.POSITIVE_INFINITY,ne=Number.NEGATIVE_INFINITY,B=Number.NEGATIVE_INFINITY;for(let fe=0;fe<f;fe++){const ce=l[fe],xe=ce.units;let Ce=0;for(let It=0,yt=xe.length;It<yt;It++){const Vt=xe[It],Ss=Vt.data,ei=Vt.data.byteLength;ee.setUint32(E,ei),E+=4,F.set(Ss,E),E+=ei,Ce+=4+ei}let Ne;if(fe<f-1)T=l[fe+1].dts-ce.dts,Ne=l[fe+1].pts-ce.pts;else{const It=this.config,yt=fe>0?ce.dts-l[fe-1].dts:k;if(Ne=fe>0?ce.pts-l[fe-1].pts:k,It.stretchShortVideoTrack&&this.nextAudioTs!==null){const Vt=Math.floor(It.maxBufferHole*u),Ss=(a?A+a*u:this.nextAudioTs+m)-ce.pts;Ss>Vt?(T=Ss-yt,T<0?T=yt:me=!0,this.log(`It is approximately ${Ss/90} ms to the next segment; using duration ${T/90} ms for the last video frame.`)):T=yt}else T=yt}const Me=Math.round(ce.pts-ce.dts);be=Math.min(be,T),ne=Math.max(ne,T),Te=Math.min(Te,Ne),B=Math.max(B,Ne),c.push(IT(ce.key,T,Ce,Me))}if(c.length){if(Jr){if(Jr<70){const fe=c[0].flags;fe.dependsOn=2,fe.isNonSync=0}}else if(G0&&B-Te<ne-be&&k/ne<.025&&c[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let fe=v;for(let ce=0,xe=c.length;ce<xe;ce++){const Ce=fe+c[ce].duration,Ne=fe+c[ce].cts;if(ce<xe-1){const Me=Ce+c[ce+1].cts;c[ce].duration=Me-Ne}else c[ce].duration=ce?c[ce-1].duration:k;c[ce].cts=0,fe=Ce}}}T=me||!T?k:T;const W=S+T;this.nextVideoTs=g=W-m,this.videoSampleDuration=T,this.isVideoContiguous=!0;const pe={data1:q.moof(e.sequenceNumber++,v,ot(e,{samples:c})),data2:F,startPTS:(A-m)/u,endPTS:(I+T-m)/u,startDTS:(v-m)/u,endDTS:g/u,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,pe}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return XO;case"ac3":return WO;default:return QO}}remuxAudio(e,t,i,a,u){const l=e.inputTimeScale,c=e.samplerate?e.samplerate:l,f=l/c,h=this.getSamplesPerFrame(e),m=h*f,g=this._initPTS,E=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,T=[],v=u!==void 0;let S=e.samples,A=E?0:8,I=this.nextAudioTs||-1;const R=g.baseTime*l/g.timescale,N=R+t*l;if(this.isAudioContiguous=i=i||S.length&&I>0&&(a&&Math.abs(N-(I+R))<9e3||Math.abs(Xs(S[0].pts,N)-(I+R))<20*m),S.forEach(function(B){B.pts=Xs(B.pts,N)}),!i||I<0){const B=S.length;if(S=S.filter(W=>W.pts>=0),B!==S.length&&this.warn(`Removed ${S.length-B} of ${B} samples (initPTS ${R} / ${l})`),!S.length)return;u===0?I=0:a&&!v?I=Math.max(0,N-R):I=S[0].pts-R}if(e.segmentCodec==="aac"){const B=this.config.maxAudioFramesDrift;for(let W=0,te=I+R;W<S.length;W++){const J=S[W],pe=J.pts,fe=pe-te,ce=Math.abs(1e3*fe/l);if(fe<=-B*m&&v)W===0&&(this.warn(`Audio frame @ ${(pe/l).toFixed(3)}s overlaps marker by ${Math.round(1e3*fe/l)} ms.`),this.nextAudioTs=I=pe-R,te=pe);else if(fe>=B*m&&ce<zO&&v){let xe=Math.round(fe/m);for(te=pe-xe*m;te<0&&xe&&m;)xe--,te+=m;W===0&&(this.nextAudioTs=I=te-R),this.warn(`Injecting ${xe} audio frames @ ${((te-R)/l).toFixed(3)}s due to ${Math.round(1e3*fe/l)} ms gap.`);for(let Ce=0;Ce<xe;Ce++){let Ne=qO.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Ne||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Ne=J.unit.subarray()),S.splice(W,0,{unit:Ne,pts:te}),te+=m,W++}}J.pts=te,te+=m}}let D=null,k=null,G,U=0,H=S.length;for(;H--;)U+=S[H].unit.byteLength;for(let B=0,W=S.length;B<W;B++){const te=S[B],J=te.unit;let pe=te.pts;if(k!==null){const ce=T[B-1];ce.duration=Math.round((pe-k)/f)}else if(i&&e.segmentCodec==="aac"&&(pe=I+R),D=pe,U>0){U+=A;try{G=new Uint8Array(U)}catch(ce){this.observer.emit(L.ERROR,L.ERROR,{type:Ae.MUX_ERROR,details:Y.REMUX_ALLOC_ERROR,fatal:!1,error:ce,bytes:U,reason:`fail allocating audio mdat ${U}`});return}E||(new DataView(G.buffer).setUint32(0,U),G.set(q.types.mdat,4))}else return;G.set(J,A);const fe=J.byteLength;A+=fe,T.push(IT(!0,h,fe,0)),k=pe}const $=T.length;if(!$)return;const F=T[T.length-1];I=k-R,this.nextAudioTs=I+f*F.duration;const ee=E?new Uint8Array(0):q.moof(e.sequenceNumber++,D/f,ot({},e,{samples:T}));e.samples=[];const me=(D-R)/l,be=this.nextAudioTs/l,ne={data1:ee,data2:G,startPTS:me,endPTS:be,startDTS:me,endDTS:be,type:"audio",hasAudio:!0,hasVideo:!1,nb:$};return this.isAudioContiguous=!0,ne}}function Xs(s,e){let t;if(e===null)return s;for(e<s?t=-8589934592:t=8589934592;Math.abs(s-e)>4294967296;)s+=t;return s}function ZO(s){for(let e=0;e<s.length;e++)if(s[e].key)return e;return-1}function Gv(s,e,t,i){const a=s.samples.length;if(!a)return;const u=s.inputTimeScale;for(let c=0;c<a;c++){const f=s.samples[c];f.pts=Xs(f.pts-t.baseTime*u/t.timescale,e*u)/u,f.dts=Xs(f.dts-i.baseTime*u/i.timescale,e*u)/u}const l=s.samples;return s.samples=[],{samples:l}}function Vv(s,e,t){const i=s.samples.length;if(!i)return;const a=s.inputTimeScale;for(let l=0;l<i;l++){const c=s.samples[l];c.pts=Xs(c.pts-t.baseTime*a/t.timescale,e*a)/a}s.samples.sort((l,c)=>l.pts-c.pts);const u=s.samples;return s.samples=[],{samples:u}}class JO extends gi{constructor(e,t,i,a){super("passthrough-remuxer",a),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,a){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(e,a),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:i,videoCodec:a}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:u,video:l}=this.initData=X2(e);if(t)jD(e,t);else{const f=u||l;f!=null&&f.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${f.codec}")!`)}u&&(i=RT(u,dt.AUDIO,this)),l&&(a=RT(l,dt.VIDEO,this));const c={};u&&l?c.audiovideo={container:"video/mp4",codec:i+","+a,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:u?c.audio={container:"audio/mp4",codec:i,encrypted:u.encrypted,initSegment:e,id:"audio"}:l?c.video={container:"video/mp4",codec:a,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=c}remux(e,t,i,a,u,l){var c,f;let{initPTS:h,lastEndTime:m}=this;const g={audio:void 0,video:void 0,text:a,id3:i,initSegment:void 0};Ee(m)||(m=this.lastEndTime=u||0);const E=t.samples;if(!E.length)return g;const T={initPTS:void 0,timescale:void 0,trackId:void 0};let v=this.initData;if((c=v)!=null&&c.length||(this.generateInitSegment(E),v=this.initData),!((f=v)!=null&&f.length))return this.warn("Failed to generate initSegment."),g;this.emitInitSegment&&(T.tracks=this.initTracks,this.emitInitSegment=!1);const S=$D(E,v,this),A=v.audio?S[v.audio.id]:null,I=v.video?S[v.video.id]:null,R=Kc(I,1/0),N=Kc(A,1/0),D=Kc(I,0,!0),k=Kc(A,0,!0);let G=u,U=0;const H=A&&(!I||!h&&N<R||h&&h.trackId===v.audio.id),$=H?A:I;if($){const te=$.timescale,J=$.start-u*te,pe=H?v.audio.id:v.video.id;G=$.start/te,U=H?k-N:D-R,(l||!h)&&(ew(h,G,u,U)||te!==h.timescale)&&(h&&this.warn(`Timestamps at playlist time: ${l?"":"~"}${u} ${J/te} != initPTS: ${h.baseTime/h.timescale} (${h.baseTime}/${h.timescale}) trackId: ${h.trackId}`),this.log(`Found initPTS at playlist time: ${u} offset: ${G-u} (${J}/${te}) trackId: ${pe}`),h=null,T.initPTS=J,T.timescale=te,T.trackId=pe)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${u}`);h?(T.initPTS=h.baseTime,T.timescale=h.timescale,T.trackId=h.trackId):((!T.timescale||T.trackId===void 0||T.initPTS===void 0)&&(this.warn("Could not set initPTS"),T.initPTS=G,T.timescale=1,T.trackId=-1),this.initPTS=h={baseTime:T.initPTS,timescale:T.timescale,trackId:T.trackId});const F=G-h.baseTime/h.timescale,ee=F+U;U>0?this.lastEndTime=ee:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const me=!!v.audio,be=!!v.video;let Te="";me&&(Te+="audio"),be&&(Te+="video");const ne=(v.audio?v.audio.encrypted:!1)||(v.video?v.video.encrypted:!1),B={data1:E,startPTS:F,startDTS:F,endPTS:ee,endDTS:ee,type:Te,hasAudio:me,hasVideo:be,nb:1,dropped:0,encrypted:ne};g.audio=me&&!be?B:void 0,g.video=be?B:void 0;const W=I==null?void 0:I.sampleCount;if(W){const te=I.keyFrameIndex,J=te!==-1;B.nb=W,B.dropped=te===0||this.isVideoContiguous?0:J?te:W,B.independent=J,B.firstKeyFrame=te,J&&I.keyFrameStart&&(B.firstKeyFramePTS=(I.keyFrameStart-h.baseTime)/h.timescale),this.isVideoContiguous||(g.independent=J),this.isVideoContiguous||(this.isVideoContiguous=J),B.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${te}/${W} dropped: ${B.dropped} start: ${B.firstKeyFramePTS||"NA"}`)}return g.initSegment=T,g.id3=Gv(i,u,h,h),a.samples.length&&(g.text=Vv(a,u,h)),g}}function Kc(s,e,t=!1){return(s==null?void 0:s.start)!==void 0?(s.start+(t?s.duration:0))/s.timescale:e}function ew(s,e,t,i){if(s===null)return!0;const a=Math.max(i,1),u=e-s.baseTime/s.timescale;return Math.abs(u-t)>a}function RT(s,e,t){const i=s.codec;return i&&i.length>4?i:e===dt.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?Nd(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let vn;try{vn=self.performance.now.bind(self.performance)}catch{vn=Date.now}const od=[{demux:FO,remux:JO},{demux:ra,remux:ld},{demux:MO,remux:ld},{demux:UO,remux:ld}];od.splice(2,0,{demux:PO,remux:ld});class NT{constructor(e,t,i,a,u,l){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=u,this.logger=l}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,a){const u=i.transmuxing;u.executeStart=vn();let l=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:f}=this;a&&(this.currentTransmuxState=a);const{contiguous:h,discontinuity:m,trackSwitch:g,accurateTimeOffset:E,timeOffset:T,initSegmentChange:v}=a||c,{audioCodec:S,videoCodec:A,defaultInitPts:I,duration:R,initSegmentData:N}=f,D=tw(l,t);if(D&&ru(D.method)){const H=this.getDecrypter(),$=Lg(D.method);if(H.isSync()){let F=H.softwareDecrypt(l,D.key.buffer,D.iv.buffer,$);if(i.part>-1){const me=H.flush();F=me&&me.buffer}if(!F)return u.executeEnd=vn(),V0(i);l=new Uint8Array(F)}else return this.asyncResult=!0,this.decryptionPromise=H.webCryptoDecrypt(l,D.key.buffer,D.iv.buffer,$).then(F=>{const ee=this.push(F,null,i);return this.decryptionPromise=null,ee}),this.decryptionPromise}const k=this.needsProbing(m,g);if(k){const H=this.configureTransmuxer(l);if(H)return this.logger.warn(`[transmuxer] ${H.message}`),this.observer.emit(L.ERROR,L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!1,error:H,reason:H.message}),u.executeEnd=vn(),V0(i)}(m||g||v||k)&&this.resetInitSegment(N,S,A,R,t),(m||v||k)&&this.resetInitialTimestamp(I),h||this.resetContiguity();const G=this.transmux(l,D,T,E,i);this.asyncResult=to(G);const U=this.currentTransmuxState;return U.contiguous=!0,U.discontinuity=!1,U.trackSwitch=!1,u.executeEnd=vn(),G}flush(e){const t=e.transmuxing;t.executeStart=vn();const{decrypter:i,currentTransmuxState:a,decryptionPromise:u}=this;if(u)return this.asyncResult=!0,u.then(()=>this.flush(e));const l=[],{timeOffset:c}=a;if(i){const g=i.flush();g&&l.push(this.push(g.buffer,null,e))}const{demuxer:f,remuxer:h}=this;if(!f||!h){t.executeEnd=vn();const g=[V0(e)];return this.asyncResult?Promise.resolve(g):g}const m=f.flush(c);return to(m)?(this.asyncResult=!0,m.then(g=>(this.flushRemux(l,g,e),l))):(this.flushRemux(l,m,e),this.asyncResult?Promise.resolve(l):l)}flushRemux(e,t,i){const{audioTrack:a,videoTrack:u,id3Track:l,textTrack:c}=t,{accurateTimeOffset:f,timeOffset:h}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===ye.MAIN?"level":"track"} ${i.level}`);const m=this.remuxer.remux(a,u,l,c,h,f,!0,this.id);e.push({remuxResult:m,chunkMeta:i}),i.transmuxing.executeEnd=vn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,a,u){const{demuxer:l,remuxer:c}=this;!l||!c||(l.resetInitSegment(e,t,i,a),c.resetInitSegment(e,t,i,u))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,a,u){let l;return t&&t.method==="SAMPLE-AES"?l=this.transmuxSampleAes(e,t,i,a,u):l=this.transmuxUnencrypted(e,i,a,u),l}transmuxUnencrypted(e,t,i,a){const{audioTrack:u,videoTrack:l,id3Track:c,textTrack:f}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(u,l,c,f,t,i,!1,this.id),chunkMeta:a}}transmuxSampleAes(e,t,i,a,u){return this.demuxer.demuxSampleAes(e,t,i).then(l=>({remuxResult:this.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,i,a,!1,this.id),chunkMeta:u}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:a}=this;let u;for(let g=0,E=od.length;g<E;g++){var l;if((l=od[g].demux)!=null&&l.probe(e,this.logger)){u=od[g];break}}if(!u)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,f=this.remuxer,h=u.remux,m=u.demux;(!f||!(f instanceof h))&&(this.remuxer=new h(i,t,a,this.logger)),(!c||!(c instanceof m))&&(this.demuxer=new m(i,t,a,this.logger),this.probe=m.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Ag(this.config)),e}}function tw(s,e){let t=null;return s.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const V0=s=>({remuxResult:{},chunkMeta:s});function to(s){return"then"in s&&s.then instanceof Function}class sw{constructor(e,t,i,a,u){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=a,this.defaultInitPts=u||null}}class iw{constructor(e,t,i,a,u,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=a,this.timeOffset=u,this.initSegmentChange=l}}let CT=0;class qv{constructor(e,t,i,a){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=CT++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=f=>{const h=f.data,m=this.hls;if(!(!m||!(h!=null&&h.event)||h.instanceNo!==this.instanceNo))switch(h.event){case"init":{var g;const E=(g=this.workerContext)==null?void 0:g.objectURL;E&&self.URL.revokeObjectURL(E);break}case"transmuxComplete":{this.handleTransmuxComplete(h.data);break}case"flush":{this.onFlush(h.data);break}case"workerLog":{m.logger[h.data.logType]&&m.logger[h.data.logType](h.data.message);break}default:{h.data=h.data||{},h.data.frag=this.frag,h.data.part=this.part,h.data.id=this.id,m.trigger(h.event,h.data);break}}},this.onWorkerError=f=>{if(!this.hls)return;const h=new Error(`${f.message}  (${f.filename}:${f.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(L.ERROR,{type:Ae.OTHER_ERROR,details:Y.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:h})};const u=e.config;this.hls=e,this.id=t,this.useWorker=!!u.enableWorker,this.onTransmuxComplete=i,this.onFlush=a;const l=(f,h)=>{h=h||{},h.frag=this.frag||void 0,f===L.ERROR&&(h=h,h.parent=this.id,h.part=this.part,this.error=h.error),this.hls.trigger(f,h)};this.observer=new Ng,this.observer.on(L.FRAG_DECRYPTED,l),this.observer.on(L.ERROR,l);const c=qx(u.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const f=this.hls.logger;if(u.workerPath||uO()){try{u.workerPath?(f.log(`loading Web Worker ${u.workerPath} for "${t}"`),this.workerContext=oO(u.workerPath)):(f.log(`injecting Web Worker for "${t}"`),this.workerContext=lO());const{worker:m}=this.workerContext;m.addEventListener("message",this.onWorkerMessage),m.addEventListener("error",this.onWorkerError),m.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:t,config:ft(u)})}catch(m){f.warn(`Error setting up "${t}" Web Worker, fallback to inline`,m),this.terminateWorker(),this.error=null,this.transmuxer=new NT(this.observer,c,u,"",t,e.logger)}return}}this.transmuxer=new NT(this.observer,c,u,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=CT++;const t=this.hls.config,i=qx(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:ft(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),cO(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,a,u,l,c,f,h,m){var g,E;h.transmuxing.start=self.performance.now();const{instanceNo:T,transmuxer:v}=this,S=l?l.start:u.start,A=u.decryptdata,I=this.frag,R=!(I&&u.cc===I.cc),N=!(I&&h.level===I.level),D=I?h.sn-I.sn:-1,k=this.part?h.part-this.part.index:-1,G=D===0&&h.id>1&&h.id===(I==null?void 0:I.stats.chunkCount),U=!N&&(D===1||D===0&&(k===1||G&&k<=0)),H=self.performance.now();(N||D||u.stats.parsing.start===0)&&(u.stats.parsing.start=H),l&&(k||!U)&&(l.stats.parsing.start=H);const $=!(I&&((g=u.initSegment)==null?void 0:g.url)===((E=I.initSegment)==null?void 0:E.url)),F=new iw(R,U,f,N,S,$);if(!U||R||$){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${u.type} sn: ${h.sn}${h.part>-1?" part: "+h.part:""} ${this.id===ye.MAIN?"level":"track"}: ${h.level} id: ${h.id}
        discontinuity: ${R}
        trackSwitch: ${N}
        contiguous: ${U}
        accurateTimeOffset: ${f}
        timeOffset: ${S}
        initSegmentChange: ${$}`);const ee=new sw(i,a,t,c,m);this.configureTransmuxer(ee)}if(this.frag=u,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:T,cmd:"demux",data:e,decryptdata:A,chunkMeta:h,state:F},e instanceof ArrayBuffer?[e]:[]);else if(v){const ee=v.push(e,A,h,F);to(ee)?ee.then(me=>{this.handleTransmuxComplete(me)}).catch(me=>{this.transmuxerError(me,h,"transmuxer-interface push error")}):this.handleTransmuxComplete(ee)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const a=i.flush(e);to(a)?a.then(u=>{this.handleFlushResult(u,e)}).catch(u=>{this.transmuxerError(u,e,"transmuxer-interface flush error")}):this.handleFlushResult(a,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const DT=100;class nw extends Rg{constructor(e,t,i){super(e,t,i,"audio-stream-controller",ye.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:a,timescale:u,trackId:l}){if(i===ye.MAIN){const c=t.cc,f=this.fragCurrent;if(this.initPTS[c]={baseTime:a,timescale:u,trackId:l},this.log(`InitPTS for cc: ${c} found from main: ${a/u} (${a}/${u}) trackId: ${l}`),this.mainAnchor=t,this.state===ue.WAITING_INIT_PTS){const h=this.waitingData;(!h&&!this.loadingParts||h&&h.frag.cc!==c)&&this.syncWithAnchor(t,h==null?void 0:h.frag)}else!this.hls.hasEnoughToStart&&f&&f.cc!==c?(f.abortRequests(),this.syncWithAnchor(t,f)):this.state===ue.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;const a=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&(a==null?void 0:a.cc)===t.cc)return;const u=(a||e).cc,l=this.getLevelDetails(),c=this.getLoadPosition(),f=uv(l,u,c);f&&(this.log(`Syncing with main frag at ${f.start} cc ${f.cc}`),this.startFragRequested=!1,this.nextLoadPosition=f.start,this.resetLoadingState(),this.state===ue.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ue.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(DT),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=ue.IDLE):this.state=ue.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ue.IDLE:this.doTickIdle();break;case ue.WAITING_TRACK:{const{levels:e,trackId:t}=this,i=e==null?void 0:e[t],a=i==null?void 0:i.details;if(a&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(a))break;this.state=ue.WAITING_INIT_PTS}break}case ue.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ue.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:i,cache:a,complete:u}=e,l=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=ue.FRAG_LOADING;const c=a.flush().buffer,f={frag:t,part:i,payload:c,networkDetails:null};this._handleFragmentLoadProgress(f),u&&super._handleFragmentLoadComplete(f)}else l&&l.cc!==e.frag.cc&&this.syncWithAnchor(l,e.frag)}else this.state=ue.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:a,trackId:u}=this,l=t.config;if(!this.buffering||!a&&!this.primaryPrefetch&&(this.startFragRequested||!l.startFragPrefetch)||!(i!=null&&i[u]))return;const c=i[u],f=c.details;if(!f||this.waitForLive(c)||this.waitForCdnTuneIn(f)){this.state=ue.WAITING_TRACK,this.startFragRequested=!1;return}const h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,dt.AUDIO,ye.AUDIO));const m=this.getFwdBufferInfo(h,ye.AUDIO);if(m===null)return;if(!this.switchingTrack&&this._streamEnded(m,f)){t.trigger(L.BUFFER_EOS,{type:"audio"}),this.state=ue.ENDED;return}const g=m.len,E=t.maxBufferLength,T=f.fragments,v=T[0].start,S=this.getLoadPosition(),A=this.flushing?S:m.end;if(this.switchingTrack&&a){const N=S;f.PTSKnown&&N<v&&(m.end>v||m.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),a.currentTime=v+.05)}if(g>=E&&!this.switchingTrack&&A<T[T.length-1].start)return;let I=this.getNextFragment(A,f);if(I&&this.isLoopLoading(I,A)&&(I=this.getNextFragmentLoopLoading(I,f,m,ye.MAIN,E)),!I){this.bufferFlushed=!0;return}let R=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&R&&Ct(I)&&!I.endList&&(!f.live||!this.loadingParts&&A<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(R)===Kt.OK&&(this.mainFragLoading=R=null),R&&Ct(R))){if(I.start>R.end){const D=this.fragmentTracker.getFragAtPos(A,ye.MAIN);D&&D.end>R.end&&(R=D,this.mainFragLoading={frag:D,targetBufferTime:null})}if(I.start>R.end)return}this.loadFragment(I,c,A)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new Zl(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:a}=this;a&&(a.abortRequests(),this.removeUnbufferedFrags(a.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ue.STOPPED&&(this.setInterval(DT),this.state=ue.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(L.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:a}=this,{details:u,id:l,groupId:c,track:f}=t;if(!a){this.warn(`Audio tracks reset while loading track ${l} "${f.name}" of "${c}"`);return}const h=this.mainDetails;if(!h||u.endCC>h.endCC||h.expired){this.cachedTrackLoadedData=t,this.state!==ue.STOPPED&&(this.state=ue.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${l} "${f.name}" of "${c}" loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""},duration:${u.totalduration}`);const m=a[l];let g=0;if(u.live||(i=m.details)!=null&&i.live){if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;if(m.details){var E;g=this.alignPlaylists(u,m.details,(E=this.levelLastLoaded)==null?void 0:E.details)}u.alignedSliding||(_v(u,h),u.alignedSliding||Pd(u,h),g=u.fragmentStart)}m.details=u,this.levelLastLoaded=m,this.startFragRequested||this.setStartPosition(h,g),this.hls.trigger(L.AUDIO_TRACK_UPDATED,{details:u,id:l,groupId:t.groupId}),this.state===ue.WAITING_TRACK&&!this.waitForCdnTuneIn(u)&&(this.state=ue.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:a,payload:u}=e,{config:l,trackId:c,levels:f}=this;if(!f){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const h=f[c];if(!h){this.warn("Audio track is undefined on fragment load progress");return}const m=h.details;if(!m){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const g=l.defaultAudioCodec||h.audioCodec||"mp4a.40.2";let E=this.transmuxer;E||(E=this.transmuxer=new qv(this.hls,ye.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const T=this.initPTS[i.cc],v=(t=i.initSegment)==null?void 0:t.data;if(T!==void 0){const A=a?a.index:-1,I=A!==-1,R=new _g(i.level,i.sn,i.stats.chunkCount,u.byteLength,A,I);E.push(u,v,g,"",i,a,m.totalduration,!1,R,T)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${m.startSN} ,${m.endSN}],track ${c}`);const{cache:S}=this.waitingData=this.waitingData||{frag:i,part:a,cache:new Lv,complete:!1};S.push(new Uint8Array(u)),this.state!==ue.STOPPED&&(this.state=ue.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ye.MAIN&&Ct(t.frag)&&(this.mainFragLoading=t,this.state===ue.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:a}=t;if(i.type!==ye.AUDIO){!this.audioOnly&&i.type===ye.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${a?" p: "+a.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Ct(i)){this.fragPrevious=i;const u=this.switchingTrack;u&&(this.bufferedTrack=u,this.switchingTrack=null,this.hls.trigger(L.AUDIO_TRACK_SWITCHED,it({},u)))}this.fragBufferedComplete(i,a),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=ue.ERROR;return}switch(t.details){case Y.FRAG_GAP:case Y.FRAG_PARSING_ERROR:case Y.FRAG_DECRYPT_ERROR:case Y.FRAG_LOAD_ERROR:case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_ERROR:case Y.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ye.AUDIO,t);break;case Y.AUDIO_TRACK_LOAD_ERROR:case Y.AUDIO_TRACK_LOAD_TIMEOUT:case Y.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ue.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===Fe.AUDIO_TRACK&&(this.state=ue.IDLE);break;case Y.BUFFER_ADD_CODEC_ERROR:case Y.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Y.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Y.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==dt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==dt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ue.ENDED&&(this.state=ue.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,ye.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:a}=this,{remuxResult:u,chunkMeta:l}=e,c=this.getCurrentContext(l);if(!c){this.resetWhenMissingContext(l);return}const{frag:f,part:h,level:m}=c,{details:g}=m,{audio:E,text:T,id3:v,initSegment:S}=u;if(this.fragContextChanged(f)||!g){this.fragmentTracker.removeFragment(f);return}if(this.state=ue.PARSING,this.switchingTrack&&E&&this.completeAudioSwitch(this.switchingTrack),S!=null&&S.tracks){const A=f.initSegment||f;if(this.unhandledEncryptionError(S,f))return;this._bufferInitSegment(m,S.tracks,A,l),a.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:A,id:i,tracks:S.tracks})}if(E){const{startPTS:A,endPTS:I,startDTS:R,endDTS:N}=E;h&&(h.elementaryStreams[dt.AUDIO]={startPTS:A,endPTS:I,startDTS:R,endDTS:N}),f.setElementaryStreamInfo(dt.AUDIO,A,I,R,N),this.bufferFragmentData(E,f,h,l)}if(v!=null&&(t=v.samples)!=null&&t.length){const A=ot({id:i,frag:f,details:g},v);a.trigger(L.FRAG_PARSING_METADATA,A)}if(T){const A=ot({id:i,frag:f,details:g},T);a.trigger(L.FRAG_PARSING_USERDATA,A)}}_bufferInitSegment(e,t,i,a){if(this.state!==ue.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const u=t.audio;u.id=ye.AUDIO;const l=e.audioCodec;this.log(`Init audio buffer, container:${u.container}, codecs[level/parsed]=[${l}/${u.codec}]`),l&&l.split(",").length===1&&(u.levelCodec=l),this.hls.trigger(L.BUFFER_CODECS,t);const c=u.initSegment;if(c!=null&&c.byteLength){const f={type:"audio",frag:i,part:null,chunkMeta:a,parent:i.type,data:c};this.hls.trigger(L.BUFFER_APPENDING,f)}this.tickImmediate()}loadFragment(e,t,i){const a=this.fragmentTracker.getState(e);if(this.switchingTrack||a===Kt.NOT_LOADED||a===Kt.PARTIAL){var u;if(!Ct(e))this._loadInitSegment(e,t);else if((u=t.details)!=null&&u.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ue.WAITING_INIT_PTS;const l=this.mainDetails;l&&l.fragmentStart!==t.details.fragmentStart&&Pd(t.details,l)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:a,characteristics:u,audioCodec:l,channels:c}=this.bufferedTrack;er({name:t,lang:i,assocLang:a,characteristics:u,audioCodec:l,channels:c},e,Va)||(Dd(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(L.AUDIO_TRACK_SWITCHED,it({},e))}}class Pg extends gi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const a=t==null?void 0:t.renditionReports;if(a){let u=-1;for(let l=0;l<a.length;l++){const c=a[l];let f;try{f=new self.URL(c.URI,t.url).href}catch(h){this.warn(`Could not construct new URL for Rendition Report: ${h}`),f=c.URI||""}if(f===e){u=l;break}else f===e.substring(0,f.length)&&(u=l)}if(u!==-1){const l=a[u],c=parseInt(l["LAST-MSN"])||t.lastPartSn;let f=parseInt(l["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const m=Math.min(t.age-t.partTarget,t.targetduration);f>=0&&m>t.partTarget&&(f+=1)}const h=i&&Yx(i);return new Kx(c,f>=0?f:void 0,h)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:a,stats:u}=t,l=self.performance.now(),c=u.loading.first?Math.max(0,l-u.loading.first):0;a.advancedDateTime=Date.now()-c;const f=this.hls.config.timelineOffset;if(f!==a.appliedTimelineOffset){const m=Math.max(f||0,0);a.appliedTimelineOffset=m,a.fragments.forEach(g=>{g.setStart(g.playlistOffset+m)})}if(a.live||i!=null&&i.live){const m="levelInfo"in t?t.levelInfo:t.track;if(a.reloaded(i),i&&a.fragments.length>0){X8(i,a,this);const R=a.playlistParsingError;if(R){this.warn(R);const N=this.hls;if(!N.config.ignorePlaylistParsingErrors){var h;const{networkDetails:D}=t;N.trigger(L.ERROR,{type:Ae.NETWORK_ERROR,details:Y.LEVEL_PARSING_ERROR,fatal:!1,url:a.url,error:R,reason:R.message,level:t.level||void 0,parent:(h=a.fragments[0])==null?void 0:h.type,networkDetails:D,stats:u});return}a.playlistParsingError=null}}a.requestScheduled===-1&&(a.requestScheduled=u.loading.start);const g=this.hls.mainForwardBufferInfo,E=g?g.end-g.len:0,T=(a.edge-E)*1e3,v=Tv(a,T);if(a.requestScheduled+v<l?a.requestScheduled=l:a.requestScheduled+=v,this.log(`live playlist ${e} ${a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:a.updated?"UPDATED":"MISSED"}`),!this.canLoad||!a.live)return;let S,A,I;if(a.canBlockReload&&a.endSN&&a.advanced){const R=this.hls.config.lowLatencyMode,N=a.lastPartSn,D=a.endSN,k=a.lastPartIndex,G=k!==-1,U=N===D;G?U?(A=D+1,I=R?0:k):(A=N,I=R?k+1:a.maxPartIndex):A=D+1;const H=a.age,$=H+a.ageHeader;let F=Math.min($-a.partTarget,a.targetduration*1.5);if(F>0){if($>a.targetduration*3)this.log(`Playlist last advanced ${H.toFixed(2)}s ago. Omitting segment and part directives.`),A=void 0,I=void 0;else if(i!=null&&i.tuneInGoal&&$-a.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${F} with playlist age: ${a.age}`),F=0;else{const ee=Math.floor(F/a.targetduration);if(A+=ee,I!==void 0){const me=Math.round(F%a.targetduration/a.partTarget);I+=me}this.log(`CDN Tune-in age: ${a.ageHeader}s last advanced ${H.toFixed(2)}s goal: ${F} skip sn ${ee} to part ${I}`)}a.tuneInGoal=F}if(S=this.getDeliveryDirectives(a,t.deliveryDirectives,A,I),R||!U){a.requestScheduled=l,this.loadingPlaylist(m,S);return}}else(a.canBlockReload||a.canSkipUntil)&&(S=this.getDeliveryDirectives(a,t.deliveryDirectives,A,I));S&&A!==void 0&&a.canBlockReload&&(a.requestScheduled=u.loading.first+Math.max(v-c*2,v/2)),this.scheduleLoading(m,S,a)}else this.clearTimer()}scheduleLoading(e,t,i){const a=i||e.details;if(!a){this.loadingPlaylist(e,t);return}const u=self.performance.now(),l=a.requestScheduled;if(u>=l){this.loadingPlaylist(e,t);return}const c=l-u;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),c)}getDeliveryDirectives(e,t,i,a){let u=Yx(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,a=t.part,u=rd.No),new Kx(i,a,u)}checkRetry(e){const t=e.details,i=Od(e),a=e.errorAction,{action:u,retryCount:l=0,retryConfig:c}=a||{},f=!!a&&!!c&&(u===ds.RetryRequest||!a.resolved&&u===ds.SendAlternateToPenaltyBox);if(f){var h;if(l>=c.maxNumRetry)return!1;if(i&&(h=e.context)!=null&&h.deliveryDirectives)this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const m=Sg(c,l);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),m),this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${t}" in ${m}ms`)}e.levelRetry=!0,a.resolved=!0}return f}}function Yv(s,e){if(s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(!so(s[t].attrs,e[t].attrs))return!1;return!0}function so(s,e,t){const i=s["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(a=>s[a]!==e[a])}function Pm(s,e){return e.label.toLowerCase()===s.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(s.lang||"").toLowerCase())}class aw extends Pg{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:a,details:u}=t,l=this.tracksInGroup[i];if(!l||l.groupId!==a){this.warn(`Audio track with id:${i} and group:${a} not found in active group ${l==null?void 0:l.groupId}`);return}const c=l.details;l.details=t.details,this.log(`Audio track ${i} "${l.name}" lang:${l.lang} group:${a} loaded [${u.startSN}-${u.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,a=this.groupIds;let u=this.currentTrack;if(!i||(a==null?void 0:a.length)!==(i==null?void 0:i.length)||i!=null&&i.some(c=>(a==null?void 0:a.indexOf(c))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(E=>!i||i.indexOf(E.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(E=>E.default)&&(this.selectDefaultTrack=!1),c.forEach((E,T)=>{E.id=T});else if(!u&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const f=this.hls.config.audioPreference;if(!u&&f){const E=Vi(f,c,Va);if(E>-1)u=c[E];else{const T=Vi(f,this.tracks);u=this.tracks[T]}}let h=this.findTrackId(u);h===-1&&u&&(h=this.findTrackId(null));const m={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${i==null?void 0:i.join(",")}`),this.hls.trigger(L.AUDIO_TRACKS_UPDATED,m);const g=this.trackId;if(h!==-1&&g===-1)this.setAudioTrack(h);else if(c.length&&g===-1){var l;const E=new Error(`No audio track selected for current audio group-ID(s): ${(l=this.groupIds)==null?void 0:l.join(",")} track count: ${c.length}`);this.warn(E.message),this.hls.trigger(L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:E})}}}onError(e,t){t.fatal||!t.context||t.context.type===Fe.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const a=this.currentTrack;if(a&&er(e,a,Va))return a;const u=Vi(e,this.tracksInGroup,Va);if(u>-1){const l=this.tracksInGroup[u];return this.setAudioTrack(u),l}else if(a){let l=t.loadLevel;l===-1&&(l=t.firstAutoLevel);const c=b8(e,t.levels,i,l,Va);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const l=Vi(e,i);if(l>-1)return i[l]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,a=t[e],u=a.details&&!a.details.live;if(e===this.trackId&&a===i&&u||(this.log(`Switching to audio-track ${e} "${a.name}" lang:${a.lang} group:${a.groupId} channels:${a.channels}`),this.trackId=e,this.currentTrack=a,this.hls.trigger(L.AUDIO_TRACK_SWITCHING,it({},a)),u))return;const l=this.switchParams(a.url,i==null?void 0:i.details,a.details);this.loadPlaylist(l)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const a=t[i];if(!(this.selectDefaultTrack&&!a.default)&&(!e||er(e,a,Va)))return i}if(e){const{name:i,lang:a,assocLang:u,characteristics:l,audioCodec:c,channels:f}=e;for(let h=0;h<t.length;h++){const m=t[h];if(er({name:i,lang:a,assocLang:u,characteristics:l,audioCodec:c,channels:f},m,Va))return h}for(let h=0;h<t.length;h++){const m=t[h];if(so(e.attrs,m.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return h}for(let h=0;h<t.length;h++){const m=t[h];if(so(e.attrs,m.attrs,["LANGUAGE"]))return h}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Dd(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,a=e.groupId,u=this.getUrlWithDirectives(e.url,t),l=e.details,c=l==null?void 0:l.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${a}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${u}`),this.hls.trigger(L.AUDIO_TRACK_LOADING,{url:u,id:i,groupId:a,deliveryDirectives:t||null,track:e})}}class rw{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const a=this.queues[t];a.push(e),a.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const a=t[0];try{a.execute()}catch(u){var i;if(a.onError(u),this.queues===null||this.tracks===null)return;const l=(i=this.tracks[e])==null?void 0:i.buffer;l!=null&&l.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],a=i==null?void 0:i.buffer;return a?`SourceBuffer${a.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const OT=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Kv="HlsJsTrackRemovedError";class uw extends Error{constructor(e){super(e),this.name=Kv}}class lw extends gi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var a;this.hls&&((a=this.mediaSource)==null?void 0:a.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:a,mediaSource:u}=this;i&&this.log("Media source opened"),!(!a||!u)&&(u.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(L.MEDIA_ATTACHED,{media:a,mediaSource:u}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:a}=this;i!==a&&this.error(`Media element src was set while attaching MediaSource (${a} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=CD(Ea(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_APPENDING,this.onBufferAppending,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.BUFFER_EOS,this.onBufferEos,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.FRAG_PARSED,this.onFragParsed,this),e.on(L.FRAG_CHANGED,this.onFragChanged,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_APPENDING,this.onBufferAppending,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_EOS,this.onBufferEos,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.FRAG_PARSED,this.onFragParsed,this),e.off(L.FRAG_CHANGED,this.onFragChanged,this),e.off(L.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const u=this.isUpdating();u||this.operationQueue.removeBlockers();const l=this.isQueued();(u||l)&&this.warn(`Transfering MediaSource with${l?" operations in queue":""}${u?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const a=this.transferData;return!this.sourceBufferCount&&a&&a.mediaSource===t?ot(i,a.tracks):this.sourceBuffers.forEach(u=>{const[l]=u;l&&(i[l]=ot({},this.tracks[l]),this.removeBuffer(l)),u[0]=u[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let a=2;(t.audio&&!t.video||!t.altAudio)&&(a=1),this.bufferCodecEventsTotal=a,this.log(`${a} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&a&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media;this.transferData=this.overrides=void 0;const a=Ea(this.appendSource);if(a){const u=!!t.mediaSource;(u||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const l=this.mediaSource=t.mediaSource||new a;if(this.assignMediaSource(l),u)this._objectUrl=i.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{i.removeAttribute("src");const f=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||f&&l instanceof f,wT(i),ow(i,c),i.load()}catch{i.src=c}else i.src=c}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,a=t.tracks,u=a?Object.keys(a):null,l=u?u.length:0,c=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(a&&u&&l){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${ft(i,(f,h)=>f==="initSegment"?void 0:h)};
transfer tracks: ${ft(a,(f,h)=>f==="initSegment"?void 0:h)}}`),!G2(a,i)){t.mediaSource=null,t.tracks=void 0;const f=e.currentTime,h=this.details,m=Math.max(f,(h==null?void 0:h.fragments[0].start)||0);if(m-f>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${f} -> ${m}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(a)}"->"${Object.keys(i)}") start time: ${m} currentTime: ${f}`),this.onMediaDetaching(L.MEDIA_DETACHING,{}),this.onMediaAttaching(L.MEDIA_ATTACHING,t),e.currentTime=m;return}this.transferData=void 0,u.forEach(f=>{const h=f,m=a[h];if(m){const g=m.buffer;if(g){const E=this.fragmentTracker,T=m.id;if(E.hasFragments(T)||E.hasParts(T)){const A=ke.getBuffered(g);E.detectEvictedFragments(h,A,T,null,!0)}const v=q0(h),S=[h,g];this.sourceBuffers[v]=S,g.updating&&this.operationQueue&&this.operationQueue.prependBlocker(h),this.trackSourceBuffer(h,m)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:a,mediaSource:u,_objectUrl:l}=this;if(u){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=u.readyState==="open";try{const f=u.sourceBuffers;for(let h=f.length;h--;)c&&f[h].abort(),u.removeSourceBuffer(f[h]);c&&u.endOfStream()}catch(f){this.warn(`onMediaDetaching: ${f.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}u.removeEventListener("sourceopen",this._onMediaSourceOpen),u.removeEventListener("sourceended",this._onMediaSourceEnded),u.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(u.removeEventListener("startstreaming",this._onStartStreaming),u.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}a&&(a.removeEventListener("emptied",this._onMediaEmptied),i||(l&&self.URL.revokeObjectURL(l),this.mediaSrc===l?(a.removeAttribute("src"),this.appendSource&&wT(a),a.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(L.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var a;(a=this.mediaSource)!=null&&a.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(u){this.warn(`onBufferReset ${e}`,u)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[q0(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new rw(this.tracks)}onBufferCodecs(e,t){var i;const a=this.tracks,u=Object.keys(t);this.log(`BUFFER_CODECS: "${u}" (current SB count ${this.sourceBufferCount})`);const l="audiovideo"in t&&(a.audio||a.video)||a.audiovideo&&("audio"in t||"video"in t),c=!l&&this.sourceBufferCount&&this.media&&u.some(f=>!a[f]);if(l||c){this.warn(`Unsupported transition between "${Object.keys(a)}" and "${u}" SourceBuffers`);return}u.forEach(f=>{var h,m;const g=t[f],{id:E,codec:T,levelCodec:v,container:S,metadata:A,supplemental:I}=g;let R=a[f];const N=(h=this.transferData)==null||(h=h.tracks)==null?void 0:h[f],D=N!=null&&N.buffer?N:R,k=(D==null?void 0:D.pendingCodec)||(D==null?void 0:D.codec),G=D==null?void 0:D.levelCodec;R||(R=a[f]={buffer:void 0,listeners:[],codec:T,supplemental:I,container:S,levelCodec:v,metadata:A,id:E});const U=ad(k,G),H=U==null?void 0:U.replace(OT,"$1");let $=ad(T,v);const F=(m=$)==null?void 0:m.replace(OT,"$1");$&&U&&H!==F&&(f.slice(0,5)==="audio"&&($=Nd($,this.appendSource)),this.log(`switching codec ${k} to ${$}`),$!==(R.pendingCodec||R.codec)&&(R.pendingCodec=$),R.container=S,this.appendChangeType(f,S,$))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((i=t.audio)==null?void 0:i.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const a=`${t};codecs=${i}`,u={label:`change-type=${a}`,execute:()=>{const l=this.tracks[e];if(l){const c=l.buffer;c!=null&&c.changeType&&(this.log(`changing ${e} sourceBuffer type to ${a}`),c.changeType(a),l.codec=i,l.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn(`Failed to change ${e} SourceBuffer type`,l)}};this.append(u,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,a=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,ye.MAIN))==null?void 0:t.gap)===!0)return;const l={label:"block-audio",execute:()=>{var c;const f=this.tracks.video;(this.lastVideoAppendEnd>a||f!=null&&f.buffer&&ke.isBuffered(f.buffer,a)||((c=this.fragmentTracker.getAppendedFrag(a,ye.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:l,frag:e},this.append(l,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:a,type:u,parent:l,frag:c,part:f,chunkMeta:h,offset:m}=t,g=h.buffering[u],{sn:E,cc:T}=c,v=self.performance.now();g.start=v;const S=c.stats.buffering,A=f?f.stats.buffering:null;S.start===0&&(S.start=v),A&&A.start===0&&(A.start=v);const I=i.audio;let R=!1;u==="audio"&&(I==null?void 0:I.container)==="audio/mpeg"&&(R=!this.lastMpegAudioChunk||h.id===1||this.lastMpegAudioChunk.sn!==h.sn,this.lastMpegAudioChunk=h);const N=i.video,D=N==null?void 0:N.buffer;if(D&&E!=="initSegment"){const U=f||c,H=this.blockedAudioAppend;if(u==="audio"&&l!=="main"&&!this.blockedAudioAppend&&!(N.ending||N.ended)){const F=U.start+U.duration*.05,ee=D.buffered,me=this.currentOp("video");!ee.length&&!me?this.blockAudio(U):!me&&!ke.isBuffered(D,F)&&this.lastVideoAppendEnd<F&&this.blockAudio(U)}else if(u==="video"){const $=U.end;if(H){const F=H.frag.start;($>F||$<this.lastVideoAppendEnd||ke.isBuffered(D,F))&&this.unblockAudio()}this.lastVideoAppendEnd=$}}const k=(f||c).start,G={label:`append-${u}`,execute:()=>{var U;g.executeStart=self.performance.now();const H=(U=this.tracks[u])==null?void 0:U.buffer;H&&(R?this.updateTimestampOffset(H,k,.1,u,E,T):m!==void 0&&Ee(m)&&this.updateTimestampOffset(H,m,1e-6,u,E,T)),this.appendExecutor(a,u)},onStart:()=>{},onComplete:()=>{const U=self.performance.now();g.executeEnd=g.end=U,S.first===0&&(S.first=U),A&&A.first===0&&(A.first=U);const H={};this.sourceBuffers.forEach(([$,F])=>{$&&(H[$]=ke.getBuffered(F))}),this.appendErrors[u]=0,u==="audio"||u==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(L.BUFFER_APPENDED,{type:u,frag:c,part:f,chunkMeta:h,parent:c.type,timeRanges:H})},onError:U=>{var H;const $={type:Ae.MEDIA_ERROR,parent:c.type,details:Y.BUFFER_APPEND_ERROR,sourceBufferName:u,frag:c,part:f,chunkMeta:h,error:U,err:U,fatal:!1},F=(H=this.media)==null?void 0:H.error;if(U.code===DOMException.QUOTA_EXCEEDED_ERR||U.name=="QuotaExceededError"||"quota"in U)$.details=Y.BUFFER_FULL_ERROR;else if(U.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!F)$.errorAction=au(!0);else if(U.name===Kv&&this.sourceBufferCount===0)$.errorAction=au(!0);else{const ee=++this.appendErrors[u];this.warn(`Failed ${ee}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${u}" sourceBuffer (${F||"no media error"})`),(ee>=this.hls.config.appendErrorMaxRetry||F)&&($.fatal=!0)}this.hls.trigger(L.ERROR,$)}};this.log(`queuing "${u}" append sn: ${E}${f?" p: "+f.index:""} of ${c.type===ye.MAIN?"level":"track"} ${c.level} cc: ${T}`),this.append(G,u,this.isPending(this.tracks[u]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(L.BUFFER_FLUSHED,{type:e})},onError:a=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,a)}}}onBufferFlushing(e,t){const{type:i,startOffset:a,endOffset:u}=t;i?this.append(this.getFlushOp(i,a,u),i):this.sourceBuffers.forEach(([l])=>{l&&this.append(this.getFlushOp(l,a,u),l)})}onFragParsed(e,t){const{frag:i,part:a}=t,u=[],l=a?a.elementaryStreams:i.elementaryStreams;l[dt.AUDIOVIDEO]?u.push("audiovideo"):(l[dt.AUDIO]&&u.push("audio"),l[dt.VIDEO]&&u.push("video"));const c=()=>{const f=self.performance.now();i.stats.buffering.end=f,a&&(a.stats.buffering.end=f);const h=a?a.stats:i.stats;this.hls.trigger(L.FRAG_BUFFERED,{frag:i,part:a,stats:h,id:i.type})};u.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(c,u).catch(f=>{this.warn(`Fragment buffered callback ${f}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([l])=>{if(l){const c=this.tracks[l];(!t.type||t.type===l)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${l} buffer reached EOS`)))}});const a=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([l])=>{var c;return l&&!((c=this.tracks[l])!=null&&c.ended)})?a?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:l}=this;if(!l||l.readyState!=="open"){l&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${l.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),l.endOfStream(),this.hls.trigger(L.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(L.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Y.BUFFER_APPEND_ERROR&&t.frag){var i;const a=(i=t.errorAction)==null?void 0:i.nextAutoLevel;Ee(a)&&a!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const a=e.config,u=i.currentTime,l=t.levelTargetDuration,c=t.live&&a.liveBackBufferLength!==null?a.liveBackBufferLength:a.backBufferLength;if(Ee(c)&&c>=0){const h=Math.max(c,l),m=Math.floor(u/l)*l-h;this.flushBackBuffer(u,l,m)}const f=a.frontBufferFlushThreshold;if(Ee(f)&&f>0){const h=Math.max(a.maxBufferLength,f),m=Math.max(h,l),g=Math.floor(u/l)*l+m;this.flushFrontBuffer(u,l,g)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([a,u])=>{if(u){const c=ke.getBuffered(u);if(c.length>0&&i>c.start(0)){var l;this.hls.trigger(L.BACK_BUFFER_REACHED,{bufferEnd:i});const f=this.tracks[a];if((l=this.details)!=null&&l.live)this.hls.trigger(L.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(f!=null&&f.ended){this.log(`Cannot flush ${a} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:a})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([a,u])=>{if(u){const l=ke.getBuffered(u),c=l.length;if(c<2)return;const f=l.start(c-1),h=l.end(c-1);if(i>f||e>=f&&e<=h)return;this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:f,endOffset:1/0,type:a})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||(i==null?void 0:i.readyState)!=="open")return null;const a=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&i.setLiveSeekableRange){const h=Math.max(0,t.fragmentStart),m=Math.max(h,a);return{duration:1/0,start:h,end:m}}return{duration:1/0}}const u=(e=this.overrides)==null?void 0:e.duration;if(u)return Ee(u)?{duration:u}:null;const l=this.media.duration,c=Ee(i.duration)?i.duration:0;return a>c&&a>l||!Ee(l)?{duration:a}:null}updateMediaSource({duration:e,start:t,end:i}){const a=this.mediaSource;!this.media||!a||a.readyState!=="open"||(a.duration!==e&&(Ee(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),a.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${a.duration}. Setting seekable range to ${t}-${i}.`),a.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${ft(i)}`),this.tracksReady){var a;const u=(a=this.transferData)==null?void 0:a.tracks;u&&Object.keys(u).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const a=this.tracks[t];e[t]={buffer:i,container:a.container,codec:a.codec,supplemental:a.supplemental,levelCodec:a.levelCodec,id:a.id,metadata:a.metadata}}}),this.hls.trigger(L.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const u in e){const l=u,c=e[l];if(this.isPending(c)){const f=this.getTrackCodec(c,l),h=`${c.container};codecs=${f}`;c.codec=f,this.log(`creating sourceBuffer(${h})${this.currentOp(l)?" Queued":""} ${ft(c)}`);try{const m=i.addSourceBuffer(h),g=q0(l),E=[l,m];t[g]=E,c.buffer=m}catch(m){var a;this.error(`error while trying to add sourceBuffer: ${m.message}`),this.shiftAndExecuteNext(l),(a=this.operationQueue)==null||a.removeBlockers(),delete this.tracks[l],this.hls.trigger(L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,sourceBufferName:l,mimeType:h,parent:c.id});return}this.trackSourceBuffer(l,c)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let a=e.codec;i&&(t==="video"||t==="audiovideo")&&Xl(i,"video")&&(a=ZD(a,i));const u=ad(a,e.levelCodec);return u?t.slice(0,5)==="audio"?Nd(u,this.appendSource):u:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const a=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:a,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(u,l)=>{const c=l.removedRanges;c!=null&&c.length&&this.hls.trigger(L.BUFFER_FLUSHED,{type:u})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i==null?void 0:i.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const a=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${a}`,t),this.hls.trigger(L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:a,fatal:!1});const u=this.currentOp(e);u&&u.onError(a)}updateTimestampOffset(e,t,i,a,u,l){const c=t-e.timestampOffset;Math.abs(c)>=i&&(this.log(`Updating ${a} SourceBuffer timestampOffset to ${t} (sn: ${u} cc: ${l})`),e.timestampOffset=t)}removeExecutor(e,t,i){const{media:a,mediaSource:u}=this,l=this.tracks[e],c=l==null?void 0:l.buffer;if(!a||!u||!c){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const f=Ee(a.duration)?a.duration:1/0,h=Ee(u.duration)?u.duration:1/0,m=Math.max(0,t),g=Math.min(i,f,h);g>m&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${m},${g}] from the ${e} SourceBuffer`),c.remove(m,g)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],a=i==null?void 0:i.buffer;if(!a)throw new uw(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,a.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,a=t.map(l=>this.appendBlocker(l));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(a).then(l=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const a=(i=this.tracks[t])==null?void 0:i.buffer;!a||a.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const a=this.tracks[e];if(!a)return;const u=a.buffer;if(!u)return;const l=i.bind(this,e);a.listeners.push({event:t,listener:l}),u.addEventListener(t,l)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(a=>{i.removeEventListener(a.event,a.listener)}),t.listeners.length=0)}}function wT(s){const e=s.querySelectorAll("source");[].slice.call(e).forEach(t=>{s.removeChild(t)})}function ow(s,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,s.appendChild(t)}function q0(s){return s==="audio"?1:0}class Ug{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Ee(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((a,u)=>this.isLevelAllowed(a)&&u<=e);return this.clientRect=null,Ug.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const a=(c,f)=>f?c.width!==f.width||c.height!==f.height:!0;let u=e.length-1;const l=Math.max(t,i);for(let c=0;c<e.length;c+=1){const f=e[c];if((f.width>=l||f.height>=l)&&a(f,e[c+1])){u=c;break}}return u}}const cw={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},ks=cw,dw={HLS:"h"},fw=dw;class zi{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof zi?i:new zi(i))),this.value=e,this.params=t}}const hw="Dict";function mw(s){return Array.isArray(s)?JSON.stringify(s):s instanceof Map?"Map{}":s instanceof Set?"Set{}":typeof s=="object"?JSON.stringify(s):String(s)}function gw(s,e,t,i){return new Error(`failed to ${s} "${mw(e)}" as ${t}`,{cause:i})}function Qi(s,e,t){return gw("serialize",s,e,t)}class zv{constructor(e){this.description=e}}const kT="Bare Item",pw="Boolean";function bw(s){if(typeof s!="boolean")throw Qi(s,pw);return s?"?1":"?0"}function Ew(s){return btoa(String.fromCharCode(...s))}const xw="Byte Sequence";function Tw(s){if(ArrayBuffer.isView(s)===!1)throw Qi(s,xw);return`:${Ew(s)}:`}const yw="Integer";function vw(s){return s<-999999999999999||999999999999999<s}function Qv(s){if(vw(s))throw Qi(s,yw);return s.toString()}function Sw(s){return`@${Qv(s.getTime()/1e3)}`}function Xv(s,e){if(s<0)return-Xv(-s,e);const t=Math.pow(10,e);if(Math.abs(s*t%1-.5)<Number.EPSILON){const a=Math.floor(s*t);return(a%2===0?a:a+1)/t}else return Math.round(s*t)/t}const Aw="Decimal";function _w(s){const e=Xv(s,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Qi(s,Aw);const t=e.toString();return t.includes(".")?t:`${t}.0`}const Lw="String",Iw=/[\x00-\x1f\x7f]+/;function Rw(s){if(Iw.test(s))throw Qi(s,Lw);return`"${s.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function Nw(s){return s.description||s.toString().slice(7,-1)}const Cw="Token";function MT(s){const e=Nw(s);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Qi(e,Cw);return e}function Um(s){switch(typeof s){case"number":if(!Ee(s))throw Qi(s,kT);return Number.isInteger(s)?Qv(s):_w(s);case"string":return Rw(s);case"symbol":return MT(s);case"boolean":return bw(s);case"object":if(s instanceof Date)return Sw(s);if(s instanceof Uint8Array)return Tw(s);if(s instanceof zv)return MT(s);default:throw Qi(s,kT)}}const Dw="Key";function Bm(s){if(/^[a-z*][a-z0-9\-_.*]*$/.test(s)===!1)throw Qi(s,Dw);return s}function Bg(s){return s==null?"":Object.entries(s).map(([e,t])=>t===!0?`;${Bm(e)}`:`;${Bm(e)}=${Um(t)}`).join("")}function Wv(s){return s instanceof zi?`${Um(s.value)}${Bg(s.params)}`:Um(s)}function Ow(s){return`(${s.value.map(Wv).join(" ")})${Bg(s.params)}`}function ww(s,e={whitespace:!0}){if(typeof s!="object"||s==null)throw Qi(s,hw);const t=s instanceof Map?s.entries():Object.entries(s),i=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([a,u])=>{u instanceof zi||(u=new zi(u));let l=Bm(a);return u.value===!0?l+=Bg(u.params):(l+="=",Array.isArray(u.value)?l+=Ow(u):l+=Wv(u)),l}).join(`,${i}`)}function Zv(s,e){return ww(s,e)}const ki="CMCD-Object",At="CMCD-Request",$a="CMCD-Session",ta="CMCD-Status",kw={br:ki,ab:ki,d:ki,ot:ki,tb:ki,tpb:ki,lb:ki,tab:ki,lab:ki,url:ki,pb:At,bl:At,tbl:At,dl:At,ltc:At,mtp:At,nor:At,nrr:At,rc:At,sn:At,sta:At,su:At,ttfb:At,ttfbb:At,ttlb:At,cmsdd:At,cmsds:At,smrt:At,df:At,cs:At,ts:At,cid:$a,pr:$a,sf:$a,sid:$a,st:$a,v:$a,msd:$a,bs:ta,bsd:ta,cdn:ta,rtp:ta,bg:ta,pt:ta,ec:ta,e:ta},Mw={REQUEST:At};function Pw(s){return Object.keys(s).reduce((e,t)=>{var i;return(i=s[t])===null||i===void 0||i.forEach(a=>e[a]=t),e},{})}function Uw(s,e){const t={};if(!s)return t;const i=Object.keys(s),a=e?Pw(e):{};return i.reduce((u,l)=>{var c;const f=kw[l]||a[l]||Mw.REQUEST,h=(c=u[f])!==null&&c!==void 0?c:u[f]={};return h[l]=s[l],u},t)}function Bw(s){return["ot","sf","st","e","sta"].includes(s)}function Fw(s){return typeof s=="number"?Ee(s):s!=null&&s!==""&&s!==!1}const Jv="event";function jw(s,e){const t=new URL(s),i=new URL(e);if(t.origin!==i.origin)return s;const a=t.pathname.split("/").slice(1),u=i.pathname.split("/").slice(1,-1);for(;a[0]===u[0];)a.shift(),u.shift();for(;u.length;)u.shift(),a.unshift("..");return a.join("/")+t.search+t.hash}const cd=s=>Math.round(s),Fm=(s,e)=>Array.isArray(s)?s.map(t=>Fm(t,e)):s instanceof zi&&typeof s.value=="string"?new zi(Fm(s.value,e),s.params):(e.baseUrl&&(s=jw(s,e.baseUrl)),e.version===1?encodeURIComponent(s):s),zc=s=>cd(s/100)*100,Hw=(s,e)=>{let t=s;return e.version>=2&&(s instanceof zi&&typeof s.value=="string"?t=new zi([s]):typeof s=="string"&&(t=[s])),Fm(t,e)},$w={br:cd,d:cd,bl:zc,dl:zc,mtp:zc,nor:Hw,rtp:zc,tb:cd},eS="request",tS="response",Fg=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Gw=["e"],Vw=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function sf(s){return Vw.test(s)}function qw(s){return Fg.includes(s)||Gw.includes(s)||sf(s)}const sS=["d","dl","nor","ot","rtp","su"];function Yw(s){return Fg.includes(s)||sS.includes(s)||sf(s)}const Kw=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function zw(s){return Fg.includes(s)||sS.includes(s)||Kw.includes(s)||sf(s)}const Qw=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Xw(s){return Qw.includes(s)||sf(s)}const Ww={[tS]:zw,[Jv]:qw,[eS]:Yw};function iS(s,e={}){const t={};if(s==null||typeof s!="object")return t;const i=e.version||s.v||1,a=e.reportingMode||eS,u=i===1?Xw:Ww[a];let l=Object.keys(s).filter(u);const c=e.filter;typeof c=="function"&&(l=l.filter(c));const f=a===tS||a===Jv;f&&!l.includes("ts")&&l.push("ts"),i>1&&!l.includes("v")&&l.push("v");const h=ot({},$w,e.formatters),m={version:i,reportingMode:a,baseUrl:e.baseUrl};return l.sort().forEach(g=>{let E=s[g];const T=h[g];if(typeof T=="function"&&(E=T(E,m)),g==="v"){if(i===1)return;E=i}g=="pr"&&E===1||(f&&g==="ts"&&!Ee(E)&&(E=Date.now()),Fw(E)&&(Bw(g)&&typeof E=="string"&&(E=new zv(E)),t[g]=E))}),t}function Zw(s,e={}){const t={};if(!s)return t;const i=iS(s,e),a=Uw(i,e==null?void 0:e.customHeaderMap);return Object.entries(a).reduce((u,[l,c])=>{const f=Zv(c,{whitespace:!1});return f&&(u[l]=f),u},t)}function Jw(s,e,t){return ot(s,Zw(e,t))}const e5="CMCD";function t5(s,e={}){return s?Zv(iS(s,e),{whitespace:!1}):""}function s5(s,e={}){if(!s)return"";const t=t5(s,e);return encodeURIComponent(t)}function i5(s,e={}){if(!s)return"";const t=s5(s,e);return`${e5}=${t}`}const PT=/CMCD=[^&#]+/;function n5(s,e,t){const i=i5(e,t);if(!i)return s;if(PT.test(s))return s.replace(PT,i);const a=s.includes("?")?"&":"?";return`${s}${a}${i}`}class a5{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=a=>{try{this.apply(a,{ot:ks.MANIFEST,su:!this.initialized})}catch(u){this.hls.logger.warn("Could not generate manifest CMCD data.",u)}},this.applyFragmentData=a=>{try{const{frag:u,part:l}=a,c=this.hls.levels[u.level],f=this.getObjectType(u),h={d:(l||u).duration*1e3,ot:f};(f===ks.VIDEO||f===ks.AUDIO||f==ks.MUXED)&&(h.br=c.bitrate/1e3,h.tb=this.getTopBandwidth(f)/1e3,h.bl=this.getBufferLength(f));const m=l?this.getNextPart(l):this.getNextFrag(u);m!=null&&m.url&&m.url!==u.url&&(h.nor=m.url),this.apply(a,h)}catch(u){this.hls.logger.warn("Could not generate segment CMCD data.",u)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHED,this.onMediaDetached,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHED,this.onMediaDetached,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,a;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(a=t.tracks.video)==null?void 0:a.buffer}createData(){var e;return{v:1,sf:fw.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){ot(t,this.createData());const i=t.ot===ks.INIT||t.ot===ks.VIDEO||t.ot===ks.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:a}=this;a&&(t=Object.keys(t).reduce((l,c)=>(a.includes(c)&&(l[c]=t[c]),l),{}));const u={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),Jw(e.headers,t,u)):e.url=n5(e.url,t,u)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const a=e.sn-i.startSN;return i.fragments[a+1]}}getNextPart(e){var t;const{index:i,fragment:a}=e,u=(t=this.hls.levels[a.level])==null||(t=t.details)==null?void 0:t.partList;if(u){const{sn:l}=a;for(let c=u.length-1;c>=0;c--){const f=u[c];if(f.index===i&&f.fragment.sn===l)return u[c+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return ks.TIMED_TEXT;if(e.sn==="initSegment")return ks.INIT;if(t==="audio")return ks.AUDIO;if(t==="main")return this.hls.audioTracks.length?ks.VIDEO:ks.MUXED}getTopBandwidth(e){let t=0,i;const a=this.hls;if(e===ks.AUDIO)i=a.audioTracks;else{const u=a.maxAutoLevel,l=u>-1?u+1:a.levels.length;i=a.levels.slice(0,l)}return i.forEach(u=>{u.bitrate>t&&(t=u.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===ks.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:ke.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(u){this.loader=void 0,this.loader=new i(u)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(u,l,c){t(u),this.loader.load(u,l,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(u){this.loader=void 0,this.loader=new i(u)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(u,l,c){t(u),this.loader.load(u,l,c)}}}}const r5=3e5;class u5 extends gi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((i==null?void 0:i.action)===ds.SendAlternateToPenaltyBox&&i.flags===Qs.MoveAllAlternatesMatchingHost){const a=this.levels;let u=this._pathwayPriority,l=this.pathwayId;if(t.context){const{groupId:c,pathwayId:f,type:h}=t.context;c&&a?l=this.getPathwayForGroupId(c,h,l):f&&(l=f)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!u&&a&&(u=this.pathways()),u&&u.length>1&&(this.updatePathwayPriority(u),i.resolved=this.pathwayId!==l),t.details===Y.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${l} levels: ${a&&a.length} priorities: ${ft(u)} penalized: ${ft(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,a=performance.now();Object.keys(i).forEach(u=>{a-i[u]>r5&&delete i[u]});for(let u=0;u<e.length;u++){const l=e[u];if(l in i)continue;if(l===this.pathwayId)return;const c=this.hls.nextLoadLevel,f=this.hls.levels[c];if(t=this.getLevelsForPathway(l),t.length>0){this.log(`Setting Pathway to "${l}"`),this.pathwayId=l,Sv(t),this.hls.trigger(L.LEVELS_UPDATED,{levels:t});const h=this.hls.levels[c];f&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==f.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==f.bitrate&&this.log(`Unstable Pathways change from bitrate ${f.bitrate} to ${h.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,i){const a=this.getLevelsForPathway(i).concat(this.levels||[]);for(let u=0;u<a.length;u++)if(t===Fe.AUDIO_TRACK&&a[u].hasAudioGroup(e)||t===Fe.SUBTITLE_TRACK&&a[u].hasSubtitleGroup(e))return a[u].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},a={};e.forEach(u=>{const{ID:l,"BASE-ID":c,"URI-REPLACEMENT":f}=u;if(t.some(m=>m.pathwayId===l))return;const h=this.getLevelsForPathway(c).map(m=>{const g=new Et(m.attrs);g["PATHWAY-ID"]=l;const E=g.AUDIO&&`${g.AUDIO}_clone_${l}`,T=g.SUBTITLES&&`${g.SUBTITLES}_clone_${l}`;E&&(i[g.AUDIO]=E,g.AUDIO=E),T&&(a[g.SUBTITLES]=T,g.SUBTITLES=T);const v=nS(m.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",f),S=new Zl({attrs:g,audioCodec:m.audioCodec,bitrate:m.bitrate,height:m.height,name:m.name,url:v,videoCodec:m.videoCodec,width:m.width});if(m.audioGroups)for(let A=1;A<m.audioGroups.length;A++)S.addGroupId("audio",`${m.audioGroups[A]}_clone_${l}`);if(m.subtitleGroups)for(let A=1;A<m.subtitleGroups.length;A++)S.addGroupId("text",`${m.subtitleGroups[A]}_clone_${l}`);return S});t.push(...h),UT(this.audioTracks,i,f,l),UT(this.subtitleTracks,a,f,l)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let a;try{a=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(a.protocol!=="data:"){const m=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;a.searchParams.set("_HLS_pathway",this.pathwayId),a.searchParams.set("_HLS_throughput",""+m)}const u={responseType:"json",url:a.href},l=t.steeringManifestLoadPolicy.default,c=l.errorRetry||l.timeoutRetry||{},f={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},h={onSuccess:(m,g,E,T)=>{this.log(`Loaded steering manifest: "${a}"`);const v=m.data;if((v==null?void 0:v.VERSION)!==1){this.log(`Steering VERSION ${v.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=v.TTL;const{"RELOAD-URI":S,"PATHWAY-CLONES":A,"PATHWAY-PRIORITY":I}=v;if(S)try{this.uri=new self.URL(S,a).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${S}`);return}this.scheduleRefresh(this.uri||E.url),A&&this.clonePathways(A);const R={steeringManifest:v,url:a.toString()};this.hls.trigger(L.STEERING_MANIFEST_LOADED,R),I&&this.updatePathwayPriority(I)},onError:(m,g,E,T)=>{if(this.log(`Error loading steering manifest: ${m.code} ${m.text} (${g.url})`),this.stopLoad(),m.code===410){this.enabled=!1,this.log(`Steering manifest ${g.url} no longer available`);return}let v=this.timeToLoad*1e3;if(m.code===429){const S=this.loader;if(typeof(S==null?void 0:S.getResponseHeader)=="function"){const A=S.getResponseHeader("Retry-After");A&&(v=parseFloat(A)*1e3)}this.log(`Steering manifest ${g.url} rate limited`);return}this.scheduleRefresh(this.uri||g.url,v)},onTimeout:(m,g,E)=>{this.log(`Timeout loading steering manifest (${g.url})`),this.scheduleRefresh(this.uri||g.url)}};this.log(`Requesting steering manifest: ${a}`),this.loader.load(u,f,h)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const a=(i=this.hls)==null?void 0:i.media;if(a&&!a.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function UT(s,e,t,i){s&&Object.keys(e).forEach(a=>{const u=s.filter(l=>l.groupId===a).map(l=>{const c=ot({},l);return c.details=void 0,c.attrs=new Et(c.attrs),c.url=c.attrs.URI=nS(l.url,l.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[a],c.attrs["PATHWAY-ID"]=i,c});s.push(...u)})}function nS(s,e,t,i){const{HOST:a,PARAMS:u,[t]:l}=i;let c;e&&(c=l==null?void 0:l[e],c&&(s=c));const f=new self.URL(s);return a&&!c&&(f.host=a),u&&Object.keys(u).sort().forEach(h=>{h&&f.searchParams.set(h,u[h])}),f.href}class uu extends gi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=uu.CDMCleanupPromise?[uu.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:i,initData:a}=t,u=`"${t.type}" event: init data type: "${i}"`;if(this.debug(u),a!==null){if(!this.keyFormatPromise){let l=Object.keys(this.keySystemAccessPromises);l.length||(l=Rl(this.config));const c=l.map(U0).filter(f=>!!f);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(l=>{const c=ud(l);if(i!=="sinf"||c!==xt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${i}" for selected key-system ${c}`);return}let f;try{const T=Yt(new Uint8Array(a)),v=Ig(JSON.parse(T).sinf),S=Z2(v);if(!S)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");f=new Uint8Array(S.subarray(8,24))}catch(T){this.warn(`${u} Failed to parse sinf: ${T}`);return}const h=fs(f),{keyIdToKeySessionPromise:m,mediaKeySessions:g}=this;let E=m[h];for(let T=0;T<g.length;T++){const v=g[T],S=v.decryptdata;if(!S.keyId)continue;const A=fs(S.keyId);if(kd(f,S.keyId)||S.uri.replace(/-/g,"").indexOf(h)!==-1){if(E=m[A],!E)continue;if(S.pssh)break;delete m[A],S.pssh=new Uint8Array(a),S.keyId=f,E=m[h]=E.then(()=>this.generateRequestWithPreferredKeySession(v,i,a,"encrypted-event-key-match")),E.catch(I=>this.handleError(I));break}}E||this.handleError(new Error(`Key ID ${h} not encountered in playlist. Key-system sessions ${g.length}.`))}).catch(l=>this.handleError(l))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(L.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,a=t==null?void 0:t[e];if(a)return a.licenseUrl;if(e===xt.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t==null?void 0:t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(l,c,f)=>!!l&&f.indexOf(l)===c,a=t.map(l=>l.audioCodec).filter(i),u=t.map(l=>l.videoCodec).filter(i);return a.length+u.length===0&&u.push("avc1.42e01e"),new Promise((l,c)=>{const f=h=>{const m=h.shift();this.getMediaKeysPromise(m,a,u).then(g=>l({keySystem:m,mediaKeys:g})).catch(g=>{h.length?f(h):g instanceof zs?c(g):c(new zs({type:Ae.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))})};f(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let a=`Configured requestMediaKeySystemAccess is not a function ${i}`;return gv===null&&self.location.protocol==="http:"&&(a=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(a))}return i(e,t)}getMediaKeysPromise(e,t,i){var a;const u=H8(e,t,i,this.config.drmSystemOptions||{});let l=this.keySystemAccessPromises[e],c=(a=l)==null?void 0:a.keySystemAccess;if(!c){this.log(`Requesting encrypted media "${e}" key-system access with config: ${ft(u)}`),c=this.requestMediaKeySystemAccess(e,u);const f=l=this.keySystemAccessPromises[e]={keySystemAccess:c};return c.catch(h=>{this.log(`Failed to obtain access to key-system "${e}": ${h}`)}),c.then(h=>{this.log(`Access for key-system "${h.keySystem}" obtained`);const m=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const g=f.mediaKeys=h.createMediaKeys().then(E=>(this.log(`Media-keys created for "${e}"`),f.hasMediaKeys=!0,m.then(T=>T?this.setMediaKeysServerCertificate(E,e,T):E)));return g.catch(E=>{this.error(`Failed to create media-keys for "${e}"}: ${E}`)}),g})}return c.then(()=>l.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${fs(e.keyId||[])} keyUri: ${e.uri}`);const a=i.createSession(),u={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:a,keyStatus:"status-pending"};return this.mediaKeySessions.push(u),u}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),a=Qc(t),u="cenc";this.keyIdToKeySessionPromise[a]=this.generateRequestWithPreferredKeySession(i,u,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyId ${fs(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),i.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>U0(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:i})=>this.attemptSetMediaKeys(t,i))}selectKeySystem(e){return new Promise((t,i)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:a})=>{const u=U0(a);u?t(u):i(new Error(`Unable to find format for key-system "${a}"`))}).catch(i)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Rl(this.config),i=e.map(ud).filter(a=>!!a&&t.indexOf(a)!==-1);return this.selectKeySystem(i)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let i=0;i<t.length;i++){const a=l5(e,t[i]);if(a)return a}}loadKey(e){const t=e.keyInfo.decryptdata,i=Qc(t),a=this.bannedKeyIds[i];if(a||this.getKeyStatus(t)==="internal-error"){const c=BT(a||"internal-error",t);return this.handleError(c,e.frag),Promise.reject(c)}const u=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${u}`);const l=this.keyIdToKeySessionPromise[i];if(!l){const c=this.getKeySystemForKeyPromise(t).then(({keySystem:f,mediaKeys:h})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${u}`),this.attemptSetMediaKeys(f,h).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:f,mediaKeys:h,decryptdata:t}))))).then(f=>{const h="cenc",m=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(f,h,m,"playlist-key")});return c.catch(f=>this.handleError(f,e.frag)),this.keyIdToKeySessionPromise[i]=c,c}return l.catch(c=>{if(c instanceof zs){const f=it({},c.data);this.getKeyStatus(t)==="internal-error"&&(f.decryptdata=t);const h=new zs(f,c.message);this.handleError(h,e.frag)}}),l}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof zs){t&&(e.data.frag=t);const i=e.data.decryptdata;this.error(`${e.message}${i?` (${fs(i.keyId||[])})`:""}`),this.hls.trigger(L.ERROR,e.data)}else this.error(e.message),this.hls.trigger(L.ERROR,{type:Ae.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Qc(e),i=this.keyIdToKeySessionPromise[t];if(!i){const a=ud(e.keyFormat),u=a?[a]:Rl(this.config);return this.attemptKeySystemAccess(u)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=Rl(this.config)),e.length===0)throw new zs({type:Ae.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${ft({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const a=Promise.all(i).then(()=>this.media?this.media.setMediaKeys(t):new Promise((u,l)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return l(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(u).catch(l)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(a),a.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(a),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(u=>i.indexOf(u)===-1)})}generateRequestWithPreferredKeySession(e,t,i,a){var u;const l=(u=this.config.drmSystems)==null||(u=u[e.keySystem])==null?void 0:u.generateRequest;if(l)try{const v=l.call(this.hls,t,i,e);if(!v)throw new Error("Invalid response from configured generateRequest filter");t=v.initDataType,i=v.initData?v.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(v){if(this.warn(v.message),this.hls&&this.hls.config.debug)throw v}if(i===null)return this.log(`Skipping key-session request for "${a}" (no initData)`),Promise.resolve(e);const c=Qc(e.decryptdata),f=e.decryptdata.uri;this.log(`Generating key-session request for "${a}" keyId: ${c} URI: ${f} (init data type: ${t} length: ${i.byteLength})`);const h=new Ng,m=e._onmessage=v=>{const S=e.mediaKeysSession;if(!S){h.emit("error",new Error("invalid state"));return}const{messageType:A,message:I}=v;this.log(`"${A}" message event for session "${S.sessionId}" message size: ${I.byteLength}`),A==="license-request"||A==="license-renewal"?this.renewLicense(e,I).catch(R=>{h.eventNames().length?h.emit("error",R):this.handleError(R)}):A==="license-release"?e.keySystem===xt.FAIRPLAY&&this.updateKeySession(e,Dm("acknowledged")).then(()=>this.removeSession(e)).catch(R=>this.handleError(R)):this.warn(`unhandled media key message type "${A}"`)},g=(v,S)=>{S.keyStatus=v;let A;v.startsWith("usable")?h.emit("resolved"):v==="internal-error"||v==="output-restricted"||v==="output-downscaled"?A=BT(v,S.decryptdata):v==="expired"?A=new Error(`key expired (keyId: ${c})`):v==="released"?A=new Error("key released"):v==="status-pending"||this.warn(`unhandled key status change "${v}" (keyId: ${c})`),A&&(h.eventNames().length?h.emit("error",A):this.handleError(A))},E=e._onkeystatuseschange=v=>{if(!e.mediaKeysSession){h.emit("error",new Error("invalid state"));return}const A=this.getKeyStatuses(e);if(!Object.keys(A).some(D=>A[D]!=="status-pending"))return;if(A[c]==="expired"){this.log(`Expired key ${ft(A)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let R=A[c];if(R)g(R,e);else{var N;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(N=e.keyStatusTimeouts)[c]||(N[c]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const k=this.getKeyStatus(e.decryptdata);if(k&&k!=="status-pending")return this.log(`No status for keyId ${c} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${k} from other session.`),g(k,e);this.log(`key status for ${c} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),R="internal-error",g(R,e)},1e3)),this.log(`No status for keyId ${c} (${ft(A)}).`)}};vs(e.mediaKeysSession,"message",m),vs(e.mediaKeysSession,"keystatuseschange",E);const T=new Promise((v,S)=>{h.on("error",S),h.on("resolved",v)});return e.mediaKeysSession.generateRequest(t,i).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${c} URI: ${f}`)}).catch(v=>{throw new zs({type:Ae.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_SESSION,error:v,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${v}`)}).then(()=>T).catch(v=>(h.removeAllListeners(),this.removeSession(e).then(()=>{throw v}))).then(()=>(h.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((i,a)=>{if(typeof a=="string"&&typeof i=="object"){const c=a;a=i,i=c}const u="buffer"in a?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):new Uint8Array(a);if(e.keySystem===xt.PLAYREADY&&u.length===16){const c=fs(u);t[c]=i,hv(u)}const l=fs(u);i==="internal-error"&&(this.bannedKeyIds[l]=i),this.log(`key status change "${i}" for keyStatuses keyId: ${l} key-session "${e.mediaKeysSession.sessionId}"`),t[l]=i}),t}fetchServerCertificate(e){const t=this.config,i=t.loader,a=new i(t),u=this.getServerCertificateUrl(e);return u?(this.log(`Fetching server certificate for "${e}"`),new Promise((l,c)=>{const f={responseType:"arraybuffer",url:u},h=t.certLoadPolicy.default,m={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(E,T,v,S)=>{l(E.data)},onError:(E,T,v,S)=>{c(new zs({type:Ae.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:it({url:f.url,data:void 0},E)},`"${e}" certificate request failed (${u}). Status: ${E.code} (${E.text})`))},onTimeout:(E,T,v)=>{c(new zs({type:Ae.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:{url:f.url,data:void 0}},`"${e}" certificate request timed out (${u})`))},onAbort:(E,T,v)=>{c(new Error("aborted"))}};a.load(f,m,g)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((a,u)=>{e.setServerCertificate(i).then(l=>{this.log(`setServerCertificate ${l?"success":"not supported by CDM"} (${i.byteLength}) on "${t}"`),a(e)}).catch(l=>{u(new zs({type:Ae.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(a=>{throw new zs({type:Ae.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:a,fatal:!1},a.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const a=new DOMParser().parseFromString(i,"application/xml"),u=a.querySelectorAll("HttpHeader");if(u.length>0){let m;for(let g=0,E=u.length;g<E;g++){var l,c;m=u[g];const T=(l=m.querySelector("name"))==null?void 0:l.textContent,v=(c=m.querySelector("value"))==null?void 0:c.textContent;T&&v&&e.setRequestHeader(T,v)}}const f=a.querySelector("Challenge"),h=f==null?void 0:f.textContent;if(!h)throw new Error("Cannot find <Challenge> in key message");return Dm(atob(h))}setupLicenseXHR(e,t,i,a){const u=this.config.licenseXhrSetup;return u?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return u.call(this.hls,e,t,i,a)}).catch(l=>{if(!i.decryptdata)throw l;return e.open("POST",t,!0),u.call(this.hls,e,t,i,a)}).then(l=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:l||a})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:a}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((a,u)=>{const l=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${l}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return u(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let f=c.response;this.log(`License received ${f instanceof ArrayBuffer?f.byteLength:f}`);const h=this.config.licenseResponseCallback;if(h)try{f=h.call(this.hls,c,l,e)}catch(m){this.error(m)}a(f)}else{const f=i.errorRetry,h=f?f.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>h||c.status>=400&&c.status<500)u(new zs({type:Ae.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:c,response:{url:l,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${l}). Status: ${c.status} (${c.statusText})`));else{const m=h-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${m} attempts left`),this.requestLicense(e,t).then(a,u)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,l,e,t).then(({xhr:f,licenseChallenge:h})=>{e.keySystem==xt.PLAYREADY&&(h=this.unpackPlayReadyKeyMessage(f,h)),f.send(h)}).catch(u)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,vs(i,"encrypted",this.onMediaEncrypted),vs(i,"waitingforkey",this.onWaitingForKey);const a=this.mediaResolved;a?a():this.mediaKeys=i.mediaKeys}onMediaDetached(){const e=this.media;e&&(Bs(e,"encrypted",this.onMediaEncrypted),Bs(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const i=this.media,a=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,ba.clearKeyUriToKeyIdMap();const u=a.length;uu.CDMCleanupPromise=Promise.all(a.map(l=>this.removeSession(l)).concat((i==null||(e=i.setMediaKeys(null))==null?void 0:e.catch(l=>{this.log(`Could not clear media keys: ${l}`),this.hls&&this.hls.trigger(L.ERROR,{type:Ae.OTHER_ERROR,details:Y.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${l}`)})}))||Promise.resolve())).catch(l=>{this.log(`Could not close sessions and clear media keys: ${l}`),this.hls&&this.hls.trigger(L.ERROR,{type:Ae.OTHER_ERROR,details:Y.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${l}`)})}).then(()=>{u&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((a,u)=>(a.indexOf(u.keyFormat)===-1&&a.push(u.keyFormat),a),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i,decryptdata:a}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${fs((a==null?void 0:a.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const u=this.mediaKeySessions.indexOf(e);u>-1&&this.mediaKeySessions.splice(u,1);const{keyStatusTimeouts:l}=e;l&&Object.keys(l).forEach(h=>self.clearTimeout(l[h]));const{drmSystemOptions:c}=this.config;return(G8(c)?new Promise((h,m)=>{self.setTimeout(()=>m(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(h).catch(m)}):Promise.resolve()).catch(h=>{this.log(`Could not remove session: ${h}`),this.hls&&this.hls.trigger(L.ERROR,{type:Ae.OTHER_ERROR,details:Y.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${h}`)})}).then(()=>t.close()).catch(h=>{this.log(`Could not close session: ${h}`),this.hls&&this.hls.trigger(L.ERROR,{type:Ae.OTHER_ERROR,details:Y.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${h}`)})})}return Promise.resolve()}}uu.CDMCleanupPromise=void 0;function Qc(s){if(!s)throw new Error("Could not read keyId of undefined decryptdata");if(s.keyId===null)throw new Error("keyId is null");return fs(s.keyId)}function l5(s,e){if(s.keyId&&e.mediaKeysSession.keyStatuses.has(s.keyId))return e.mediaKeysSession.keyStatuses.get(s.keyId);if(s.matches(e.decryptdata))return e.keyStatus}class zs extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function BT(s,e){const t=s==="output-restricted",i=t?Y.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Y.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new zs({type:Ae.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${s}"`)}class o5{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const a=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=a,a&&typeof a.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const a=performance.now();if(t){if(this.lastTime){const u=a-this.lastTime,l=i-this.lastDroppedFrames,c=t-this.lastDecodedFrames,f=1e3*l/u,h=this.hls;if(h.trigger(L.FPS_DROP,{currentDropped:l,currentDecoded:c,totalDroppedFrames:i}),f>0&&l>h.config.fpsDroppedMonitoringThreshold*c){let m=h.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+m),m>0&&(h.autoLevelCapping===-1||h.autoLevelCapping>=m)&&(m=m-1,h.trigger(L.FPS_DROP_LEVEL_CAPPING,{level:m,droppedLevel:h.currentLevel}),h.autoLevelCapping=m,this.streamController.nextLevelSwitch())}}this.lastTime=a,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function aS(s,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=s,e.dispatchEvent(t)}function rS(s,e){const t=s.mode;if(t==="disabled"&&(s.mode="hidden"),s.cues&&!s.cues.getCueById(e.id))try{if(s.addCue(e),!s.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){nt.debug(`[texttrack-utils]: ${i}`);try{const a=new self.TextTrackCue(e.startTime,e.endTime,e.text);a.id=e.id,s.addCue(a)}catch(a){nt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${a}`)}}t==="disabled"&&(s.mode=t)}function su(s,e){const t=s.mode;if(t==="disabled"&&(s.mode="hidden"),s.cues)for(let i=s.cues.length;i--;)e&&s.cues[i].removeEventListener("enter",e),s.removeCue(s.cues[i]);t==="disabled"&&(s.mode=t)}function jm(s,e,t,i){const a=s.mode;if(a==="disabled"&&(s.mode="hidden"),s.cues&&s.cues.length>0){const u=d5(s.cues,e,t);for(let l=0;l<u.length;l++)(!i||i(u[l]))&&s.removeCue(u[l])}a==="disabled"&&(s.mode=a)}function c5(s,e){if(e<=s[0].startTime)return 0;const t=s.length-1;if(e>s[t].endTime)return-1;let i=0,a=t,u;for(;i<=a;)if(u=Math.floor((a+i)/2),e<s[u].startTime)a=u-1;else if(e>s[u].startTime&&i<t)i=u+1;else return u;return s[i].startTime-e<e-s[a].startTime?i:a}function d5(s,e,t){const i=[],a=c5(s,e);if(a>-1)for(let u=a,l=s.length;u<l;u++){const c=s[u];if(c.startTime>=e&&c.endTime<=t)i.push(c);else if(c.startTime>t)return i}return i}function dd(s){const e=[];for(let t=0;t<s.length;t++){const i=s[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(s[t])}return e}class f5 extends Pg{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=dd(this.media.textTracks);for(let u=0;u<i.length;u++)if(i[u].mode==="hidden")t=i[u];else if(i[u].mode==="showing"){t=i[u];break}const a=this.findTrackForTextTrack(t);this.subtitleTrack!==a&&this.setSubtitleTrack(a)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const a=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,a)return;dd(i.textTracks).forEach(l=>{su(l)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:a,details:u}=t,l=this.tracksInGroup[i];if(!l||l.groupId!==a){this.warn(`Subtitle track with id:${i} and group:${a} not found in active group ${l==null?void 0:l.groupId}`);return}const c=l.details;l.details=t.details,this.log(`Subtitle track ${i} "${l.name}" lang:${l.lang} group:${a} loaded [${u.startSN}-${u.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,a=this.groupIds;let u=this.currentTrack;if(!i||(a==null?void 0:a.length)!==(i==null?void 0:i.length)||i!=null&&i.some(l=>(a==null?void 0:a.indexOf(l))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(m=>!i||i.indexOf(m.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(m=>m.default)&&(this.selectDefaultTrack=!1),l.forEach((m,g)=>{m.id=g});else if(!u&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const c=this.hls.config.subtitlePreference;if(!u&&c){this.selectDefaultTrack=!1;const m=Vi(c,l);if(m>-1)u=l[m];else{const g=Vi(c,this.tracks);u=this.tracks[g]}}let f=this.findTrackId(u);f===-1&&u&&(f=this.findTrackId(null));const h={subtitleTracks:l};this.log(`Updating subtitle tracks, ${l.length} track(s) found in "${i==null?void 0:i.join(",")}" group-id`),this.hls.trigger(L.SUBTITLE_TRACKS_UPDATED,h),f!==-1&&this.trackId===-1&&this.setSubtitleTrack(f)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let a=0;a<t.length;a++){const u=t[a];if(!(i&&!u.default||!i&&!e)&&(!e||er(u,e)))return a}if(e){for(let a=0;a<t.length;a++){const u=t[a];if(so(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return a}for(let a=0;a<t.length;a++){const u=t[a];if(so(e.attrs,u.attrs,["LANGUAGE"]))return a}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const a=t[i];if(Pm(a,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Fe.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&er(e,i))return i;const a=Vi(e,this.tracksInGroup);if(a>-1){const u=this.tracksInGroup[a];return this.setSubtitleTrack(a),u}else{if(i)return null;{const u=Vi(e,t);if(u>-1)return t[u]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,a=e.groupId,u=this.getUrlWithDirectives(e.url,t),l=e.details,c=l==null?void 0:l.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${a}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${u}`),this.hls.trigger(L.SUBTITLE_TRACK_LOADING,{url:u,id:i,groupId:a,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=dd(e.textTracks),i=this.currentTrack;let a;if(i&&(a=t.filter(u=>Pm(i,u))[0],a||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(u=>{u.mode!=="disabled"&&u!==a&&(u.mode="disabled")}),a){const u=this.subtitleDisplay?"showing":"hidden";a.mode!==u&&(a.mode=u)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Ee(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,a=t[e]||null;if(this.trackId=e,this.currentTrack=a,this.toggleTrackModes(),!a){this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:e});return}const u=!!a.details&&!a.details.live;if(e===this.trackId&&a===i&&u)return;this.log(`Switching to subtitle-track ${e}`+(a?` "${a.name}" lang:${a.lang} group:${a.groupId}`:""));const{id:l,groupId:c="",name:f,type:h,url:m}=a;this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:l,groupId:c,name:f,type:h,url:m});const g=this.switchParams(a.url,i==null?void 0:i.details,a.details);this.loadPlaylist(g)}}function h5(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>{const u=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(a=="x"?u:u&3|8).toString(16)})}}}function Bl(s){let e=5381,t=s.length;for(;t;)e=e*33^s.charCodeAt(--t);return(e>>>0).toString()}const lu=.025;let Bd=(function(s){return s[s.Point=0]="Point",s[s.Range=1]="Range",s})({});function m5(s,e,t){return`${s.identifier}-${t+1}-${Bl(e)}`}class g5{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Y0(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=Y0(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Ee(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Y0(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<lu))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Bd.Range:Bd.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return p5(this)}}function Y0(s,e){return s-e.start<e.duration/2&&!(Math.abs(s-(e.start+e.duration))<lu)?e.start:e.start+e.duration}function uS(s,e,t){const i=new self.URL(s,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function K0(s,e){for(;(t=s.assetList[++e])!=null&&t.error;)var t;return e}function p5(s){return`["${s.identifier}" ${s.cue.pre?"<pre>":s.cue.post?"<post>":""}${s.timelineStart.toFixed(2)}-${s.resumeTime.toFixed(2)}]`}function tu(s){const e=s.timelineStart,t=s.duration||0;return`["${s.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class b5{constructor(e,t,i,a){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(L.PLAYOUT_LIMIT_REACHED,{})};const u=this.hls=new e(t);this.interstitial=i,this.assetItem=a;const l=()=>{this.hasDetails=!0};u.once(L.LEVEL_LOADED,l),u.once(L.AUDIO_TRACK_LOADED,l),u.once(L.SUBTITLE_TRACK_LOADED,l),u.on(L.MEDIA_ATTACHING,(c,{media:f})=>{this.removeMediaListeners(),this.mediaAttached=f,this.interstitial.playoutLimit&&(f.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&u.on(L.BUFFER_APPENDED,()=>{const m=this.bufferedEnd;this.reachedPlayout(m)&&(this._bufferedEosTime=m,u.trigger(L.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=uS(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const i=Math.min(this._bufferedEosTime||1/0,this.duration),a=this.timelineOffset,u=ke.bufferInfo(e,a,0);return this.getAssetTime(u.end)>=i-.02}reachedPlayout(e){const i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=ke.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const i=t-this.startOffset;if(i>0&&i<e)return i}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){var a;(a=this.hls)==null||a.on(e,t)}once(e,t,i){var a;(a=this.hls)==null||a.once(e,t)}off(e,t,i){var a;(a=this.hls)==null||a.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${tu(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const FT=.033;class E5 extends gi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,a)=>e<=a.startOffset&&t>a.startOffset?(delete a.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const a=this.items;if(a)for(a[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(u=a[i])!=null&&u.event;){var u;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let a=0;a<i.length;a++){let u=i[a];if(t&&t!=="primary"&&(u=u[t]),e===u.start||e>u.start&&e<u.end)return a}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let a=e;a<=t&&i[a];a++){const u=i[a].event;if(u!=null&&u.restrictions.jump&&!u.appendInPlace)return a}return-1}findEventIndex(e){const t=this.items;if(t)for(let a=t.length;a--;){var i;if(((i=t[a].event)==null?void 0:i.identifier)===e)return a}return-1}findAssetIndex(e,t){const i=e.assetList,a=i.length;if(a>1)for(let u=0;u<a;u++){const l=i[u];if(!l.error){const c=l.timelineStart;if(t===c||t>c&&(t<c+(l.duration||0)||u===a-1))return u}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const i=t.assetList,a=i[i.length-1];if(a)return a.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:a}=i,u=this.events,l=this.parseDateRanges(a,{url:i.url},t),c=Object.keys(a),f=u?u.filter(h=>!c.includes(h.identifier)):[];l.length&&l.sort((h,m)=>{const g=h.cue.pre,E=h.cue.post,T=m.cue.pre,v=m.cue.post;if(g&&!T)return-1;if(T&&!g||E&&!v)return 1;if(v&&!E)return-1;if(!g&&!T&&!E&&!v){const S=h.startTime,A=m.startTime;if(S!==A)return S-A}return h.dateRange.tagOrder-m.dateRange.tagOrder}),this.events=l,f.forEach(h=>{this.removeEvent(h)}),this.updateSchedule(e,f)}updateSchedule(e,t=[],i=!1){const a=this.events||[];if(a.length||t.length||this.length<2){const u=this.items,l=this.parseSchedule(a,e);(i||t.length||(u==null?void 0:u.length)!==l.length||l.some((f,h)=>Math.abs(f.playout.start-u[h].playout.start)>.005||Math.abs(f.playout.end-u[h].playout.end)>.005))&&(this.items=l,this.onScheduleUpdate(t,u))}}parseDateRanges(e,t,i){const a=[],u=Object.keys(e);for(let l=0;l<u.length;l++){const c=u[l],f=e[c];if(f.isInterstitial){let h=this.eventMap[c];h?h.setDateRange(f):(h=new g5(f,t),this.eventMap[c]=h,i===!1&&(h.appendInPlace=i)),a.push(h)}}return a}parseSchedule(e,t){const i=[],a=t.main.details,u=a.live?1/0:a.edge;let l=0;if(e=e.filter(f=>!f.error&&!(f.cue.once&&f.hasPlayed)),e.length){this.resolveOffsets(e,t);let f=0,h=0;if(e.forEach((m,g)=>{const E=m.cue.pre,T=m.cue.post,v=e[g-1]||null,S=m.appendInPlace,A=T?u:m.startOffset,I=m.duration,R=m.timelineOccupancy===Bd.Range?I:0,N=m.resumptionOffset,D=(v==null?void 0:v.startTime)===A,k=A+m.cumulativeDuration;let G=S?k+I:A+N;if(E||!T&&A<=0){const H=h;h+=R,m.timelineStart=k;const $=l;l+=I,i.push({event:m,start:k,end:G,playout:{start:$,end:l},integrated:{start:H,end:h}})}else if(A<=u){if(!D){const F=A-f;if(F>FT){const ee=f,me=h;h+=F;const be=l;l+=F;const Te={previousEvent:e[g-1]||null,nextEvent:m,start:ee,end:ee+F,playout:{start:be,end:l},integrated:{start:me,end:h}};i.push(Te)}else F>0&&v&&(v.cumulativeDuration+=F,i[i.length-1].end=A)}T&&(G=k),m.timelineStart=k;const H=h;h+=R;const $=l;l+=I,i.push({event:m,start:k,end:G,playout:{start:$,end:l},integrated:{start:H,end:h}})}else return;const U=m.resumeTime;T||U>u?f=u:f=U}),f<u){var c;const m=f,g=h,E=u-f;h+=E;const T=l;l+=E,i.push({previousEvent:((c=i[i.length-1])==null?void 0:c.event)||null,nextEvent:null,start:f,end:m+E,playout:{start:T,end:l},integrated:{start:g,end:h}})}this.setDurations(u,l,h)}else i.push({previousEvent:null,nextEvent:null,start:0,end:u,playout:{start:0,end:u},integrated:{start:0,end:u}}),this.setDurations(u,u,u);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,a=i.live?1/0:i.edge;let u=0,l=-1;e.forEach((c,f)=>{const h=c.cue.pre,m=c.cue.post,g=h?0:m?a:c.startTime;this.updateAssetDurations(c),l===g?c.cumulativeDuration=u:(u=0,l=g),!m&&c.snapOptions.in&&(c.resumeAnchor=nr(null,i.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,t)||(c.appendInPlace=!1)),!c.appendInPlace&&f+1<e.length&&e[f+1].startTime-e[f].resumeTime<FT&&(e[f+1].appendInPlace=!1,e[f+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const T=Ee(c.resumeOffset)?c.resumeOffset:c.duration;u+=T})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,a=e.startTime+e.resumptionOffset;return Math.abs(i-a)>lu?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${a}`),!1):!Object.keys(t).some(l=>{const c=t[l].details,f=c.edge;if(i>=f)return this.log(`"${e.identifier}" resumption ${i} past ${l} playlist end ${f}`),!1;const h=nr(null,c.fragments,i);if(!h)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${l} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const m=l==="audio"?.175:0;return Math.abs(h.start-i)<lu+m||Math.abs(h.end-i)<lu+m?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${l} fragment bounds (${h.start}-${h.end} sn: ${h.sn} cc: ${h.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,a=!1,u=!1;for(let l=0;l<e.assetList.length;l++){const c=e.assetList[l],f=t+i;c.startOffset=i,c.timelineStart=f,a||(a=c.duration===null),u||(u=!!c.error);const h=c.error?0:c.duration||0;i+=h}a&&!u?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function yi(s){return`[${s.event?'"'+s.event.identifier+'"':"primary"}: ${s.start.toFixed(2)}-${s.end.toFixed(2)}]`}class x5{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let a;try{a=uS(i,this.hls.sessionId,e.baseUrl)}catch(E){const T=this.assignAssetListError(e,Y.ASSET_LIST_LOAD_ERROR,E,i);this.hls.trigger(L.ERROR,T);return}t&&a.protocol!=="data:"&&a.searchParams.set("_HLS_start_offset",""+t);const u=this.hls.config,l=u.loader,c=new l(u),f={responseType:"json",url:a.href},h=u.interstitialAssetListLoadPolicy.default,m={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(E,T,v,S)=>{const A=E.data,I=A==null?void 0:A.ASSETS;if(!Array.isArray(I)){const R=this.assignAssetListError(e,Y.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),v.url,T,S);this.hls.trigger(L.ERROR,R);return}e.assetListResponse=A,this.hls.trigger(L.ASSET_LIST_LOADED,{event:e,assetListResponse:A,networkDetails:S})},onError:(E,T,v,S)=>{const A=this.assignAssetListError(e,Y.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${E.code} ${E.text} (${T.url})`),T.url,S,v);this.hls.trigger(L.ERROR,A)},onTimeout:(E,T,v)=>{const S=this.assignAssetListError(e,Y.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${T.url})`),T.url,E,v);this.hls.trigger(L.ERROR,S)}};return c.load(f,m,g),this.hls.trigger(L.ASSET_LIST_LOADING,{event:e}),c}assignAssetListError(e,t,i,a,u,l){return e.error=i,{type:Ae.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:a,error:i,networkDetails:l,stats:u}}}function jT(s){var e;s==null||(e=s.play())==null||e.catch(()=>{})}function Xc(s,e){return`[${s}] Advancing timeline position to ${e}`}class T5 extends gi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled||!this.schedule)return;const a=i-this.timelinePos;if(Math.abs(a)<1/7056e5)return;const l=a<=-.01;this.timelinePos=i,this.bufferedPos=i;const c=this.playingItem;if(!c){this.checkBuffer();return}if(l&&this.schedule.resetErrorsInRange(i,i-a)&&this.updateSchedule(!0),this.checkBuffer(),l&&i<c.start||i>=c.end){var f;const T=this.findItemIndex(c);let v=this.schedule.findItemIndexAtTime(i);if(v===-1&&(v=T+(l?-1:1),this.log(`seeked ${l?"back ":""}to position not covered by schedule ${i} (resolving from ${T} to ${v})`)),!this.isInterstitial(c)&&(f=this.media)!=null&&f.paused&&(this.shouldPlay=!1),!l&&v>T){const S=this.schedule.findJumpRestrictedIndex(T+1,v);if(S>T){this.setSchedulePosition(S);return}}this.setSchedulePosition(v);return}const h=this.playingAsset;if(!h){if(this.playingLastItem&&this.isInterstitial(c)){const T=c.event.assetList[0];T&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,T))}return}const m=h.timelineStart,g=h.duration||0;if(l&&i<m||i>=m+g){var E;(E=c.event)!=null&&E.appendInPlace&&(this.clearAssetPlayers(c.event,c),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,h)}},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const a=this.playingItem;if(!a||this.playingLastItem)return;if(i>=a.end){this.timelinePos=a.end;const c=this.findItemIndex(a);this.setSchedulePosition(c+1)}const u=this.playingAsset;if(!u)return;const l=u.timelineStart+(u.duration||0);i>=l&&this.setScheduleToAssetAtTime(i,u)},this.onScheduleUpdate=(i,a)=>{const u=this.schedule;if(!u)return;const l=this.playingItem,c=u.events||[],f=u.items||[],h=u.durations,m=i.map(S=>S.identifier),g=!!(c.length||m.length);(g||a)&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${f.map(S=>yi(S))} pos: ${this.timelinePos}`),m.length&&this.log(`Removed events ${m}`);let E=null,T=null;l&&(E=this.updateItem(l,this.timelinePos),this.itemsMatch(l,E)?this.playingItem=E:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const v=this.bufferingItem;if(v&&(T=this.updateItem(v,this.bufferedPos),this.itemsMatch(v,T)?this.bufferingItem=T:v.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(v.event,null))),i.forEach(S=>{S.assetList.forEach(A=>{this.clearAssetPlayer(A.identifier,null)})}),this.playerQueue.forEach(S=>{if(S.interstitial.appendInPlace){const A=S.assetItem.timelineStart,I=S.timelineOffset-A;if(I)try{S.timelineOffset=A}catch(R){Math.abs(I)>lu&&this.warn(`${R} ("${S.assetId}" ${S.timelineOffset}->${A})`)}}}),g||a){if(this.hls.trigger(L.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:f.slice(0),durations:h,removedIds:m}),this.isInterstitial(l)&&m.includes(l.event.identifier)){this.warn(`Interstitial "${l.event.identifier}" removed while playing`),this.primaryFallback(l.event);return}l&&this.trimInPlace(E,l),v&&T!==E&&this.trimInPlace(T,v),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new x5(e),this.schedule=new E5(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(L.MEDIA_ENDED,this.onMediaEnded,this),e.on(L.ERROR,this.onError,this),e.on(L.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(L.MEDIA_ENDED,this.onMediaEnded,this),e.off(L.ERROR,this.onError,this),e.off(L.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Bs(e,"play",this.onPlay),Bs(e,"pause",this.onPause),Bs(e,"seeking",this.onSeeking),Bs(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;vs(i,"seeking",this.onSeeking),vs(i,"timeupdate",this.onTimeupdate),vs(i,"play",this.onPlay),vs(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,a=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!a){this.clearScheduleState();const u=this.findItemIndex(i);this.setSchedulePosition(u)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,a=this.media;if(this.media=null,!i&&(a&&this.removeMediaListeners(a),this.detachedData)){const u=this.getBufferingPlayer();u&&(this.log(`Removing schedule state for detachedData and ${u}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,u.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=g=>g&&e.getAssetPlayer(g.identifier),a=(g,E,T,v,S)=>{if(g){let A=g[E].start;const I=g.event;if(I){if(E==="playout"||I.timelineOccupancy!==Bd.Point){const R=i(T);(R==null?void 0:R.interstitial)===I&&(A+=R.assetItem.startOffset+R[S])}}else{const R=v==="bufferedPos"?l():e[v];A+=R-g.start}return A}return 0},u=(g,E)=>{var T;if(g!==0&&E!=="primary"&&(T=e.schedule)!=null&&T.length){var v;const S=e.schedule.findItemIndexAtTime(g),A=(v=e.schedule.items)==null?void 0:v[S];if(A){const I=A[E].start-A.start;return g+I}}return g},l=()=>{const g=e.bufferedPos;return g===Number.MAX_VALUE?c("primary"):Math.max(g,0)},c=g=>{var E,T;return(E=e.primaryDetails)!=null&&E.live?e.primaryDetails.edge:((T=e.schedule)==null?void 0:T.durations[g])||0},f=(g,E)=>{var T,v;const S=e.effectivePlayingItem;if(S!=null&&(T=S.event)!=null&&T.restrictions.skip||!e.schedule)return;e.log(`seek to ${g} "${E}"`);const A=e.effectivePlayingItem,I=e.schedule.findItemIndexAtTime(g,E),R=(v=e.schedule.items)==null?void 0:v[I],N=e.getBufferingPlayer(),D=N==null?void 0:N.interstitial,k=D==null?void 0:D.appendInPlace,G=A&&e.itemsMatch(A,R);if(A&&(k||G)){const U=i(e.playingAsset),H=(U==null?void 0:U.media)||e.primaryMedia;if(H){const $=E==="primary"?H.currentTime:a(A,E,e.playingAsset,"timelinePos","currentTime"),F=g-$,ee=(k?$:H.currentTime)+F;if(ee>=0&&(!U||k||ee<=U.duration)){H.currentTime=ee;return}}}if(R){let U=g;if(E!=="primary"){const $=R[E].start,F=g-$;U=R.start+F}const H=!e.isInterstitial(R);if((!e.isInterstitial(A)||A.event.appendInPlace)&&(H||R.event.appendInPlace)){const $=e.media||(k?N==null?void 0:N.media:null);$&&($.currentTime=U)}else if(A){const $=e.findItemIndex(A);if(I>$){const ee=e.schedule.findJumpRestrictedIndex($+1,I);if(ee>$){e.setSchedulePosition(ee);return}}let F=0;if(H)e.timelinePos=U,e.checkBuffer();else{const ee=R.event.assetList,me=g-(R[E]||R).start;for(let be=ee.length;be--;){const Te=ee[be];if(Te.duration&&me>=Te.startOffset&&me<Te.startOffset+Te.duration){F=be;break}}}e.setSchedulePosition(I,F)}}},h=()=>{const g=e.effectivePlayingItem;if(e.isInterstitial(g))return g;const E=t();return e.isInterstitial(E)?E:null},m={get bufferedEnd(){const g=t(),E=e.bufferingItem;if(E&&E===g){var T;return a(E,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-E.playout.start||((T=e.bufferingAsset)==null?void 0:T.startOffset)||0}return 0},get currentTime(){const g=h(),E=e.effectivePlayingItem;return E&&E===g?a(E,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-E.playout.start:0},set currentTime(g){const E=h(),T=e.effectivePlayingItem;T&&T===E&&f(g+T.playout.start,"playout")},get duration(){const g=h();return g?g.playout.end-g.playout.start:0},get assetPlayers(){var g;const E=(g=h())==null?void 0:g.event.assetList;return E?E.map(T=>e.getAssetPlayer(T.identifier)):[]},get playingIndex(){var g;const E=(g=h())==null?void 0:g.event;return E&&e.effectivePlayingAsset?E.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return h()}};return this.manager={get events(){var g;return((g=e.schedule)==null||(g=g.events)==null?void 0:g.slice(0))||[]},get schedule(){var g;return((g=e.schedule)==null||(g=g.items)==null?void 0:g.slice(0))||[]},get interstitialPlayer(){return h()?m:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const g=t();return e.findItemIndex(g)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const g=e.effectivePlayingItem;return e.findItemIndex(g)},primary:{get bufferedEnd(){return l()},get currentTime(){const g=e.timelinePos;return g>0?g:0},set currentTime(g){f(g,"primary")},get duration(){return c("primary")},get seekableStart(){var g;return((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0}},integrated:{get bufferedEnd(){return a(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return a(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(g){f(g,"integrated")},get duration(){return c("integrated")},get seekableStart(){var g;return u(((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0,"integrated")}},skip:()=>{const g=e.effectivePlayingItem,E=g==null?void 0:g.event;if(E&&!E.restrictions.skip){const T=e.findItemIndex(g);if(E.appendInPlace){const v=g.playout.start+g.event.duration;f(v+.001,"playout")}else e.advanceAfterAssetEnded(E,T,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let a=this.media;!a&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(a=this.primaryMedia);const u=(t=a)==null?void 0:t.currentTime;if(!(u===void 0||!Ee(u)))return u}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,a=e.media;if(i&&a===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&a){this.detachedData={media:a};return}const u=e.transferMedia();this.log(`transfer MediaSource from ${e} ${ft(u)}`),this.detachedData=u}else t&&a&&(this.shouldPlay||(this.shouldPlay=!a.paused))}transferMediaTo(e,t){var i,a;if(e.media===t)return;let u=null;const l=this.hls,c=e!==l,f=c&&e.interstitial.appendInPlace,h=(i=this.detachedData)==null?void 0:i.mediaSource;let m;if(l.media)f&&(u=l.transferMedia(),this.detachedData=u),m="Primary";else if(h){const v=this.getBufferingPlayer();v?(u=v.transferMedia(),m=`${v}`):m="detached MediaSource"}else m="detached media";if(!u){if(h)u=this.detachedData,this.log(`using detachedData: MediaSource ${ft(u)}`);else if(!this.detachedData||l.media===t){const v=this.playerQueue;v.length>1&&v.forEach(S=>{if(c&&S.interstitial.appendInPlace!==f){const A=S.interstitial;this.clearInterstitial(S.interstitial,null),A.appendInPlace=!1,A.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${A}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const g=u&&"mediaSource"in u&&((a=u.mediaSource)==null?void 0:a.readyState)!=="closed",E=g&&u?u:t;this.log(`${g?"transfering MediaSource":"attaching media"} to ${c?e:"Primary"} from ${m} (media.currentTime: ${t.currentTime})`);const T=this.schedule;if(E===u&&T){const v=c&&e.assetId===T.assetIdAtEnd;E.overrides={duration:T.duration,endOfStream:!c||v,cueRemoval:!c}}e.attachMedia(E)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,a=this.effectivePlayingItem;if(i===-1){const u=this.hls.startPosition;if(this.log(Xc("checkStart",u)),this.timelinePos=u,t.length&&t[0].cue.pre){const l=e.findEventIndex(t[0].identifier);this.setSchedulePosition(l)}else if(u>=0||!this.primaryLive){const l=this.timelinePos=u>0?u:0,c=e.findItemIndexAtTime(l);this.setSchedulePosition(c)}}else if(a&&!this.playingItem){const u=e.findItemIndex(a);this.setSchedulePosition(u)}}advanceAssetBuffering(e,t){const i=e.event,a=i.findAssetIndex(t),u=K0(i,a);if(!i.isAssetPastPlayoutLimit(u))this.bufferedToEvent(e,u);else if(this.schedule){var l;const c=(l=this.schedule.items)==null?void 0:l[this.findItemIndex(e)+1];c&&this.bufferedToItem(c)}}advanceAfterAssetEnded(e,t,i){const a=K0(e,i);if(e.isAssetPastPlayoutLimit(a)){if(this.schedule){const u=this.schedule.items;if(u){const l=t+1,c=u.length;if(l>=c){this.setSchedulePosition(-1);return}const f=e.resumeTime;this.timelinePos<f&&(this.log(Xc("advanceAfterAssetEnded",f)),this.timelinePos=f,e.appendInPlace&&this.advanceInPlace(f),this.checkBuffer(this.bufferedPos<f)),this.setSchedulePosition(l)}}}else{if(e.appendInPlace){const u=e.assetList[a];u&&this.advanceInPlace(u.timelineStart)}this.setSchedulePosition(t,a)}}setScheduleToAssetAtTime(e,t){const i=this.schedule;if(!i)return;const a=t.parentIdentifier,u=i.getEvent(a);if(u){const l=i.findEventIndex(a),c=i.findAssetIndex(u,e);this.advanceAfterAssetEnded(u,l,c-1)}}setSchedulePosition(e,t){var i;const a=(i=this.schedule)==null?void 0:i.items;if(!a||this.playbackDisabled)return;const u=e>=0?a[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${u&&yi(u)}) pos: ${this.timelinePos}`);const l=this.waitingItem||this.playingItem,c=this.playingLastItem;if(this.isInterstitial(l)){const m=l.event,g=this.playingAsset,E=g==null?void 0:g.identifier,T=E?this.getAssetPlayer(E):null;if(T&&E&&(!this.eventItemsMatch(l,u)||t!==void 0&&E!==m.assetList[t].identifier)){var f;const v=m.findAssetIndex(g);if(this.log(`INTERSTITIAL_ASSET_ENDED ${v+1}/${m.assetList.length} ${tu(g)}`),this.endedAsset=g,this.playingAsset=null,this.hls.trigger(L.INTERSTITIAL_ASSET_ENDED,{asset:g,assetListIndex:v,event:m,schedule:a.slice(0),scheduleIndex:e,player:T}),l!==this.playingItem){this.itemsMatch(l,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(m,this.findItemIndex(this.playingItem),v);return}this.retreiveMediaSource(E,u),T.media&&!((f=this.detachedData)!=null&&f.mediaSource)&&T.detachMedia()}if(!this.eventItemsMatch(l,u)&&(this.endedItem=l,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${m} ${yi(l)}`),m.hasPlayed=!0,this.hls.trigger(L.INTERSTITIAL_ENDED,{event:m,schedule:a.slice(0),scheduleIndex:e}),m.cue.once)){var h;this.updateSchedule();const v=(h=this.schedule)==null?void 0:h.items;if(u&&v){const S=this.findItemIndex(u);this.advanceSchedule(S,v,t,l,c)}return}}this.advanceSchedule(e,a,t,l,c)}advanceSchedule(e,t,i,a,u){const l=this.schedule;if(!l)return;const c=t[e]||null,f=this.primaryMedia,h=this.playerQueue;if(h.length&&h.forEach(m=>{const g=m.interstitial,E=l.findEventIndex(g.identifier);(E<e||E>e+1)&&this.clearInterstitial(g,c)}),this.isInterstitial(c)){this.timelinePos=Math.min(Math.max(this.timelinePos,c.start),c.end);const m=c.event;if(i===void 0){i=l.findAssetIndex(m,this.timelinePos);const v=K0(m,i-1);if(m.isAssetPastPlayoutLimit(v)||m.appendInPlace&&this.timelinePos===c.end){this.advanceAfterAssetEnded(m,e,i);return}i=v}const g=this.waitingItem;this.assetsBuffered(c,f)||this.setBufferingItem(c);let E=this.preloadAssets(m,i);if(this.eventItemsMatch(c,g||a)||(this.waitingItem=c,this.log(`INTERSTITIAL_STARTED ${yi(c)} ${m.appendInPlace?"append in place":""}`),this.hls.trigger(L.INTERSTITIAL_STARTED,{event:m,schedule:t.slice(0),scheduleIndex:e})),!m.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${m}`);return}if(m.assetListLoader&&(m.assetListLoader.destroy(),m.assetListLoader=void 0),!f){this.log(`Waiting for attachMedia to start Interstitial ${m}`);return}this.waitingItem=this.endedItem=null,this.playingItem=c;const T=m.assetList[i];if(!T){this.advanceAfterAssetEnded(m,e,i||0);return}if(E||(E=this.getAssetPlayer(T.identifier)),E===null||E.destroyed){const v=m.assetList.length;this.warn(`asset ${i+1}/${v} player destroyed ${m}`),E=this.createAssetPlayer(m,T,i),E.loadSource()}if(!this.eventItemsMatch(c,this.bufferingItem)&&m.appendInPlace&&this.isAssetBuffered(T))return;this.startAssetPlayer(E,i,t,e,f),this.shouldPlay&&jT(E.media)}else c?(this.resumePrimary(c,e,a),this.shouldPlay&&jT(this.hls.media)):u&&this.isInterstitial(a)&&(this.endedItem=null,this.playingItem=a,a.event.appendInPlace||this.attachPrimary(l.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var a,u;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${yi(e)}`),!((a=this.detachedData)!=null&&a.mediaSource)){let c=this.timelinePos;(c<e.start||c>=e.end)&&(c=this.getPrimaryResumption(e,t),this.log(Xc("resumePrimary",c)),this.timelinePos=c),this.attachPrimary(c,e)}if(!i)return;const l=(u=this.schedule)==null?void 0:u.items;l&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${yi(e)}`),this.hls.trigger(L.INTERSTITIALS_PRIMARY_RESUMED,{schedule:l.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const a=this.primaryDetails;if(t===0)return this.hls.startPosition;if(a&&(i<a.fragmentStart||i>a.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:ke.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const a=this.primaryMedia;if(!a)return;const u=this.hls;u.media?this.checkBuffer():(this.transferMediaTo(u,a),i&&this.startLoadingPrimaryAt(e,i)),i||(this.log(Xc("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const a=this.hls;!a.loadingEnabled||!a.media||Math.abs((((i=a.mainForwardBufferInfo)==null?void 0:i.start)||a.media.currentTime)-e)>.5?a.startLoad(e,t):a.bufferingEnabled||a.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(L.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(L.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const i=this.hls.levels[t.level];if(!i.details)return;const a=it(it({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=a,this.schedule.parseInterstitialDateRanges(a,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],a=this.mediaSelection;if(!a){this.altSelection=it(it({},this.altSelection),{},{audio:i});return}const u=it(it({},a),{},{audio:i});this.mediaSelection=u}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],a=this.mediaSelection;if(!a){this.altSelection=it(it({},this.altSelection),{},{subtitles:i});return}const u=it(it({},a),{},{subtitles:i});this.mediaSelection=u}onAudioTrackSwitching(e,t){const i=Qx(t);this.playerQueue.forEach(({hls:a})=>a&&(a.setAudioOption(t)||a.setAudioOption(i)))}onSubtitleTrackSwitch(e,t){const i=Qx(t);this.playerQueue.forEach(({hls:a})=>a&&(a.setSubtitleOption(t)||t.id!==-1&&a.setSubtitleOption(i)))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const a=this.timelinePos;this.bufferedPos=a,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let a=0;a<t.length;a++){const u=t[a];if(u.cue.post){var i;const l=this.schedule.findEventIndex(u.identifier),c=(i=this.schedule.items)==null?void 0:i[l];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){var i;const a=(i=this.schedule)==null?void 0:i.items;if(e&&a){const u=this.findItemIndex(e,t);return a[u]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((u,l)=>{e.event.isAssetPastPlayoutLimit(l)&&this.clearAssetPlayer(u.identifier,null)});const i=e.end+.25,a=ke.bufferInfo(this.primaryMedia,i,0);(a.end>i||(a.nextStart||0)>i)&&(this.log(`trim buffered interstitial ${yi(e)} (was ${yi(t)})`),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const i=this.mediaSelection;i&&((t=this.schedule)==null||t.updateSchedule(i,[],e))}checkBuffer(e){var t;const i=(t=this.schedule)==null?void 0:t.items;if(!i)return;const a=ke.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=a.len<1),this.updateBufferedPos(a.end,i,e)}updateBufferedPos(e,t,i){const a=this.schedule,u=this.bufferingItem;if(this.bufferedPos>e||!a)return;if(t.length===1&&this.itemsMatch(t[0],u)){this.bufferedPos=e;return}const l=this.playingItem,c=this.findItemIndex(l);let f=a.findItemIndexAtTime(e);if(this.bufferedPos<e){var h;const m=this.findItemIndex(u),g=Math.min(m+1,t.length-1),E=t[g];if((f===-1&&u&&e>=u.end||(h=E.event)!=null&&h.appendInPlace&&e+.01>=E.start)&&(f=g),this.isInterstitial(u)){const T=u.event;if(g-c>1&&T.appendInPlace===!1||T.assetList.length===0&&T.assetListLoader)return}if(this.bufferedPos=e,f>m&&f>c)this.bufferedToItem(E);else{const T=this.primaryDetails;this.primaryLive&&T&&e>T.edge-T.targetduration&&E.start<T.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(E)&&this.preloadAssets(E.event,0)}}else i&&l&&!this.itemsMatch(l,u)&&(f===c?this.bufferedToItem(l):f===c+1&&this.bufferedToItem(t[f]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(a=>{const u=this.getAssetPlayer(a.identifier);return!(u!=null&&u.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,t)&&i){const{items:a,events:u}=i;if(!a||!u)return t;const l=this.isInterstitial(e),c=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const f=c?c.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${yi(e)}`+(t?` (${f.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(l){const h=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((m,g)=>{const E=this.getAssetPlayer(m.identifier);E&&(g===h&&E.loadSource(),E.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(h=>h.pauseBuffering());this.hls.trigger(L.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:u.slice(0),schedule:a.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const a=this.detachedData;a?a.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,a=i.assetList.length===0&&!i.assetListLoader,u=i.cue.once;if(a||!u){const l=this.preloadAssets(i,t);if(l!=null&&l.interstitial.appendInPlace){const c=this.primaryMedia;c&&this.bufferAssetPlayer(l,c)}}}preloadAssets(e,t){const i=e.assetUrl,a=e.assetList.length,u=a===0&&!e.assetListLoader,l=e.cue.once;if(u){const f=e.timelineStart;if(e.appendInPlace){var c;const E=this.playingItem;!this.isInterstitial(E)&&(E==null||(c=E.nextEvent)==null?void 0:c.identifier)===e.identifier&&this.flushFrontBuffer(f+.25)}let h,m=0;if(!this.playingItem&&this.primaryLive&&(m=this.hls.startPosition,m===-1&&(m=this.hls.liveSyncPosition||0)),m&&!(e.cue.pre||e.cue.post)){const E=m-f;E>0&&(h=Math.round(E*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:a} ${e}${h?` live-start: ${m} start-offset: ${h}`:""}`),i)return this.createAsset(e,0,0,f,e.duration,i);const g=this.assetListLoader.loadAssetList(e,h);g&&(e.assetListLoader=g)}else if(!l&&a){for(let h=t;h<a;h++){const m=e.assetList[h],g=this.getAssetPlayerQueueIndex(m.identifier);(g===-1||this.playerQueue[g].destroyed)&&!m.error&&this.createAssetPlayer(e,m,h)}const f=e.assetList[t];if(f){const h=this.getAssetPlayer(f.identifier);return h&&h.loadSource(),h}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(a=>{this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:a})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,a,u,l){const c={parentIdentifier:e.identifier,identifier:m5(e,l,t),duration:u,startOffset:i,timelineStart:a,uri:l};return this.createAssetPlayer(e,c,t)}createAssetPlayer(e,t,i){const a=this.hls,u=a.userConfig;let l=u.videoPreference;const c=a.loadLevelObj||a.levels[a.currentLevel];(l||c)&&(l=ot({},l),c.videoCodec&&(l.videoCodec=c.videoCodec),c.videoRange&&(l.allowedVideoRanges=[c.videoRange]));const f=a.audioTracks[a.audioTrack],h=a.subtitleTracks[a.subtitleTrack];let m=0;if(this.primaryLive||e.appendInPlace){const D=this.timelinePos-t.timelineStart;if(D>1){const k=t.duration;k&&D<k&&(m=D)}}const g=t.identifier,E=it(it({},u),{},{maxMaxBufferLength:Math.min(180,a.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:a.sessionId,assetPlayerId:g,abrEwmaDefaultEstimate:a.bandwidthEstimate,interstitialsController:void 0,startPosition:m,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:l,audioPreference:f||u.audioPreference,subtitlePreference:h||u.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(E.timelineOffset=t.timelineStart));const T=E.cmcd;T!=null&&T.sessionId&&T.contentId&&(E.cmcd=ot({},T,{contentId:Bl(t.uri)})),this.getAssetPlayer(g)&&this.warn(`Duplicate date range identifier ${e} and asset ${g}`);const v=new b5(this.HlsPlayerClass,E,e,t);this.playerQueue.push(v),e.assetList[i]=t;let S=!0;const A=D=>{if(D.live){var k;const H=new Error(`Interstitials MUST be VOD assets ${e}`),$={fatal:!0,type:Ae.OTHER_ERROR,details:Y.INTERSTITIAL_ASSET_ITEM_ERROR,error:H},F=((k=this.schedule)==null?void 0:k.findEventIndex(e.identifier))||-1;this.handleAssetItemError($,e,F,i,H.message);return}const G=D.edge-D.fragmentStart,U=t.duration;(S||U===null||G>U)&&(S=!1,this.log(`Interstitial asset "${g}" duration change ${U} > ${G}`),t.duration=G,this.updateSchedule())};v.on(L.LEVEL_UPDATED,(D,{details:k})=>A(k)),v.on(L.LEVEL_PTS_UPDATED,(D,{details:k})=>A(k)),v.on(L.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const I=(D,k)=>{const G=this.getAssetPlayer(g);if(G&&k.tracks){G.off(L.BUFFER_CODECS,I),G.tracks=k.tracks;const U=this.primaryMedia;this.bufferingAsset===G.assetItem&&U&&!G.media&&this.bufferAssetPlayer(G,U)}};v.on(L.BUFFER_CODECS,I);const R=()=>{var D;const k=this.getAssetPlayer(g);if(this.log(`buffered to end of asset ${k}`),!k||!this.schedule)return;const G=this.schedule.findEventIndex(e.identifier),U=(D=this.schedule.items)==null?void 0:D[G];this.isInterstitial(U)&&this.advanceAssetBuffering(U,t)};v.on(L.BUFFERED_TO_END,R);const N=D=>()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;this.shouldPlay=!0;const G=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,G,D)};return v.once(L.MEDIA_ENDED,N(i)),v.once(L.PLAYOUT_LIMIT_REACHED,N(1/0)),v.on(L.ERROR,(D,k)=>{if(!this.schedule)return;const G=this.getAssetPlayer(g);if(k.details===Y.BUFFER_STALLED_ERROR){if(G!=null&&G.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(k,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${k.error} ${e}`)}),v.on(L.DESTROYING,()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;const k=new Error(`Asset player destroyed unexpectedly ${g}`),G={fatal:!0,type:Ae.OTHER_ERROR,details:Y.INTERSTITIAL_ASSET_ITEM_ERROR,error:k};this.handleAssetItemError(G,e,this.schedule.findEventIndex(e.identifier),i,k.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${tu(t)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:v}),v}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){const a=this.playerQueue[i];this.log(`clear ${a} toSegment: ${t&&yi(t)}`),this.transferMediaFromPlayer(a,t),this.playerQueue.splice(i,1),a.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,a,u){const{interstitial:l,assetItem:c,assetId:f}=e,h=l.assetList.length,m=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!m||m.identifier!==f)&&(m&&(this.clearAssetPlayer(m.identifier,i[a]),delete m.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${h} ${tu(c)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:t,event:l,schedule:i.slice(0),scheduleIndex:a,player:e})),this.bufferAssetPlayer(e,u)}bufferAssetPlayer(e,t){var i,a;if(!this.schedule)return;const{interstitial:u,assetItem:l}=e,c=this.schedule.findEventIndex(u.identifier),f=(i=this.schedule.items)==null?void 0:i[c];if(!f)return;e.loadSource(),this.setBufferingItem(f),this.bufferingAsset=l;const h=this.getBufferingPlayer();if(h===e)return;const m=u.appendInPlace;if(m&&(h==null?void 0:h.interstitial.appendInPlace)===!1)return;const g=(h==null?void 0:h.tracks)||((a=this.detachedData)==null?void 0:a.tracks)||this.requiredTracks;if(m&&l!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(g&&!G2(g,e.tracks)){const E=new Error(`Asset ${tu(l)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(g)}')`),T={fatal:!0,type:Ae.OTHER_ERROR,details:Y.INTERSTITIAL_ASSET_ITEM_ERROR,error:E},v=u.findAssetIndex(l);this.handleAssetItemError(T,u,c,v,E.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,i=this.primaryMedia;if(!t||!i)return;const a=i.currentTime,u=t.findAssetIndex(e,a),l=e.assetList[u];if(l){const c=this.getAssetPlayer(l.identifier);if(c){const f=c.currentTime||a-l.timelineStart,h=c.duration-f;if(this.warn(`Stalled at ${f} of ${f+h} in ${c} ${e} (media.currentTime: ${a})`),f&&(h/i.playbackRate<.5||c.bufferedInPlaceToEnd(i))&&c.hls){const m=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,m,u)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,i,a,u){if(e.details===Y.BUFFER_STALLED_ERROR)return;const l=t.assetList[a]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${l&&tu(l)} ${e.error}`),!this.schedule)return;const c=(l==null?void 0:l.identifier)||"",f=this.getAssetPlayerQueueIndex(c),h=this.playerQueue[f]||null,m=this.schedule.items,g=ot({},e,{fatal:!1,errorAction:au(!0),asset:l,assetListIndex:a,event:t,schedule:m,scheduleIndex:i,player:h});if(this.hls.trigger(L.INTERSTITIAL_ASSET_ERROR,g),!e.fatal)return;const E=this.playingAsset,T=this.bufferingAsset,v=new Error(u);if(l&&(this.clearAssetPlayer(c,null),l.error=v),!t.assetList.some(S=>!S.error))t.error=v;else for(let S=a;S<t.assetList.length;S++)this.resetAssetPlayer(t.assetList[S].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):E&&E.identifier===c?this.advanceAfterAssetEnded(t,i,a):T&&T.identifier===c&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,T)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;let a=this.timelinePos;if(i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${a} playing: ${yi(i)} error: ${e.error}`),a===-1&&(a=this.hls.startPosition);const l=this.updateItem(i,a);this.itemsMatch(i,l)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(a===-1){this.checkStart();return}if(!this.schedule)return;const u=this.schedule.findItemIndexAtTime(a);this.setSchedulePosition(u)}onAssetListLoaded(e,t){var i,a;const u=t.event,l=u.identifier,c=t.assetListResponse.ASSETS;if(!((i=this.schedule)!=null&&i.hasEvent(l)))return;const f=u.timelineStart,h=u.duration;let m=0;c.forEach((S,A)=>{const I=parseFloat(S.DURATION);this.createAsset(u,A,m,f+m,I,S.URI),m+=I}),u.duration=m,this.log(`Loaded asset-list with duration: ${m} (was: ${h}) ${u}`);const g=this.waitingItem,E=(g==null?void 0:g.event.identifier)===l;this.updateSchedule();const T=(a=this.bufferingItem)==null?void 0:a.event;if(E){var v;const S=this.schedule.findEventIndex(l),A=(v=this.schedule.items)==null?void 0:v[S];if(A){if(!this.playingItem&&this.timelinePos>A.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==S){u.error=new Error(`Interstitial ${c.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${u}`),this.log(u.error.message),this.updateSchedule(!0),this.primaryFallback(u);return}this.setBufferingItem(A)}this.setSchedulePosition(S)}else if((T==null?void 0:T.identifier)===l){const S=u.assetList[0];if(S){const A=this.getAssetPlayer(S.identifier);if(T.appendInPlace){const I=this.primaryMedia;A&&I&&this.bufferAssetPlayer(A,I)}else A&&A.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Y.ASSET_LIST_PARSING_ERROR:case Y.ASSET_LIST_LOAD_ERROR:case Y.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case Y.BUFFER_STALLED_ERROR:{const i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace){this.handleInPlaceStall(i.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const HT=500;class y5 extends Rg{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",ye.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ue.IDLE,this.setInterval(HT),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:a}=t;if(this.fragContextChanged(i)||(Ct(i)&&(this.fragPrevious=i),this.state=ue.IDLE),!a)return;const u=this.tracksBuffered[this.currentTrackId];if(!u)return;let l;const c=i.start;for(let h=0;h<u.length;h++)if(c>=u[h].start&&c<=u[h].end){l=u[h];break}const f=i.start+i.duration;l?l.end=f:(l={start:c,end:f},u.push(l)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:a}=t;if(i===0&&a!==Number.POSITIVE_INFINITY){const u=a-1;if(u<=0)return;t.endOffsetSubtitles=Math.max(0,u),this.tracksBuffered.forEach(l=>{for(let c=0;c<l.length;){if(l[c].end<=u){l.shift();continue}else if(l[c].start<u)l[c].start=u;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(i,u,ye.SUBTITLE)}}onError(e,t){const i=t.frag;(i==null?void 0:i.type)===ye.SUBTITLE&&(t.details===Y.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ue.STOPPED&&(this.state=ue.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Yv(this.levels,t)){this.levels=t.map(i=>new Zl(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const a=new Zl(i);return this.tracksBuffered[a.id]=[],a}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ye.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const a=this.levels[this.currentTrackId];a!=null&&a.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,a&&this.state!==ue.STOPPED&&this.setInterval(HT)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:a,levels:u}=this,{details:l,id:c}=t;if(!u){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const f=u[c];if(c>=u.length||!f)return;this.log(`Subtitle track ${c} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let h=0;if(l.live||(i=f.details)!=null&&i.live){if(l.deltaUpdateFailed)return;const g=this.mainDetails;if(!g){this.startFragRequested=!1;return}const E=g.fragments[0];if(!f.details)l.hasProgramDateTime&&g.hasProgramDateTime?(Pd(l,g),h=l.fragmentStart):E&&(h=E.start,wm(l,h));else{var m;h=this.alignPlaylists(l,f.details,(m=this.levelLastLoaded)==null?void 0:m.details),h===0&&E&&(h=E.start,wm(l,h))}g&&!this.startFragRequested&&this.setStartPosition(g,h)}f.details=l,this.levelLastLoaded=f,c===a&&(this.hls.trigger(L.SUBTITLE_TRACK_UPDATED,{details:l,id:c,groupId:t.groupId}),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===ue.IDLE&&(nr(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),f.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,a=t.decryptdata,u=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&a!=null&&a.key&&a.iv&&ru(a.method)){const l=performance.now();this.decrypter.decrypt(new Uint8Array(i),a.key.buffer,a.iv.buffer,Lg(a.method)).catch(c=>{throw u.trigger(L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const f=performance.now();u.trigger(L.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:l,tdecrypt:f}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=ue.IDLE})}}doTick(){if(!this.media){this.state=ue.IDLE;return}if(this.state===ue.IDLE){const{currentTrackId:e,levels:t}=this,i=t==null?void 0:t[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:a}=this,u=this.getLoadPosition(),l=ke.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],u,a.maxBufferHole),{end:c,len:f}=l,h=i.details,m=this.hls.maxBufferLength+h.levelTargetDuration;if(f>m)return;const g=h.fragments,E=g.length,T=h.edge;let v=null;const S=this.fragPrevious;if(c<T){const R=a.maxFragLookUpTolerance,N=c>T-R?0:R;v=nr(S,g,Math.max(g[0].start,c),N),!v&&S&&S.start<g[0].start&&(v=g[0])}else v=g[E-1];if(v=this.filterReplacedPrimary(v,i.details),!v)return;const A=v.sn-h.startSN,I=g[A-1];if(I&&I.cc===v.cc&&this.fragmentTracker.getState(I)===Kt.NOT_LOADED&&(v=I),this.fragmentTracker.getState(v)===Kt.NOT_LOADED){const R=this.mapToInitFragWhenRequired(v);R&&this.loadFragment(R,i,c)}}}loadFragment(e,t,i){Ct(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new v5(this.tracksBuffered[this.currentTrackId]||[])}}class v5{constructor(e){this.buffered=void 0;const t=(i,a,u)=>{if(a=a>>>0,a>u-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${a}) is greater than the maximum bound (${u})`);return e[a][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const S5={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},lS=s=>String.fromCharCode(S5[s]||s),vi=15,bn=100,A5={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},_5={17:2,18:4,21:6,22:8,23:10,19:13,20:15},L5={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},I5={25:2,26:4,29:6,30:8,31:10,27:13,28:15},R5=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class N5{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;nt.log(`${this.time} [${e}] ${i}`)}}}const Ga=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class oS{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const a=t[i];e.hasOwnProperty(a)&&(this[a]=e[a])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class C5{constructor(){this.uchar=" ",this.penState=new oS}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class D5{constructor(e){this.chars=[],this.pos=0,this.currPenState=new oS,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<bn;t++)this.chars.push(new C5);this.logger=e}equals(e){for(let t=0;t<bn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<bn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<bn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>bn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=bn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=lS(e);if(this.pos>=bn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<bn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<bn;i++){const a=this.chars[i].uchar;a!==" "&&(t=!1),e.push(a)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class z0{constructor(e){this.rows=[],this.currRow=vi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<vi;t++)this.rows.push(new D5(e));this.logger=e}reset(){for(let e=0;e<vi;e++)this.rows[e].clear();this.currRow=vi-1}equals(e){let t=!0;for(let i=0;i<vi;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<vi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<vi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+ft(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<vi;c++)this.rows[c].clear();const u=this.currRow+1-this.nrRollUpRows,l=this.lastOutputScreen;if(l){const c=l.rows[u].cueStartTime,f=this.logger.time;if(c!==null&&f!==null&&c<f)for(let h=0;h<this.nrRollUpRows;h++)this.rows[t-this.nrRollUpRows+h+1].copy(l.rows[u+h])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const u=e.indent,l=Math.max(u-1,0);i.setCursor(e.indent),e.color=i.chars[l].penState.foreground}const a={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(a)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+ft(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",a=-1;for(let u=0;u<vi;u++){const l=this.rows[u].getTextString();l&&(a=u+1,e?t.push("Row "+a+": '"+l+"'"):t.push(l.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class $T{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new z0(i),this.nonDisplayedMemory=new z0(i),this.lastOutputScreen=new z0(i),this.currRollUpRow=this.displayedMemory.rows[vi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[vi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,a=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=a[i]}this.logger.log(2,"MIDROW: "+ft(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class GT{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=w5(),this.logger=void 0;const a=this.logger=new N5;this.channels=[null,new $T(e,t,a),new $T(e+1,i,a)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const a=t[i]&127,u=t[i+1]&127;let l=!1,c=null;if(a===0&&u===0)continue;this.logger.log(3,()=>"["+Ga([t[i],t[i+1]])+"] -> ("+Ga([a,u])+")");const f=this.cmdHistory;if(a>=16&&a<=31){if(O5(a,u,f)){Wc(null,null,f),this.logger.log(3,()=>"Repeated command ("+Ga([a,u])+") is dropped");continue}Wc(a,u,this.cmdHistory),l=this.parseCmd(a,u),l||(l=this.parseMidrow(a,u)),l||(l=this.parsePAC(a,u)),l||(l=this.parseBackgroundAttributes(a,u))}else Wc(null,null,f);if(!l&&(c=this.parseChars(a,u),c)){const m=this.currentChannel;m&&m>0?this.channels[m].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!l&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Ga([a,u])+" orig: "+Ga([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,a=(e===23||e===31)&&t>=33&&t<=35;if(!(i||a))return!1;const u=e===20||e===21||e===23?1:2,l=this.channels[u];return e===20||e===21||e===28||e===29?t===32?l.ccRCL():t===33?l.ccBS():t===34?l.ccAOF():t===35?l.ccAON():t===36?l.ccDER():t===37?l.ccRU(2):t===38?l.ccRU(3):t===39?l.ccRU(4):t===40?l.ccFON():t===41?l.ccRDC():t===42?l.ccTR():t===43?l.ccRTD():t===44?l.ccEDM():t===45?l.ccCR():t===46?l.ccENM():t===47&&l.ccEOC():l.ccTO(t-32),this.currentChannel=u,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const a=this.channels[i];return a?(a.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Ga([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const a=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,u=(e===16||e===24)&&t>=64&&t<=95;if(!(a||u))return!1;const l=e<=23?1:2;t>=64&&t<=95?i=l===1?A5[e]:L5[e]:i=l===1?_5[e]:I5[e];const c=this.channels[l];return c?(c.setPAC(this.interpretPAC(i,t)),this.currentChannel=l,!0):!1}interpretPAC(e,t){let i;const a={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,a.underline=(i&1)===1,i<=13?a.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(a.italics=!0,a.color="white"):a.indent=Math.floor((i-16)/2)*4,a}parseChars(e,t){let i,a=null,u=null;if(e>=25?(i=2,u=e-8):(i=1,u=e),u>=17&&u<=19){let l;u===17?l=t+80:u===18?l=t+112:l=t+144,this.logger.log(2,()=>"Special char '"+lS(l)+"' in channel "+i),a=[l]}else e>=32&&e<=127&&(a=t===0?[e]:[e,t]);return a&&this.logger.log(3,()=>"Char codes =  "+Ga(a).join(",")),a}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,a=(e===23||e===31)&&t>=45&&t<=47;if(!(i||a))return!1;let u;const l={};e===16||e===24?(u=Math.floor((t-32)/2),l.background=R5[u],t%2===1&&(l.background=l.background+"_semi")):t===45?l.background="transparent":(l.foreground="black",t===47&&(l.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(l),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Wc(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function Wc(s,e,t){t.a=s,t.b=e}function O5(s,e,t){return t.a===s&&t.b===e}function w5(){return{a:null,b:null}}var jg=(function(){if(Md!=null&&Md.VTTCue)return self.VTTCue;const s=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,f){if(typeof f!="string"||!Array.isArray(c))return!1;const h=f.toLowerCase();return~c.indexOf(h)?h:!1}function i(c){return t(s,c)}function a(c){return t(e,c)}function u(c,...f){let h=1;for(;h<arguments.length;h++){const m=arguments[h];for(const g in m)c[g]=m[g]}return c}function l(c,f,h){const m=this,g={enumerable:!0};m.hasBeenReset=!1;let E="",T=!1,v=c,S=f,A=h,I=null,R="",N=!0,D="auto",k="start",G=50,U="middle",H=50,$="middle";Object.defineProperty(m,"id",u({},g,{get:function(){return E},set:function(F){E=""+F}})),Object.defineProperty(m,"pauseOnExit",u({},g,{get:function(){return T},set:function(F){T=!!F}})),Object.defineProperty(m,"startTime",u({},g,{get:function(){return v},set:function(F){if(typeof F!="number")throw new TypeError("Start time must be set to a number.");v=F,this.hasBeenReset=!0}})),Object.defineProperty(m,"endTime",u({},g,{get:function(){return S},set:function(F){if(typeof F!="number")throw new TypeError("End time must be set to a number.");S=F,this.hasBeenReset=!0}})),Object.defineProperty(m,"text",u({},g,{get:function(){return A},set:function(F){A=""+F,this.hasBeenReset=!0}})),Object.defineProperty(m,"region",u({},g,{get:function(){return I},set:function(F){I=F,this.hasBeenReset=!0}})),Object.defineProperty(m,"vertical",u({},g,{get:function(){return R},set:function(F){const ee=i(F);if(ee===!1)throw new SyntaxError("An invalid or illegal string was specified.");R=ee,this.hasBeenReset=!0}})),Object.defineProperty(m,"snapToLines",u({},g,{get:function(){return N},set:function(F){N=!!F,this.hasBeenReset=!0}})),Object.defineProperty(m,"line",u({},g,{get:function(){return D},set:function(F){if(typeof F!="number"&&F!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");D=F,this.hasBeenReset=!0}})),Object.defineProperty(m,"lineAlign",u({},g,{get:function(){return k},set:function(F){const ee=a(F);if(!ee)throw new SyntaxError("An invalid or illegal string was specified.");k=ee,this.hasBeenReset=!0}})),Object.defineProperty(m,"position",u({},g,{get:function(){return G},set:function(F){if(F<0||F>100)throw new Error("Position must be between 0 and 100.");G=F,this.hasBeenReset=!0}})),Object.defineProperty(m,"positionAlign",u({},g,{get:function(){return U},set:function(F){const ee=a(F);if(!ee)throw new SyntaxError("An invalid or illegal string was specified.");U=ee,this.hasBeenReset=!0}})),Object.defineProperty(m,"size",u({},g,{get:function(){return H},set:function(F){if(F<0||F>100)throw new Error("Size must be between 0 and 100.");H=F,this.hasBeenReset=!0}})),Object.defineProperty(m,"align",u({},g,{get:function(){return $},set:function(F){const ee=a(F);if(!ee)throw new SyntaxError("An invalid or illegal string was specified.");$=ee,this.hasBeenReset=!0}})),m.displayState=void 0}return l.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},l})();class k5{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function cS(s){function e(i,a,u,l){return(i|0)*3600+(a|0)*60+(u|0)+parseFloat(l||0)}const t=s.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class M5{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let a=0;a<i.length;++a)if(t===i[a]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function dS(s,e,t,i){const a=i?s.split(i):[s];for(const u in a){if(typeof a[u]!="string")continue;const l=a[u].split(t);if(l.length!==2)continue;const c=l[0],f=l[1];e(c,f)}}const Hm=new jg(0,0,""),Zc=Hm.align==="middle"?"middle":"center";function P5(s,e,t){const i=s;function a(){const c=cS(s);if(c===null)throw new Error("Malformed timestamp: "+i);return s=s.replace(/^[^\sa-zA-Z-]+/,""),c}function u(c,f){const h=new M5;dS(c,function(E,T){let v;switch(E){case"region":for(let S=t.length-1;S>=0;S--)if(t[S].id===T){h.set(E,t[S].region);break}break;case"vertical":h.alt(E,T,["rl","lr"]);break;case"line":v=T.split(","),h.integer(E,v[0]),h.percent(E,v[0])&&h.set("snapToLines",!1),h.alt(E,v[0],["auto"]),v.length===2&&h.alt("lineAlign",v[1],["start",Zc,"end"]);break;case"position":v=T.split(","),h.percent(E,v[0]),v.length===2&&h.alt("positionAlign",v[1],["start",Zc,"end","line-left","line-right","auto"]);break;case"size":h.percent(E,T);break;case"align":h.alt(E,T,["start",Zc,"end","left","right"]);break}},/:/,/\s/),f.region=h.get("region",null),f.vertical=h.get("vertical","");let m=h.get("line","auto");m==="auto"&&Hm.line===-1&&(m=-1),f.line=m,f.lineAlign=h.get("lineAlign","start"),f.snapToLines=h.get("snapToLines",!0),f.size=h.get("size",100),f.align=h.get("align",Zc);let g=h.get("position","auto");g==="auto"&&Hm.position===50&&(g=f.align==="start"||f.align==="left"?0:f.align==="end"||f.align==="right"?100:50),f.position=g}function l(){s=s.replace(/^\s+/,"")}if(l(),e.startTime=a(),l(),s.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);s=s.slice(3),l(),e.endTime=a(),l(),u(s,e)}function fS(s){return s.replace(/<br(?: \/)?>/gi,`
`)}class U5{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new k5,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let u=t.buffer,l=0;for(u=fS(u);l<u.length&&u[l]!=="\r"&&u[l]!==`
`;)++l;const c=u.slice(0,l);return u[l]==="\r"&&++l,u[l]===`
`&&++l,t.buffer=u.slice(l),c}function a(u){dS(u,function(l,c){},/:/)}try{let u="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;u=i();const c=u.match(/^()?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let l=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(l?l=!1:u=i(),t.state){case"HEADER":/:/.test(u)?a(u):u||(t.state="ID");continue;case"NOTE":u||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(u)){t.state="NOTE";break}if(!u)continue;if(t.cue=new jg(0,0,""),t.state="CUE",u.indexOf("-->")===-1){t.cue.id=u;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{P5(u,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=u.indexOf("-->")!==-1;if(!u||c&&(l=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=u}continue;case"BADCUE":u||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const B5=/\r\n|\n\r|\n|\r/g,Q0=function(e,t,i=0){return e.slice(i,i+t.length)===t},F5=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),a=parseInt(e.slice(-9,-7)),u=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ee(t)||!Ee(i)||!Ee(a)||!Ee(u))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*a,t+=3600*1e3*u,t};function Hg(s,e,t){return Bl(s.toString())+Bl(e.toString())+Bl(t)}const j5=function(e,t,i){let a=e[t],u=e[a.prevCC];if(!u||!u.new&&a.new){e.ccOffset=e.presentationOffset=a.start,a.new=!1;return}for(;(l=u)!=null&&l.new;){var l;e.ccOffset+=a.start-u.start,a.new=!1,a=u,u=e[a.prevCC]}e.presentationOffset=i};function H5(s,e,t,i,a,u,l){const c=new U5,f=Js(new Uint8Array(s)).trim().replace(B5,`
`).split(`
`),h=[],m=e?KO(e.baseTime,e.timescale):0;let g="00:00.000",E=0,T=0,v,S=!0;c.oncue=function(A){const I=t[i];let R=t.ccOffset;const N=(E-m)/9e4;if(I!=null&&I.new&&(T!==void 0?R=t.ccOffset=I.start:j5(t,i,N)),N){if(!e){v=new Error("Missing initPTS for VTT MPEGTS");return}R=N-t.presentationOffset}const D=A.endTime-A.startTime,k=Xs((A.startTime+R-T)*9e4,a*9e4)/9e4;A.startTime=Math.max(k,0),A.endTime=Math.max(k+D,0);const G=A.text.trim();A.text=decodeURIComponent(encodeURIComponent(G)),A.id||(A.id=Hg(A.startTime,A.endTime,G)),A.endTime>0&&h.push(A)},c.onparsingerror=function(A){v=A},c.onflush=function(){if(v){l(v);return}u(h)},f.forEach(A=>{if(S)if(Q0(A,"X-TIMESTAMP-MAP=")){S=!1,A.slice(16).split(",").forEach(I=>{Q0(I,"LOCAL:")?g=I.slice(6):Q0(I,"MPEGTS:")&&(E=parseInt(I.slice(7)))});try{T=F5(g)/1e3}catch(I){v=I}return}else A===""&&(S=!1);c.parse(A+`
`)}),c.flush()}const X0="stpp.ttml.im1t",hS=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,mS=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,$5={left:"start",center:"center",right:"end",start:"start",end:"end"};function VT(s,e,t,i){const a=Be(new Uint8Array(s),["mdat"]);if(a.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const u=a.map(c=>Js(c)),l=YO(e.baseTime,1,e.timescale);try{u.forEach(c=>t(G5(c,l)))}catch(c){i(c)}}function G5(s,e){const a=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("tt")[0];if(!a)throw new Error("Invalid ttml");const u={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},l=Object.keys(u).reduce((g,E)=>(g[E]=a.getAttribute(`ttp:${E}`)||u[E],g),{}),c=a.getAttribute("xml:space")!=="preserve",f=qT(W0(a,"styling","style")),h=qT(W0(a,"layout","region")),m=W0(a,"body","[begin]");return[].map.call(m,g=>{const E=gS(g,c);if(!E||!g.hasAttribute("begin"))return null;const T=J0(g.getAttribute("begin"),l),v=J0(g.getAttribute("dur"),l);let S=J0(g.getAttribute("end"),l);if(T===null)throw YT(g);if(S===null){if(v===null)throw YT(g);S=T+v}const A=new jg(T-e,S-e,E);A.id=Hg(A.startTime,A.endTime,A.text);const I=h[g.getAttribute("region")],R=f[g.getAttribute("style")],N=V5(I,R,f),{textAlign:D}=N;if(D){const k=$5[D];k&&(A.lineAlign=k),A.align=D}return ot(A,N),A}).filter(g=>g!==null)}function W0(s,e,t){const i=s.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function qT(s){return s.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function gS(s,e){return[].slice.call(s.childNodes).reduce((t,i,a)=>{var u;return i.nodeName==="br"&&a?t+`
`:(u=i.childNodes)!=null&&u.length?gS(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function V5(s,e,t){const i="http://www.w3.org/ns/ttml#styling";let a=null;const u=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],l=s!=null&&s.hasAttribute("style")?s.getAttribute("style"):null;return l&&t.hasOwnProperty(l)&&(a=t[l]),u.reduce((c,f)=>{const h=Z0(e,i,f)||Z0(s,i,f)||Z0(a,i,f);return h&&(c[f]=h),c},{})}function Z0(s,e,t){return s&&s.hasAttributeNS(e,t)?s.getAttributeNS(e,t):null}function YT(s){return new Error(`Could not parse ttml timestamp ${s}`)}function J0(s,e){if(!s)return null;let t=cS(s);return t===null&&(hS.test(s)?t=q5(s,e):mS.test(s)&&(t=Y5(s,e))),t}function q5(s,e){const t=hS.exec(s),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function Y5(s,e){const t=mS.exec(s),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class Jc{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class K5{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=zT(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Jc(this,"textTrack1"),t=new Jc(this,"textTrack2"),i=new Jc(this,"textTrack3"),a=new Jc(this,"textTrack4");this.cea608Parser1=new GT(1,e,t),this.cea608Parser2=new GT(3,i,a)}addCues(e,t,i,a,u){let l=!1;for(let c=u.length;c--;){const f=u[c],h=z5(f[0],f[1],t,i);if(h>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],i),l=!0,h/(i-t)>.5))return}if(l||u.push([t,i]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,i,a)}else{const c=this.Cues.newCue(null,t,i,a);this.hls.trigger(L.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:a,timescale:u,trackId:l}){const{unparsedVttFrags:c}=this;i===ye.MAIN&&(this.initPTS[t.cc]={baseTime:a,timescale:u,trackId:l}),c.length&&(this.unparsedVttFrags=[],c.forEach(f=>{this.initPTS[f.frag.cc]?this.onFragLoaded(L.FRAG_LOADED,f):this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:f.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let a=0;a<i.textTracks.length;a++){const u=i.textTracks[a];if(KT(u,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return u}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:a}=this,{label:u,languageCode:l}=t[e],c=this.getExistingTrack(u,l);if(c)i[e]=c,su(i[e]),aS(i[e],a);else{const f=this.createTextTrack("captions",u,l);f&&(f[e]=!0,i[e]=f)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,a={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=a,this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[a]})}createTextTrack(e,t,i){const a=this.media;if(a)return a.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:a}=this;Object.keys(a).forEach(u=>{su(a[u]),delete a[u]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=zT(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)su(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],a=i.some(u=>u.textCodec===X0);if(this.config.enableWebVTT||a&&this.config.enableIMSC1){if(Yv(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const l=this.media,c=l?dd(l.textTracks):null;if(this.tracks.forEach((f,h)=>{let m;if(c){let g=null;for(let E=0;E<c.length;E++)if(c[E]&&KT(c[E],f)){g=c[E],c[E]=null;break}g&&(m=g)}if(m)su(m);else{const g=pS(f);m=this.createTextTrack(g,f.name,f.lang),m&&(m.mode="disabled")}m&&this.textTracks.push(m)}),c!=null&&c.length){const f=c.filter(h=>h!==null).map(h=>h.label);f.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${f.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const l=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const a=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!a)return;const u=`textTrack${a[1]}`,l=this.captionsProperties[u];l&&(l.label=i.name,i.lang&&(l.languageCode=i.lang),l.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ye.MAIN){var i,a;const{cea608Parser1:u,cea608Parser2:l,lastSn:c}=this,{cc:f,sn:h}=t.frag,m=(i=(a=t.part)==null?void 0:a.index)!=null?i:-1;u&&l&&(h!==c+1||h===c&&m!==this.lastPartIndex+1||f!==this.lastCc)&&(u.reset(),l.reset()),this.lastCc=f,this.lastSn=h,this.lastPartIndex=m}}onFragLoaded(e,t){const{frag:i,payload:a}=t;if(i.type===ye.SUBTITLE)if(a.byteLength){const u=i.decryptdata,l="stats"in t;if(u==null||!u.encrypted||l){const c=this.tracks[i.level],f=this.vttCCs;f[i.cc]||(f[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),c&&c.textCodec===X0?this._parseIMSC1(i,a):this._parseVTTs(t)}}else this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;VT(t,this.initPTS[e.cc],a=>{this._appendCues(a,e.level),i.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},a=>{i.logger.log(`Failed to parse IMSC1: ${a}`),i.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})}_parseVTTs(e){var t;const{frag:i,payload:a}=e,{initPTS:u,unparsedVttFrags:l}=this,c=u.length-1;if(!u[i.cc]&&c===-1){l.push(e);return}const f=this.hls,h=(t=i.initSegment)!=null&&t.data?mi(i.initSegment.data,new Uint8Array(a)).buffer:a;H5(h,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,m=>{this._appendCues(m,i.level),f.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},m=>{const g=m.message==="Missing initPTS for VTT MPEGTS";g?l.push(e):this._fallbackToIMSC1(i,a),f.logger.log(`Failed to parse VTT cue: ${m}`),!(g&&c>i.cc)&&f.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:m})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||VT(t,this.initPTS[e.cc],()=>{i.textCodec=X0,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const a=this.textTracks[t];if(!a||a.mode==="disabled")return;e.forEach(u=>rS(a,u))}else{const a=this.tracks[t];if(!a)return;const u=a.default?"default":"subtitles"+t;i.trigger(L.CUES_PARSED,{type:"subtitles",cues:e,track:u})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===ye.SUBTITLE&&this.onFragLoaded(L.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:a}=t;if(!(i.type===ye.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let u=0;u<a.length;u++){const l=a[u].bytes;if(l){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(l);this.cea608Parser1.addData(a[u].pts,c[0]),this.cea608Parser2.addData(a[u].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:a,type:u}){const{media:l}=this;if(!(!l||l.currentTime<i)){if(!u||u==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(f=>jm(c[f],t,i))}if(this.config.renderTextTracksNatively&&t===0&&a!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(f=>jm(c[f],t,a))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let a=2;for(let u=0;u<i;u++){const l=e[a++],c=127&e[a++],f=127&e[a++];if(c===0&&f===0)continue;if((4&l)!==0){const m=3&l;(m===0||m===1)&&(t[m].push(c),t[m].push(f))}}return t}}function pS(s){return s.characteristics&&/transcribes-spoken-dialog/gi.test(s.characteristics)&&/describes-music-and-sound/gi.test(s.characteristics)?"captions":"subtitles"}function KT(s,e){return!!s&&s.kind===pS(e)&&Pm(e,s)}function z5(s,e,t,i){return Math.min(e,i)-Math.max(s,t)}function zT(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const Q5=/\s/,X5={newCue(s,e,t,i){const a=[];let u,l,c,f,h;const m=self.VTTCue||self.TextTrackCue;for(let E=0;E<i.rows.length;E++)if(u=i.rows[E],c=!0,f=0,h="",!u.isEmpty()){var g;for(let S=0;S<u.chars.length;S++)Q5.test(u.chars[S].uchar)&&c?f++:(h+=u.chars[S].uchar,c=!1);u.cueStartTime=e,e===t&&(t+=1e-4),f>=16?f--:f++;const T=fS(h.trim()),v=Hg(e,t,T);s!=null&&(g=s.cues)!=null&&g.getCueById(v)||(l=new m(e,t,T),l.id=v,l.line=E+1,l.align="left",l.position=10+Math.min(80,Math.floor(f*8/32)*10),a.push(l))}return s&&a.length&&(a.sort((E,T)=>E.line==="auto"||T.line==="auto"?0:E.line>8&&T.line>8?T.line-E.line:E.line-T.line),a.forEach(E=>rS(s,E))),a}};function W5(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const Z5=/(\d+)-(\d+)\/(\d+)/;class QT{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||sk,this.controller=new self.AbortController,this.stats=new xg}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();const u=J5(e,this.controller.signal),l=e.responseType==="arraybuffer",c=l?"byteLength":"length",{maxTimeToFirstByteMs:f,maxLoadTimeMs:h}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,u),self.clearTimeout(this.requestTimeout),t.timeout=f&&Ee(f)?f:h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(a,e,this.response))},t.timeout),(to(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(g=>{var E;this.response=this.loader=g;const T=Math.max(self.performance.now(),a.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=h,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(a,e,this.response))},h-(T-a.loading.start)),!g.ok){const{status:S,statusText:A}=g;throw new ik(A||"fetch, bad network response",S,g)}a.loading.first=T,a.total=tk(g.headers)||a.total;const v=(E=this.callbacks)==null?void 0:E.onProgress;return v&&Ee(t.highWaterMark)?this.loadProgressively(g,a,e,t.highWaterMark,v):l?g.arrayBuffer():e.responseType==="json"?g.json():g.text()}).then(g=>{var E,T;const v=this.response;if(!v)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first);const S=g[c];S&&(a.loaded=a.total=S);const A={url:v.url,data:g,code:v.status},I=(E=this.callbacks)==null?void 0:E.onProgress;I&&!Ee(t.highWaterMark)&&I(a,e,g,v),(T=this.callbacks)==null||T.onSuccess(A,a,e,v)}).catch(g=>{var E;if(self.clearTimeout(this.requestTimeout),a.aborted)return;const T=g&&g.code||0,v=g?g.message:null;(E=this.callbacks)==null||E.onError({code:T,text:v},e,g?g.details:null,a)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,a=0,u){const l=new Lv,c=e.body.getReader(),f=()=>c.read().then(h=>{if(h.done)return l.dataLength&&u(t,i,l.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const m=h.value,g=m.length;return t.loaded+=g,g<a||l.dataLength?(l.push(m),l.dataLength>=a&&u(t,i,l.flush().buffer,e)):u(t,i,m.buffer,e),f()}).catch(()=>Promise.reject());return f()}}function J5(s,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(ot({},s.headers))};return s.rangeEnd&&t.headers.set("Range","bytes="+s.rangeStart+"-"+String(s.rangeEnd-1)),t}function ek(s){const e=Z5.exec(s);if(e)return parseInt(e[2])-parseInt(e[1])+1}function tk(s){const e=s.get("Content-Range");if(e){const i=ek(e);if(Ee(i))return i}const t=s.get("Content-Length");if(t)return parseInt(t)}function sk(s,e){return new self.Request(s.url,e)}class ik extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const nk=/^age:\s*[\d.]+\s*$/im;class bS{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new xg,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,a=this.stats;a.loading.first=0,a.loaded=0,a.aborted=!1;const u=this.xhrSetup;u?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return u(i,t.url)}).catch(l=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),u(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(l=>{var c;(c=this.callbacks)==null||c.onError({code:i.status,text:l.message},t,i,a)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const a=t.headers,{maxTimeToFirstByteMs:u,maxLoadTimeMs:l}=i.loadPolicy;if(a)for(const c in a)e.setRequestHeader(c,a[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=u&&Ee(u)?u:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const a=t.readyState,u=this.config;if(!i.aborted&&a>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),u.timeout!==u.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),u.timeout=u.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),u.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),a===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const h=t.status,m=t.responseType==="text"?t.responseText:null;if(h>=200&&h<300){const v=m??t.response;if(v!=null){var l,c;i.loading.end=Math.max(self.performance.now(),i.loading.first);const S=t.responseType==="arraybuffer"?v.byteLength:v.length;i.loaded=i.total=S,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const A=(l=this.callbacks)==null?void 0:l.onProgress;A&&A(i,e,v,t);const I={url:t.responseURL,data:v,code:h};(c=this.callbacks)==null||c.onSuccess(I,i,e,t);return}}const g=u.loadPolicy.errorRetry,E=i.retry,T={url:e.url,data:void 0,code:h};if(wd(g,E,!1,T))this.retry(g);else{var f;nt.error(`${h} while loading ${e.url}`),(f=this.callbacks)==null||f.onError({code:h,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(wd(e,t,!0))this.retry(e);else{var i;nt.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const a=this.callbacks;a&&(this.abortInternal(),a.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=Sg(e,i.retry),i.retry++,nt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&nk.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const ak={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},rk=it(it({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:bS,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:E8,bufferController:lw,capLevelController:Ug,errorController:S8,fpsController:o5,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:gv,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:ak},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},uk()),{},{subtitleStreamController:y5,subtitleTrackController:f5,timelineController:K5,audioStreamController:nw,audioTrackController:aw,emeController:uu,cmcdController:a5,contentSteeringController:u5,interstitialsController:T5});function uk(){return{cueHandler:X5,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function lk(s,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=$m(s),a=["manifest","level","frag"],u=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return a.forEach(l=>{const c=`${l==="level"?"playlist":l}LoadPolicy`,f=e[c]===void 0,h=[];u.forEach(m=>{const g=`${l}Loading${m}`,E=e[g];if(E!==void 0&&f){h.push(g);const T=i[c].default;switch(e[c]={default:T},m){case"TimeOut":T.maxLoadTimeMs=E,T.maxTimeToFirstByteMs=E;break;case"MaxRetry":T.errorRetry.maxNumRetry=E,T.timeoutRetry.maxNumRetry=E;break;case"RetryDelay":T.errorRetry.retryDelayMs=E,T.timeoutRetry.retryDelayMs=E;break;case"MaxRetryTimeout":T.errorRetry.maxRetryDelayMs=E,T.timeoutRetry.maxRetryDelayMs=E;break}}}),h.length&&t.warn(`hls.js config: "${h.join('", "')}" setting(s) are deprecated, use "${c}": ${ft(e[c])}`)}),it(it({},i),e)}function $m(s){return s&&typeof s=="object"?Array.isArray(s)?s.map($m):Object.keys(s).reduce((e,t)=>(e[t]=$m(s[t]),e),{}):s}function ok(s,e){const t=s.loader;t!==QT&&t!==bS?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1):W5()&&(s.loader=QT,s.progressive=!0,s.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const fd=2,ck=.1,dk=.05,fk=100;class hk extends cv{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(fk),this.mediaSource=t.mediaSource;const i=this.media=t.media;vs(i,"playing",this.onMediaPlaying),vs(i,"waiting",this.onMediaWaiting),vs(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(Bs(i,"playing",this.onMediaPlaying),Bs(i,"waiting",this.onMediaWaiting),Bs(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,a;const u=(i=this.hls)==null?void 0:i.config;if(!u)return;const l=this.media;if(!l)return;const{seeking:c}=l,f=this.seeking&&!c,h=!this.seeking&&c,m=l.paused&&!c||l.ended||l.playbackRate===0;if(this.seeking=c,e!==t){t&&(this.ended=0),this.moved=!0,c||(this.nudgeRetry=0,u.nudgeOnVideoHole&&!m&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(h||f){f&&this.stallResolved(e);return}if(m){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&l.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1}));return}if(!ke.getBuffered(l).length){this.nudgeRetry=0;return}const g=ke.bufferInfo(l,e,0),E=g.nextStart||0,T=this.fragmentTracker;if(c&&T&&this.hls){const G=XT(this.hls.inFlightFragments,e),U=g.len>fd,H=!E||G||E-e>fd&&!T.getPartialFragment(e);if(U||H)return;this.moved=!1}const v=(a=this.hls)==null?void 0:a.latestLevelDetails;if(!this.moved&&this.stalled!==null&&T){if(!(g.len>0)&&!E)return;const U=Math.max(E,g.start||0)-e,$=!!(v!=null&&v.live)?v.targetduration*2:fd,F=ed(e,T);if(U>0&&(U<=$||F)){l.paused||this._trySkipBufferHole(F);return}}const S=u.detectStallWithCurrentTimeMs,A=self.performance.now(),I=this.waiting;let R=this.stalled;if(R===null)if(I>0&&A-I<S)R=this.stalled=I;else{this.stalled=A;return}const N=A-R;if(!c&&(N>=S||I)&&this.hls){var D;if(((D=this.mediaSource)==null?void 0:D.readyState)==="ended"&&!(v!=null&&v.live)&&Math.abs(e-((v==null?void 0:v.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(g),!this.media||!this.hls)return}const k=ke.bufferInfo(l,e,u.maxBufferHole);this._tryFixBufferStall(k,N,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(L.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const a=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&a&&a.length>1&&e>a.end(0)){const u=ke.bufferedInfo(ke.timeRangesToArray(this.buffered.audio),e,0);if(u.len>1&&t>=u.start){const l=ke.timeRangesToArray(a),c=ke.bufferedInfo(l,t,0).bufferedIndex;if(c>-1&&c<l.length-1){const f=ke.bufferedInfo(l,e,0).bufferedIndex,h=l[c].end,m=l[c+1].start;if((f===-1||f>c)&&m-h<1&&e-h<2){const g=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${h} -> ${m} buffered index: ${f}`);this.warn(g.message),this.media.currentTime+=1e-6;let E=ed(e,this.fragmentTracker);E&&"fragment"in E?E=E.fragment:E||(E=void 0);const T=ke.bufferInfo(this.media,e,0);this.hls.trigger(L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:E,buffer:T.len,bufferInfo:T})}}}}}_tryFixBufferStall(e,t,i){var a,u;const{fragmentTracker:l,media:c}=this,f=(a=this.hls)==null?void 0:a.config;if(!c||!l||!f)return;const h=(u=this.hls)==null?void 0:u.latestLevelDetails,m=ed(i,l);if((m||h!=null&&h.live&&i<h.fragmentStart)&&(this._trySkipBufferHole(m)||!this.media))return;const g=e.buffered,E=this.adjacentTraversal(e,i);(g&&g.length>1&&e.len>f.maxBufferHole||e.nextStart&&(e.nextStart-i<f.maxBufferHole||E))&&(t>f.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const i=this.fragmentTracker,a=e.nextStart;if(i&&a){const u=i.getFragAtPos(t,ye.MAIN),l=i.getFragAtPos(a,ye.MAIN);if(u&&l)return l.sn-u.sn<2}return!1}_reportStall(e){const{hls:t,media:i,stallReported:a,stalled:u}=this;if(!a&&u!==null&&i&&t){this.stallReported=!0;const l=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${ft(e)})`);this.warn(l.message),t.trigger(L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.BUFFER_STALLED_ERROR,fatal:!1,error:l,buffer:e.len,bufferInfo:e,stalled:{start:u}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:a}=this,u=(t=this.hls)==null?void 0:t.config;if(!a||!i||!u)return 0;const l=a.currentTime,c=ke.bufferInfo(a,l,0),f=l<c.start?c.start:c.nextStart;if(f&&this.hls){const m=c.len<=u.maxBufferHole,g=c.len>0&&c.len<1&&a.readyState<3,E=f-l;if(E>0&&(m||g)){if(E>u.maxBufferHole){let v=!1;if(l===0){const S=i.getAppendedFrag(0,ye.MAIN);S&&f<S.end&&(v=!0)}if(!v&&e){var h;if(!((h=this.hls.loadLevelObj)!=null&&h.details)||XT(this.hls.inFlightFragments,f))return 0;let A=!1,I=e.end;for(;I<f;){const R=ed(I,i);if(R)I+=R.duration;else{A=!0;break}}if(A)return 0}}const T=Math.max(f+dk,l+ck);if(this.warn(`skipping hole, adjusting currentTime from ${l} to ${T}`),this.moved=!0,a.currentTime=T,!(e!=null&&e.gap)){const v=new Error(`fragment loaded with buffer holes, seeking from ${l} to ${T}`),S={type:Ae.MEDIA_ERROR,details:Y.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:v,reason:v.message,buffer:c.len,bufferInfo:c};e&&("fragment"in e?S.part=e:S.frag=e),this.hls.trigger(L.ERROR,S)}return T}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:a}=this,u=t==null?void 0:t.config;if(!i||!u)return 0;const l=i.currentTime;if(this.nudgeRetry++,a<u.nudgeMaxRetry){const c=l+(a+1)*u.nudgeOffset,f=new Error(`Nudging 'currentTime' from ${l} to ${c}`);this.warn(f.message),i.currentTime=c,t.trigger(L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.BUFFER_NUDGE_ON_STALL,error:f,fatal:!1,buffer:e.len,bufferInfo:e})}else{const c=new Error(`Playhead still not moving while enough data buffered @${l} after ${u.nudgeMaxRetry} nudges`);this.error(c.message),t.trigger(L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:e.len,bufferInfo:e})}}}function XT(s,e){const t=WT(s.main);if(t&&t.start<=e)return t;const i=WT(s.audio);return i&&i.start<=e?i:null}function WT(s){if(!s)return null;switch(s.state){case ue.IDLE:case ue.STOPPED:case ue.ENDED:case ue.ERROR:return null}return s.frag}function ed(s,e){return e.getAppendedFrag(s,ye.MAIN)||e.getPartialFragment(s)}const mk=.25;function Gm(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function em(s,e,t,i,a){let u=new s(e,t,"");try{u.value=i,a&&(u.type=a)}catch{u=new s(e,t,ft(a?it({type:a},i):i))}return u}const td=(()=>{const s=Gm();try{s&&new s(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class gk{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(L.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&su(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return aS(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:i,enableID3MetadataCues:a}=this.hls.config;if(!i&&!a)return;const{samples:u}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=Gm();if(l)for(let c=0;c<u.length;c++){const f=u[c].type;if(f===Zs.emsg&&!i||!a)continue;const h=wv(u[c].data),m=u[c].pts;let g=m+u[c].duration;g>td&&(g=td),g-m<=0&&(g=m+mk);for(let T=0;T<h.length;T++){const v=h[T];if(!kv(v)){this.updateId3CueEnds(m,f);const S=em(l,m,g,v,f);S&&this.id3Track.addCue(S)}}}}updateId3CueEnds(e,t){var i;const a=(i=this.id3Track)==null?void 0:i.cues;if(a)for(let u=a.length;u--;){const l=a[u];l.type===t&&l.startTime<e&&l.endTime===td&&(l.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:a}){const{id3Track:u,hls:l}=this;if(!l)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:f}}=l;if(u&&(c||f)){let h;a==="audio"?h=m=>m.type===Zs.audioId3&&f:a==="video"?h=m=>m.type===Zs.emsg&&c:h=m=>m.type===Zs.audioId3&&f||m.type===Zs.emsg&&c,jm(u,t,i,h)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:i,timelineOffset:a,enableDateRangeMetadataCues:u,interstitialsController:l}=this.hls.config;if(!u)return;const c=Gm();if(i&&a&&!l){const{fragmentStart:S,fragmentEnd:A}=e;let I=this.assetCue;I?(I.startTime=S,I.endTime=A):c&&(I=this.assetCue=em(c,S,A,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),I&&(I.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(I),I.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:f}=this,{dateRanges:h}=e,m=Object.keys(h);let g=this.dateRangeCuesAppended;if(f&&t){var E;if((E=f.cues)!=null&&E.length){const S=Object.keys(g).filter(A=>!m.includes(A));for(let A=S.length;A--;){var T;const I=S[A],R=(T=g[I])==null?void 0:T.cues;delete g[I],R&&Object.keys(R).forEach(N=>{const D=R[N];if(D){D.removeEventListener("enter",this.onEventCueEnter);try{f.removeCue(D)}catch{}}})}}else g=this.dateRangeCuesAppended={}}const v=e.fragments[e.fragments.length-1];if(!(m.length===0||!Ee(v==null?void 0:v.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let S=0;S<m.length;S++){const A=m[S],I=h[A],R=I.startTime,N=g[A],D=(N==null?void 0:N.cues)||{};let k=(N==null?void 0:N.durationKnown)||!1,G=td;const{duration:U,endDate:H}=I;if(H&&U!==null)G=R+U,k=!0;else if(I.endOnNext&&!k){const F=m.reduce((ee,me)=>{if(me!==I.id){const be=h[me];if(be.class===I.class&&be.startDate>I.startDate&&(!ee||I.startDate<ee.startDate))return be}return ee},null);F&&(G=F.startTime,k=!0)}const $=Object.keys(I.attr);for(let F=0;F<$.length;F++){const ee=$[F];if(!P8(ee))continue;const me=D[ee];if(me)k&&!(N!=null&&N.durationKnown)?me.endTime=G:Math.abs(me.startTime-R)>.01&&(me.startTime=R,me.endTime=G);else if(c){let be=I.attr[ee];U8(ee)&&(be=V2(be));const ne=em(c,R,G,{key:ee,data:be},Zs.dateRange);ne&&(ne.id=A,this.id3Track.addCue(ne),D[ee]=ne,l&&(ee==="X-ASSET-LIST"||ee==="X-ASSET-URL")&&ne.addEventListener("enter",this.onEventCueEnter))}}g[A]={cues:D,dateRange:I,durationKnown:k}}}}}class pk{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const a=this.computeLatency();if(a===null)return;this._latency=a;const{lowLatencyMode:u,maxLiveSyncPlaybackRate:l}=this.config;if(!u||l===1||!i.live)return;const c=this.targetLatency;if(c===null)return;const f=a-c,h=Math.min(this.maxLatency,c+i.targetduration);if(f<h&&f>.05&&this.forwardBufferLength>1){const g=Math.min(2,Math.max(1,l)),E=Math.round(2/(1+Math.exp(-.75*f-this.edgeStalled))*20)/20,T=Math.min(g,Math.max(1,E));this.changeMediaPlaybackRate(t,T)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:a}=e,{liveSyncDuration:u,liveSyncDurationCount:l,lowLatencyMode:c}=this.config,f=this.hls.userConfig;let h=c&&i||t;(this._targetLatencyUpdated||f.liveSyncDuration||f.liveSyncDurationCount||h===0)&&(h=u!==void 0?u:l*a);const m=a;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,m)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const a=i.edge,u=e-t-this.edgeStalled,l=a-i.totalduration,c=a-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(l,u),c)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===Y.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,a;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(a=this.targetLatency)==null?void 0:a.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class bk extends Pg{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,a=[],u={},l={};let c=!1,f=!1,h=!1;t.levels.forEach(m=>{const g=m.attrs;let{audioCodec:E,videoCodec:T}=m;E&&(m.audioCodec=E=Nd(E,i)||void 0),T&&(T=m.videoCodec=JD(T));const{width:v,height:S,unknownCodecs:A}=m,I=(A==null?void 0:A.length)||0;if(c||(c=!!(v&&S)),f||(f=!!T),h||(h=!!E),I||E&&!this.isAudioSupported(E)||T&&!this.isVideoSupported(T)){this.log(`Some or all CODECS not supported "${g.CODECS}"`);return}const{CODECS:R,"FRAME-RATE":N,"HDCP-LEVEL":D,"PATHWAY-ID":k,RESOLUTION:G,"VIDEO-RANGE":U}=g,$=`${`${k||"."}-`}${m.bitrate}-${G}-${N}-${R}-${U}-${D}`;if(u[$])if(u[$].uri!==m.url&&!m.attrs["PATHWAY-ID"]){const F=l[$]+=1;m.attrs["PATHWAY-ID"]=new Array(F+1).join(".");const ee=this.createLevel(m);u[$]=ee,a.push(ee)}else u[$].addGroupId("audio",g.AUDIO),u[$].addGroupId("text",g.SUBTITLES);else{const F=this.createLevel(m);u[$]=F,l[$]=1,a.push(F)}}),this.filterAndSortMediaOptions(a,t,c,f,h)}createLevel(e){const t=new Zl(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const a=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(a.message),t.supportedResult=sv(a,[])}return t}isAudioSupported(e){return Xl(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Xl(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,a,u){var l;let c=[],f=[],h=e;const m=((l=t.stats)==null?void 0:l.parsing)||{};if((i||a)&&u&&(h=h.filter(({videoCodec:R,videoRange:N,width:D,height:k})=>(!!R||!!(D&&k))&&o8(N))),h.length===0){Promise.resolve().then(()=>{if(this.hls){let R="no level with compatible codecs found in manifest",N=R;t.levels.length&&(N=`one or more CODECS in variant not supported: ${ft(t.levels.map(k=>k.attrs.CODECS).filter((k,G,U)=>U.indexOf(k)===G))}`,this.warn(N),R+=` (${N})`);const D=new Error(R);this.hls.trigger(L.ERROR,{type:Ae.MEDIA_ERROR,details:Y.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:D,reason:N})}}),m.end=performance.now();return}t.audioTracks&&(c=t.audioTracks.filter(R=>!R.audioCodec||this.isAudioSupported(R.audioCodec)),ZT(c)),t.subtitles&&(f=t.subtitles,ZT(f));const g=h.slice(0);h.sort((R,N)=>{if(R.attrs["HDCP-LEVEL"]!==N.attrs["HDCP-LEVEL"])return(R.attrs["HDCP-LEVEL"]||"")>(N.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&R.height!==N.height)return R.height-N.height;if(R.frameRate!==N.frameRate)return R.frameRate-N.frameRate;if(R.videoRange!==N.videoRange)return Cd.indexOf(R.videoRange)-Cd.indexOf(N.videoRange);if(R.videoCodec!==N.videoCodec){const D=Gx(R.videoCodec),k=Gx(N.videoCodec);if(D!==k)return k-D}if(R.uri===N.uri&&R.codecSet!==N.codecSet){const D=Rd(R.codecSet),k=Rd(N.codecSet);if(D!==k)return k-D}return R.averageBitrate!==N.averageBitrate?R.averageBitrate-N.averageBitrate:0});let E=g[0];if(this.steering&&(h=this.steering.filterParsedLevels(h),h.length!==g.length)){for(let R=0;R<g.length;R++)if(g[R].pathwayId===h[0].pathwayId){E=g[R];break}}this._levels=h;for(let R=0;R<h.length;R++)if(h[R]===E){var T;this._firstLevel=R;const N=E.bitrate,D=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${h.length} level(s) found, first bitrate: ${N}`),((T=this.hls.userConfig)==null?void 0:T.abrEwmaDefaultEstimate)===void 0){const k=Math.min(N,this.hls.config.abrEwmaDefaultEstimateMax);k>D&&D===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}const v=u&&!a,S=this.hls.config,A=!!(S.audioStreamController&&S.audioTrackController),I={levels:h,audioTracks:c,subtitleTracks:f,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:u,video:a,altAudio:A&&!v&&c.some(R=>!!R.url)};m.end=performance.now(),this.hls.trigger(L.MANIFEST_PARSED,I)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const m=new Error("invalid level idx"),g=e<0;if(this.hls.trigger(L.ERROR,{type:Ae.OTHER_ERROR,details:Y.LEVEL_SWITCH_ERROR,level:e,fatal:g,error:m,reason:m.message}),g)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,a=this.currentLevel,u=a?a.attrs["PATHWAY-ID"]:void 0,l=t[e],c=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=l,i===e&&a&&u===c)return;this.log(`Switching to level ${e} (${l.height?l.height+"p ":""}${l.videoRange?l.videoRange+" ":""}${l.codecSet?l.codecSet+" ":""}@${l.bitrate})${c?" with Pathway "+c:""} from level ${i}${u?" with Pathway "+u:""}`);const f={level:e,attrs:l.attrs,details:l.details,bitrate:l.bitrate,averageBitrate:l.averageBitrate,maxBitrate:l.maxBitrate,realBitrate:l.realBitrate,width:l.width,height:l.height,codecSet:l.codecSet,audioCodec:l.audioCodec,videoCodec:l.videoCodec,audioGroups:l.audioGroups,subtitleGroups:l.subtitleGroups,loaded:l.loaded,loadError:l.loadError,fragmentError:l.fragmentError,name:l.name,id:l.id,uri:l.uri,url:l.url,urlId:0,audioGroupIds:l.audioGroupIds,textGroupIds:l.textGroupIds};this.hls.trigger(L.LEVEL_SWITCHING,f);const h=l.details;if(!h||h.live){const m=this.switchParams(l.uri,a==null?void 0:a.details,h);this.loadPlaylist(m)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(a=>t.indexOf(a)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===Fe.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ye.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(u=>!!i[u]))return;const a=this._levels[t.level];a!=null&&a.loadError&&(this.log(`Resetting level error count of ${a.loadError} on frag buffered`),a.loadError=0)}}onLevelLoaded(e,t){var i;const{level:a,details:u}=t,l=t.levelInfo;if(!l){var c;this.warn(`Invalid level index ${a}`),(c=t.deliveryDirectives)!=null&&c.skip&&(u.deltaUpdateFailed=!0);return}if(l===this.currentLevel||t.withoutMultiVariant){l.fragmentError===0&&(l.loadError=0);let f=l.details;f===t.details&&f.advanced&&(f=void 0),this.playlistLoaded(a,t,f)}else(i=t.deliveryDirectives)!=null&&i.skip&&(u.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),a=this.currentLevelIndex,u=e.attrs["PATHWAY-ID"],l=e.details,c=l==null?void 0:l.age;this.log(`Loading level index ${a}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u?" Pathway "+u:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${i}`),this.hls.trigger(L.LEVEL_LOADING,{url:i,level:a,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((u,l)=>l!==e?!0:(this.steering&&this.steering.removeLevel(u),u===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,u.details&&u.details.fragments.forEach(c=>c.level=-1)),!1));Sv(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const a=i.length-1;this._firstLevel=Math.min(this._firstLevel,a),this._startLevel&&(this._startLevel=Math.min(this._startLevel,a)),this.hls.trigger(L.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(L.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function ZT(s){const e={};s.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function ES(){return self.SourceBuffer||self.WebKitSourceBuffer}function xS(){if(!Ea())return!1;const e=ES();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function Ek(){if(!xS())return!1;const s=Ea();return typeof(s==null?void 0:s.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>s.isTypeSupported(Wl(e,"video")))||["mp4a.40.2","fLaC"].some(e=>s.isTypeSupported(Wl(e,"audio"))))}function xk(){var s;const e=ES();return typeof(e==null||(s=e.prototype)==null?void 0:s.changeType)=="function"}const Tk=100;class yk extends Rg{constructor(e,t,i){super(e,t,i,"stream-controller",ye.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const a=this.media,u=a?a.currentTime:null;if(u===null||!Ee(u)||(this.log(`Media seeked to ${u.toFixed(3)}`),!this.getBufferedFrag(u)))return;const l=this.getFwdBufferInfoAtPos(a,u,ye.MAIN,0);if(l===null||l.len===0){this.warn(`Main forward buffer length at ${u} on "seeked" event ${l?l.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:a}=this;if(this.stopLoad(),this.setInterval(Tk),this.level=-1,!this.startFragRequested){let u=a.startLevel;u===-1&&(a.config.testBandwidth&&this.levels.length>1?(u=0,this.bitrateTest=!0):u=a.firstAutoLevel),a.nextLoadLevel=u,this.level=a.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=ue.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ue.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ue.WAITING_LEVEL:{const{levels:e,level:t}=this,i=e==null?void 0:e[t],a=i==null?void 0:i.details;if(a&&(!a.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(a))break;this.state=ue.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ue.IDLE;break}break}case ue.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ue.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:a}=this;if(t===null||!a&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const u=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[u]))return;const l=i[u],c=this.getMainFwdBufferInfo();if(c===null)return;const f=this.getLevelDetails();if(f&&this._streamEnded(c,f)){const S={};this.altAudio===2&&(S.type="video"),this.hls.trigger(L.BUFFER_EOS,S),this.state=ue.ENDED;return}if(!this.buffering)return;e.loadLevel!==u&&e.manualLevel===-1&&this.log(`Adapting to level ${u} from level ${this.level}`),this.level=e.nextLoadLevel=u;const h=l.details;if(!h||this.state===ue.WAITING_LEVEL||this.waitForLive(l)){this.level=u,this.state=ue.WAITING_LEVEL,this.startFragRequested=!1;return}const m=c.len,g=this.getMaxBufferLength(l.maxBitrate);if(m>=g)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const E=this.backtrackFragment?this.backtrackFragment.start:c.end;let T=this.getNextFragment(E,h);if(this.couldBacktrack&&!this.fragPrevious&&T&&Ct(T)&&this.fragmentTracker.getState(T)!==Kt.OK){var v;const A=((v=this.backtrackFragment)!=null?v:T).sn-h.startSN,I=h.fragments[A-1];I&&T.cc===I.cc&&(T=I,this.fragmentTracker.removeFragment(I))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(T&&this.isLoopLoading(T,E)){if(!T.gap){const A=this.audioOnly&&!this.altAudio?dt.AUDIO:dt.VIDEO,I=(A===dt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;I&&this.afterBufferFlushed(I,A,ye.MAIN)}T=this.getNextFragmentLoopLoading(T,h,c,ye.MAIN,g)}T&&(T.initSegment&&!T.initSegment.data&&!this.bitrateTest&&(T=T.initSegment),this.loadFragment(T,l,E))}loadFragment(e,t,i){const a=this.fragmentTracker.getState(e);a===Kt.NOT_LOADED||a===Kt.PARTIAL?Ct(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ye.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const a=this.getAppendedFrag(t.currentTime);a&&a.start>1&&this.flushMainBuffer(0,a.start-1);const u=this.getLevelDetails();if(u!=null&&u.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<u.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,f=e[c],h=this.fragLastKbps;h&&this.fragCurrent?i=this.fragCurrent.duration*f.maxBitrate/(1e3*h)+1:i=0}else i=0;const l=this.getBufferedFrag(t.currentTime+i);if(l){const c=this.followingBufferedFrag(l);if(c){this.abortCurrentFrag();const f=c.maxStartPTS?c.maxStartPTS:c.start,h=c.duration,m=Math.max(l.end,f+Math.min(Math.max(h-this.config.maxFragLookUpTolerance,h*(this.couldBacktrack?.5:.125)),h*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(m,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ue.KEY_LOADING:case ue.FRAG_LOADING:case ue.FRAG_LOADING_WAITING_RETRY:case ue.PARSING:case ue.PARSED:this.state=ue.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;vs(i,"playing",this.onMediaPlaying),vs(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(Bs(i,"playing",this.onMediaPlaying),Bs(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(L.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,a=!1;for(let u=0;u<t.levels.length;u++){const l=t.levels[u].audioCodec;l&&(i=i||l.indexOf("mp4a.40.2")!==-1,a=a||l.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&a&&!xk(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==ue.IDLE)return;const a=t.levelInfo;(!a.details||a.details.live&&(this.levelLastLoaded!==a||a.details.expired)||this.waitForCdnTuneIn(a.details))&&(this.state=ue.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:a,startFragRequested:u}=this,l=t.level,c=t.details,f=c.totalduration;if(!a){this.warn(`Levels were reset while loading level ${l}`);return}this.log(`Level ${l} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${f}`);const h=t.levelInfo,m=this.fragCurrent;m&&(this.state===ue.FRAG_LOADING||this.state===ue.FRAG_LOADING_WAITING_RETRY)&&m.level!==t.level&&m.loader&&this.abortCurrentFrag();let g=0;if(c.live||(i=h.details)!=null&&i.live){var E;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;g=this.alignPlaylists(c,h.details,(E=this.levelLastLoaded)==null?void 0:E.details)}if(h.details=c,this.levelLastLoaded=h,u||this.setStartPosition(c,g),this.hls.trigger(L.LEVEL_UPDATED,{details:c,level:l}),this.state===ue.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=ue.IDLE}u&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const a=this.hls.liveSyncPosition,u=this.getLoadPosition(),l=e.fragmentStart,c=e.edge,f=u>=l-t.maxFragLookUpTolerance&&u<=c;if(a!==null&&i.duration>a&&(u<a||!f)){const m=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!f&&i.readyState<4||u<c-m)&&(this._hasEnoughToStart||(this.nextLoadPosition=a),i.readyState))if(this.warn(`Playback: ${u.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${a.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var h;const g=ke.bufferInfo(i,a,0);if(!((h=g.buffered)!=null&&h.length)){i.currentTime=a;return}if(g.start<=u){i.currentTime=a;return}const{nextStart:T}=ke.bufferedInfo(g.buffered,u,0);T&&(i.currentTime=T)}else i.currentTime=a}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:a,payload:u}=e,{levels:l}=this;if(!l){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const c=l[i.level];if(!c){this.warn(`Level ${i.level} not found on progress`);return}const f=c.details;if(!f){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const h=c.videoCodec,m=f.PTSKnown||!f.live,g=(t=i.initSegment)==null?void 0:t.data,E=this._getAudioCodec(c),T=this.transmuxer=this.transmuxer||new qv(this.hls,ye.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=a?a.index:-1,S=v!==-1,A=new _g(i.level,i.sn,i.stats.chunkCount,u.byteLength,v,S),I=this.initPTS[i.cc];T.push(u,g,E,h,i,a,f.totalduration,m,A,I)}onAudioTrackSwitching(e,t){const i=this.hls,a=this.altAudio!==0;if(Dd(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(a){this.altAudio=0,this.fragmentTracker.removeAllFragments(),i.once(L.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(L.AUDIO_TRACK_SWITCHED,t)}),i.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(L.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=Dd(t.url,this.hls);if(i){const a=this.videoBuffer;a&&this.mediaBuffer!==a&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=a)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let a,u,l=!1;for(const c in i){const f=i[c];if(f.id==="main"){if(u=c,a=f,c==="video"){const h=i[c];h&&(this.videoBuffer=h.buffer)}}else l=!0}l&&a?(this.log(`Alternate track found, use ${u}.buffered to schedule main fragment loading`),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:a}=t,u=i.type===ye.MAIN;if(u){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${a?" p: "+a.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ue.PARSED&&(this.state=ue.IDLE);return}const c=a?a.stats:i.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),Ct(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,a)}const l=this.media;l&&(!this._hasEnoughToStart&&ke.getBuffered(l).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),u&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=ue.ERROR;return}switch(t.details){case Y.FRAG_GAP:case Y.FRAG_PARSING_ERROR:case Y.FRAG_DECRYPT_ERROR:case Y.FRAG_LOAD_ERROR:case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_ERROR:case Y.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ye.MAIN,t);break;case Y.LEVEL_LOAD_ERROR:case Y.LEVEL_LOAD_TIMEOUT:case Y.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ue.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===Fe.LEVEL&&(this.state=ue.IDLE);break;case Y.BUFFER_ADD_CODEC_ERROR:case Y.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Y.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Y.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ue.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==dt.AUDIO||!this.altAudio){const i=(t===dt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,ye.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const a=this.timelineOffset;a&&i&&(i+=a);const u=this.getLevelDetails(),l=ke.getBuffered(e),c=l.length?l.start(0):0,f=c-i,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||f>0&&(f<h||this.loadingParts&&f<2*((u==null?void 0:u.partTarget)||0)))&&(this.log(`adjusting start position by ${f} to match buffer start`),i+=f,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${c}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:a}=this,u=i==null?void 0:i.frag;if(!u||this.fragContextChanged(u))return;t.fragmentError=0,this.state=ue.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const l=u.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),a.trigger(L.FRAG_LOADED,i),u.bitrateTest=!1}).catch(i=>{this.state===ue.STOPPED||this.state===ue.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:i}=this,{remuxResult:a,chunkMeta:u}=e,l=this.getCurrentContext(u);if(!l){this.resetWhenMissingContext(u);return}const{frag:c,part:f,level:h}=l,{video:m,text:g,id3:E,initSegment:T}=a,{details:v}=h,S=this.altAudio?void 0:a.audio;if(this.fragContextChanged(c)){this.fragmentTracker.removeFragment(c);return}if(this.state=ue.PARSING,T){const A=T.tracks;if(A){const D=c.initSegment||c;if(this.unhandledEncryptionError(T,c))return;this._bufferInitSegment(h,A,D,u),i.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:t,tracks:A})}const I=T.initPTS,R=T.timescale,N=this.initPTS[c.cc];if(Ee(I)&&(!N||N.baseTime!==I||N.timescale!==R)){const D=T.trackId;this.initPTS[c.cc]={baseTime:I,timescale:R,trackId:D},i.trigger(L.INIT_PTS_FOUND,{frag:c,id:t,initPTS:I,timescale:R,trackId:D})}}if(m&&v){S&&m.type==="audiovideo"&&this.logMuxedErr(c);const A=v.fragments[c.sn-1-v.startSN],I=c.sn===v.startSN,R=!A||c.cc>A.cc;if(a.independent!==!1){const{startPTS:N,endPTS:D,startDTS:k,endDTS:G}=m;if(f)f.elementaryStreams[m.type]={startPTS:N,endPTS:D,startDTS:k,endDTS:G};else if(m.firstKeyFrame&&m.independent&&u.id===1&&!R&&(this.couldBacktrack=!0),m.dropped&&m.independent){const U=this.getMainFwdBufferInfo(),H=(U?U.end:this.getLoadPosition())+this.config.maxBufferHole,$=m.firstKeyFramePTS?m.firstKeyFramePTS:N;if(!I&&H<$-this.config.maxBufferHole&&!R){this.backtrack(c);return}else R&&(c.gap=!0);c.setElementaryStreamInfo(m.type,c.start,D,c.start,G,!0)}else I&&N-(v.appliedTimelineOffset||0)>fd&&(c.gap=!0);c.setElementaryStreamInfo(m.type,N,D,k,G),this.backtrackFragment&&(this.backtrackFragment=c),this.bufferFragmentData(m,c,f,u,I||R)}else if(I||R)c.gap=!0;else{this.backtrack(c);return}}if(S){const{startPTS:A,endPTS:I,startDTS:R,endDTS:N}=S;f&&(f.elementaryStreams[dt.AUDIO]={startPTS:A,endPTS:I,startDTS:R,endDTS:N}),c.setElementaryStreamInfo(dt.AUDIO,A,I,R,N),this.bufferFragmentData(S,c,f,u)}if(v&&E!=null&&E.samples.length){const A={id:t,frag:c,details:v,samples:E.samples};i.trigger(L.FRAG_PARSING_METADATA,A)}if(v&&g){const A={id:t,frag:c,details:v,samples:g.samples};i.trigger(L.FRAG_PARSING_USERDATA,A)}}logMuxedErr(e){this.warn(`${Ct(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,a){if(this.state!==ue.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:u,video:l,audiovideo:c}=t;if(u){const h=e.audioCodec;let m=ad(u.codec,h);m==="mp4a"&&(m="mp4a.40.5");const g=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){m&&(m.indexOf("mp4a.40.5")!==-1?m="mp4a.40.2":m="mp4a.40.5");const E=u.metadata;E&&"channelCount"in E&&(E.channelCount||1)!==1&&g.indexOf("firefox")===-1&&(m="mp4a.40.5")}m&&m.indexOf("mp4a.40.5")!==-1&&g.indexOf("android")!==-1&&u.container!=="audio/mpeg"&&(m="mp4a.40.2",this.log(`Android: force audio codec to ${m}`)),h&&h!==m&&this.log(`Swapping manifest audio codec "${h}" for "${m}"`),u.levelCodec=m,u.id=ye.MAIN,this.log(`Init audio buffer, container:${u.container}, codecs[selected/level/parsed]=[${m||""}/${h||""}/${u.codec}]`),delete t.audiovideo}if(l){l.levelCodec=e.videoCodec,l.id=ye.MAIN;const h=l.codec;if((h==null?void 0:h.length)===4)switch(h){case"hvc1":case"hev1":l.codec="hvc1.1.6.L120.90";break;case"av01":l.codec="av01.0.04M.08";break;case"avc1":l.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${l.container}, codecs[level/parsed]=[${e.videoCodec||""}/${h}]${l.codec!==h?" parsed-corrected="+l.codec:""}${l.supplemental?" supplemental="+l.supplemental:""}`),delete t.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),delete t.video,delete t.audio);const f=Object.keys(t);if(f.length){if(this.hls.trigger(L.BUFFER_CODECS,t),!this.hls)return;f.forEach(h=>{const g=t[h].initSegment;g!=null&&g.byteLength&&this.hls.trigger(L.BUFFER_APPENDING,{type:h,data:g,frag:i,part:null,chunkMeta:a,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ye.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e==null?void 0:e[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ue.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(ke.isBuffered(e,i)?t=this.getAppendedFrag(i):ke.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const a=this.fragPlaying,u=t.level;(!a||t.sn!==a.sn||a.level!==u)&&(this.fragPlaying=t,this.hls.trigger(L.FRAG_CHANGED,{frag:t}),(!a||a.level!==u)&&this.hls.trigger(L.LEVEL_SWITCHED,{level:u}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Ee(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Ee(t)){const i=this.getLevelDetails(),a=this.currentFrag||(i?nr(null,i.fragments,t):null);if(a){const u=a.programDateTime;if(u!==null){const l=u+(t-a.start)*1e3;return new Date(l)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class vk extends gi{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyIdToKeyInfo){const a=this.keyIdToKeyInfo[i].loader;if(a){var t;if(e&&e!==((t=a.context)==null?void 0:t.frag.type))return;a.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Y.KEY_LOAD_ERROR,i,a,u){return new yn({type:Ae.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:u,error:i,networkDetails:a})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let a=0,u=t.length;a<u;a++){const l=t[a];if(e.cc<=l.cc&&(!Ct(e)||!Ct(l)||e.sn<l.sn)||!i&&a==u-1)return this.emeController.selectKeySystemFormat(l).then(c=>{if(!this.emeController)return;l.setKeyFormat(c);const f=ud(c);if(f)return this.emeController.getKeySystemAccess([f])})}if(this.config.requireKeySystemAccessOnStart){const a=Rl(this.config);if(a.length)return this.emeController.getKeySystemAccess(a)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,a;t&&e.setKeyFormat(t);const u=e.decryptdata;if(!u){const h=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Y.KEY_LOAD_ERROR,h))}const l=u.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,Y.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${l}"`)));const c=tm(u);let f=this.keyIdToKeyInfo[c];if((i=f)!=null&&i.decryptdata.key)return u.key=f.decryptdata.key,Promise.resolve({frag:e,keyInfo:f});if(this.emeController&&(a=f)!=null&&a.keyLoadPromise)switch(this.emeController.getKeyStatus(f.decryptdata)){case"usable":case"usable-in-future":return f.keyLoadPromise.then(m=>{const{keyInfo:g}=m;return u.key=g.decryptdata.key,{frag:e,keyInfo:g}})}switch(this.log(`${this.keyIdToKeyInfo[c]?"Rel":"L"}oading${u.keyId?" keyId: "+fs(u.keyId):""} URI: ${u.uri} from ${e.type} ${e.level}`),f=this.keyIdToKeyInfo[c]={decryptdata:u,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},u.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return u.keyFormat==="identity"?this.loadKeyHTTP(f,e):this.loadKeyEME(f,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(f,e);default:return Promise.reject(this.createKeyLoadError(e,Y.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${u.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var a;if(!e.decryptdata.keyId&&(a=t.initSegment)!=null&&a.data){const l=HD(t.initSegment.data);if(l.length){let c=l[0];c.some(f=>f!==0)?(this.log(`Using keyId found in init segment ${fs(c)}`),ba.setKeyIdForUri(e.decryptdata.uri,c)):(c=ba.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${fs(c)}`)),e.decryptdata.keyId=c}}if(!e.decryptdata.keyId&&!Ct(t))return Promise.resolve(i);const u=this.emeController.loadKey(i);return(e.keyLoadPromise=u.then(l=>(e.mediaKeySessionContext=l,i))).catch(l=>{throw e.keyLoadPromise=null,"data"in l&&(l.data.frag=t),l})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,a=i.loader,u=new a(i);return t.keyLoader=e.loader=u,e.keyLoadPromise=new Promise((l,c)=>{const f={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},h=i.keyLoadPolicy.default,m={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(E,T,v,S)=>{const{frag:A,keyInfo:I}=v,R=tm(I.decryptdata);if(!A.decryptdata||I!==this.keyIdToKeyInfo[R])return c(this.createKeyLoadError(A,Y.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));I.decryptdata.key=A.decryptdata.key=new Uint8Array(E.data),A.keyLoader=null,I.loader=null,l({frag:A,keyInfo:I})},onError:(E,T,v,S)=>{this.resetLoader(T),c(this.createKeyLoadError(t,Y.KEY_LOAD_ERROR,new Error(`HTTP Error ${E.code} loading key ${E.text}`),v,it({url:f.url,data:void 0},E)))},onTimeout:(E,T,v)=>{this.resetLoader(T),c(this.createKeyLoadError(t,Y.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),v))},onAbort:(E,T,v)=>{this.resetLoader(T),c(this.createKeyLoadError(t,Y.INTERNAL_ABORTED,new Error("key loading aborted"),v))}};u.load(f,m,g)})}resetLoader(e){const{frag:t,keyInfo:i,url:a}=e,u=i.loader;t.keyLoader===u&&(t.keyLoader=null,i.loader=null);const l=tm(i.decryptdata)||a;delete this.keyIdToKeyInfo[l],u&&u.destroy()}}function tm(s){if(s.keyFormat!==hs.FAIRPLAY){const e=s.keyId;if(e)return fs(e)}return s.uri}function JT(s){const{type:e}=s;switch(e){case Fe.AUDIO_TRACK:return ye.AUDIO;case Fe.SUBTITLE_TRACK:return ye.SUBTITLE;default:return ye.MAIN}}function sm(s,e){let t=s.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class Sk{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,a=t.loader,u=i||a,l=new u(t);return this.loaders[e.type]=l,l}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Fe.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:a,pathwayId:u,url:l,deliveryDirectives:c,levelInfo:f}=t;this.load({id:i,level:a,pathwayId:u,responseType:"text",type:Fe.LEVEL,url:l,deliveryDirectives:c,levelOrTrack:f})}onAudioTrackLoading(e,t){const{id:i,groupId:a,url:u,deliveryDirectives:l,track:c}=t;this.load({id:i,groupId:a,level:null,responseType:"text",type:Fe.AUDIO_TRACK,url:u,deliveryDirectives:l,levelOrTrack:c})}onSubtitleTrackLoading(e,t){const{id:i,groupId:a,url:u,deliveryDirectives:l,track:c}=t;this.load({id:i,groupId:a,level:null,responseType:"text",type:Fe.SUBTITLE_TRACK,url:u,deliveryDirectives:l,levelOrTrack:c})}onLevelsUpdated(e,t){const i=this.loaders[Fe.LEVEL];if(i){const a=i.context;a&&!t.levels.some(u=>u===a.levelOrTrack)&&(i.abort(),delete this.loaders[Fe.LEVEL])}}load(e){var t;const i=this.hls.config;let a=this.getInternalLoader(e);if(a){const h=this.hls.logger,m=a.context;if(m&&m.levelOrTrack===e.levelOrTrack&&(m.url===e.url||m.deliveryDirectives&&!e.deliveryDirectives)){m.url===e.url?h.log(`[playlist-loader]: ignore ${e.url} ongoing request`):h.log(`[playlist-loader]: ignore ${e.url} in favor of ${m.url}`);return}h.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),a.abort()}let u;if(e.type===Fe.MANIFEST?u=i.manifestLoadPolicy.default:u=ot({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),a=this.createInternalLoader(e),Ee((t=e.deliveryDirectives)==null?void 0:t.part)){let h;if(e.type===Fe.LEVEL&&e.level!==null?h=this.hls.levels[e.level].details:e.type===Fe.AUDIO_TRACK&&e.id!==null?h=this.hls.audioTracks[e.id].details:e.type===Fe.SUBTITLE_TRACK&&e.id!==null&&(h=this.hls.subtitleTracks[e.id].details),h){const m=h.partTarget,g=h.targetduration;if(m&&g){const E=Math.max(m*3,g*.8)*1e3;u=ot({},u,{maxTimeToFirstByteMs:Math.min(E,u.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(E,u.maxTimeToFirstByteMs)})}}}const l=u.errorRetry||u.timeoutRetry||{},c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},f={onSuccess:(h,m,g,E)=>{const T=this.getInternalLoader(g);this.resetInternalLoader(g.type);const v=h.data;m.parsing.start=performance.now(),qi.isMediaPlaylist(v)||g.type!==Fe.MANIFEST?this.handleTrackOrLevelPlaylist(h,m,g,E||null,T):this.handleMasterPlaylist(h,m,g,E)},onError:(h,m,g,E)=>{this.handleNetworkError(m,g,!1,h,E)},onTimeout:(h,m,g)=>{this.handleNetworkError(m,g,!0,void 0,h)}};a.load(e,c,f)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,a){const u=this.hls,l=e.data,c=sm(e,i),f=qi.parseMasterPlaylist(l,c);if(f.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,i,f.playlistParsingError,a,t);return}const{contentSteering:h,levels:m,sessionData:g,sessionKeys:E,startTimeOffset:T,variableList:v}=f;this.variableList=v,m.forEach(R=>{const{unknownCodecs:N}=R;if(N){const{preferManagedMediaSource:D}=this.hls.config;let{audioCodec:k,videoCodec:G}=R;for(let U=N.length;U--;){const H=N[U];Xl(H,"audio",D)?(R.audioCodec=k=k?`${k},${H}`:H,Tu.audio[k.substring(0,4)]=2,N.splice(U,1)):Xl(H,"video",D)&&(R.videoCodec=G=G?`${G},${H}`:H,Tu.video[G.substring(0,4)]=2,N.splice(U,1))}}});const{AUDIO:S=[],SUBTITLES:A,"CLOSED-CAPTIONS":I}=qi.parseMasterPlaylistMedia(l,c,f);S.length&&!S.some(N=>!N.url)&&m[0].audioCodec&&!m[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Et({}),bitrate:0,url:""})),u.trigger(L.MANIFEST_LOADED,{levels:m,audioTracks:S,subtitles:A,captions:I,contentSteering:h,url:c,stats:t,networkDetails:a,sessionData:g,sessionKeys:E,startTimeOffset:T,variableList:v})}handleTrackOrLevelPlaylist(e,t,i,a,u){const l=this.hls,{id:c,level:f,type:h}=i,m=sm(e,i),g=Ee(f)?f:Ee(c)?c:0,E=JT(i),T=qi.parseLevelPlaylist(e.data,m,g,E,0,this.variableList);if(h===Fe.MANIFEST){const v={attrs:new Et({}),bitrate:0,details:T,name:"",url:m};T.requestScheduled=t.loading.start+Tv(T,0),l.trigger(L.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:m,stats:t,networkDetails:a,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=T,this.handlePlaylistLoaded(T,e,t,i,a,u)}handleManifestParsingError(e,t,i,a,u){this.hls.trigger(L.ERROR,{type:Ae.NETWORK_ERROR,details:Y.MANIFEST_PARSING_ERROR,fatal:t.type===Fe.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:a,stats:u})}handleNetworkError(e,t,i=!1,a,u){let l=`A network ${i?"timeout":"error"+(a?" (status "+a.code+")":"")} occurred while loading ${e.type}`;e.type===Fe.LEVEL?l+=`: ${e.level} id: ${e.id}`:(e.type===Fe.AUDIO_TRACK||e.type===Fe.SUBTITLE_TRACK)&&(l+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(l);this.hls.logger.warn(`[playlist-loader]: ${l}`);let f=Y.UNKNOWN,h=!1;const m=this.getInternalLoader(e);switch(e.type){case Fe.MANIFEST:f=i?Y.MANIFEST_LOAD_TIMEOUT:Y.MANIFEST_LOAD_ERROR,h=!0;break;case Fe.LEVEL:f=i?Y.LEVEL_LOAD_TIMEOUT:Y.LEVEL_LOAD_ERROR,h=!1;break;case Fe.AUDIO_TRACK:f=i?Y.AUDIO_TRACK_LOAD_TIMEOUT:Y.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case Fe.SUBTITLE_TRACK:f=i?Y.SUBTITLE_TRACK_LOAD_TIMEOUT:Y.SUBTITLE_LOAD_ERROR,h=!1;break}m&&this.resetInternalLoader(e.type);const g={type:Ae.NETWORK_ERROR,details:f,fatal:h,url:e.url,loader:m,context:e,error:c,networkDetails:t,stats:u};if(a){const E=(t==null?void 0:t.url)||e.url;g.response=it({url:E,data:void 0},a)}this.hls.trigger(L.ERROR,g)}handlePlaylistLoaded(e,t,i,a,u,l){const c=this.hls,{type:f,level:h,levelOrTrack:m,id:g,groupId:E,deliveryDirectives:T}=a,v=sm(t,a),S=JT(a);let A=typeof a.level=="number"&&S===ye.MAIN?h:void 0;const I=e.playlistParsingError;if(I){if(this.hls.logger.warn(`${I} ${e.url}`),!c.config.ignorePlaylistParsingErrors){c.trigger(L.ERROR,{type:Ae.NETWORK_ERROR,details:Y.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:I,reason:I.message,response:t,context:a,level:A,parent:S,networkDetails:u,stats:i});return}e.playlistParsingError=null}if(!e.fragments.length){const R=e.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(L.ERROR,{type:Ae.NETWORK_ERROR,details:Y.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:R,reason:R.message,response:t,context:a,level:A,parent:S,networkDetails:u,stats:i});return}switch(e.live&&l&&(l.getCacheAge&&(e.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),f){case Fe.MANIFEST:case Fe.LEVEL:if(A){if(!m)A=0;else if(m!==c.levels[A]){const R=c.levels.indexOf(m);R>-1&&(A=R)}}c.trigger(L.LEVEL_LOADED,{details:e,levelInfo:m||c.levels[0],level:A||0,id:g||0,stats:i,networkDetails:u,deliveryDirectives:T,withoutMultiVariant:f===Fe.MANIFEST});break;case Fe.AUDIO_TRACK:c.trigger(L.AUDIO_TRACK_LOADED,{details:e,track:m,id:g||0,groupId:E||"",stats:i,networkDetails:u,deliveryDirectives:T});break;case Fe.SUBTITLE_TRACK:c.trigger(L.SUBTITLE_TRACK_LOADED,{details:e,track:m,id:g||0,groupId:E||"",stats:i,networkDetails:u,deliveryDirectives:T});break}}}class _n{static get version(){return Jl}static isMSESupported(){return xS()}static isSupported(){return Ek()}static getMediaSource(){return Ea()}static get Events(){return L}static get MetadataSchema(){return Zs}static get ErrorTypes(){return Ae}static get ErrorDetails(){return Y}static get DefaultConfig(){return _n.defaultConfig?_n.defaultConfig:rk}static set DefaultConfig(e){_n.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Ng,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=ND(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=lk(_n.DefaultConfig,e,t);this.userConfig=e,i.progressive&&ok(i,t);const{abrController:a,bufferController:u,capLevelController:l,errorController:c,fpsController:f}=i,h=new c(this),m=this.abrController=new a(this),g=new A8(this),E=i.interstitialsController,T=E?this.interstitialsController=new E(this,_n):null,v=this.bufferController=new u(this,g),S=this.capLevelController=new l(this),A=new f(this),I=new Sk(this),R=i.contentSteeringController,N=R?new R(this):null,D=this.levelController=new bk(this,N),k=new gk(this),G=new vk(this.config,this.logger),U=this.streamController=new yk(this,g,G),H=this.gapController=new hk(this,g);S.setStreamController(U),A.setStreamController(U);const $=[I,D,U];T&&$.splice(1,0,T),N&&$.splice(1,0,N),this.networkControllers=$;const F=[m,v,H,S,A,k,g];this.audioTrackController=this.createController(i.audioTrackController,$);const ee=i.audioStreamController;ee&&$.push(this.audioStreamController=new ee(this,g,G)),this.subtitleTrackController=this.createController(i.subtitleTrackController,$);const me=i.subtitleStreamController;me&&$.push(this.subtititleStreamController=new me(this,g,G)),this.createController(i.timelineController,F),G.emeController=this.emeController=this.createController(i.emeController,F),this.cmcdController=this.createController(i.cmcdController,F),this.latencyController=this.createController(pk,F),this.coreComponents=F,$.push(h);const be=h.onErrorOut;typeof be=="function"&&this.on(L.ERROR,be,h),this.on(L.MANIFEST_LOADED,I.onManifestLoaded,I)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,a){this._emitter.off(e,t,i,a)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const a=e===L.ERROR;this.trigger(L.ERROR,{type:Ae.OTHER_ERROR,details:Y.INTERNAL_EXCEPTION,fatal:a,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(L.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const u=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(L.ERROR,{type:Ae.OTHER_ERROR,details:Y.ATTACH_MEDIA_ERROR,fatal:!0,error:u});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,a=t?e:{media:i};this._media=i,this.trigger(L.MEDIA_ATTACHING,a)}detachMedia(){this.logger.log("detachMedia"),this.trigger(L.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(L.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,a=this._url=Eg.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${a}`),t&&i&&(i!==a||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(L.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ye.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ye.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ye.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=h5()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){l8(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let a=0;a<i;a++)if(e[a].maxBitrate>=t)return a;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let a;if(t===-1&&e!=null&&e.length?a=e.length-1:a=t,i)for(let u=a;u--;){const l=e[u].attrs["HDCP-LEVEL"];if(l&&l<=i)return u}return a}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=av(t);return iv(e,i,navigator.mediaCapabilities)}}_n.defaultConfig=void 0;const Ak=({src:s,poster:e})=>{const t=ie.useRef(null);return ie.useEffect(()=>{const i=t.current;if(!i)return;let a=null;return _n.isSupported()?(a=new _n,a.loadSource(s),a.attachMedia(i)):i.canPlayType("application/vnd.apple.mpegurl")&&(i.src=s),()=>{a&&a.destroy()}},[s]),b.jsx("div",{className:"relative w-full aspect-video bg-black rounded-xl overflow-hidden shadow-2xl border border-white/10",children:b.jsx("video",{ref:t,poster:e,controls:!0,className:"w-full h-full object-contain",playsInline:!0})})},_k="https://iptv-org.github.io/iptv",ey={getChannelsByCategory:async s=>{try{if(s==="xxx")return Lk();const e=await Li.get(`${_k}/categories/${s}.m3u`);return Ik(e.data,s)}catch(e){return console.error(`Failed to fetch channels for category: ${s}`,e),[]}},getAllCategories:()=>[{id:"movies",name:"Movies"},{id:"news",name:"News"},{id:"music",name:"Music"},{id:"sport",name:"Sports"},{id:"documentary",name:"Documentary"},{id:"kids",name:"Kids"},{id:"family",name:"Family"},{id:"education",name:"Education"},{id:"entertainment",name:"Entertainment"},{id:"lifestyle",name:"Lifestyle"},{id:"xxx",name:"Adult 18+"}]},Lk=async()=>{const s=[];try{const t=await Li.get("https://www.eporner.com/api/v2/video/search/",{params:{query:"",per_page:30,page:1,thumbsize:"medium",order:"top-weekly",format:"json"},timeout:5e3});if(t.data&&t.data.videos){const i=t.data.videos.map((a,u)=>{var l;return{id:`eporner-${a.id||u}`,name:a.title||`Adult Video ${u+1}`,logo:((l=a.default_thumb)==null?void 0:l.src)||"",url:a.embed||a.url||"#",category:"xxx"}});s.push(...i)}}catch(t){console.log("Failed to fetch Eporner videos, using fallback channels...",t)}const e=[{id:"adult-1",name:"RedTraffic Big Ass",logo:"",url:"http://live.redtraffic.xyz/bigass.m3u8",category:"xxx"},{id:"adult-2",name:"RedTraffic Big Dick",logo:"",url:"http://live.redtraffic.xyz/bigdick.m3u8",category:"xxx"},{id:"adult-3",name:"RedTraffic Big Tits",logo:"",url:"http://live.redtraffic.xyz/bigtits.m3u8",category:"xxx"},{id:"adult-4",name:"RedTraffic Blowjob",logo:"",url:"http://live.redtraffic.xyz/blowjob.m3u8",category:"xxx"},{id:"adult-5",name:"RedTraffic Cuckold",logo:"",url:"http://live.redtraffic.xyz/cuckold.m3u8",category:"xxx"},{id:"adult-6",name:"RedTraffic Fetish",logo:"",url:"http://live.redtraffic.xyz/fetish.m3u8",category:"xxx"},{id:"adult-7",name:"RedTraffic Hardcore",logo:"",url:"http://live.redtraffic.xyz/hardcore.m3u8",category:"xxx"},{id:"adult-8",name:"RedTraffic Interracial",logo:"",url:"http://live.redtraffic.xyz/interracial.m3u8",category:"xxx"},{id:"adult-9",name:"RedTraffic Latina",logo:"",url:"http://live.redtraffic.xyz/latina.m3u8",category:"xxx"},{id:"adult-10",name:"RedTraffic Lesbian",logo:"",url:"http://live.redtraffic.xyz/lesbian.m3u8",category:"xxx"},{id:"adult-11",name:"RedTraffic MILF",logo:"",url:"http://live.redtraffic.xyz/milf.m3u8",category:"xxx"},{id:"adult-12",name:"RedTraffic Pornstar",logo:"",url:"http://live.redtraffic.xyz/pornstar.m3u8",category:"xxx"},{id:"adult-13",name:"RedTraffic POV",logo:"",url:"http://live.redtraffic.xyz/pov.m3u8",category:"xxx"},{id:"adult-14",name:"RedTraffic Russian",logo:"",url:"http://live.redtraffic.xyz/russian.m3u8",category:"xxx"},{id:"adult-15",name:"RedTraffic Teen",logo:"",url:"http://live.redtraffic.xyz/teen.m3u8",category:"xxx"},{id:"adult-16",name:"RedTraffic Threesome",logo:"",url:"http://live.redtraffic.xyz/threesome.m3u8",category:"xxx"}];return s.push(...e),s},Ik=(s,e)=>{const t=s.split(`
`),i=[];let a={};return t.forEach(u=>{if(u=u.trim(),u.startsWith("#EXTINF:")){const l=u.substring(8),c=l.split(","),f=c[c.length-1].trim(),h=l.match(/tvg-logo="([^"]*)"/),m=h?h[1]:"",g=l.match(/tvg-id="([^"]*)"/);a={id:g?g[1]:`ch-${i.length}`,name:f,logo:m,category:e}}else u.startsWith("http")&&a.name&&(i.push({...a,url:u}),a={})}),i},Rk=()=>{const[s]=ie.useState(ey.getAllCategories()),[e,t]=ie.useState("movies"),[i,a]=ie.useState([]),[u,l]=ie.useState(null),[c,f]=ie.useState(!0),[h,m]=ie.useState("");ie.useEffect(()=>{(async()=>{f(!0),a([]);try{const T=await ey.getChannelsByCategory(e);a(T),T.length>0?l(T[0]):l(null)}catch(T){console.error("Failed to load channels",T)}finally{f(!1)}})()},[e]);const g=ie.useMemo(()=>i.filter(E=>E.name.toLowerCase().includes(h.toLowerCase())),[i,h]);return b.jsx("div",{className:"min-h-screen bg-background pt-24 pb-20 px-4",children:b.jsxs("div",{className:"w-full max-w-[2000px] mx-auto px-4 md:px-8",children:[b.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[b.jsx(fy,{className:"text-primary w-8 h-8 animate-pulse"}),b.jsx("h1",{className:"text-3xl font-bold text-text",children:"Global Live TV"})]}),b.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[b.jsx("div",{className:"flex-1 order-2 lg:order-1",children:u?b.jsxs(b.Fragment,{children:[b.jsx(Ak,{src:u.url,poster:u.logo}),b.jsxs("div",{className:"mt-4 p-4 bg-surface rounded-xl border border-white/10 flex items-center gap-4",children:[b.jsxs("div",{className:"w-16 h-16 bg-white/5 rounded-lg p-2 flex items-center justify-center overflow-hidden",children:[u.logo?b.jsx("img",{src:u.logo,alt:u.name,className:"max-w-full max-h-full object-contain",onError:E=>{var T;E.currentTarget.style.display="none",(T=E.currentTarget.nextElementSibling)==null||T.classList.remove("hidden")}}):null,b.jsx(Hl,{size:32,className:`text-text-muted ${u.logo?"hidden":""}`})]}),b.jsxs("div",{children:[b.jsx("h2",{className:"text-2xl font-bold text-text",children:u.name}),b.jsxs("p",{className:"text-text-muted mt-1 capitalize",children:[u.category,"  Live Stream"]})]})]})]}):b.jsx("div",{className:"aspect-video bg-black/50 rounded-xl flex items-center justify-center border border-white/10",children:b.jsx("p",{className:"text-text-muted",children:"Select a channel to start watching"})})}),b.jsxs("div",{className:"w-full lg:w-96 flex-shrink-0 order-1 lg:order-2 flex flex-col gap-6",children:[b.jsxs("div",{className:"bg-surface p-4 rounded-xl border border-white/10",children:[b.jsx("h3",{className:"text-sm font-bold text-text-muted uppercase mb-3",children:"Categories"}),b.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(E=>b.jsx("button",{onClick:()=>t(E.id),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-colors ${e===E.id?"bg-primary text-black":"bg-background text-text-muted hover:bg-white/10 hover:text-text"}`,children:E.name},E.id))})]}),b.jsxs("div",{className:"bg-surface p-4 rounded-xl border border-white/10 flex-1 min-h-[500px] flex flex-col",children:[b.jsx("div",{className:"mb-4",children:b.jsxs("div",{className:"relative",children:[b.jsx(bu,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",size:18}),b.jsx("input",{type:"text",placeholder:"Search channels...",value:h,onChange:E=>m(E.target.value),className:"w-full bg-background border border-white/10 rounded-lg pl-10 pr-4 py-2 text-text focus:outline-none focus:border-primary/50"})]})}),b.jsx("div",{className:"flex-1 overflow-y-auto pr-2 space-y-2 max-h-[600px] custom-scrollbar",children:c?b.jsx("div",{className:"flex justify-center py-10",children:b.jsx(In,{className:"animate-spin text-primary"})}):g.length>0?g.map(E=>b.jsxs("button",{onClick:()=>l(E),className:`w-full flex items-center gap-3 p-3 rounded-lg transition-all text-left ${(u==null?void 0:u.url)===E.url?"bg-primary text-black font-bold shadow-lg shadow-primary/20":"bg-background text-text-muted hover:bg-white/10 hover:text-text"}`,children:[b.jsxs("div",{className:"w-10 h-10 bg-white/10 rounded-full flex items-center justify-center overflow-hidden p-1 flex-shrink-0",children:[E.logo?b.jsx("img",{src:E.logo,alt:E.name,className:"w-full h-full object-contain",onError:T=>{var v;T.currentTarget.style.display="none",(v=T.currentTarget.nextElementSibling)==null||v.classList.remove("hidden")}}):null,b.jsx(Hl,{size:18,className:`text-text-muted ${E.logo?"hidden":""}`})]}),b.jsx("span",{className:"truncate",children:E.name}),(u==null?void 0:u.url)===E.url&&b.jsx("div",{className:"ml-auto w-2 h-2 bg-red-500 rounded-full animate-pulse flex-shrink-0"})]},`${E.id}-${E.url}`)):b.jsx("div",{className:"text-center py-10 text-text-muted",children:b.jsx("p",{children:"No channels found"})})})]})]})]})]})})},Nk=()=>{const{actorId:s}=Fd(),[e,t]=ie.useState(null),[i,a]=ie.useState(null),[u,l]=ie.useState(null),[c,f]=ie.useState("movies"),[h,m]=ie.useState(!0),[g,E]=ie.useState(null);if(ie.useEffect(()=>{(async()=>{if(s){m(!0),E(null);try{const[A,I,R]=await Promise.all([He.getActorDetails(s),He.getActorMovieCredits(s),He.getActorTVCredits(s)]);t(A),a(I),l(R)}catch(A){console.error(A),E("Failed to load actor details.")}finally{m(!1)}}})()},[s]),h)return b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsxs("div",{className:"flex flex-col items-center gap-4",children:[b.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin"}),b.jsx("p",{className:"text-primary font-medium",children:"Loading actor details..."})]})});if(g)return b.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center text-red-500 gap-4",children:[b.jsx("p",{className:"text-xl",children:g}),b.jsx(gt,{to:"/",className:"px-4 py-2 bg-primary text-black rounded hover:bg-blue-400",children:"Go Home"})]});if(!e)return b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Actor not found"});const T=(i==null?void 0:i.cast.sort((S,A)=>(A.popularity||0)-(S.popularity||0)))||[],v=(u==null?void 0:u.cast.map(S=>({...S,title:S.name,release_date:S.first_air_date})).sort((S,A)=>(A.popularity||0)-(S.popularity||0)))||[];return b.jsx("div",{className:"min-h-screen bg-background pb-20",children:b.jsx("div",{className:"relative bg-gradient-to-b from-surface to-background",children:b.jsxs("div",{className:"w-full max-w-[2000px] mx-auto px-4 md:px-8 py-8",children:[b.jsxs(gt,{to:"/",className:"inline-flex items-center gap-2 text-gray-400 hover:text-primary transition-colors mb-6",children:[b.jsx(qm,{size:20})," Back"]}),b.jsxs("div",{className:"flex flex-col md:flex-row gap-8 items-start",children:[b.jsx("div",{className:"w-64 md:w-80 flex-shrink-0 mx-auto md:mx-0",children:b.jsx("div",{className:"aspect-[2/3] rounded-2xl overflow-hidden shadow-2xl border border-white/10",children:b.jsx("img",{src:He.getImageUrl(e.profile_path,"original"),alt:e.name,className:"w-full h-full object-cover"})})}),b.jsxs("div",{className:"flex gap-4 mb-8 border-b border-white/10",children:[b.jsxs("button",{onClick:()=>f("movies"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 ${c==="movies"?"text-primary border-b-2 border-primary":"text-text-muted hover:text-text"}`,children:[b.jsx(am,{size:20}),"Movies (",T.length,")"]}),b.jsxs("button",{onClick:()=>f("tv"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 ${c==="tv"?"text-primary border-b-2 border-primary":"text-text-muted hover:text-text"}`,children:[b.jsx(Hl,{size:20}),"TV Shows (",v.length,")"]})]}),b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:(c==="movies"?T:v).map(S=>b.jsx("div",{className:"transform transition-transform hover:-translate-y-1",children:b.jsx(gt,{to:`/${c==="movies"?"movies":"webseries"}/${S.id}`,className:"group relative block",children:b.jsxs("div",{className:"relative bg-surface backdrop-blur-xl rounded-2xl overflow-hidden border border-white/10 transition-all duration-500 hover:shadow-2xl hover:shadow-primary/20 hover:border-primary/30",children:[b.jsxs("div",{className:"relative aspect-[2/3] w-full overflow-hidden",children:[b.jsx("img",{src:He.getImageUrl(S.poster_path),alt:S.title||S.name,loading:"lazy",className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent opacity-60 group-hover:opacity-80 transition-opacity duration-300"}),S.vote_average>0&&b.jsxs("div",{className:"absolute bottom-2 right-2 flex items-center gap-1 px-2 py-1 bg-black/60 backdrop-blur-md rounded-full border border-yellow-500/30",children:[b.jsx(ys,{size:10,className:"fill-yellow-400 text-yellow-400"}),b.jsx("span",{className:"text-yellow-400 text-xs font-bold",children:S.vote_average.toFixed(1)})]})]}),b.jsxs("div",{className:"p-3",children:[b.jsx("h3",{className:"text-sm font-bold text-text line-clamp-2 group-hover:text-primary transition-colors",children:S.title||S.name}),(S.release_date||S.first_air_date)&&b.jsx("p",{className:"text-xs text-text-muted mt-1",children:new Date(S.release_date||S.first_air_date||"").getFullYear()})]})]})})},S.id))}),c==="movies"&&T.length===0&&b.jsxs("div",{className:"text-center py-20 text-gray-500",children:[b.jsx(am,{size:48,className:"mx-auto mb-4 opacity-50"}),b.jsx("p",{children:"No movies found"})]}),c==="tv"&&v.length===0&&b.jsxs("div",{className:"text-center py-20 text-gray-500",children:[b.jsx(Hl,{size:48,className:"mx-auto mb-4 opacity-50"}),b.jsx("p",{children:"No TV shows found"})]})]})]})})})},Ck=()=>{const[s,e]=ie.useState(""),[t,i]=ie.useState(""),[a,u]=ie.useState(!1),[l,c]=ie.useState(""),[f,h]=ie.useState(!1),{login:m,isAuthenticated:g}=ar();ie.useEffect(()=>{l&&c("")},[s,t]);const E=async T=>{T.preventDefault(),c(""),h(!0);try{await m(s,t)}catch(v){c(v.message||"Login failed. Please try again.")}finally{h(!1)}};return ie.useEffect(()=>{g&&(window.location.hash="/")},[g]),b.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 via-red-900 to-black px-4",children:[b.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[b.jsx("div",{className:"absolute -top-1/2 -left-1/2 w-full h-full bg-purple-500/10 rounded-full blur-3xl animate-pulse"}),b.jsx("div",{className:"absolute -bottom-1/2 -right-1/2 w-full h-full bg-pink-500/10 rounded-full blur-3xl animate-pulse delay-1000"})]}),b.jsxs("div",{className:"relative w-full max-w-md",children:[b.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-xl rounded-2xl shadow-2xl border border-gray-700/50 overflow-hidden",children:[b.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 p-8 text-center",children:[b.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-white/20 rounded-full mb-4",children:b.jsx(Za,{className:"w-8 h-8 text-white"})}),b.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Welcome Back"}),b.jsx("p",{className:"text-purple-100",children:"Sign in to access CineStream Pro"})]}),b.jsx("div",{className:"p-8 bg-surface",children:b.jsxs("form",{onSubmit:E,className:"space-y-6",children:[l&&b.jsxs("div",{className:"bg-red-500/10 border border-red-500/50 rounded-lg p-4 flex items-start gap-3 animate-shake",children:[b.jsx(Ym,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),b.jsx("p",{className:"text-red-400 text-sm",children:l})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-text-muted mb-2",children:"Username "}),b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:b.jsx(jl,{className:"w-5 h-5 text-text-muted"})}),b.jsx("input",{id:"username",type:"text",value:s,onChange:T=>e(T.target.value),className:"w-full pl-10 pr-4 py-3 bg-white border border-white/10 rounded-lg text-black placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition",placeholder:"Enter your username",required:!0,autoComplete:"username",disabled:f})]})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-text-muted mb-2",children:"Password "}),b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:b.jsx(Za,{className:"w-5 h-5 text-text-muted"})}),b.jsx("input",{id:"password",type:a?"text":"password",value:t,onChange:T=>i(T.target.value),className:"w-full pl-10 pr-12 py-3 bg-white border border-white/10 rounded-lg text-black placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition",placeholder:"Enter your password",required:!0,autoComplete:"current-password",disabled:f}),b.jsx("button",{type:"button",onClick:()=>u(!a),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-text-muted hover:text-text transition",disabled:f,children:a?b.jsx(X3,{className:"w-5 h-5"}):b.jsx(eu,{className:"w-5 h-5"})})]})]}),b.jsx("button",{type:"submit",disabled:f,className:"w-full py-3 px-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2",children:f?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}),b.jsx("span",{children:"Signing in..."})]}):b.jsxs(b.Fragment,{children:[b.jsx(Za,{className:"w-5 h-5"}),b.jsx("span",{children:"Sign In"})]})})]})})]}),b.jsx("p",{className:"text-center text-white/60 text-sm mt-6",children:" 2025 CineStream Pro. All rights reserved."}),b.jsxs("span",{className:"flex justify-center text-center text-white/60 text-sm mt-6",children:["Designed and Developed by",b.jsx("span",{className:"text-[#F5B027] ml-2",children:" K Mahesh Kumar Achary "})]})]})]})},Dk=()=>{const{user:s,logout:e}=ar(),[t,i]=ie.useState([]),[a,u]=ie.useState(!0),[l,c]=ie.useState(""),[f,h]=ie.useState(!1),[m,g]=ie.useState(!1),[E,T]=ie.useState(null),[v,S]=ie.useState(null),[A,I]=ie.useState(""),[R,N]=ie.useState(""),[D,k]=ie.useState("user"),[G,U]=ie.useState("");ie.useEffect(()=>{H()},[]);const H=async()=>{try{u(!0);const ne=await Fi.getAllUsers();ne.success&&i(ne.data.users)}catch{$("error","Failed to fetch users")}finally{u(!1)}},$=(ne,B)=>{S({type:ne,message:B}),setTimeout(()=>S(null),5e3)},F=async ne=>{var B,W;ne.preventDefault();try{(await Fi.createUser(A,R,D)).success&&($("success","User created successfully"),h(!1),I(""),N(""),k("user"),H())}catch(te){$("error",((W=(B=te.response)==null?void 0:B.data)==null?void 0:W.message)||"Failed to create user")}},ee=async ne=>{var B,W;if(confirm("Are you sure you want to delete this user?"))try{(await Fi.deleteUser(ne)).success&&($("success","User deleted successfully"),H())}catch(te){$("error",((W=(B=te.response)==null?void 0:B.data)==null?void 0:W.message)||"Failed to delete user")}},me=async(ne,B)=>{var W,te;try{(B?await Fi.unblockUser(ne):await Fi.blockUser(ne)).success&&($("success",B?"User unblocked":"User blocked"),H())}catch(J){$("error",((te=(W=J.response)==null?void 0:W.data)==null?void 0:te.message)||"Failed to update user")}},be=async ne=>{var B,W;if(ne.preventDefault(),!!E)try{(await Fi.resetPassword(E.id,G)).success&&($("success","Password reset successfully"),g(!1),U(""),T(null))}catch(te){$("error",((W=(B=te.response)==null?void 0:B.data)==null?void 0:W.message)||"Failed to reset password")}},Te=t.filter(ne=>ne.username.toLowerCase().includes(l.toLowerCase()));return b.jsxs("div",{className:"min-h-screen bg-background",children:[b.jsx("div",{className:"bg-surface/50 backdrop-blur-xl border-b border-white/10",children:b.jsx("div",{className:"w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-8 py-6",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsx("div",{className:"p-3 bg-primary rounded-xl",children:b.jsx(Fl,{className:"w-8 h-8 text-white"})}),b.jsxs("div",{children:[b.jsx("h1",{className:"text-3xl font-bold text-text",children:"Admin Dashboard"}),b.jsx("p",{className:"text-text-muted",children:"Manage users and system settings"})]})]}),b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsxs("div",{className:"text-right",children:[b.jsx("p",{className:"text-sm text-text-muted",children:"Logged in as"}),b.jsx("p",{className:"text-text font-semibold",children:s==null?void 0:s.username})]}),b.jsx("button",{onClick:e,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition",children:"Logout"})]})]})})}),v&&b.jsx("div",{className:"fixed top-6 right-6 z-50 max-w-md w-full animate-slide-in",children:b.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-xl shadow-2xl backdrop-blur-xl border border-white/10 ${v.type==="success"?"bg-surface/90 border-l-4 border-l-green-500":"bg-surface/90 border-l-4 border-l-red-500"}`,children:[b.jsx("div",{className:`p-2 rounded-full ${v.type==="success"?"bg-green-500/20":"bg-red-500/20"}`,children:v.type==="success"?b.jsx(jE,{className:`w-5 h-5 ${v.type==="success"?"text-green-500":"text-red-500"}`}):b.jsx(Ym,{className:"w-5 h-5 text-red-500"})}),b.jsxs("div",{className:"flex-1",children:[b.jsx("h4",{className:`font-semibold ${v.type==="success"?"text-green-400":"text-red-400"}`,children:v.type==="success"?"Success":"Error"}),b.jsx("p",{className:"text-text-muted text-sm",children:v.message})]}),b.jsx("button",{onClick:()=>S(null),className:"p-1 hover:bg-white/10 rounded-lg transition text-text-muted hover:text-text",children:b.jsx(iu,{className:"w-4 h-4"})})]})}),b.jsxs("div",{className:"w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[b.jsx("div",{className:"bg-surface/50 backdrop-blur-xl rounded-xl p-6 border border-white/10 hover:border-primary/50 transition duration-300",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-text-muted text-sm font-medium",children:"Total Users"}),b.jsx("p",{className:"text-3xl font-bold text-text mt-2",children:t.length})]}),b.jsx("div",{className:"p-3 bg-primary/20 rounded-xl",children:b.jsx(HE,{className:"w-8 h-8 text-primary"})})]})}),b.jsx("div",{className:"bg-surface/50 backdrop-blur-xl rounded-xl p-6 border border-white/10 hover:border-green-500/50 transition duration-300",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-text-muted text-sm font-medium",children:"Active Users"}),b.jsx("p",{className:"text-3xl font-bold text-text mt-2",children:t.filter(ne=>!ne.isBlocked).length})]}),b.jsx("div",{className:"p-3 bg-green-500/20 rounded-xl",children:b.jsx(jE,{className:"w-8 h-8 text-green-500"})})]})}),b.jsx("div",{className:"bg-surface/50 backdrop-blur-xl rounded-xl p-6 border border-white/10 hover:border-red-500/50 transition duration-300",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-text-muted text-sm font-medium",children:"Blocked Users"}),b.jsx("p",{className:"text-3xl font-bold text-text mt-2",children:t.filter(ne=>ne.isBlocked).length})]}),b.jsx("div",{className:"p-3 bg-red-500/20 rounded-xl",children:b.jsx(Za,{className:"w-8 h-8 text-red-500"})})]})})]}),b.jsx("div",{className:"bg-surface/50 backdrop-blur-xl rounded-xl p-6 border border-white/10 mb-6",children:b.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[b.jsxs("div",{className:"relative flex-1 w-full sm:max-w-md group",children:[b.jsx(bu,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-muted group-focus-within:text-primary transition-colors"}),b.jsx("input",{type:"text",value:l,onChange:ne=>c(ne.target.value),placeholder:"Search users...",className:"w-full pl-10 pr-4 py-3 bg-white border border-white/10 rounded-xl text-black placeholder-gray-500 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all"})]}),b.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-6 py-3 bg-primary hover:bg-blue-400 text-black font-bold rounded-xl transition transform hover:scale-105 shadow-lg shadow-primary/20",children:[b.jsx(W3,{className:"w-5 h-5"}),b.jsx("span",{children:"Add User"})]})]})}),b.jsx("div",{className:"bg-surface/50 backdrop-blur-xl rounded-xl border border-white/10 overflow-hidden shadow-xl",children:a?b.jsxs("div",{className:"p-20 text-center",children:[b.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"}),b.jsx("p",{className:"text-text-muted mt-4 animate-pulse",children:"Loading users..."})]}):Te.length===0?b.jsxs("div",{className:"p-20 text-center",children:[b.jsx("div",{className:"w-20 h-20 bg-surface rounded-full flex items-center justify-center mx-auto mb-6",children:b.jsx(HE,{className:"w-10 h-10 text-text-muted"})}),b.jsx("h3",{className:"text-xl font-semibold text-text mb-2",children:"No users found"}),b.jsx("p",{className:"text-text-muted",children:"Try adjusting your search query"})]}):b.jsx("div",{className:"overflow-x-auto",children:b.jsxs("table",{className:"w-full",children:[b.jsx("thead",{className:"bg-black/20",children:b.jsxs("tr",{children:[b.jsx("th",{className:"px-6 py-5 text-left text-xs font-semibold text-text-muted uppercase tracking-wider",children:"User"}),b.jsx("th",{className:"px-6 py-5 text-left text-xs font-semibold text-text-muted uppercase tracking-wider",children:"Role"}),b.jsx("th",{className:"px-6 py-5 text-left text-xs font-semibold text-text-muted uppercase tracking-wider",children:"Status"}),b.jsx("th",{className:"px-6 py-5 text-left text-xs font-semibold text-text-muted uppercase tracking-wider",children:"Created"}),b.jsx("th",{className:"px-6 py-5 text-right text-xs font-semibold text-text-muted uppercase tracking-wider",children:"Actions"})]})}),b.jsx("tbody",{className:"divide-y divide-white/5",children:Te.map(ne=>b.jsxs("tr",{className:"hover:bg-white/5 transition duration-200 group",children:[b.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary/20 to-purple-500/20 flex items-center justify-center border border-white/10 group-hover:border-primary/50 transition-colors",children:b.jsx(jl,{className:"w-5 h-5 text-primary"})}),b.jsxs("div",{children:[b.jsx("p",{className:"text-text font-medium",children:ne.username}),b.jsxs("p",{className:"text-text-muted text-xs",children:["ID: ",ne.id]})]})]})}),b.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:b.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${ne.role==="admin"?"bg-purple-500/10 text-purple-400 border-purple-500/20":"bg-blue-500/10 text-blue-400 border-blue-500/20"}`,children:ne.role})}),b.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:b.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold border ${ne.isBlocked?"bg-red-500/10 text-red-400 border-red-500/20":"bg-green-500/10 text-green-400 border-green-500/20"}`,children:ne.isBlocked?"Blocked":"Active"})}),b.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-text-muted text-sm",children:new Date(ne.createdAt).toLocaleDateString()}),b.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:b.jsxs("div",{className:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[b.jsx("button",{onClick:()=>me(ne.id,ne.isBlocked),disabled:ne.id===(s==null?void 0:s.id),className:`p-2 rounded-lg transition ${ne.isBlocked?"bg-green-500/10 hover:bg-green-500/20 text-green-400":"bg-red-500/10 hover:bg-red-500/20 text-red-400"} disabled:opacity-50 disabled:cursor-not-allowed`,title:ne.isBlocked?"Unblock":"Block",children:ne.isBlocked?b.jsx(Z3,{className:"w-4 h-4"}):b.jsx(Za,{className:"w-4 h-4"})}),b.jsx("button",{onClick:()=>{T(ne),g(!0)},className:"p-2 bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 rounded-lg transition",title:"Reset Password",children:b.jsx(J3,{className:"w-4 h-4"})}),b.jsx("button",{onClick:()=>ee(ne.id),disabled:ne.id===(s==null?void 0:s.id),className:"p-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete User",children:b.jsx(gd,{className:"w-4 h-4"})})]})})]},ne.id))})]})})})]}),f&&b.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in fade-in duration-200",children:b.jsxs("div",{className:"bg-surface border border-white/10 rounded-2xl max-w-md w-full shadow-2xl transform transition-all animate-in zoom-in-95 duration-200",children:[b.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10",children:[b.jsxs("div",{children:[b.jsx("h2",{className:"text-2xl font-bold text-text",children:"Add New User"}),b.jsx("p",{className:"text-text-muted text-sm mt-1",children:"Create a new account"})]}),b.jsx("button",{onClick:()=>h(!1),className:"p-2 hover:bg-white/10 rounded-lg transition text-text-muted hover:text-text",children:b.jsx(iu,{className:"w-5 h-5"})})]}),b.jsxs("form",{onSubmit:F,className:"p-6 space-y-5",children:[b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"Username"}),b.jsx("input",{type:"text",value:A,onChange:ne=>I(ne.target.value),className:"w-full px-4 py-3 bg-white border border-white/10 rounded-xl text-black placeholder-gray-500 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all",required:!0,minLength:3,maxLength:30,placeholder:"Enter username"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"Password"}),b.jsx("input",{type:"password",value:R,onChange:ne=>N(ne.target.value),className:"w-full px-4 py-3 bg-white border border-white/10 rounded-xl text-black placeholder-gray-500 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all",required:!0,minLength:8,placeholder:"Enter password"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"Role"}),b.jsxs("div",{className:"relative",children:[b.jsxs("select",{value:D,onChange:ne=>k(ne.target.value),className:"w-full px-4 py-3 bg-white border border-white/10 rounded-xl text-black focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none",children:[b.jsx("option",{value:"user",className:"bg-white text-black",children:"User"}),b.jsx("option",{value:"admin",className:"bg-white text-black",children:"Admin"})]}),b.jsx("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none text-text-muted",children:b.jsx(Fl,{className:"w-4 h-4"})})]})]}),b.jsxs("div",{className:"flex gap-3 pt-4",children:[b.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 px-4 py-3 bg-white/5 hover:bg-white/10 text-text font-medium rounded-xl transition",children:"Cancel"}),b.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 bg-primary hover:bg-blue-400 text-black font-bold rounded-xl transition transform hover:scale-[1.02]",children:"Create User"})]})]})]})}),m&&E&&b.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in fade-in duration-200",children:b.jsxs("div",{className:"bg-surface border border-white/10 rounded-2xl max-w-md w-full shadow-2xl transform transition-all animate-in zoom-in-95 duration-200",children:[b.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10",children:[b.jsxs("div",{children:[b.jsx("h2",{className:"text-2xl font-bold text-text",children:"Reset Password"}),b.jsx("p",{className:"text-text-muted text-sm mt-1",children:"Update user credentials"})]}),b.jsx("button",{onClick:()=>{g(!1),T(null),U("")},className:"p-2 hover:bg-white/10 rounded-lg transition text-text-muted hover:text-text",children:b.jsx(iu,{className:"w-5 h-5"})})]}),b.jsxs("form",{onSubmit:be,className:"p-6 space-y-5",children:[b.jsxs("div",{className:"p-4 bg-primary/10 rounded-xl border border-primary/20 flex items-center gap-3",children:[b.jsx("div",{className:"p-2 bg-primary/20 rounded-full",children:b.jsx(jl,{className:"w-5 h-5 text-primary"})}),b.jsxs("div",{children:[b.jsx("p",{className:"text-text-muted text-xs uppercase tracking-wider font-semibold",children:"Resetting for"}),b.jsx("p",{className:"text-text font-bold",children:E.username})]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"New Password"}),b.jsx("input",{type:"password",value:G,onChange:ne=>U(ne.target.value),className:"w-full px-4 py-3 bg-white border border-white/10 rounded-xl text-black placeholder-gray-500 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all",required:!0,minLength:8,placeholder:"Enter new password",autoFocus:!0})]}),b.jsxs("div",{className:"flex gap-3 pt-4",children:[b.jsx("button",{type:"button",onClick:()=>{g(!1),T(null),U("")},className:"flex-1 px-4 py-3 bg-white/5 hover:bg-white/10 text-text font-medium rounded-xl transition",children:"Cancel"}),b.jsx("button",{type:"submit",className:"flex-1 px-4 py-3 bg-primary hover:bg-blue-400 text-black font-bold rounded-xl transition transform hover:scale-[1.02]",children:"Reset Password"})]})]})]})}),b.jsx("style",{children:`
        @keyframes slide-in {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
        .animate-slide-in {
          animation: slide-in 0.3s ease-out;
        }
      `})]})},Ok=()=>b.jsx("footer",{className:"w-full py-6 sm:py-8 mt-auto bg-gradient-to-t from-black to-transparent backdrop-blur-sm",children:b.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:b.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 sm:gap-4 text-center",children:[b.jsx("div",{className:"flex flex-wrap items-center justify-center gap-1 sm:gap-2 text-gray-400 text-xs sm:text-sm md:text-base font-medium tracking-wide",children:b.jsx("span",{children:"Designed & Developed by"})}),b.jsx("h3",{className:"text-[19px] sm:text-2xl md:text-3xl lg:text-4xl font-bold bg-gradient-to-r from-primary via-purple-500 to-secondary bg-clip-text text-transparent animate-pulse font-signature tracking-wider px-4",children:"K Mahesh Kumar Achary"}),b.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-1 sm:gap-2 text-gray-400 text-xs sm:text-sm md:text-base font-medium tracking-wide",children:[b.jsx("p",{children:"Made In India With"}),b.jsx(rm,{className:"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0",color:"red",fill:"red"})]}),b.jsx("div",{className:"mt-2 sm:mt-4 pt-3 sm:pt-4 border-t border-white/10 w-full max-w-md",children:b.jsxs("p",{className:"text-gray-500 text-xs sm:text-sm",children:[" ",new Date().getFullYear()," CineStream Pro. All rights reserved."]})})]})})});class wk extends ie.Component{constructor(e){super(e),this.handleReload=()=>{window.location.reload()},this.handleGoHome=()=>{window.location.href="/"},this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,t){console.error("Uncaught error:",e,t),this.setState({errorInfo:t})}render(){return this.state.hasError?b.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:b.jsxs("div",{className:"max-w-md w-full bg-surface border border-white/10 rounded-2xl p-8 text-center shadow-2xl",children:[b.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-500/10 rounded-full mb-6",children:b.jsx(e_,{className:"w-8 h-8 text-red-500"})}),b.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Something went wrong"}),b.jsx("p",{className:"text-text-muted mb-6",children:"We apologize for the inconvenience. An unexpected error has occurred."}),!1,b.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[b.jsxs("button",{onClick:this.handleReload,className:"flex items-center justify-center gap-2 px-6 py-3 bg-primary hover:bg-primary/90 text-white rounded-lg transition-colors font-medium",children:[b.jsx(t_,{className:"w-4 h-4"}),"Reload Page"]}),b.jsxs("button",{onClick:this.handleGoHome,className:"flex items-center justify-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors font-medium",children:[b.jsx(s_,{className:"w-4 h-4"}),"Go Home"]})]})]})}):this.props.children}}const kk=()=>{const{user:s,unlock:e,logout:t}=ar(),[i,a]=ie.useState(""),[u,l]=ie.useState(""),[c,f]=ie.useState(!1),h=async m=>{m.preventDefault(),l(""),f(!0);try{await e(i)}catch(g){l(g.message||"Incorrect password")}finally{f(!1)}};return b.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-background/95 backdrop-blur-xl",children:b.jsxs("div",{className:"w-full max-w-md p-8 animate-in fade-in zoom-in duration-300",children:[b.jsxs("div",{className:"text-center mb-8",children:[b.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-primary/10 rounded-full mb-6 border border-primary/20",children:b.jsx(Za,{className:"w-10 h-10 text-primary"})}),b.jsx("h1",{className:"text-3xl font-bold text-text mb-2",children:"Welcome Back"}),b.jsxs("p",{className:"text-text-muted",children:["Enter your password to unlock ",b.jsx("span",{className:"text-primary font-semibold",children:s==null?void 0:s.username})]})]}),b.jsxs("form",{onSubmit:h,className:"space-y-6",children:[u&&b.jsxs("div",{className:"bg-red-500/10 border border-red-500/50 rounded-lg p-3 flex items-center gap-3 text-red-400 text-sm animate-shake",children:[b.jsx(Ym,{className:"w-4 h-4 flex-shrink-0"}),u]}),b.jsx("div",{className:"space-y-2",children:b.jsx("input",{type:"password",value:i,onChange:m=>a(m.target.value),placeholder:"Enter your password",className:"w-full px-4 py-3 bg-surface border border-white/10 rounded-xl text-text placeholder-text-muted focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all text-center tracking-widest",autoFocus:!0,required:!0})}),b.jsx("button",{type:"submit",disabled:c,className:"w-full py-3 px-4 bg-primary hover:bg-blue-400 text-black font-bold rounded-xl transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:c?b.jsx("div",{className:"w-5 h-5 border-2 border-black/30 border-t-black rounded-full animate-spin"}):b.jsxs(b.Fragment,{children:[b.jsx("span",{children:"Unlock Session"}),b.jsx(i_,{className:"w-5 h-5"})]})})]}),b.jsx("div",{className:"mt-8 text-center",children:b.jsxs("button",{onClick:t,className:"text-text-muted hover:text-red-400 text-sm flex items-center justify-center gap-2 mx-auto transition-colors",children:[b.jsx(nm,{className:"w-4 h-4"}),b.jsx("span",{children:"Not you? Log out"})]})})]})})},Mk=new M_({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*30,retry:1,refetchOnWindowFocus:!1}}}),Ms=({children:s})=>b.jsxs("div",{className:"min-h-screen flex flex-col",children:[b.jsx($_,{}),b.jsx("main",{className:"flex-grow",children:s}),b.jsx(Ok,{})]}),Pk=()=>{const{isLocked:s,isAuthenticated:e}=ar();return e&&s?b.jsx(kk,{}):b.jsxs(G3,{children:[b.jsx(cs,{path:"/login",element:b.jsx(Ck,{})}),b.jsx(cs,{path:"/",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(z_,{})})})}),b.jsx(cs,{path:"/movies",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(bD,{})})})}),b.jsx(cs,{path:"/webseries",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(ED,{})})})}),b.jsx(cs,{path:"/livetv",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(Rk,{})})})}),b.jsx(cs,{path:"/favorites",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(xD,{})})})}),b.jsx(cs,{path:"/history",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(TD,{})})})}),b.jsx(cs,{path:"/search",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(pD,{})})})}),b.jsx(cs,{path:"/genres",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(Px,{})})})}),b.jsx(cs,{path:"/genres/:genreId",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(Px,{})})})}),b.jsx(cs,{path:"/movies/:id",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(tx,{type:"movie"})})})}),b.jsx(cs,{path:"/webseries/:id",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(tx,{type:"tv"})})})}),b.jsx(cs,{path:"/watch/:movieId",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(mD,{})})})}),b.jsx(cs,{path:"/actor/:actorId",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(Nk,{})})})}),b.jsx(cs,{path:"/adult/*",element:b.jsx(Ds,{children:b.jsx(Ms,{children:b.jsx(gD,{})})})}),b.jsx(cs,{path:"/admin-dashboard",element:b.jsx(G_,{children:b.jsx(Dk,{})})}),b.jsx(cs,{path:"*",element:b.jsx("div",{className:"p-20 text-center text-white",children:"404 - Page Not Found"})})]})},Uk=()=>(ie.useEffect(()=>{H2()},[]),b.jsx(wk,{children:b.jsx(U_,{client:Mk,children:b.jsx($3,{children:b.jsx(F_,{children:b.jsx(j_,{children:b.jsx(Pk,{})})})})})})),TS=document.getElementById("root");if(!TS)throw new Error("Failed to find the root element");const Bk=o_.createRoot(TS);document.addEventListener("contextmenu",s=>s.preventDefault());function im(s,e){return s.ctrlKey&&s.shiftKey&&s.keyCode===e.charCodeAt(0)}document.onkeydown=s=>{if(event.keyCode===123||im(s,"I")||im(s,"J")||im(s,"C")||s.ctrlKey&&s.keyCode===85)return!1};Bk.render(b.jsx(V3.StrictMode,{children:b.jsx(Uk,{})}));
